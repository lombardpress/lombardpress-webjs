(this["webpackJsonplombardpress-web.js"]=this["webpackJsonplombardpress-web.js"]||[]).push([[0],{279:function(e,t,a){e.exports=a(645)},642:function(e,t,a){},644:function(e,t,a){},645:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(89),o=a.n(s),i=a(9),l=a(26),c=a(17),u=a(264),p=a(20),d="https://sparql.scta.info/ds/query",h=a(261);var m=function(e){var t=Object(h.a)().t;return console.log("home props",e),r.a.createElement("div",{className:"Home"},r.a.createElement(c.a,{id:"lbp-home",fluid:!0},r.a.createElement(c.a,null,r.a.createElement(u.a,{id:"lbp-jumbo"},r.a.createElement("h1",null,t("Title")),r.a.createElement("p",null,t("Subtitle")),r.a.createElement(p.a,null,r.a.createElement(i.b,{className:"nav-link",to:"/text?resourceid=http://scta.info/resource/scta",style:{color:"black"}},t("Enter")))))))},f=a(6),g=a(30),v=a(16),T=a.n(v),E=a(8),y=a.n(E);function b(e){return new Promise((function(t){var a=new XMLHttpRequest;if(a.open("GET",e),"undefined"===typeof XSLTProcessor)try{a.responseType="msxml-document"}catch(n){console.log("error",n)}a.onload=function(){t(this.responseXML)},a.send()}))}function w(e,t){return new Promise((function(a,n){Promise.all([b(e),b(t)]).then((function(e){var t=new XSLTProcessor;if(t.importStylesheet(e[1]),e[0]){var r=t.transformToFragment(e[0],document);a(r)}else{var s=new Error("xml document could not be retrieved");n(s)}}))}))}function x(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}function C(e){return T.a.get(d,{params:{query:e,output:"json"}})}function O(e,t){var a=y()("#"+e);t&&(a.addClass("highlightNone"),y()(".paragraphnumber").removeClass("highlight2"),y()(".plaoulparagraph").removeClass("highlightNone"),y()(".lbp-quote").removeClass("highlightNone"),y()(".lbp-quote").removeClass("highlight"),y()(".lbp-ref").removeClass("highlightNone"),y()(".lbp-ref").removeClass("highlight"),y()(".plaoulparagraph").removeClass("highlight"),a.children(".paragraphnumber").addClass("highlight2"),a.addClass("highlight"),a[0]&&(a[0].className.includes("lbp-quote")||a[0].className.includes("lbp-ref")||setTimeout((function(){y()(".lbp-ref").removeClass("highlight"),y()(".lbp-quote").removeClass("highlight"),y()(".plaoulparagraph").removeClass("highlight"),a.addClass("highlightNone")}),2e3))),a.length>0&&y()("html, body").stop().animate({scrollTop:a.offset().top-100},1e3)}function k(e){var t=e.parentElement.className;return t.includes("paragraphnumber")||t.includes("lbp-line-number")||t.includes("appnote")||t.includes("paragraphnumber")||t.includes("footnote")||t.includes("lbp-reg")||t.includes("lbp-folionumber")||t.includes("js-show-folio-image")?NodeFilter.FILTER_REJECT:e.nodeValue?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}function S(e){return e=(e=(e=e.replace(/^[ ]+|[ ]+$/g,"")).replace(/[.,/#!$%^&*;:{}=\-_`~()"/\u00B6/|/\u204B/]/g,"")).replace(/\s+/gi," ")}function I(e,t){for(var a=0,n=0;n<=t;n++)e[n]===e[t]&&a++;return a}function R(e,t,a,n){var r=e.split(t,a).join(t);return n?r.length:r.length+t.length}function L(e,t,a){console.log(e,t,a),function(e,t,a){var n=e.replace("https://github.com","https://raw.githubusercontent.com").replace("/raw/","/");return T.a.get(n).then((function(e){var n='xml:id="'+a+'"',r=e.data.split(n),s=r[0].split("\n").length,o=r[1],i=new RegExp("\\W".concat(t,"\\W"),"gi");return s+o.split(i)[0].split("\n").length-1}))}(e,t,a).then((function(t){var a=e.replace("raw","edit")+"#L"+t;window.open(a,"gitHubEditWindow","height=750,width=750")}))}function j(e,t){var a=t.split("-")[0],n=t.split("-")[1];return e.split(" ").filter(Boolean).slice(a-1,n).join(" ")}var F=a(62);var D=function(){return r.a.createElement("div",{className:"spinner",style:{padding:"20px 5px"}},r.a.createElement(F.a,{animation:"grow",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")),r.a.createElement(F.a,{animation:"grow",variant:"primary"}),r.a.createElement(F.a,{animation:"grow",variant:"secondary"}),r.a.createElement(F.a,{animation:"grow",variant:"success"}),r.a.createElement(F.a,{animation:"grow",variant:"danger"}),r.a.createElement(F.a,{animation:"grow",variant:"warning"}),r.a.createElement(F.a,{animation:"grow",variant:"info"}))},A=a(21),N=function(e,t){if(t)switch(t.type){case"START_EXPRESSIONS_FETCH":return{};case"COMPLETE_EXPRESSIONS_FETCH":return Object(A.a)(t.expressions);default:return e}},P=function(e,t){var a="";e.searchWorkGroup&&(a=["<"+e.searchWorkGroup+"> <http://scta.info/property/hasExpression> ?expression ."].join(" "));var n="";e.expressionAuthorType&&(n=["?expression <http://www.loc.gov/loc.terms/relators/AUT> ?expressionAuthor . ","?expressionAuthor <http://scta.info/property/personType> <http://scta.info/resource/"+e.expressionAuthorType+"> ."].join(""));var r="";e.searchAuthor&&(r=["?expression <http://www.loc.gov/loc.terms/relators/AUT> <"+e.searchAuthor+"> ."].join(""));var s=["SELECT ?type ?expression ?expressionShortId ?expressionTitle ?author ?authorTitle ?workGroup ?workGroupTitle","WHERE { ","?expression a <http://scta.info/resource/expression> .","?expression a ?type .","?expression <http://scta.info/property/level> '1' . ",n,a,r,"?expression <http://scta.info/property/shortId> ?expressionShortId .","?expression <http://scta.info/property/shortId> ?expressionShortId .","?expression <http://purl.org/dc/elements/1.1/title> ?expressionTitle .","?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","?expression <http://purl.org/dc/terms/isPartOf> ?workGroup .","?workGroup <http://purl.org/dc/elements/1.1/title> ?workGroupTitle .","}","ORDER BY ?expressionTitle"].join("");t({type:"START_EXPRESSIONS_FETCH"}),T.a.get(d,{params:{query:s,output:"json"}}).then((function(e){var a=e.data.results.bindings.map((function(e){return{expression:e.expression.value,expressionShortId:e.expressionShortId?e.expressionShortId.value:"",expressionTitle:e.expressionTitle.value,workGroup:e.workGroup?e.workGroup.value:"",workGroupTitle:e.workGroupTitle?e.workGroupTitle.value:"",author:e.author?e.author.value:"",authorTitle:e.author?e.authorTitle.value:"",type:e.type.value}}));t({type:"COMPLETE_EXPRESSIONS_FETCH",expressions:a})}))},M=function(e,t){if(t)switch(t.type){case"START_AUTHORS_FETCH":return{};case"COMPLETE_AUTHORS_FETCH":return Object(A.a)(t.authors);default:return e}},_=function(e,t){var a="";e.searchWorkGroup&&(a="<"+e.searchWorkGroup+"> <http://scta.info/property/hasExpression> ?resource .");var n=["SELECT DISTINCT ?author ?authorTitle ?authorShortId ","WHERE { ","?author a <http://scta.info/resource/person> .","?resource a <http://scta.info/resource/expression> .","?resource <http://scta.info/property/level> '1' .",a,"?resource <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://scta.info/property/shortId> ?authorShortId .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","ORDER BY ?authorTitle"].join("");t({type:"START_AUTHORS_FETCH"}),T.a.get(d,{params:{query:n,output:"json"}}).then((function(e){var a=e.data.results.bindings.map((function(e){return{author:e.author.value,authorShortId:e.authorShortId.value,authorTitle:e.authorTitle.value}}));t(function(e){return{type:"COMPLETE_AUTHORS_FETCH",authors:e}}(a))}))},B=function(e,t){if(t)switch(t.type){case"START_WORK_GROUPS_LIST_FETCH":return{};case"COMPLETE_WORK_GROUPS_LIST_FETCH":return Object(A.a)(t.workGroups);default:return e}},U=function(e,t){var a="";e.searchAuthor&&(a=["?workGroup <http://scta.info/property/hasExpression> ?expression .","?expression <http://www.loc.gov/loc.terms/relators/AUT> <"+e.searchAuthor+"> ."].join(""));var n=["SELECT DISTINCT ?workGroup ?workGroupTitle ","WHERE { ","?workGroup a <http://scta.info/resource/workGroup> .","?workGroup <http://purl.org/dc/elements/1.1/title> ?workGroupTitle .",a,"}","ORDER BY ?workGroupTitle"].join(" ");t({type:"START_WORK_GROUPS_LIST_FETCH"}),T.a.get(d,{params:{query:n,output:"json"}}).then((function(e){var a=e.data.results.bindings.map((function(e){return{workGroup:e.workGroup.value,workGroupTitle:e.workGroupTitle.value}}));t(function(e){return{type:"COMPLETE_WORK_GROUPS_LIST_FETCH",workGroups:e}}(a))}))},W=function(e,t){if(t)switch(t.type){case"START_EXPRESSION_TYPES_LIST_FETCH":return{};case"COMPLETE_EXPRESSION_TYPES_LIST_FETCH":return Object(A.a)(t.expressionTypes);default:return e}},H=a(23),z=function(e){var t=Object(n.useState)(e.searchType?e.searchType:"text"),a=Object(f.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)(e.searchTerm),l=Object(f.a)(i,2),c=l[0],u=l[1],h=Object(n.useState)(e.searchAuthor),m=Object(f.a)(h,2),v=m[0],E=m[1],y=Object(n.useState)(e.searchEid),b=Object(f.a)(y,2),w=b[0],x=b[1],C=Object(n.useState)(e.searchEType),O=Object(f.a)(C,2),k=O[0],S=O[1],I=Object(n.useState)(e.searchWorkGroup),R=Object(f.a)(I,2),L=R[0],j=R[1],F=Object(n.useState)(""),D=Object(f.a)(F,2),A=D[0],z=D[1],q=Object(n.useReducer)(W,[]),G=Object(f.a)(q,2),V=G[0],X=G[1],Y=Object(n.useReducer)(N,[]),Q=Object(f.a)(Y,2),Z=Q[0],J=Q[1],K=Object(n.useReducer)(M,[]),$=Object(f.a)(K,2),ee=$[0],te=$[1],ae=Object(n.useReducer)(B,[]),ne=Object(f.a)(ae,2),re=ne[0],se=ne[1],oe={searchTerm:c,searchAuthor:v,searchEid:w,searchWorkGroup:L,searchType:s,searchEType:k,resultsFilter:A},ie=Object(n.useState)(!1),le=Object(f.a)(ie,2),ce=le[0],ue=le[1],pe=["light/shadow","physical objects","concrete elements","letters","text","woodcut","integrated in the layout","3d and perspective","plasticity","tree","related to an experiment","specimen","material","polarity","magnetic force","scientific","analogy, allegory and symbols","practice","geometrical forms","abstract elements","inclination","arrows","knife","hand","persons or human body"];pe.sort();return Object(n.useEffect)((function(){o(e.searchType?e.searchType:"text")}),[e.searchType]),Object(n.useEffect)((function(){E(e.searchAuthor)}),[e.searchAuthor]),Object(n.useEffect)((function(){x(e.searchEid)}),[e.searchEid]),Object(n.useEffect)((function(){S(e.searchEType)}),[e.searchEType]),Object(n.useEffect)((function(){j(e.searchWorkGroup)}),[e.searchWorkGroup]),Object(n.useEffect)((function(){u(e.searchTerm)}),[e.searchTerm]),Object(n.useEffect)((function(){e.handleSetSearchParameters(oe)}),[c,v,w,L,s,k,A]),Object(n.useEffect)((function(){J(P(oe,J)),te(_(oe,te)),se(U(oe,se)),X(function(e,t){var a=["SELECT DISTINCT ?expressionType ?expressionTypeTitle ","WHERE { ","?expressionType a <http://scta.info/resource/expressionType> .","?expressionType <http://purl.org/dc/elements/1.1/title> ?expressionTypeTitle .","}","ORDER BY ?expressionTypeTitle"].join(" ");t({type:"START_EXPRESSION_TYPES_LIST_FETCH"}),T.a.get(d,{params:{query:a,output:"json"}}).then((function(e){var a=e.data.results.bindings.map((function(e){return{expressionType:e.expressionType.value,expressionTypeTitle:e.expressionTypeTitle.value}}));t(function(e){return{type:"COMPLETE_EXPRESSION_TYPES_LIST_FETCH",expressionTypes:e}}(a))}))}(0,X))}),[]),Object(n.useEffect)((function(){J(P(oe,J)),se(U(oe,se))}),[v]),Object(n.useEffect)((function(){J(P(oe,J)),te(_(oe,te))}),[L]),r.a.createElement("div",null,r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Search Term")),r.a.createElement(g.a.Control,{as:"input",type:"text",placeholder:"search term",onChange:function(e){return u(e.target.value)},value:oe.searchTerm})),"figure"===s&&r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Search by Figure Tag")),r.a.createElement(g.a.Control,{as:"select",onChange:function(e){u(e.target.value)},value:oe.searchTerm},r.a.createElement("option",{value:""}),pe.map((function(e){return r.a.createElement("option",{value:"'"+e+"'"},e)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Filter Results")),r.a.createElement(g.a.Control,{as:"input",type:"secondary results filter",placeholder:"secondary results filter",onChange:function(e){return t=e.target.value,void z(t);var t},value:A})),ce&&r.a.createElement("div",null,r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Search Type")),r.a.createElement(g.a.Control,{as:"select",onChange:function(e){o(e.target.value)},value:oe.searchType},r.a.createElement("option",{value:"questionTitles"},"Questions Titles"),r.a.createElement("option",{value:"text"},"Text"),r.a.createElement("option",{value:"figure"},"Figure"))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Work Group")),r.a.createElement(g.a.Control,{as:"select",onChange:function(e){j(e.target.value)},value:oe.searchWorkGroup},r.a.createElement("option",{value:""},"All"),re&&re.map((function(e,t){return r.a.createElement("option",{key:e.workGroup+"-"+t,value:e.workGroup},e.workGroupTitle)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Expression Type")),r.a.createElement(g.a.Control,{as:"select",onChange:function(e){S(e.target.value)},value:oe.searchEType},r.a.createElement("option",{value:""},"All"),V&&V.map((function(e,t){return r.a.createElement("option",{key:e.expressionType+"-"+t,value:e.expressionType},e.expressionTypeTitle)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Author")),r.a.createElement(g.a.Control,{as:"select",onChange:function(e){E(e.target.value)},value:oe.searchAuthor},r.a.createElement("option",{value:""},"All"),ee&&ee.map((function(e,t){return r.a.createElement("option",{key:e.author+"-"+t,value:e.author},e.authorTitle)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Text")),r.a.createElement(g.a.Control,{as:"select",onChange:function(e){x(e.target.value)},value:oe.searchEid},r.a.createElement("option",{value:""},"All"),Z&&Z.map((function(e,t){return r.a.createElement("option",{key:e.expression+"-"+t,value:e.expression},e.authorTitle,": ",e.expressionTitle)}))))),r.a.createElement(H.a.Prepend,{size:"sm",className:"mb-2"},e.children,e.showAdvancedParameters&&r.a.createElement(p.a,{className:"btn-sm",onClick:function(){ue(!ce)}},ce?"Hide":"Show"," More Filter Options")))};function q(e,t,a,n,r,s,o){var i=a&&a.split("/resource/")[1],l=t&&t.split("/resource/")[1],c=r&&r.split("/resource/")[1],u=n&&n.split("/resource/")[1],p=[];l&&p.push("eid="+l),c&&p.push("etid="+c),u&&p.push("aid="+u),i&&p.push("wgid="+i),s&&p.push("searchType="+s),o&&p.push("offset="+o);var d="https://exist2.scta.info/exist/apps/scta-app/jsonsearch/json-search-text.xq"+("?query="+e+"&"+p.join("&"));return T.a.get(d)}function G(e,t){if(e&&0!==e.length){if(e.length>0){var a=e.map((function(e,a){var n=e.previous+" <span class='highlight'>"+e.hit+"</span> "+e.next,s=e.start+"-"+e.end,o=t["http://scta.info/resource/"+e.pid]?t["http://scta.info/resource/"+e.pid].longTitle:"",l=t["http://scta.info/resource/"+e.pid]?t["http://scta.info/resource/"+e.pid].authorTitle:"";return r.a.createElement("div",{key:a},r.a.createElement("p",null,r.a.createElement(i.b,{to:"/text?resourceid=http://scta.info/resource/"+e.pid+"@"+s},l+", "+o+" ("+e.pid+"@"+s+")")),r.a.createElement("p",{dangerouslySetInnerHTML:{__html:n}}))}));return r.a.createElement("div",null,a)}return r.a.createElement("div",null,r.a.createElement("p",null,"No results"))}return r.a.createElement("div",null,r.a.createElement("p",null,"No results found"))}function V(e,t){if(e.length>0){var a=e.map((function(e,a){return r.a.createElement("div",{key:e.resource.value+"-"+a},r.a.createElement("p",null,r.a.createElement(i.b,{to:"/text?resourceid="+e.author.value},e.authorTitle.value),": ",r.a.createElement(i.b,{to:"/text?resourceid="+e.resource.value},e.longTitle.value)),r.a.createElement("p",null,e.qtitle.value.toLowerCase().replace(t.searchTerm.toLowerCase(),t.searchTerm.toUpperCase())))}));return r.a.createElement("div",null,r.a.createElement("p",null,a.length+" results"),a)}return r.a.createElement("div",null,r.a.createElement("p",null,"No results"))}var X=function(e){var t=Object(n.useState)({}),a=Object(f.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)([]),u=Object(f.a)(l,2),d=u[0],h=u[1],m=Object(n.useState)([]),v=Object(f.a)(m,2),T=v[0],E=v[1],y=Object(n.useState)(),b=Object(f.a)(y,2),w=b[0],x=b[1],O=Object(n.useState)(1),k=Object(f.a)(O,2),S=k[0],I=k[1],R=Object(n.useState)(!0),L=Object(f.a)(R,2),j=L[0],F=L[1];Object(n.useEffect)((function(){"questionTitles"===s.searchType&&V(P(T,s.resultsFilter),s),"figure"===s.searchType?V(P(d,s.resultsFilter),s.resultsFilter):"text"===s.searchType&&G(N(d,s.resultsFilter),w)}),[s.resultsFilter]),Object(n.useEffect)((function(){"fetching"!==d&&C(function(e){if(e)return["SELECT DISTINCT ?id ?longTitle ?author ?authorTitle ","{","VALUES ?id {"+e.map((function(e){return"<http://scta.info/resource/"+e.pid+">"})).join(" ")+"}","?id <http://scta.info/property/longTitle> ?longTitle .","OPTIONAL {","?id <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .","?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","}"].join("")}(d)).then((function(e){x(function(e){var t={};return e.forEach((function(e){t[e.id.value]={longTitle:e.longTitle.value,author:e.author&&e.author.value,authorTitle:e.authorTitle&&e.authorTitle.value}})),t}(e.data.results.bindings))}))}),[d]),Object(n.useEffect)((function(){h([])}),[s.searchType]),Object(n.useEffect)((function(){if(s.searchEid||s.searchAuthor||s.searchWorkGroup||s.searchEType){var e=q(s.searchTerm,s.searchEid,s.searchWorkGroup,s.searchAuthor,s.searchEType,s.searchType,S);h("fetching"),e.then((function(e){if(e.data.results)if(Array.isArray(e.data.results)){h(e.data.results);var t="true"===e.data.results[0].moreResults;F(t)}else{console.log("results when null",d),h([e.data.results]);var a="true"===e.data.results[0].moreResults;F(a)}else h([])}))}}),[S]);var A=function(e){if(e.preventDefault(),F(!0),I(1),s.searchTerm){if("text"===s.searchType||"figure"===s.searchType)h("fetching"),E([]),(s.searchEid||s.searchAuthor||s.searchWorkGroup||s.searchEType)&&q(s.searchTerm,s.searchEid,s.searchWorkGroup,s.searchAuthor,s.searchEType,s.searchType,S).then((function(e){if(e.data.results)if(Array.isArray(e.data.results)){h(e.data.results);var t="true"===e.data.results[0].moreResults;F(t)}else{h([e.data.results]);var a="true"===e.data.results.moreResults;F(a)}else h([])}));else if("questionTitles"===s.searchType){var t=C(function(e){var t=e.searchTerm,a="";e.searchWorkGroup&&(a=["BIND(<"+e.searchWorkGroup+"> AS ?workGroup) .","?workGroup <http://scta.info/property/hasExpression> ?topLevel ."].join(" "));var n="";e.searchEType&&(n=["BIND(<"+e.searchEType+"> AS ?expressionType) .","{","?resource <http://scta.info/property/expressionType> ?expressionType .","}","UNION","{","?resource <http://scta.info/property/isMemberOf> ?ancestor .","?ancestor <http://scta.info/property/expressionType> ?expressionType .","}"].join(" "));var r="";e.searchAuthor&&(r="BIND(<"+e.searchAuthor+"> AS ?author).");var s="";return e.searchEid&&(s="BIND(<"+e.searchEid+"> AS ?topLevel)."),["SELECT ?resource ?qtitle ?resourceTitle ?structureType ?longTitle ?author ?authorTitle","WHERE","{","?resource <http://scta.info/property/questionTitle> ?qtitle  .","?resource <http://purl.org/dc/elements/1.1/title> ?resourceTitle .","?resource <http://scta.info/property/structureType> ?structureType .","?resource <http://scta.info/property/longTitle> ?longTitle .",n,s,"?resource <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .",r,"?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .",a,"FILTER (REGEX(STR(?qtitle), '"+t+"', 'i')) .","}"].join(" ")}(s));E("fetching"),h([]),t.then((function(e){E(e.data.results.bindings)}))}}else h([])},N=function(e,t){var a=[];if(e&&0!==e.length){if(e.length>0)e.forEach((function(e){e.previous&&e.hit&&e.next&&([e.previous.toLowerCase(),e.hit.toLowerCase(),e.next.toLowerCase()].join(" ").includes(t.toLowerCase())&&a.push(e))}));else if(e){var n=e;if(n.previous&&n.hit&&n.next){var r=[n.previous.toLowerCase(),n.hit.toLowerCase(),n.next.toLowerCase()].join(" ");a=r.includes(t.toLowerCase())?e:""}}}else a=[];return a},P=function(e,t){var a=[];return e&&0!==e.length?e.length>0&&e.forEach((function(e){e.qtitle&&e.qtitle.value.toLowerCase().includes(t.toLowerCase())&&a.push(e)})):a=[],a};return r.a.createElement(c.a,{className:e.hidden?"hidden":"showing"},r.a.createElement(g.a,{onSubmit:A},r.a.createElement(z,{handleSetSearchParameters:function(e){o(e)},searchAuthor:e.searchAuthor,searchEid:e.searchEid,searchEType:e.searchEType,searchWorkGroup:e.searchWorkGroup,showAdvancedParameters:e.showAdvancedParameters,showLabels:e.showLabels,searchType:e.searchType,searchTerm:e.searchTerm},e.showSubmit&&r.a.createElement(p.a,{onClick:A,className:"btn-sm",style:{marginRight:"5px"}},"Submit"))),d&&d.length>0&&r.a.createElement("p",null,1!==S&&r.a.createElement("span",{onClick:function(){I(S-20)}},"Show Previous"),r.a.createElement("span",null," | "),!0===j&&r.a.createElement("span",{onClick:function(){I(S+20)}},"Show More")),function(e){return"fetching"===e||"fetching"===T?r.a.createElement(D,null):"questionTitles"===s.searchType?V(P(T,s.resultsFilter),s):"figure"===s.searchType?function(e,t){if(e&&0!==e.length){if(e.length>0){console.log("results",e);var a=e.map((function(e,a){var n=e.imgurl,s=t["http://scta.info/resource/"+e.pid]?t["http://scta.info/resource/"+e.pid].longTitle:"",o=t["http://scta.info/resource/"+e.pid]?t["http://scta.info/resource/"+e.pid].authorTitle:"";return r.a.createElement("div",{key:a,className:"figure-tile"},r.a.createElement(i.b,{to:"/text?resourceid=http://scta.info/resource/"+e.pid},r.a.createElement("span",{className:"image-description"},o+", "+s+" ("+e.pid+")"),r.a.createElement("img",{src:n,alt:"figure"})))}));return r.a.createElement("div",{className:"figure-grid"},a)}return r.a.createElement("div",null,r.a.createElement("p",null,"No results"))}return r.a.createElement("div",null,r.a.createElement("p",null,"No results found"))}(e,w):"text"===s.searchType?G(N(e,s.resultsFilter),w):void 0}(d))};X.defaultProps={showLabels:!0,showAdvancedParameters:!0,searchAuthor:"",searchEid:"",showSubmit:!0};var Y=a(11),Q=a(12),Z=a(3),J=a(14),K=a(13),$=a(125),ee=a.n($),te=a(267),ae=a(29),ne=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).getPdf=n.getPdf.bind(Object(Z.a)(n)),n.state={status:"",pdf:""},n}return Object(Q.a)(a,[{key:"getPdf",value:function(e){var t=this;T.a.get("https://print.lombardpress.org/api/v1/resource?url="+e).then((function(e){if(console.log(e),e.data.url){console.log("first condition passed",e.data.url);var a=e.data.url;t.setState({pdf:"https://print.lombardpress.org/api/v1/cache/"+a})}else t.setState({status:e.data.Status+"Please check back in a few minutes",pdf:""})}))}},{key:"componentDidMount",value:function(){var e=this.props.url;this.getPdf(e)}},{key:"componentDidUpdate",value:function(e){var t=this.props.url;t!==e.url&&this.getPdf(t)}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100%",height:"77vh",margin:"auto"}},this.state.pdf?r.a.createElement("object",{data:this.state.pdf,type:"application/pdf",width:"100%",height:"100%"},"alt : ",r.a.createElement("a",{href:this.state.pdf},this.state.pdf)):r.a.createElement("p",null,this.state.status))}}]),a}(r.a.Component),re=a(5);function se(e){return["SELECT DISTINCT ?title ?structureType ?cmanifestation ?cmanifestationTitle ?manifestation ?manifestationTitle ?ctranscription ?manifestationCTranscription ?manifestationCTranscriptionDoc ?cdoc ?cxml ?expressionShortId ?longTitle ?topLevelExpression ?next ?previous ?inbox ?author ?authorTitle ?parent ","WHERE { ","<"+e+"> <http://purl.org/dc/elements/1.1/title> ?title .","<"+e+"> <http://scta.info/property/structureType> ?structureType .","<"+e+"> <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation .","?cmanifestation <http://purl.org/dc/elements/1.1/title> ?cmanifestationTitle .","<"+e+"> <http://scta.info/property/hasManifestation> ?manifestation .","?manifestation <http://purl.org/dc/elements/1.1/title> ?manifestationTitle .","OPTIONAL {","?manifestation <http://scta.info/property/hasCanonicalTranscription> ?manifestationCTranscription .","?manifestationCTranscription <http://scta.info/property/hasDocument> ?manifestationCTranscriptionDoc .","?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .","?ctranscription <http://scta.info/property/hasDocument> ?cdoc . ","?ctranscription <http://scta.info/property/hasXML> ?cxml . ","}","<"+e+"> <http://scta.info/property/shortId> ?expressionShortId .","{","<"+e+"> <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .","}","UNION","{","<"+e+"> <http://scta.info/property/level> '1' .","BIND(<"+e+"> AS ?topLevelExpression) .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/longTitle> ?longTitle .","}","OPTIONAL {","?topLevelExpression <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/next> ?next .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/previous> ?previous .","}","OPTIONAL {","<"+e+"> <http://purl.org/dc/terms/isPartOf> ?parent .","}","<"+e+"> <http://www.w3.org/ns/ldp#inbox> ?inbox . ","}","ORDER BY ?title"].join("")}function oe(e){return["SELECT DISTINCT ?title ?description ?part ?partTitle ?partQuestionTitle ?partType ?partLevel ","WHERE { ","<"+e+"> <http://purl.org/dc/elements/1.1/title> ?title .","<"+e+"> <http://purl.org/dc/elements/1.1/description> ?description .","<"+e+"> <http://purl.org/dc/terms/hasPart> ?part .","?part <http://purl.org/dc/elements/1.1/title> ?partTitle .","?part <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?partType . ","OPTIONAL {","?part <http://scta.info/property/questionTitle> ?partQuestionTitle .","}","OPTIONAL {","?part <http://scta.info/property/level> ?partLevel .","}","OPTIONAL {","?part <http://scta.info/property/totalOrderNumber> ?totalOrderNumber .","}","}","ORDER BY ?totalOrderNumber"].join("")}function ie(e){return["SELECT DISTINCT ?surfaceTitle ?isurface ?isurfaceTitle ?icodexTitle ?canvas ?imageurl ?next_surface ?previous_surface ","{","<"+e+"> <http://purl.org/dc/elements/1.1/title> ?surfaceTitle .","<"+e+"> <http://scta.info/property/hasISurface> ?isurface .","OPTIONAL {","<"+e+"> <http://scta.info/property/next> ?next_surface .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/previous> ?previous_surface .","}","OPTIONAL {","?isurface <http://purl.org/dc/elements/1.1/title> ?isurfaceTitle .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?icodex <http://purl.org/dc/elements/1.1/title> ?icodexTitle .","}","?isurface <http://scta.info/property/hasCanvas> ?canvas .","OPTIONAL{","?canvas <http://iiif.io/api/presentation/2#hasImageAnnotations> ?blank .","}","OPTIONAL{","?canvas <http://www.w3.org/2003/12/exif/ns#height> ?c_height .","}","?blank <http://www.w3.org/1999/02/22-rdf-syntax-ns#first> ?o .","?o <http://www.w3.org/ns/oa#hasBody> ?o2 .","OPTIONAL{","?o2 <http://rdfs.org/sioc/services#has_service> ?imageurl .","}","OPTIONAL{","?o2 <http://www.shared-canvas.org/ns/hasRelatedService> ?imageurl .","}","}"].join("")}function le(e){return["SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","BIND(<"+e+"> as ?codex) . ","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}function ce(e){return["SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","?icodex <http://scta.info/property/hasOfficialManifest> <"+e+"> .","?codex <http://scta.info/property/hasCodexItem> ?icodex .","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}function ue(e){return["SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","?codex <http://scta.info/property/hasSurface> <"+e+"> .","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}function pe(e){return["SELECT DISTINCT ?codex ?surfaceFocus ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","?isurfaceFocus <http://scta.info/property/hasCanvas> <"+e+"> .","?surfaceFocus <http://scta.info/property/hasISurface> ?isurfaceFocus .","?codex <http://scta.info/property/hasSurface> ?surfaceFocus .","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}var de=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleChildren=n.handleToggleChildren.bind(Object(Z.a)(n)),n.mounted="",n.state={parts:[],showChildren:!1,isPartOf:{}},n}return Object(Q.a)(a,[{key:"handleToggleChildren",value:function(e){e.preventDefault(),this.setState((function(e){return{showChildren:!e.showChildren}}))}},{key:"retrieveParts",value:function(e){var t=this;C(function(e){return["SELECT ?part ?title ?level ?order ?structureType ?questionTitle ?author ?authorTitle ?isPartOf ?isPartOfTitle ","{","<"+e+"> <http://purl.org/dc/terms/hasPart> ?part . ","?part <http://purl.org/dc/elements/1.1/title> ?title .","OPTIONAL {","?isPartOf <http://purl.org/dc/terms/hasPart> <"+e+"> .","?isPartOf <http://purl.org/dc/elements/1.1/title> ?isPartOfTitle .","}","OPTIONAL {","?part <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL","{","?part <http://scta.info/property/level> ?level .","}","OPTIONAL","{","?part <http://scta.info/property/structureType> ?structureType .","}","OPTIONAL","{","{","?part <http://scta.info/property/sectionOrderNumber> ?order .","}","UNION","{","?part <http://scta.info/property/isTranscriptionOf> ?mpart . ","?mpart <http://scta.info/property/isManifestationOf> ?epart . ","?epart <http://scta.info/property/sectionOrderNumber> ?order .","}","UNION","{","?part <http://scta.info/property/isManifestationOf> ?epart . ","?epart <http://scta.info/property/sectionOrderNumber> ?order .","}","}","OPTIONAL","{","?part <http://scta.info/property/questionTitle> ?questionTitle .","}","}","ORDER BY ?order ?authorTitle"].join("")}(e)).then((function(e){var a=e.data.results.bindings.map((function(e){return{part:e.part.value,title:e.title.value,level:e.level?e.level.value:"",author:e.author?e.author.value:"",authorTitle:e.authorTitle?e.authorTitle.value:"",structureType:e.structureType?e.structureType.value:"",questionTitle:e.questionTitle?e.questionTitle.value:""}})),n={isPartOfId:"",isPartOfTitle:""};e.data.results.bindings[0]&&e.data.results.bindings[0].isPartOf&&(n.isPartOfId=e.data.results.bindings[0].isPartOf.value,n.isPartOfTitle=e.data.results.bindings[0].isPartOfTitle.value),t.mounted&&t.setState({parts:a,isPartOf:n})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.retrieveParts(this.props.resourceid),this.props.membersOf&&this.props.membersOf.includes(this.props.resourceid)&&this.setState({showChildren:!0})}},{key:"componentDidUpdate",value:function(e){this.props.resourceid!==e.resourceid&&this.retrieveParts(this.props.resourceid),this.props.resourceid===e.resourceid&&this.props.membersOf===e.membersOf||this.props.membersOf&&this.props.membersOf.includes(this.props.resourceid)&&this.setState({showChildren:!0})}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(){return e.state.parts.map((function(t){var n="";return e.props.membersOf&&(e.props.membersOf.includes(t.part)||t.part===e.props.focusResourceid)&&(n="bold"),r.a.createElement(a,{bold:n,key:t.part,focusResourceid:e.props.focusResourceid,showChildren:e.state.showChildren,showFirstLevelChildren:!1,resourceid:t.part,title:t.title,level:t.level,author:t.author,authorTitle:t.authorTitle,structureType:t.structureType,membersOf:e.props.membersOf,questionTitle:t.questionTitle,mtFocus:e.props.mtFocus,showAuthor:e.props.showAuthor,collectionLink:"http://scta.info/resource/structureCollection"===t.structureType&&e.props.collectionLink,showParentLink:!1})}))},n=5*this.props.level;return r.a.createElement("div",{id:"outline",style:{paddingLeft:n+"px"}},r.a.createElement("p",{className:this.props.bold},this.state.isPartOf.isPartOfId&&this.props.showParentLink&&r.a.createElement(i.b,{to:"/text?resourceid="+this.state.isPartOf.isPartOfId},r.a.createElement(re.g,null)),this.props.author&&this.props.showAuthor&&"1"===this.props.level&&r.a.createElement("span",null,r.a.createElement("span",null,this.props.authorTitle,": "),r.a.createElement(i.b,{to:"/text?resourceid="+this.props.author},r.a.createElement(re.p,null))),this.props.title,this.props.questionTitle&&r.a.createElement("span",null,": ",this.props.questionTitle),!this.props.showFirstLevelChildren&&r.a.createElement(r.a.Fragment,null,this.state.parts.length>0&&!this.state.showChildren&&r.a.createElement("span",{className:"outlineArrow",onClick:this.handleToggleChildren},r.a.createElement(re.f,null)),this.state.parts.length>0&&this.state.showChildren&&r.a.createElement("span",{className:"outlineArrow",onClick:this.handleToggleChildren},r.a.createElement(re.g,null))),this.props.resourceid&&r.a.createElement(i.b,{to:"/text?resourceid="+this.props.resourceid+this.props.mtFocus},r.a.createElement(re.p,null)),this.props.collectionLink&&r.a.createElement("a",{href:"https://mirador.scta.info?resourceid="+this.props.resourceid,target:"_blank",rel:"noopener noreferrer"}," ",r.a.createElement("img",{alt:"view in mirador",style:{width:"12px",height:"12px"},src:"https://projectmirador.org/img/mirador-logo.svg"}))),(this.props.showFirstLevelChildren||this.state.showChildren)&&t())}}]),a}(r.a.Component),he=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).mounted="",n.state={membersOf:[]},n}return Object(Q.a)(a,[{key:"retrieveMembersOf",value:function(e){var t=this;C(function(e){return["SELECT ?memberOf","{","<"+e+"> <http://scta.info/property/isMemberOf> ?memberOf . ","}"].join("")}(e)).then((function(e){var a=e.data.results.bindings.map((function(e){return e.memberOf.value}));t.mounted&&t.setState({membersOf:a})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.retrieveMembersOf(this.props.focusResourceid)}},{key:"componentDidUpdate",value:function(e){this.props.focusResourceid!==e.focusResourceid&&this.retrieveMembersOf(this.props.focusResourceid)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},r.a.createElement(de,{key:this.props.resourceid,showChildren:!0,showFirstLevelChildren:this.props.showFirstLevelChildren,focusResourceid:this.props.focusResourceid,resourceid:this.props.resourceid,title:this.props.title,level:"1",structureType:"http://scta.info/resource/structureCollection",membersOf:this.state.membersOf,mtFocus:this.props.mtFocus,collectionLink:this.props.collectionLink,showAuthor:this.props.showAuthor,showParentLink:this.props.showParentLink}))}}]),a}(r.a.Component),me=a(91),fe=a.n(me),ge=a(90),ve=a.n(ge),Te=function(e){var t=Object(n.useState)(),a=Object(f.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)({w:"",h:""}),l=Object(f.a)(i,2),c=l[0],u=l[1],p=Object(n.useState)(ve()()),d=Object(f.a)(p,1)[0];Object(n.useEffect)((function(){e.coords&&u(E(e.coords.split(",")[2],e.coords.split(",")[3]))}),[e.coords]),Object(n.useEffect)((function(){T.a.get(e.imageurl+"/info.json").then((function(t){if(s){if(s.addTiledImage({tileSource:t.data}),e.coords){var a=v(e.coords,t.data.height,t.data.width),n=new fe.a.Rect(a.x,a.y,a.w,a.h);if(m(s,n),h(s,n),e.lineFocusCoords){var r=v(e.lineFocusCoords,t.data.height,t.data.width),i=new fe.a.Rect(r.x,r.y,r.w,r.h);h(s,i)}g(s,n),s.viewport.fitBounds(n)}}else{var l="osd-"+d,c=fe()({id:l,prefixUrl:"/img/openseadragon/",preserveViewport:!0,visibilityRatio:1,minZoomLevel:1,defaultZoomLevel:1,tileSources:[t.data],controlsFadeDelay:0,controlsFadeLength:25});if(e.coords){var u=v(e.coords,t.data.height,t.data.width),p=new fe.a.Rect(u.x,u.y,u.w,u.h);if(m(c,p),h(c,p),e.lineFocusCoords){var f=v(e.lineFocusCoords,t.data.height,t.data.width),T=new fe.a.Rect(f.x,f.y,f.w,f.h);h(c,T)}g(c,p)}o(c)}}))}),[e.imageurl,e.coords]);var h=function(e,t){e.addHandler("open",(function(){var a=ve()(),n=document.createElement("div");n.id="runtime-overlay-"+a,n.className="osdhighlight",e.addOverlay({element:n,location:t})}))},m=function(e,t){e.addHandler("open",(function(){e.viewport.fitBounds(t,!0)}))},g=function(e,t){e.viewport.goHome=function(){this.fitBounds(t)}},v=function(e,t,a){var n=e.split(","),r=t/a;return{x:parseInt(n[0])/a,y:parseInt(n[1])/t*r,w:parseInt(n[2])/a,h:parseInt(n[3])/t*r}},E=function(t,a){var n=e.displayWidth;return{w:n,h:n*(parseInt(a)/parseInt(t))}};return r.a.createElement("div",null,e.coords?r.a.createElement("div",{id:"osd-"+d,className:"open-seadragon-container",style:{height:c.h+"px",width:c.w+"px"}}):r.a.createElement("div",{id:"osd-"+d,className:"open-seadragon-container",style:{height:"100vh"}}))};Te.defaultProps={imageurl:"https://loris2.scta.info/vat/V145v.jpg",displayWidth:1e3};var Ee=Te;var ye=function(e){return r.a.createElement(Ee,{imageurl:e.imageUrl,coords:e.coords,displayWidth:e.displayWidth,lineFocusCoords:e.lineFocusCoords})};var be=function(e){return r.a.createElement("div",{className:"text",style:{whiteSpace:"nowrap"}},e.number&&r.a.createElement("span",null,e.label.split("(")[0],"/"),e.number&&r.a.createElement("span",null,e.number),r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}))},we=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).state={searchText:""},n}return Object(Q.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.targetLabel===this.props.label?"ImageTextWrapper target":"ImageTextWrapper"},r.a.createElement("div",{className:"labelImageWrapper"},r.a.createElement(ye,{imageUrl:this.props.imageUrl,canvas:this.props.canvas,coords:this.props.coords,canvasShort:this.props.canvasShort,displayWidth:this.props.displayWidth,lineFocusCoords:this.props.lineFocusCoords})),r.a.createElement(be,{text:this.props.text,number:this.props.number,label:this.props.label}))}}]),a}(n.Component),xe=function(e){var t=Object(n.useState)(""),a=Object(f.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)((function(){e.imageurl&&T.a.get(e.imageurl+"/info.json").then((function(e){var t=e.data.logo["@id"];o(t)})).catch((function(e){console.log("no logo found",e),o("")}))}),[e.imageurl]),r.a.createElement(r.a.Fragment,null,s&&r.a.createElement("img",{src:s,style:{margin:e.margin,height:e.height},alt:"imagelogo"}))};xe.defaultProps={height:"20px",margin:"5px"};var Ce=xe,Oe=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).mount=!1,n.handleNext=n.handleNext.bind(Object(Z.a)(n)),n.handlePrevious=n.handlePrevious.bind(Object(Z.a)(n)),n.handleLineFocusNext=n.handleLineFocusNext.bind(Object(Z.a)(n)),n.handleLineFocusPrev=n.handleLineFocusPrev.bind(Object(Z.a)(n)),n.isLineNumberLast=n.isLineNumberLast.bind(Object(Z.a)(n)),n.isLineNumberFirst=n.isLineNumberFirst.bind(Object(Z.a)(n)),n.handleToggleTextLines=n.handleToggleTextLines.bind(Object(Z.a)(n)),n.handleToggleAllLines=n.handleToggleAllLines.bind(Object(Z.a)(n)),n.state={currentSurfaceId:"",manifest:"",canvas:"",region:"full",width:"1000",next:"",previous:"",imageurl:"",annotationsDisplay:!0,showAllLines:!1},n}return Object(Q.a)(a,[{key:"handleNext",value:function(){this.props.handleSurfaceFocusChange(this.state.next)}},{key:"handlePrevious",value:function(){this.props.handleSurfaceFocusChange(this.state.previous)}},{key:"handleToggleTextLines",value:function(){this.setState((function(e){return{annotationsDisplay:!e.annotationsDisplay}}))}},{key:"handleToggleAllLines",value:function(){this.setState((function(e){return{showAllLines:!e.showAllLines}}))}},{key:"retrieveSurfaceInfo",value:function(e){var t=this;C(ie(e)).then((function(a){var n=a.data.results.bindings[0];if(n){var r="https://exist.scta.info/exist/apps/scta-app/folio-annotaiton-list-from-simpleXmlCoordinates.xq?surfaceid="+e.split("/resource/")[1]+"&coords=loose";T.a.get(r).then((function(a){t.mount&&t.setState({currentSurfaceId:e,surfaceTitle:n.surfaceTitle.value,manifest:"",canvas:n.canvas.value,imageurl:n.imageurl.value,next:n.next_surface?n.next_surface.value:"",previous:n.previous_surface?n.previous_surface.value:"",annotations:a.data?a.data.resources:""})})).catch((function(a){console.log("failed retrieving annotationlist: ",a),t.mount&&t.setState({currentSurfaceId:e,surfaceTitle:n.surfaceTitle.value,manifest:"",canvas:n.canvas.value,imageurl:n.imageurl.value,next:n.next_surface?n.next_surface.value:"",previous:n.previous_surface?n.previous_surface.value:"",annotations:""})}))}}))}},{key:"handleLineFocusNext",value:function(){var e=parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1]),t=this.props.lineFocusId.split("/");t.pop(),t.push((e+1).toString()),this.props.handleLineFocusChange(t.join("/"))}},{key:"handleLineFocusPrev",value:function(){var e=parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1]),t=this.props.lineFocusId.split("/");t.pop(),t.push((e-1).toString()),this.props.handleLineFocusChange(t.join("/"))}},{key:"isLineNumberFirst",value:function(){return 1===parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1])}},{key:"isLineNumberLast",value:function(){var e=this.state.annotations?this.state.annotations.length:"";return parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1])===e}},{key:"componentDidMount",value:function(){this.mount=!0,this.props.surfaceid&&this.retrieveSurfaceInfo(this.props.surfaceid),this.setState({annotationsDisplay:this.props.annotationsDisplay})}},{key:"componentDidUpdate",value:function(e){this.props.surfaceid!==e.surfaceid&&this.retrieveSurfaceInfo(this.props.surfaceid)}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){var e=this,t=function(t,a){var n=t.resource.chars,s=t.on.split("#xywh=")[0],o=s.split("/")[s.split("/").length-1],i=t.on.split("#xywh=")[1],l=t.imageUrl,c=t.label;return e.state.showAllLines||parseInt(e.props.lineFocusId.split("/")[e.props.lineFocusId.split("/").length-1])===a+1||!e.props.lineFocusId?r.a.createElement(we,{key:a,imageUrl:l,canvas:s,coords:i,canvasShort:o,text:n,label:c,number:a+1,targetLabel:e.props.targetLabel,surfaceButton:!1,displayWidth:e.props.width?e.props.width:e.state.width}):null};return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},this.state.currentSurfaceId?r.a.createElement("div",null,r.a.createElement("div",{className:"surface-navigation"},r.a.createElement("p",null,this.state.surfaceTitle),this.props.handleSurfaceFocusChange&&r.a.createElement("div",null,this.state.previous&&r.a.createElement(p.a,{size:"sm",onClick:this.handlePrevious},"Previous Page"),this.state.next&&r.a.createElement(p.a,{size:"sm",onClick:this.handleNext},"Next Page")),this.props.handleLineFocusChange&&!this.state.showAllLines&&r.a.createElement("div",null,!this.isLineNumberFirst()&&r.a.createElement(p.a,{size:"sm",onClick:this.handleLineFocusPrev},"Previous Line"),!this.isLineNumberLast()&&r.a.createElement(p.a,{size:"sm",onClick:this.handleLineFocusNext},"Next Line")),r.a.createElement("div",null,this.props.lineFocusId&&r.a.createElement(p.a,{size:"sm",onClick:this.handleToggleAllLines},"Toggle All/Focus Lines"),this.state.annotations&&r.a.createElement(p.a,{size:"sm",onClick:this.handleToggleTextLines},"Toggle Show Text Lines")),r.a.createElement(Ce,{imageurl:this.state.imageurl})),function(){if(e.state.annotations&&e.state.annotationsDisplay){var a=[];if(e.state.annotations.length)a=e.state.annotations.map((function(e,a){return t(e,a)}));else a=t(e.state.annotations,0);return a}return r.a.createElement(Ee,{imageurl:e.state.imageurl})}()):r.a.createElement("p",null,"No surface selected"))}}]),a}(r.a.Component);Oe.defaultProps={annotationsDisplay:!0};var ke=Oe,Se=a(85),Ie=a(155),Re=a(656),Le=a(271),je=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).mount=!1,n.retrieveXML=n.retrieveXML.bind(Object(Z.a)(n)),n.state={xmlstring:""},n}return Object(Q.a)(a,[{key:"retrieveXML",value:function(e){var t=this,a="https://exist.scta.info/exist/apps/scta-app/document/"+e.split("/resource/")[1];T.a.get(a).then((function(e){t.mount&&t.setState({xmlstring:e.data})}))}},{key:"componentDidMount",value:function(){this.mount=!0,this.props.tresourceid&&this.retrieveXML(this.props.tresourceid)}},{key:"componentDidUpdate",value:function(e){this.props.tresourceid!==e.tresourceid&&this.retrieveXML(this.props.tresourceid)}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},r.a.createElement(Re.a,{language:"xml",style:Le.docco,showLineNumbers:!0},this.state.xmlstring))}}]),a}(r.a.Component),Fe=a(15);var De=function(e){return r.a.createElement(Fe.a,{variant:"tabs"},e.availableTabs&&e.availableTabs.map((function(t,a){return t.show?r.a.createElement(Fe.a.Item,{key:"tab-"+t.name},r.a.createElement(Fe.a.Link,{active:e.windowLoad===t.name,title:t.desc,onClick:function(){e.handleTabChange(t.name,e.windowId)}},t.icon)):null})),"minimum"!==e.openWidthHeight&&r.a.createElement(Fe.a.Item,null,r.a.createElement(Fe.a.Link,{title:"Minimize Window",onClick:function(){e.handleMinimize(e.windowId)}},r.a.createElement(re.A,null))),"middle"!==e.openWidthHeight&&r.a.createElement(Fe.a.Item,null,r.a.createElement(Fe.a.Link,{title:"Half Size Window",onClick:function(){e.handleMiddlize(e.windowId)}},r.a.createElement(re.B,null))),"maximum"!==e.openWidthHeight&&r.a.createElement(Fe.a.Item,null,r.a.createElement(Fe.a.Link,{title:"Maximize Window",onClick:function(){e.handleMaximize(e.windowId)}},r.a.createElement(re.z,null))),"window1"!==e.windowId&&r.a.createElement(Fe.a.Item,null,r.a.createElement(Fe.a.Link,{title:"Close Window",onClick:function(){e.handleClose(e.windowId)}},r.a.createElement(re.y,null))),r.a.createElement(Fe.a.Item,null,!e.altWindowState&&r.a.createElement(Fe.a.Link,{title:"Clone Window",onClick:function(){e.handleDuplicateWindow(e.windowId,e.windowType)}},r.a.createElement(re.i,null))))},Ae=a(38);var Ne=function(e){var t=Object(n.useState)(""),a=Object(f.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)(!1),l=Object(f.a)(i,2),c=l[0],u=l[1],p=function(){e.selectionRange&&e.selectionRange.wordRange?e.handleBlockFocusChange(e.info.resourceid):e.handleBlockFocusChange(e.info.parent)};return e.info?r.a.createElement(Fe.a,{variant:"tabs"},r.a.createElement(Fe.a.Link,{onClick:function(){e.handleBlockFocusChange(e.info.resourceid)}},e.selectionRange&&e.selectionRange.wordRange?e.info.title+"@"+e.selectionRange.wordRange.start+"-"+e.selectionRange.wordRange.end:e.info.title),r.a.createElement(Fe.a.Item,null,e.info.previous&&"http://scta.info/resource/"!==e.info.previous&&r.a.createElement(Fe.a.Link,{title:"Move Up to Previous Sibling Resource",onClick:function(){e.handleBlockFocusChange(e.info.previous)}},r.a.createElement(re.b,null))),r.a.createElement(Fe.a.Item,null,e.info.next&&"http://scta.info/resource/"!==e.info.next&&r.a.createElement(Fe.a.Link,{title:"Move Up to Next Sibling Resource",onClick:function(){e.handleBlockFocusChange(e.info.next)}},r.a.createElement(re.c,null))),r.a.createElement(Fe.a.Item,null,e.info.resourceid!==e.info.topLevel&&"http://scta.info/resource/"!==e.info.parent&&r.a.createElement(Fe.a.Link,{title:"Move Up to Parent Resource",onClick:p},r.a.createElement(re.d,null))),c?r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"}},r.a.createElement(Fe.a.Item,null,r.a.createElement(Fe.a.Link,null,r.a.createElement("span",{onClick:function(){u(!1)}},r.a.createElement(re.d,null)))),r.a.createElement(Ae.a,{style:{width:"90%"},type:"text",value:s,placeholder:"supply scta resource id",className:"mr-sm-2",onKeyPress:function(t){!function(t){if(13===t.charCode){var a=t.target.value;a.includes("https://scta.info/resource/")?a=a.replace("https://scta.info/resource/","http://scta.info/resource/"):a.includes("sctar:")?a=a.replace("sctar:","http://scta.info/resource/"):a.includes("http://scta.info/resource/")||(a="http://scta.info/resource/"+a),e.handleFocusChange(a),o("")}}(t)},onChange:function(e){o(e.target.value)}})):r.a.createElement(Fe.a.Item,{onClick:function(){u(!0)}},r.a.createElement(Fe.a.Link,null,"Go to: ",r.a.createElement(re.c,null)))):null},Pe=a(272),Me=a.n(Pe),_e=a(273),Be=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleShow=n.handleToggleShow.bind(Object(Z.a)(n)),n.handleToggleCompare=n.handleToggleCompare.bind(Object(Z.a)(n)),n.mounted="",n.state={showCompare:!0,showCompareType:"ngram",compareText:"",rawText:"",show:!0,levenshteinDistance:void 0,usedBase:void 0,usedCompareTranscription:void 0,showImage:!1},n}return Object(Q.a)(a,[{key:"handleToggleShow",value:function(){this.setState((function(e){return{show:!e.show}}))}},{key:"handleToggleCompare",value:function(){this.setState((function(e){return{showCompare:!e.showCompare}}))}},{key:"textClean",value:function(e){var t=e.replace(/[.,/#!$%^&*;:{}=\-_`~()/\u00B6/|/\u204B/]/g,"");return(t=(t=(t=(t=(t=(t=t.replace(/v/g,"u")).replace(/ae/g,"e")).replace(/oe/g,"e")).replace(/oe/g,"e")).replace(/y/g,"i")).replace(/\s{2,}/g," ")).toLowerCase()}},{key:"createCompare",value:function(e,t){var a=this;T.a.get("https://exist.scta.info/exist/apps/scta-app/csv-pct.xq?resourceid="+t).then((function(t){var n=t.data;a.props.isMainText&&a.props.targetRange?n=j(t.data,a.props.targetRange):"isQuotedBy"===a.props.relationLabel||"isReferencedBy"===a.props.relationLabel?n=t.data:a.props.isRelatedToRange&&(n=j(t.data,a.props.isRelatedToRange));var r=new Me.a.diff_match_patch,s=r.diff_main(a.textClean(e),a.textClean(n));r.diff_cleanupSemantic(s);var o=r.diff_levenshtein(s),i="ngram"===a.state.showCompareType?Object(_e.getHtmlDiff)(e,n).compare:r.diff_prettyHtml(s);!0===a.mounted&&e?a.setState({compareText:i,rawText:n,levenshteinDistance:o,showCompare:a.props.showCompare,showCompareType:a.props.showCompareType,usedBase:a.props.base,usedCompareTranscription:a.props.compareTranscription}):a.mounted&&a.setState({rawText:n,showCompare:a.props.showCompare,usedBase:a.props.base,usedCompareTranscription:a.props.compareTranscription})})).catch((function(e){console.log("text request/comparison error",e)}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.setState({rawText:"",compareText:"",showCompare:this.props.showCompare,showCompareType:this.props.showCompareType,showImage:this.props.showImages}),this.props.show&&this.createCompare(this.props.base,this.props.compareTranscription)}},{key:"componentDidUpdate",value:function(e){!this.props.show||this.props.base===this.state.usedBase&&this.props.compareTranscription===this.state.usedCompareTranscription||this.createCompare(this.props.base,this.props.compareTranscription),this.props.showImages!==e.showImages&&this.setState({showImage:this.props.showImages})}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(){var t=[{manifestation:e.props.manifestation,manifestationTitle:e.props.manifestationTitle,transcription:""}];return r.a.createElement("div",null,r.a.createElement("span",{onClick:function(){e.setState((function(e){return{showImage:!e.showImage}}))}},r.a.createElement(re.x,null)),e.state.showImage&&r.a.createElement("div",null,r.a.createElement(Se.Surface3Wrapper,{manifestations:t,focusedManifestation:e.props.manifestation,width:parseInt(e.props.surfaceWidth),hideSelectionList:!0,isDependentSurface3:!0,startWord:e.props.isMainText&&e.props.targetRange&&parseInt(e.props.targetRange.split("-")[0]),endWord:e.props.isMainText&&e.props.targetRange&&parseInt(e.props.targetRange.split("-")[1])})))};return function(){var a=e.props.base===e.state.rawText;if(e.state.showCompare&&e.props.base&&e.state.compareText){var n=e.state.levenshteinDistance,s=5*n;return r.a.createElement("div",{style:{borderLeft:"5px solid rgba("+s+", 0, 255, 1)",paddingLeft:"5px"}},r.a.createElement("span",null,r.a.createElement(i.b,{to:"/text?resourceid="+e.props.compareTranscription+("isQuotedBy"!==e.props.relationLabel&&"isReferencedBy"!==e.props.relationLabel&&e.props.isRelatedToRange?"@"+e.props.isRelatedToRange:"")},e.props.manifestationTitle)," "),r.a.createElement("span",null," | "),r.a.createElement("span",{className:"lbp-span-link",title:"show/hide",onClick:function(){return e.handleToggleShow()}},e.state.show?r.a.createElement(re.r,null):r.a.createElement(re.q,null)),r.a.createElement("span",null," | "),r.a.createElement("span",{className:"lbp-span-link",title:"toggle comparison off",onClick:function(){return e.handleToggleCompare()}},r.a.createElement(re.G,null)),!a&&r.a.createElement("span",null," | "),!a&&r.a.createElement("span",{className:"lbp-span-link",title:"set as base",onClick:function(){return e.props.handleChangeBase(e.state.rawText)}},r.a.createElement(re.D,null)),e.props.compareTranscriptionDoc&&r.a.createElement("span",null," | "),e.props.compareTranscriptionDoc&&r.a.createElement("span",{className:"lbp-span-link",title:"edit on github",onClick:function(){L(e.props.compareTranscriptionDoc.split("#")[0],"",e.props.compareTranscriptionDoc.split("#")[1])}},r.a.createElement(re.o,null)),r.a.createElement("span",null," | "),r.a.createElement("span",{style:{fontSize:"14px",paddingLeft:"4px"},title:"levenshtein distance"},n),r.a.createElement("div",{className:e.state.show?"unhidden":"hidden"},r.a.createElement("div",{ref:"text",dangerouslySetInnerHTML:{__html:e.state.compareText}}),t()))}return e.state.rawText?r.a.createElement("div",null,r.a.createElement("span",null,r.a.createElement(i.b,{to:"/text?resourceid="+e.props.compareTranscription+("isQuotedBy"!==e.props.relationLabel&&"isReferencedBy"!==e.props.relationLabel&&e.props.isRelatedToRange?"@"+e.props.isRelatedToRange:"")},e.props.manifestationTitle))," |",r.a.createElement("span",null," | "),r.a.createElement("span",{className:"lbp-span-link",title:"show/hide",onClick:function(){return e.handleToggleShow()}},e.state.show?r.a.createElement(re.r,null):r.a.createElement(re.q,null)),r.a.createElement("span",null," | "),r.a.createElement("span",{className:"lbp-span-link",title:"toggle comparison on",onClick:function(){return e.handleToggleCompare()}},r.a.createElement(re.F,null)),!a&&r.a.createElement("span",null," | "),!a&&r.a.createElement("span",{className:"lbp-span-link",title:"set as base",onClick:function(){return e.props.handleChangeBase(e.state.rawText)}},r.a.createElement(re.D,null)),e.props.compareTranscriptionDoc&&r.a.createElement("span",null," | "),e.props.compareTranscriptionDoc&&r.a.createElement("span",{className:"lbp-span-link",title:"edit on github",onClick:function(){L(e.props.compareTranscriptionDoc.split("#")[0],"",e.props.compareTranscriptionDoc.split("#")[1])}},r.a.createElement(re.o,null)),r.a.createElement("div",{className:e.state.show?"unhidden":"hidden"},r.a.createElement("div",{ref:"text",dangerouslySetInnerHTML:{__html:e.state.rawText}}),t())):r.a.createElement(D,null)}()}}]),a}(r.a.Component),Ue=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleShowAll=n.handleToggleShowAll.bind(Object(Z.a)(n)),n.handleToggleShowAllImages=n.handleToggleShowAllImages.bind(Object(Z.a)(n)),n.mounted="",n.state={info:"",show:!1,showImages:!1,baseText:""},n}return Object(Q.a)(a,[{key:"handleToggleShowAll",value:function(){this.setState((function(e){return{show:!e.show}}))}},{key:"handleToggleShowAllImages",value:function(){this.setState((function(e){return{showImages:!e.showImages}}))}},{key:"arrangeTextInfo",value:function(e,t){var a=this;e.then((function(e){var n=e.data.results.bindings[0],r=e.data.results.bindings.map((function(e){var t;return{manifestation:e.manifestation.value,manifestationTitle:e.manifestationTitle.value,transcription:e.manifestationCTranscription?e.manifestationCTranscription.value:"",transcriptionDoc:null===(t=e.manifestationCTranscriptionDoc)||void 0===t?void 0:t.value}}));!0===a.mounted&&n&&a.setState({info:{resourceid:t,title:n.title.value,structureType:n.structureType.value,inbox:n.inbox.value,next:n.next?n.next.value:"",previous:n.previous?n.previous.value:"",cdoc:n.cdoc?n.cdoc.value:"",cxml:n.cxml?n.cxml.value:"",topLevel:n.topLevelExpression.value,cmanifestation:n.cmanifestation?n.cmanifestation.value:"",ctranscription:n.ctranscription?n.ctranscription.value:"",manifestations:r}})}))}},{key:"getTextInfo",value:function(e){var t=C(se(e));this.arrangeTextInfo(t,e)}},{key:"componentDidMount",value:function(){this.mounted=!0,this.setState({show:this.props.show}),this.setState({showImages:this.props.showImages}),this.props.isMainText?this.setState({info:this.props.info}):this.getTextInfo(this.props.expressionid)}},{key:"componentDidUpdate",value:function(e){this.props.info.resourceid===e.info.resourceid&&this.props.info.relatedExpressions===e.info.relatedExpressions||(this.props.isMainText?this.setState({info:this.props.info}):this.getTextInfo(this.props.expressionid)),this.props.show!==e.show&&this.handleToggleShowAll(),this.props.showImages!==e.showImages&&this.handleToggleShowAllImages()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.1)",padding:"5px"}},r.a.createElement("div",{style:{fontSize:"12px"}},this.props.isMainText&&r.a.createElement("span",null,"[Target] "),r.a.createElement("span",null,this.props.relationLabel),this.props.referringResource&&this.props.referringResource!==this.props.info.resourceid&&r.a.createElement("span",null," (",r.a.createElement(i.b,{to:"/text?resourceid="+this.props.referringResource},"via"),")")),r.a.createElement("div",null,this.state.info.resourceid?r.a.createElement(i.b,{to:"/text?resourceid="+this.state.info.resourceid+("isQuotedBy"!==this.props.relationLabel&&"isReferencedBy"!==this.props.relationLabel&&this.props.isRelatedToRange?"@"+this.props.isRelatedToRange:"")},this.props.authorTitle||this.props.longTitle?r.a.createElement("span",null," ",this.props.authorTitle," ",this.props.longTitle):this.state.info.resourceid):this.props.authorTitle||this.props.longTitle?r.a.createElement("span",null," ",this.props.authorTitle," ",this.props.longTitle):this.state.info.resourceid,r.a.createElement("span",null," | "),this.state.info.resourceid&&r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return e.handleToggleShowAll()}},this.state.show?r.a.createElement(re.r,null):r.a.createElement(re.q,null)),r.a.createElement("span",null," | "),this.props.expressionid&&r.a.createElement("span",{className:"lbp-span-link",title:"add to collation table",onClick:this.props.isMainText?this.props.handleShowCollationOverlay:function(){var t="isQuotedBy"!==e.props.relationLabel&&"isReferencedBy"!==e.props.relationLabel&&e.props.isRelatedToRange?e.props.expressionid+"@"+e.props.isRelatedToRange:e.props.expressionid;e.props.handleAddCtRelatedExpressions(t)}},r.a.createElement(re.E,null)),r.a.createElement("span",null," | "),r.a.createElement("a",{href:"https://mirador.scta.info?blockid="+this.state.info.resourceid,target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{alt:"view in mirador",style:{width:"12px",height:"12px"},src:"https://projectmirador.org/img/mirador-logo.svg"}))),r.a.createElement("div",{className:this.state.show?"unhidden":"hidden",style:{paddingLeft:"10px"}},e.props.isMainText&&"http://scta.info/resource/structureCollection"===e.props.info.structureType?r.a.createElement("p",null,"Text too big to display; move down the text hierarchy to focus on a smaller section"):e.state.info.manifestations?e.state.info.manifestations.map((function(t){return r.a.createElement(Be,{key:t.transcription,base:e.props.baseText,compareTranscription:t.transcription,compareTranscriptionDoc:t.transcriptionDoc,manifestationTitle:t.manifestationTitle,manifestation:t.manifestation,handleChangeBase:e.props.handleChangeBase,show:e.state.show,showCompare:(e.props.isMainText,!0),showCompareType:e.props.isMainText?"editDistance":"ngram",surfaceWidth:e.props.surfaceWidth,isRelatedToRange:e.props.isRelatedToRange,targetRange:e.props.targetRange,isMainText:e.props.isMainText,relationLabel:e.props.relationLabel,showImages:e.state.showImages})})):void 0))}}]),a}(r.a.Component);function We(e){return T.a.get("https://ngram.scta.info/ds/query",{params:{query:e,output:"json"}})}var He=function(e){var t=[];return e.forEach((function(e){var a,n,r;t.push({id:e.target.value,relationLabel:"Ngram Intersections:"+e.count.value,referringResource:"",author:null===(a=e.author)||void 0===a?void 0:a.value,authorTitle:null===(n=e.authorTitle)||void 0===n?void 0:n.value,longTitle:null===(r=e.longTitle)||void 0===r?void 0:r.value,show:!1,isRelatedToRange:""})})),t};var ze=function(e){var t=Object(n.useState)([]),a=Object(f.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(4),c=Object(f.a)(l,2),u=c[0],p=c[1];return Object(n.useEffect)((function(){if(e.baseText&&e.targetRange){console.log("firing1");var t=function(e){var t=e.replace(/[.,/#!$%^&*;:{}=\-_`~()/\u00B6/|/\u204B/]/g,"");return(t=(t=(t=(t=(t=(t=t.replace(/v/g,"u")).replace(/ae/g,"e")).replace(/oe/g,"e")).replace(/oe/g,"e")).replace(/y/g,"i")).replace(/\s{2,}/g," ")).toLowerCase()}(e.baseText).split(" "),a=[];console.log("baseText",e.baseText),console.log("tokenizedText",t);for(var n=0;n<t.length-3;n++){var r="<http://scta.info/resource/ngram/".concat(t.slice(n,n+4).join(""),">");a.push(r)}We(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a="SELECT (COUNT(*) as ?count) ?target ?longTitle ?author ?authorTitle\n            WHERE {\n              VALUES ?ngram { ".concat(e," }\n              ?ngram <http://scta.info/property/isFoundIn> ?target .\n              ?target <http://scta.info/property/longTitle> ?longTitle .\n              ?target <http://scta.info/property/isPartOfStructureItem> ?targetItem .\n              ?targetItem <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\n              OPTIONAL{\n              ?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\n              ?author <http://purl.org/dc/elements/1.1/title> ?authorTitle . \n                OPTIONAL{\n                ?author <http://scta.info/property/dateOfBirth> ?authorBirthDate .\n                }\n              }\n            }\n            GROUP BY ?target ?longTitle ?targetItem ?topLevel ?author ?authorTitle ?authorBirthDate\n            HAVING (?count >= ").concat(t,")\n            ORDER BY ?authorTitle ?longTitle");return a}(a.join(" "),u)).then((function(e){var t=e.data.results.bindings,a=He(t);o(a)}))}else if(!e.targetRange){We(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a="SELECT (COUNT(*) as ?count) ?start ?target ?longTitle ?author ?authorTitle\n            WHERE {\n              VALUES ?start { <".concat(e,"> }\n              ?ngram <http://scta.info/property/isFoundIn> ?start .\n              ?ngram <http://scta.info/property/isFoundIn> ?target .\n              FILTER(?start != ?target) .\n              ?target <http://scta.info/property/longTitle> ?longTitle .\n              ?target <http://scta.info/property/isPartOfStructureItem> ?targetItem .\n              ?targetItem <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\n              OPTIONAL{\n              ?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\n              ?author <http://purl.org/dc/elements/1.1/title> ?authorTitle . \n                OPTIONAL{\n                ?author <http://scta.info/property/dateOfBirth> ?authorBirthDate .\n                }\n              }\n            }\n            GROUP BY ?start ?target ?longTitle ?targetItem ?topLevel ?author ?authorTitle ?authorBirthDate\n            HAVING (?count >= ").concat(t,")\n            ORDER BY ?authorTitle ?longTitle");return a}(e.resourceid,u)).then((function(e){var t=e.data.results.bindings,a=He(t);o(a)}))}}),[e.resourceid,e.baseText,e.targetRange,u]),r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("p",null,"Potential Related Passages",r.a.createElement("br",null),r.a.createElement("span",{style:{fontSize:"12px"}},"Ngram Intersection Threshold: ",u,"(",r.a.createElement("span",{className:"lbp-span-link",title:"increase intersection threshold",onClick:function(){return p(u+1)}}," + "),u>0&&r.a.createElement(r.a.Fragment,null," | ",r.a.createElement("span",{className:"lbp-span-link",title:"decrease intersection threshold",onClick:function(){return p(u-1)}}," - ")),")")),"retrieving"===s?r.a.createElement(D,null):function(){var t=s.map((function(t,a){var n=e.markedExpressions.find((function(e){return e.parentBlock===t.id}));return r.a.createElement("div",{key:a+"-ngram-"+t.id},n&&r.a.createElement("span",{style:{fontSize:"12px",paddingLeft:"2px",marginLeft:"3px",borderLeft:"3px solid purple"}},"Already Marked via ",r.a.createElement(i.b,{to:"/text?resourceid="+n.id},n.id)),r.a.createElement(Ue,{info:e.info,expressionid:t.id,relationLabel:t.relationLabel,referringResource:t.referringResource,author:t.author,authorTitle:t.authorTitle,longTitle:t.longTitle,isMainText:!1,handleChangeBase:e.handleChangeBase,baseText:e.baseText,show:t.show,surfaceWidth:e.surfaceWidth,isRelatedToRange:t.isRelatedToRange,handleAddCtRelatedExpressions:e.handleAddCtRelatedExpressions,handleShowCollationOverlay:e.handleShowCollationOverlay}))}));return t}())},qe=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleCompare=n.handleToggleCompare.bind(Object(Z.a)(n)),n.handleChangeBase=n.handleChangeBase.bind(Object(Z.a)(n)),n.handleCustomUpdateRelatedExpressions=n.handleCustomUpdateRelatedExpressions.bind(Object(Z.a)(n)),n.handleSetCustomExpressionId=n.handleSetCustomExpressionId.bind(Object(Z.a)(n)),n.handleToggleAllChildren=n.handleToggleAllChildren.bind(Object(Z.a)(n)),n.handleToggleAllChildrenImages=n.handleToggleAllChildrenImages.bind(Object(Z.a)(n)),n.getText=n.getText.bind(Object(Z.a)(n)),n.mounted="",n.state={expressions:[],expressionsCumulative:[],page:1,intendedPage:1,pagesize:10,nextPage:2,previousPage:void 0,offset:0,rangeStart:1,rangeEnd:20,baseText:"",customExpressionId:"",customExpressionObject:{},showAllChildren:!1,showAllChildrenImages:!1},n}return Object(Q.a)(a,[{key:"handleToggleAllChildren",value:function(){this.setState((function(e){return{showAllChildren:!e.showAllChildren}}))}},{key:"handleToggleAllChildrenImages",value:function(){this.setState((function(e){return{showAllChildrenImages:!e.showAllChildrenImages}}))}},{key:"handleSetCustomExpressionId",value:function(e){this.setState({customExpressionId:e})}},{key:"handleCustomUpdateRelatedExpressions",value:function(e){e.preventDefault();var t={resourceid:this.state.customExpressionId,relationLabel:"user added comparison"};this.setState({customExpressionObject:t})}},{key:"handleChangeBase",value:function(e){this.setState({baseText:e})}},{key:"handleToggleCompare",value:function(e){this.setState((function(t){var a=Object(ae.a)({},t.expressions);return a[e].show=!a[e].show,{expressions:a}}))}},{key:"getText",value:function(e){var t=this,a=this;T.a.get("https://exist.scta.info/exist/apps/scta-app/csv-pct.xq?resourceid="+e).then((function(e){if(t.mounted){var n=e.data;if(t.props.selectionRange.wordRange){var r=a.props.selectionRange.wordRange.start+"-"+a.props.selectionRange.wordRange.end;n=j(e.data,r)}a.setState({baseText:n})}}))}},{key:"getRelatedExpressions",value:function(e,t,a){var n=this,r=(t-1)*a,s=this.props.selectionRange&&this.props.selectionRange.wordRange?this.props.selectionRange.wordRange.start:"",o=this.props.selectionRange&&this.props.selectionRange.wordRange?this.props.selectionRange.wordRange.end:"";C(function(e,t,a,n,r){var s;return n&&r&&(s=["FILTER (?isRelatedToRangeEnd <="+r+")","FILTER (?isRelatedToRangeStart >="+n+")"].join(" ")),["SELECT DISTINCT ?isRelatedTo ?label ?element ?longTitle ?author ?authorTitle ?isRelatedToRangeStart ?isRelatedToRangeEnd ?parentBlock ","WHERE","{ ","BIND (<"+e+"> AS ?resource) .","{","<"+e+"> ?o ?isRelatedTo . ","?o a <http://scta.info/resource/textRelation> . ","FILTER (?o != <http://scta.info/property/quotes>) . ","FILTER (?o != <http://scta.info/property/quotedBy>) . ","FILTER (?o != <http://scta.info/property/references>).","FILTER (?o != <http://scta.info/property/referencedBy>).","?o <http://www.w3.org/1999/02/22-rdf-syntax-ns#label> ?label . ","?isRelatedTo a <http://scta.info/resource/expression> . ","}","UNION","{","{","<"+e+"> <http://scta.info/property/structureType> <http://scta.info/resource/structureElement> . ","BIND (<"+e+"> as ?element) .","} ","UNION","{","?element <http://scta.info/property/isMemberOf> <"+e+">  . ","}","{ ",n||r?["?element <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?isRelatedTo .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .",s].join(" "):["{","?element <http://scta.info/property/source> ?isRelatedTo .","FILTER (!isBlank(?isRelatedTo)) .","}","UNION","{","?element <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?isRelatedTo .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .","}"].join(" "),"{","?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> . ","BIND ('quotes' as ?label) . ","}","UNION","{","?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> . ","BIND ('refs' as ?label) . ","}","} ","} ","UNION","{ ","{ ","BIND (<"+e+">  as ?element) .","} ","UNION ","{ ","?element <http://scta.info/property/isMemberOf> <"+e+">  . ","}",n||r?["?isRelatedTo <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?element .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .",s].join(" "):["{","?isRelatedTo <http://scta.info/property/source> ?element .","}","UNION","{","?isRelatedTo <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?element .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .","}"].join(" "),"{"," ?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> . "," BIND ('isQuotedBy' as ?label) . ","} ","UNION","{ ","?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> . ","BIND ('isReferencedBy' as ?label) . ","}","OPTIONAL","{","?isRelatedTo <http://scta.info/property/isPartOfStructureBlock> ?parentBlock .","}","}","?isRelatedTo <http://scta.info/property/longTitle> ?longTitle . ","?isRelatedTo <http://scta.info/property/isMemberOf> ?mem . ","?mem <http://scta.info/property/level> '1' . ","OPTIONAL ","{ ","?mem <http://www.loc.gov/loc.terms/relators/AUT> ?author . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","} ","} ","ORDER BY ?authorTitle","LIMIT "+a,"OFFSET "+t].join(" ")}(e,r,a,s,o)).then((function(e){console.log("result from query for related expressions",e);var r=e.data.results.bindings,s=[];s.push({id:n.props.info.resourceid,authorTitle:n.props.info.authorTitle,longTitle:n.props.info.longTitle,show:!1}),r.forEach((function(e){s.push({id:e.isRelatedTo.value,relationLabel:e.label.value,referringResource:e.element?e.element.value:"",author:e.author?e.author.value:"",authorTitle:e.authorTitle?e.authorTitle.value:"",longTitle:e.longTitle?e.longTitle.value:"",show:!1,isRelatedToRange:e.isRelatedToRangeStart&&e.isRelatedToRangeEnd?e.isRelatedToRangeStart.value+"-"+e.isRelatedToRangeEnd.value:"",parentBlock:e.parentBlock?e.parentBlock.value:""})})),n.mounted&&n.setState((function(e){return{expressions:s,expressionsCumulative:e.expressionsCumulative.concat(s),intendedPage:t,nextPage:t+1,previousPage:t>1?t-1:void 0,offset:(t-1)*a,rangeStart:(t-1)*a+1,rangeEnd:a*t}}))}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.props.info&&(this.getRelatedExpressions(this.props.info.resourceid,this.state.page,this.state.pagesize),"http://scta.info/resource/structureCollection"!==this.props.info.structureType&&this.getText(this.props.info.ctranscription))}},{key:"componentDidUpdate",value:function(e,t){if(e.info.resourceid!==this.props.info.resourceid||t.page!==this.state.page||e.selectionRange!==this.props.selectionRange){var a=e.info.resourceid!==this.props.info.resourceid?1:this.state.page;this.getRelatedExpressions(this.props.info.resourceid,a,this.state.pagesize),"http://scta.info/resource/structureCollection"!==this.props.info.structureType&&this.getText(this.props.info.ctranscription)}if(t.customExpressionObject!==this.state.customExpressionObject){var n=this.state.customExpressionObject,r={id:n.resourceid,relationLabel:n.relationLabel};this.setState((function(e){return{expressions:[].concat(Object(A.a)(e.expressions),[r])}}))}}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(){return r.a.createElement("div",null,(Object.keys(e.state.expressions).length>e.state.pagesize||e.state.rangeEnd>e.state.pagesize)&&r.a.createElement("p",{className:"small"},e.state.previousPage&&r.a.createElement("span",null,r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return e.setState({page:e.state.previousPage})}},"Previous ",e.state.previousPage),r.a.createElement("span",null," | ")),r.a.createElement("span",null,"Current Page: "),r.a.createElement(Ae.a,{style:{width:"40px",display:"inline"},inline:"true",size:"sm",id:"text",type:"text",onChange:function(t){return e.setState({intendedPage:t.target.value})},value:e.state.intendedPage}),r.a.createElement(p.a,{style:{display:"inline"},inline:"true",size:"sm",onClick:function(t){return e.setState({page:parseInt(e.state.intendedPage)})}},"Go"),r.a.createElement("span",null,"(",e.state.rangeStart," - ",e.state.rangeEnd,")"),Object.keys(e.state.expressions).length>e.state.pagesize&&r.a.createElement("span",null,r.a.createElement("span",null," | "),r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return e.setState({page:e.state.nextPage})}},"Next: ",e.state.nextPage))))};return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},r.a.createElement("h4",null,"Text Comparisons"),t(),r.a.createElement("p",{className:"small"},r.a.createElement("a",{href:"https://lombardpress.org/adfontes/",target:"_blank",rel:"noopener noreferrer"},"Advanced Index and Filtering")),r.a.createElement("p",{className:"small lbp-span-link",onClick:this.handleToggleAllChildren},"Toggle All Children"),this.state.showAllChildren&&r.a.createElement("p",{className:"small lbp-span-link",onClick:this.handleToggleAllChildrenImages},"Toggle All Children Images"),r.a.createElement("hr",null),e.state.expressions.map((function(t,a){var n=e.props.info.resourceid===t.id;return r.a.createElement("div",{key:a+"-"+t.id},r.a.createElement(Ue,{info:e.props.info,expressionid:t.id,relationLabel:t.relationLabel,referringResource:t.referringResource,author:t.author,authorTitle:t.authorTitle,longTitle:t.longTitle,isMainText:n,handleChangeBase:e.handleChangeBase,baseText:e.state.baseText,show:!!e.state.showAllChildren||t.show,showImages:!!e.state.showAllChildrenImages||t.show,surfaceWidth:e.props.surfaceWidth,isRelatedToRange:t.isRelatedToRange,targetRange:e.props.selectionRange&&e.props.selectionRange.wordRange?e.props.selectionRange.wordRange.start+"-"+e.props.selectionRange.wordRange.end:"",handleAddCtRelatedExpressions:e.props.handleAddCtRelatedExpressions,handleShowCollationOverlay:e.props.handleShowCollationOverlay}))})),r.a.createElement("hr",null),t(),r.a.createElement("div",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.1)",padding:"5px"}},r.a.createElement("p",{style:{fontSize:"12px"}},"Create custom user compare"),r.a.createElement(g.a,{onSubmit:this.handleCustomUpdateRelatedExpressions,inline:"true"},r.a.createElement(Ae.a,{inline:"true",size:"sm",id:"text",type:"text",value:this.state.customExpressionId,placeholder:"expression id",className:"mr-sm-2",onChange:function(t){e.handleSetCustomExpressionId(t.target.value)}}),r.a.createElement(p.a,{inline:"true",size:"sm",type:"submit",style:{margin:"2px"}},"Submit"))),r.a.createElement("hr",null),r.a.createElement("div",null,r.a.createElement("p",null,"Other Comparison/Connection Visualizations"),r.a.createElement("p",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://lombardpress.org/collation-vizualizer/index.html?id="+this.props.info.resourceid},"Collation Overlay")),r.a.createElement("p",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://scta.github.io/networks-explorer/?resourceid="+this.props.info.resourceid},"View Reference Connections")),r.a.createElement("p",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://scta.github.io/networks-explorer/topicconnections.html?resourceid="+this.props.info.resourceid},"View Topic Connections"))),r.a.createElement("div",null,r.a.createElement(ze,{info:this.props.info,handleChangeBase:this.handleChangeBase,baseText:this.state.baseText,surfaceWidth:this.props.surfaceWidth,resourceid:this.props.info.resourceid,markedExpressions:this.state.expressionsCumulative,handleAddCtRelatedExpressions:this.props.handleAddCtRelatedExpressions,handleShowCollationOverlay:this.props.handleShowCollationOverlay,targetRange:this.props.selectionRange&&this.props.selectionRange.wordRange?this.props.selectionRange.wordRange.start+"-"+this.props.selectionRange.wordRange.end:""})))}}]),a}(r.a.Component);var Ge=function(e){var t=Object(n.useState)(),a=Object(f.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(),u=Object(f.a)(l,2),p=u[0],d=u[1],h=Object(n.useState)(),m=Object(f.a)(h,2),g=m[0],v=m[1],E=Object(n.useState)(),y=Object(f.a)(E,2),b=y[0],w=y[1],x=Object(n.useState)(),O=Object(f.a)(x,2),k=O[0],S=O[1],I=Object(n.useState)([]),R=Object(f.a)(I,2),L=R[0],j=R[1],F=Object(n.useState)([]),D=Object(f.a)(F,2),A=D[0],N=D[1];Object(n.useEffect)((function(){var t;j([]),N([]),d(""),v(""),w(""),S(""),o(""),C(["SELECT ?author ?authorTitle ?wikidataid","{","BIND(<"+e.resourceid+"> AS ?author) .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","OPTIONAL {","?author <http://www.w3.org/2002/07/owl#sameAs> ?wikidataid .","FILTER(regex(str(?wikidataid), 'http://www.wikidata.org' ))","}","}","ORDER BY ?authorTitle"].join(" ")).then((function(e){var t=e.data.results.bindings;if(t.length>0){var a=t[0].authorTitle&&t[0].authorTitle.value,n=t[0].wikidataid&&t[0].wikidataid.value;o(a),n&&M(n)}})),C(["select ?personTitle ?author ?authorTitle (count(?ref) as ?count)","where {","?ref <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementName> .","?ref <http://scta.info/property/isInstanceOf> <"+(t=e.resourceid)+"> .","<"+t+"> <http://purl.org/dc/elements/1.1/title> ?personTitle .","?ref <http://scta.info/property/isPartOfTopLevelExpression> ?refTopLevel .","?refTopLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","GROUP BY ?author ?authorTitle ?personTitle"].join("")).then((function(e){var t=e.data.results.bindings;if(t.length>0&&"0"!==t[0].count.value){t.sort(P);var a=t.map((function(e){return r.a.createElement("p",{key:e.author.value},r.a.createElement(i.b,{to:"/text?resourceid="+e.author.value},e.authorTitle.value),":",e.count.value)}));j(a)}})),C(function(e){return["select ?author ?authorTitle (count(?ref) as ?count)","where {","?sourceTopLevel <http://www.loc.gov/loc.terms/relators/AUT> <"+e+"> .","?sourceTopLevel <http://scta.info/property/level> '1' .","?ref <http://scta.info/property/isPartOfTopLevelExpression> ?sourceTopLevel .","?ref <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementName> .","?ref <http://scta.info/property/isInstanceOf> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","GROUP BY ?author ?authorTitle"].join("")}(e.resourceid)).then((function(e){var t=e.data.results.bindings;if(t.length>0&&"0"!==t[0].count.value){t.sort(P);var a=t.map((function(e,t){return r.a.createElement("p",{key:t+"-"+e.author.value},r.a.createElement(i.b,{to:"/text?resourceid="+e.author.value},e.authorTitle.value),":",e.count.value)}));N(a)}}))}),[e.resourceid]);var P=function(e,t){var a=e.authorTitle.value.toUpperCase(),n=t.authorTitle.value.toUpperCase();return a<n?-1:a>n?1:0},M=function(e){var t=e.split("/entity/")[1];T.a.get("https://www.wikidata.org/w/api.php?origin=*&action=wbgetentities&ids="+t+"&format=json").then((function(e){var a=e.data.entities[t].claims.P18&&e.data.entities[t].claims.P18[0].mainsnak.datavalue.value,n=e.data.entities[t].descriptions.en&&e.data.entities[t].descriptions.en.value,r=e.data.entities[t].claims.P569&&e.data.entities[t].claims.P569[0].mainsnak.datavalue.value.time,s=e.data.entities[t].claims.P570&&e.data.entities[t].claims.P570[0].mainsnak.datavalue.value.time;T.a.get("https://commons.wikimedia.org/w/api.php?origin=*&action=query&prop=imageinfo&iiprop=url&redirects&format=json&titles=File:"+a).then((function(e){var t=e.data.query.pages,a=Object.keys(t)[0],o=e.data.query.pages[a].imageinfo&&e.data.query.pages[a].imageinfo[0].url;d(o),v(n),w(parseInt(r)),S(parseInt(s))}))}))};return r.a.createElement("div",{className:e.hidden?"hidden":"showing"},r.a.createElement(c.a,null,r.a.createElement("h1",null,"PersonInfo for ",s," ",b&&"("+b+"-"+k+")"),r.a.createElement("div",{style:{display:"flex",justifyContent:"left"}},p&&r.a.createElement("img",{alt:"author",src:p,width:"100px"}),r.a.createElement("p",{style:{marginLeft:"10px"}},g," ",g&&"(wikidata)")),r.a.createElement("div",null,r.a.createElement("h1",null,"Discussed/Mentioned By Frequency"),L),r.a.createElement("div",null,r.a.createElement("h1",null,"Discusses/Mentions Frequency"),A)))};var Ve=function(e){var t,a=Object(n.useState)(""),s=Object(f.a)(a,2),o=s[0],i=s[1],l=function(t){i(""),e.handleOnClickTag(t)};return r.a.createElement("div",null,r.a.createElement(Ae.a,{size:"sm",type:"text",value:o,placeholder:e.placeHolderText,className:"mr-sm-2",onChange:function(e){i(e.target.value)},onKeyPress:function(t){!function(t){13===t.charCode&&(e.handleOnClickTag(t.target.value),i(""))}(t)}}),o&&r.a.createElement("div",{className:"tagSuggestionList"},(t=e.tagsList,Object.keys(t).map((function(e){return"?"===o||e.toLowerCase().includes(o.toLowerCase())?r.a.createElement("span",{onClick:function(){return l(e)},key:"tsuggest-"+e},e):null})))))};var Xe=function(e){var t=Object(h.a)().t,a=Object(n.useState)(e.comment),s=Object(f.a)(a,2),o=s[0],i=s[1],l=Object(n.useState)(e.motivation||"commenting"),c=Object(f.a)(l,2),u=c[0],d=c[1],m=e.selectionRange&&e.selectionRange.text?e.selectionRange.text:"",g=Object(n.useState)(e.selectionRange&&e.selectionRange.textEdited?e.selectionRange.textEdited:m),v=Object(f.a)(g,2),T=v[0],E=v[1],y=Object(n.useState)(e.noTarget||!1),b=Object(f.a)(y,2),w=b[0],x=b[1],C=Object(n.useState)(e.orderNumber),O=Object(f.a)(C,1)[0],k=Object(n.useState)(e.tagsList||[]),S=Object(f.a)(k,2),I=S[0],R=S[1];Object(n.useEffect)((function(){var t=e.selectionRange&&e.selectionRange.text?e.selectionRange.text:"";E(e.selectionRange&&e.selectionRange.textEdited?e.selectionRange.textEdited:t)}),[e.selectionRange]),Object(n.useEffect)((function(){"commenting"===u&&E(e.selectionRange?e.selectionRange.text:"")}),[u]);var L=e.selectionRange&&e.selectionRange.wordRange?e.selectionRange.wordRange.start+"-"+e.selectionRange.wordRange.end:"";return r.a.createElement("div",null,"editing"===u&&r.a.createElement("div",null,r.a.createElement("span",null,"Suggest Edit for :",r.a.createElement("i",null,e.selectionRange.text," "),r.a.createElement("span",{className:"lbp-span-link",title:"leave simple comment on text",onClick:function(){d("commenting")}}," ",r.a.createElement(re.l,null)," "),r.a.createElement("span",null," (",L,") ")),r.a.createElement(Ae.a,{as:"textarea",type:"text",id:"editedText",rows:"3",value:T,placeholder:t("comment"),className:"mr-sm-2",onChange:function(e){E(e.target.value)}})),r.a.createElement("div",null,e.selectionRange&&e.selectionRange.text&&r.a.createElement("div",null,"editing"===u?r.a.createElement("span",null,"Leave comment on edit"):r.a.createElement("span",null,"Comment on:",r.a.createElement("i",null,e.selectionRange.text," "),r.a.createElement("span",{className:"lbp-span-link",title:"edit text",onClick:function(){d("editing")}}," ",r.a.createElement(re.o,null)," "),r.a.createElement("span",null," (",L,") "))),r.a.createElement("span",null,"Has Target: ",r.a.createElement("input",{type:"checkbox",inline:"true",label:"has target",checked:!w,onChange:function(e){x(!w)},style:{display:"inline"}})),r.a.createElement(Ae.a,{as:"textarea",type:"text",id:"comment",rows:"3",value:o,placeholder:t("comment"),className:"mr-sm-2",onChange:function(e){i(e.target.value)}}),I&&r.a.createElement("span",null,"Selected Tags: ",I.map((function(e){return r.a.createElement("span",{key:"tag-"+e},r.a.createElement("span",{onClick:function(){!function(e){var t=I.filter((function(t){return t.split(":")[0]!==e.split(":")[0]?t:null}));R(t)}(e)}},"X"),r.a.createElement("span",null,e))}))),r.a.createElement(Ve,{tagsList:e.availableTagsList,handleOnClickTag:function(e){I.includes(e)||R([].concat(Object(A.a)(I),[e]))},placeHolderText:"add tags (e.g beauty, faith:1, faith:2); type ? to see in-use tags"})),r.a.createElement(p.a,{size:"sm",type:"submit",onClick:function(t){t.preventDefault();var a=u;e.submitComment(o,a,T,e.selectionRange,O,w,I),i("")},block:!0,style:{margin:"2px"}},t("Submit")))};var Ye=function(e){var t=Object(h.a)().t,a=Object(n.useState)(!1),s=Object(f.a)(a,2),o=s[0],l=s[1],c="string"===typeof e.comment.target?e.comment.target:e.comment.target.source,u=void 0,p=void 0;e.comment.target.selector&&(u=e.comment.target.selector.filter((function(e){return"TextQuoteSelector"===e.type}))[0].exact,c=(p=e.comment.target.selector.filter((function(e){return"TextPositionSelector"===e.type}))[0]).start?c+"@"+p.start+"-"+p.end:c);var d,m={text:u,textEdited:e.comment.body.editedValue,wordRange:p},g=function(t,a){var n=t.replace("http://inbox.scta.info/notifications/","sctan:");return e.tagsList[a]&&e.tagsList[a][n]&&e.tagsList[a][n].order?e.tagsList[a][n].order:null};return r.a.createElement("div",null,r.a.createElement("p",null,t("For"),": ",r.a.createElement(i.b,{to:"/text?resourceid="+c},c)),o?r.a.createElement(Xe,{submitComment:function(t,a,n,r,s,o,i){e.updateComment(e.comment.id,t,n,a,r,s,o,i),l(!1)},comment:e.comment.body.value,selectionRange:m,motivation:e.comment.motivation,noTarget:!e.comment.target,orderNumber:e.orderNumber,tagsList:function(t,a){var n=[];return Object.keys(e.tagsList).length>0&&a&&Object.keys(a).forEach((function(e){var a=g(t,e),r=a?e+":"+a:e;n.push(r)})),n}(e.comment.id,e.comment.tags),availableTagsList:e.tagsList}):r.a.createElement("p",null,u&&r.a.createElement("span",null,"Comment on: ",r.a.createElement("i",null,u)),r.a.createElement("br",null),"editing"===e.comment.motivation&&r.a.createElement("span",null,"Suggested Correction: ",e.comment.body.editedValue,r.a.createElement("br",null)),r.a.createElement("span",null,function(e){var t=e.match(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gi);if(t){var a=[e.split(t[0])[0]];return t.forEach((function(n,s){var o=r.a.createElement(i.b,{key:n,to:"/res?resourceid="+n},n),l=r.a.createElement("span",{key:"s-"+n,className:"lbp-span-link",title:"Copy Resource Url Clipboard",onClick:function(e){e.preventDefault(),x(n)}},r.a.createElement(re.h,null));a.push(o),a.push(l);var c=e.split(n)[1].split(t[s+1])[0];a.push(c)})),a}return e}(e.comment.body.value)),r.a.createElement("br",null),r.a.createElement("span",null,"Tags: ",(d=e.comment.tags,Object.keys(e.tagsList).length>0?d&&Object.keys(d).map((function(t){var a=g(e.comment.id,t);return r.a.createElement("span",{key:"tag-"+t,className:"lbp-span-link",onClick:function(){return e.setTagFilter(t)}},t," ",a&&r.a.createElement("span",null,"(",a,")")," ")})):null)),r.a.createElement("br",null),r.a.createElement("span",null,"Submitted: ")," ",e.comment.created&&e.comment.created.split("T")[0]," |",r.a.createElement("span",{className:"lbp-span-link",onClick:function(){e.removeComment(e.comment.id)}},r.a.createElement(re.H,null)," ")," |",r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return l(!0)}}," ",r.a.createElement(re.o,null))),r.a.createElement("hr",null))},Qe=function(e){var t=Object(n.useState)(""),a=Object(f.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)(!1),l=Object(f.a)(i,2),c=l[0],u=l[1],p=Object(n.useState)(null),d=Object(f.a)(p,2),h=d[0],m=d[1],g=function(){T.a.post("https://print.lombardpress.org/api/v1/annolist",e.currentList).then((function(e){if(e.data.url){console.log("first condition passed",e.data.url);var t=e.data.url;m({pdf:"https://print.lombardpress.org/api/v1/cache/"+t})}else m({status:e.data.Status+"Please check back in a few minutes",pdf:""})}))};return r.a.createElement("div",null,r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return u(!c)}},"Import ",r.a.createElement(re.I,null)),c&&r.a.createElement("div",null,r.a.createElement("span",{className:"lbp-span-link"},r.a.createElement(re.I,null)," Load from local file"),r.a.createElement("br",null),r.a.createElement("input",{type:"file",id:"files",name:"files[]",onChange:function(t){var a=new FileReader;a.readAsText(t.target.files[0]);var n=t.target.files[0].name;a.onload=function(t){var r=a.result;e.handleImportList(JSON.parse(r),n)}}}),r.a.createElement("br",null),r.a.createElement("span",{className:"lbp-span-link"},r.a.createElement(re.j,null)," Load from Cloud"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),T.a.get(s).then((function(t){console.log("data",t),e.handleImportList(t.data,s)}))}},r.a.createElement("input",{type:"text",value:s,onChange:function(e){o(e.target.value)}}),r.a.createElement("input",{type:"submit"}))),r.a.createElement("br",null),r.a.createElement("a",{href:function(){var t=JSON.stringify(e.currentList,null,2);return"data:application/json;charset=utf-8,"+encodeURI(t)}(),download:e.currentListName.split(".json")[0]+"-"+(new Date).toISOString().slice(0,10)},r.a.createElement("span",{className:"lbp-span-link"},"Export ",r.a.createElement(re.n,null))),h?h.pdf?r.a.createElement("p",null,r.a.createElement("a",{href:h.pdf,rel:"noopener noreferrer"},"View PDF")):r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("span",null,h.status)),r.a.createElement("p",null,r.a.createElement("span",{className:"lbp-span-link",onClick:g},"Click here to update status")," ")):r.a.createElement("p",null,r.a.createElement("span",{className:"lbp-span-link",onClick:g},"Generate Pdf Text From List")," "))},Ze=a(96);Ze.initializeApp({apiKey:"AIzaSyDYqsSNAdVzipni4Zj6H0lTxFQz_bTE3XE",authDomain:"scta-65c18.firebaseapp.com",databaseURL:"https://scta-65c18-default-rtdb.firebaseio.com",projectId:"scta-65c18",storageBucket:"scta-65c18.appspot.com",messagingSenderId:"300565788198",appId:"1:300565788198:web:fcce3fafc05706de0718e7",measurementId:"G-WN007V665V"});var Je=Ze.database(),Ke=new Ze.auth.GoogleAuthProvider;var $e=function(e){var t=Object(h.a)().t,a=Object(n.useState)({local:[]}),s=Object(f.a)(a,2),o=s[0],l=s[1],u=Object(n.useState)([]),d=Object(f.a)(u,2),m=d[0],g=d[1],v=Object(n.useState)({}),T=Object(f.a)(v,2),E=T[0],y=T[1],b=Object(n.useState)({}),w=Object(f.a)(b,2),C=w[0],O=w[1],k=Object(n.useState)(!0),S=Object(f.a)(k,2),I=S[0],R=S[1],L=Object(n.useState)(""),j=Object(f.a)(L,2),F=j[0],D=j[1],N=Object(n.useState)([]),P=Object(f.a)(N,2),M=P[0],_=P[1],B=Object(n.useState)(""),U=Object(f.a)(B,2),W=U[0],H=U[1],z=Object(n.useState)([]),q=Object(f.a)(z,2),G=q[0],V=q[1],X=Object(n.useState)(!1),Y=Object(f.a)(X,2),Q=Y[0],Z=Y[1];Object(n.useEffect)((function(){H(e.userId),e.userId&&"jeff"!==e.userId&&Je.ref(e.userId).once("value").then((function(e){var t=e.val();t?(y(t.annotations||{}),O(t.tags||{})):(y({}),O({}))}))}),[e.userId]);var J=function(e,t){var a=e.map((function(e){return e.split(":")[0]})),n={};e.forEach((function(e){var t=e.split(":")[1],a=e.split(":")[0];n[a]=!!t&&parseInt(t)}));var r=Object(ae.a)({},C);return a.forEach((function(e){r[e]?(n[e]&&Object.keys(r[e]).forEach((function(t){r[e][t].order&&r[e][t].order>=n[e]&&(r[e][t].order=r[e][t].order+1)})),r[e][t]=!n[e]||{order:n[e]}):(r[e]={},r[e][t]=!n[e]||{order:n[e]})})),r},K=function(e){var t=e.map((function(e){return e.split(":")[0]})),a={};return t.forEach((function(e){a[e]=!0})),a},$=function(e){var t="sctan:"+e.split("/notifications/")[1];return t},ee=function(e){g([e])},te=function(e){var t=Object(ae.a)({},E),a=Object.keys(t[$(e)].tags);delete t[$(e)];var n=Object(ae.a)({},C);a.forEach((function(t){delete n[t][$(e)]})),y(t),O(n)},ne=function(e,t,a,n,r,s,o,i){var l=Object(ae.a)({},E),c=l[$(e)];c.body.value=t,c.body.editedValue=a,c.motivation=n,c.target=!o&&c.target,c.tags=K(i);var u=$(e),p=J(i,u);y(l),O(p)};Object(n.useEffect)((function(){_(se())}),[e.resourceid]);var se=function(){if(Object.keys(E).length>0){var t=Object.keys(E).map((function(t){return E[t].body.value&&E[t].body.value.includes(e.resourceid.split("/resource/")[1].split("/")[0])?"string"===typeof E[t].target?E[t].target:E[t].target.source:void 0}));return t=t.filter((function(e){return void 0!==e}))}return[]};Object(n.useEffect)((function(){if(Je&&Object.keys(E).length>0)try{Je.ref(W).set({annotations:E,tags:C})}catch(e){console.log("error in db update",e)}}),[E,o,C]);var oe=function(){var e=[];if(m)if(1===m.length){var t=m[0],a=Object(ae.a)({},E);Object.keys(a).forEach((function(n){return C&&C[t]&&Object.keys(C[t]).includes(n)?(C[t][n].order&&(a[n].order=C[t][n].order),e.push(a[n])):null}))}else{var n=Object(ae.a)({},E);Object.keys(n).forEach((function(t){return n[t].tags&&m.every((function(e){return Object.keys(n[t].tags).includes(e)}))?e.push(n[t]):null}))}else Object.keys(E).forEach((function(t){e.push(E[t])}));return e.sort((function(e,t){return e.order>t.order?1:e.order<t.order?-1:0})),e};return r.a.createElement(c.a,{className:e.hidden?"hidden":"showing"},e.userId&&"jeff"!==e.userId?r.a.createElement(r.a.Fragment,null,r.a.createElement(Xe,{submitComment:function(t,a,n,r,s,o,i){var l="http://inbox.scta.info/notifications/"+ve()(),c=$(l),u=new Date,p=J(i,c),d="",h="";r&&r.wordRange&&(d=r.wordRange.start,h=r.wordRange.end);var m=[{type:"TextQuoteSelector",exact:r?r.text:""},{type:"TextPositionSelector",start:d,end:h}],f={"@context":"http://www.w3.org/ns/anno.jsonld",id:l,type:"Annotation",created:u.toISOString(),creator:"http://scta.info/resource/jeffreycwitt",motivation:a,tags:K(i),body:{type:"TextualBody",value:t},target:!o&&{source:e.resourceid,esource:"http://scta.info/resource/"+e.resourceid.split("/resource/")[1].split("/")[0],selector:m}};"editing"===a?f.body.editedValue=n:delete f.body.editedValue,D("");var g=Object(ae.a)({},E);g[c]=f,y(g),O(p)},selectionRange:e.selectionRange,textEdit:e.textEdit,orderNumber:Object.keys(E).length,availableTagsList:C}),r.a.createElement("hr",null),r.a.createElement("div",{id:"commentToggleButtons"},I?r.a.createElement(p.a,{size:"sm",disabled:!0},t("Show Comments For Focused Passage")):r.a.createElement(p.a,{id:"btnAllCommentsToggle",size:"sm",onClick:function(){return R(!0)}},t("Show Comments For Focused Passage")),I?r.a.createElement(p.a,{id:"btnAllCommentsToggle",size:"sm",onClick:function(){return R(!1)}},"Show Comments Regardless of Target"):r.a.createElement(p.a,{size:"sm",disabled:!0},"Show Comments Regardless of Target")),r.a.createElement("div",{id:"commentFilterInputs"},r.a.createElement("div",null,r.a.createElement(Ae.a,{size:"sm",type:"text",value:F,placeholder:t("filter comments by text"),className:"mr-sm-2",onChange:function(e){D(e.target.value)}})),r.a.createElement(Ve,{tagsList:C,handleOnClickTag:function(e){m.includes(e)||g([].concat(Object(A.a)(m),[e]))},placeHolderText:"search for tags; type ? to see all tags"})),m&&r.a.createElement("span",null,"Filter Tags: ",m.map((function(e){return r.a.createElement("span",{key:"tag-"+e},r.a.createElement("span",{onClick:function(){!function(e){var t=m.filter((function(t){return t.split(":")[0]!==e.split(":")[0]?t:null}));g(t)}(e)}},"X"),r.a.createElement("span",null,e))}))),r.a.createElement("hr",null),M.length>0&&r.a.createElement("div",null,r.a.createElement("span",null,"Discussed By:"),M.map((function(e){return r.a.createElement("div",null,r.a.createElement(i.b,{key:e,to:"/res?resourceid="+e},e),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Resource Url Clipboard",onClick:function(t){t.preventDefault(),x(e)}},r.a.createElement(re.h,null)))})),r.a.createElement("hr",null)),r.a.createElement("div",null,function(){var t=oe(),a=t.length>0&&t.slice(0).map((function(t,a){var n="string"===typeof t.target?t.target:t.target.source;return I?n&&n.includes(e.expressionid)&&t.body.value&&t.body.value.includes(F)?r.a.createElement("div",{key:a},r.a.createElement(Ye,{comment:t,focused:!0,removeComment:te,updateComment:ne,handleOnClickComment:e.handleOnClickComment,setTagFilter:ee,tagsList:C})):null:n&&n.includes(e.expressionid)&&t.body.value&&t.body.value.includes(F)?r.a.createElement("div",{key:a,style:{borderLeft:"1px solid black"}},r.a.createElement(Ye,{comment:t,removeComment:te,updateComment:ne,setTagFilter:ee,tagsList:C})):t.body.value&&t.body.value.includes(F)?r.a.createElement("div",{key:a},r.a.createElement(Ye,{comment:t,removeComment:te,updateComment:ne,setTagFilter:ee,tagsList:C})):null}));return a}()),r.a.createElement("div",null,r.a.createElement("span",{className:"lbp-span-link",onClick:function(){Z(!Q)}},"Manage Tags"),Q&&r.a.createElement("div",null,G&&r.a.createElement("span",null,"Selected Tags: ",G.map((function(e){return r.a.createElement("span",{key:"tag-"+e},r.a.createElement("span",{onClick:function(){!function(e){var t=G.filter((function(t){return t.split(":")[0]!==e.split(":")[0]?t:null}));V(t)}(e)}},"X"),r.a.createElement("span",null,e))}))),r.a.createElement("div",null,r.a.createElement(Ve,{tagsList:C,handleOnClickTag:function(e){G.includes(e)||V([].concat(Object(A.a)(G),[e]))},placeHolderText:"search for tags; type ? to see all tags"})),r.a.createElement("p",{onClick:function(){!function(e){var t=Object(ae.a)({},E),a=Object(ae.a)({},C),n=[];e.forEach((function(e){var r=Object.keys(a[e]);n.push(r),r.forEach((function(a){delete t[a].tags[e]})),delete a[e]})),alert("Are you sure you want to remove these tags; This will modify "+n.length+"annotations"),O(a),y(t)}(G)}},"Delete Tags"))),r.a.createElement(Qe,{currentList:oe(),currentListName:m.join("-")||"all",handleImportList:function(e,t){try{var a=e,n=t.replace(/(?:[!-\/:-@\[-`\{-~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])/g,"").replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()})).replace(/\s+/g,"")||ve()();o[n]=a,l(Object(ae.a)({},o))}catch(r){console.log("error",r)}}})):r.a.createElement("p",null," You must be logged in to comment"))},et=a(7),tt=a.n(et),at=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).mounted="",n.state={eurl:"",etitle:"",murl:"",mtitle:"",turl:"",fetching:!1},n}return Object(Q.a)(a,[{key:"retrieveCitation",value:function(e){var t,a=this;e&&(this.setState({fetching:!0}),C(["SELECT DISTINCT ?manifestation ?manifestationTitle ?manifestationSurface ?surfaceTitle ?codexTitle ?datasource ?eLongTitle ?author ?authorTitle ?expression ?editor ?editorTitle","{","<"+(t=e)+"> <http://scta.info/property/isTranscriptionOf> ?manifestation .","<"+t+"> <http://scta.info/property/hasXML> ?datasource . ","?manifestation <http://purl.org/dc/elements/1.1/title> ?manifestationTitle .","{","?manifestation <http://scta.info/property/isPartOfTopLevelManifestation> ?topLevelManifestation .","}","UNION","{","?manifestation <http://scta.info/property/level> '1' .","BIND (?manifestation AS ?topLevelManifestation) .","}","OPTIONAL {","?topLevelManifestation <http://scta.info/property/editor> ?editor .","?editor <http://purl.org/dc/elements/1.1/title> ?editorTitle .","}","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","{","?expression <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .","}","UNION","{","?expression <http://scta.info/property/level> '1' .","BIND (?expression AS ?topLevelExpression) .","}","OPTIONAL {","?expression <http://scta.info/property/longTitle> ?eLongTitle","}","OPTIONAL {","?topLevelExpression <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL","{","{","?manifestation <http://scta.info/property/isOnZone> ?bn . ","?bn <http://scta.info/property/isOnZone> ?zone .","?zone <http://scta.info/property/isPartOfSurface> ?manifestationSurface .","}","UNION","{","?manifestation <http://scta.info/property/hasStructureBlock> ?block .","?block <http://scta.info/property/isOnSurface> ?manifestationSurface .","}","UNION","{","?manifestation <http://scta.info/property/hasStructureItem> ?item .","?item <http://scta.info/property/isOnSurface> ?manifestationSurface .","}","?manifestationSurface <http://purl.org/dc/elements/1.1/title> ?surfaceTitle .","?manifestationSurface <http://scta.info/property/order> ?surface_order .","?codex <http://scta.info/property/hasSurface> ?manifestationSurface .","?codex <http://purl.org/dc/elements/1.1/title> ?codexTitle .","}","}","ORDER BY ?surface_order"].join("")).then((function(t){var n=t.data.results.bindings;if(n.length>0){var r=n[0],s=r.expression?r.expression.value:"",o=r.manifestation?r.manifestation.value:"",i=r.eLongTitle?r.eLongTitle.value:"",l=r.authorTitle?r.authorTitle.value:"",c=r.author?r.author.value:"",u=r.editorTitle?r.editorTitle.value:"",p=r.editor?r.editor.value:"",d=r.datasource?r.datasource.value:"",h=r.codexTitle?r.codexTitle.value:"",m=r.surfaceTitle?r.surfaceTitle.value:"",f=n[n.length-1].surfaceTitle?n[n.length-1].surfaceTitle.value:"";a.mounted&&a.setState({author:c,authorTitle:l,editor:p,editorTitle:u,eurl:s,etitle:i,murl:o,mtitle:m!==f?h+", "+m+"-"+f:h+", "+m,turl:e,datasource:d,fetching:!1})}})))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.retrieveCitation(this.props.tresourceid)}},{key:"componentDidUpdate",value:function(e){this.props.tresourceid!==e.tresourceid&&this.retrieveCitation(this.props.tresourceid)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=this.state.authorTitle+", "+this.state.etitle+"("+this.state.mtitle+") Data source: "+this.state.datasource+".",a=this.props.selectionRange&&this.props.selectionRange.wordRange&&this.props.selectionRange.wordRange.start+"-"+this.props.selectionRange.wordRange.end;return r.a.createElement(c.a,null,r.a.createElement("h4",null,"Citation"),this.state.fetching?r.a.createElement(D,null):r.a.createElement("div",null,r.a.createElement("p",{className:"etitle"},this.state.authorTitle,", ",this.state.etitle," ",a&&a&&"@ "+a," (",r.a.createElement("a",{href:this.state.eurl,target:"_blank",rel:"noopener noreferrer"},this.state.eurl,a&&"@"+a)," ",r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),x(a?e.state.eurl+"@"+a:e.state.eurl)}},r.a.createElement(re.h,null)),")"),r.a.createElement("p",{className:"mtitle"},this.state.editor&&r.a.createElement("span",null,"Ed. ",this.state.editorTitle,", "),this.state.mtitle&&this.state.mtitle+" ","(",r.a.createElement("a",{href:this.state.murl,target:"_blank",rel:"noopener noreferrer"},this.state.murl,a&&"@"+a),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),x(a?e.state.murl+"@"+a:e.state.murl)}},r.a.createElement(re.h,null)),")"),r.a.createElement("p",{className:"ttitle"},r.a.createElement("span",null,"Transcription Resource: "),r.a.createElement("a",{href:this.state.turl,target:"_blank",rel:"noopener noreferrer"},this.state.turl,a&&"@"+a),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),x(a?e.state.turl+"@"+a:e.state.turl)}},r.a.createElement(re.h,null)),r.a.createElement("br",null),r.a.createElement("span",null,"Data source: "),r.a.createElement("a",{href:this.state.datasource,target:"_blank",rel:"noopener noreferrer"}," ",this.state.datasource),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),x(e.state.datasource)}},r.a.createElement(re.h,null))),r.a.createElement("p",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(e){e.preventDefault(),x(t)}},r.a.createElement(re.h,null)," Copy Full Citation to Clipboard")))}}]),a}(r.a.Component),nt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).toggleCitationExplanation=n.toggleCitationExplanation.bind(Object(Z.a)(n)),n.state={showCitationExplanation:!1},n}return Object(Q.a)(a,[{key:"toggleCitationExplanation",value:function(){this.setState((function(e){return{showCitationExplanation:!e.showCitationExplanation}}))}},{key:"render",value:function(){return r.a.createElement(c.a,{className:"CitationExplanation"},r.a.createElement("p",{onClick:this.toggleCitationExplanation},this.state.showCitationExplanation?r.a.createElement("span",null,r.a.createElement(re.f,null),"Hide Explanation of Citation Practices"):r.a.createElement("span",null,r.a.createElement(re.g,null),"View Explanation of Citation Practices")," "),this.state.showCitationExplanation&&r.a.createElement("div",null,r.a.createElement("p",null,"The citation of a text that has survived through a historical succession of manifestations is a complicated endeavor. Today, when transcriptions of these manifestations can be published as data, separate from any presentation, and thereby can be presented in a variety of ways, a full citation inevitably becomes even more complex. In order to identify the content hierarchy of the text, the specifical material or born digital manifestation of that text, and the data sources used to represent and display that manifestation, specificity and precision are needed."),r.a.createElement("p",null,"Full citations therefore identify three aspects of the text currently being viewed."),r.a.createElement("p",{className:"etitle"},"First (blue) it identifies the idea of the paragraph in question situated within the conceptual hierarchy of the text."),r.a.createElement("p",{className:"mtitle"},"Second (red) it identifies the manifestation of the text in a historical or born digital edition."),r.a.createElement("p",{className:"ttitle"},"Third (purple) it identifies the transcription and transcription data source used to power the current text presentation.")))}}]),a}(r.a.Component),rt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).toggleAlternativeManifestations=n.toggleAlternativeManifestations.bind(Object(Z.a)(n)),n.state={showAlternativeManifestations:!0},n}return Object(Q.a)(a,[{key:"toggleAlternativeManifestations",value:function(){this.setState((function(e){return{showAlternativeManifestations:!e.showAlternativeManifestations}}))}},{key:"render",value:function(){var e=this,t=this.props.selectionRange&&this.props.selectionRange.wordRange&&this.props.selectionRange.wordRange.start+"-"+this.props.selectionRange.wordRange.end;return r.a.createElement(c.a,{className:"ManifestationList"},this.props.optionalDisplay?r.a.createElement("h4",{onClick:this.toggleAlternativeManifestations},this.state.showAlternativeManifestations?r.a.createElement("span",null,r.a.createElement(re.f,null),"Hide Alternative Manifestations"):r.a.createElement("span",null,r.a.createElement(re.g,null),"View Alternative Manifestations")," "):r.a.createElement("h4",null,"Available Manifestations"),this.state.showAlternativeManifestations&&function(){if(e.props.manifestations)return e.props.manifestations.map((function(a){return e.props.tresourceid.includes(a.manifestation)?r.a.createElement("p",{key:a.manifestation},a.manifestationTitle,t&&"@"+t," (Currrent Focus)"):r.a.createElement("p",{key:a.manifestation},r.a.createElement(i.b,{to:t?"/text?resourceid="+a.manifestation+"@"+t:"/text?resourceid="+a.manifestation},a.manifestationTitle,t&&"@"+t))}))}())}}]),a}(r.a.Component);at.propTypes={tresourceid:tt.a.string.isRequired,manifestations:tt.a.array,hidden:tt.a.bool,handleFocusChange:tt.a.func};var st=function(e){return r.a.createElement(c.a,{className:e.hidden?"CitationWrapper hidden":"CitationWrapper showing"},r.a.createElement(at,{tresourceid:e.tresourceid,selectionRange:e.selectionRange}),r.a.createElement(nt,null),r.a.createElement("hr",null),r.a.createElement(rt,{tresourceid:e.tresourceid,manifestations:e.manifestations,selectionRange:e.selectionRange}))};var ot=function(e){var t=Object(n.useState)([]),a=Object(f.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)((function(){var t,a;t=e.resourceid,C("surface"===(a=e.codexResourceType)?ue(t):"canvas"===a?pe(t):"manifest"===a?ce(t):le(t)).then((function(e){console.log("id",t,"type",a,"data",e);var n=e.data.results.bindings;if(n.length>0&&n[0].surface){var r=n.map((function(e){return e.expression?e.expression.value:""})).filter((function(e,t,a){return a.indexOf(e)===t})),s={};r.forEach((function(e){s[e]=[]})),n.forEach((function(e){var t={expression:e.expression.value,expressionTitle:e.item_expression_title.value,manifestation:e.manifestation.value,surface:e.surface.value,surfaceTitle:e.surface_title.value,questionTitle:e.item_expression_question_title?e.item_expression_question_title.value:""};s[e.expression.value].push(t)})),o(s)}}))}),[e.resourceid]),r.a.createElement("div",{className:e.hidden?"hidden":"showing"},function(){var e=Object.keys(s).map((function(e){return r.a.createElement("p",{key:s[e][0].expression},r.a.createElement("span",null,r.a.createElement(i.b,{to:"/text?resourceid="+s[e][0].surface},s[e][0].surfaceTitle),"-",r.a.createElement(i.b,{to:"/text?resourceid="+s[e][s[e].length-1].surface},s[e][s[e].length-1].surfaceTitle)),": ",r.a.createElement(i.b,{to:"/text?resourceid="+s[e][0].manifestation},s[e][0].expressionTitle),": ",s[e][0].questionTitle&&s[e][0].questionTitle)}));return e}())},it=a(274);var lt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleShowTokenPosition=n.handleToggleShowTokenPosition.bind(Object(Z.a)(n)),n.mounted=!1,n.state={tresourceid:"",longTitle:null,showTokenPosition:!1},n}return Object(Q.a)(a,[{key:"handleToggleShowTokenPosition",value:function(){this.setState((function(e){return{showTokenPosition:!e.showTokenPosition}}))}},{key:"getTranscriptionId",value:function(e){var t,a=this;C(["SELECT DISTINCT ?ctranscription ?longTitle ","WHERE { ","{","<"+(t=e)+"> <http://scta.info/property/hasCanonicalManifestation> ?manifestation .","?manifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .","}","UNION","{","BIND(<"+t+"> AS ?ctranscription ) . ","?ctranscription a <http://scta.info/resource/transcription> .","}","UNION","{","<"+t+"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .","}","?ctranscription <http://scta.info/property/isTranscriptionOf> ?m .","?m <http://scta.info/property/isManifestationOf> ?e .","?e <http://scta.info/property/longTitle> ?longTitle .","}"].join(" ")).then((function(e){a.mounted&&a.setState({tresourceid:e.data.results.bindings[0].ctranscription.value,longTitle:e.data.results.bindings[0].longTitle.value})})).catch((function(e){a.setState({tresourceid:""})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.getTranscriptionId(this.props.textPreviewResourceId)}},{key:"componentDidUpdate",value:function(e){e.textPreviewResourceId!==this.props.textPreviewResourceId&&this.getTranscriptionId(this.props.textPreviewResourceId)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=this.props.textPreviewStart&&this.props.textPreviewEnd?this.state.tresourceid+"@"+this.props.textPreviewStart+"-"+this.props.textPreviewEnd:this.state.tresourceid,a=this.props.referringSelectionRange&&this.props.referringSelectionRange.wordRange&&this.props.referringSelectionRange.wordRange.start+"-"+this.props.referringSelectionRange.wordRange.end;return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},r.a.createElement("p",null,"Go to: ",r.a.createElement(i.b,{onClick:function(){e.props.handleTextPreviewFocusChange([{id:e.props.referringResource,range:a}])},to:"/text?resourceid="+t},this.state.longTitle)),this.state.tresourceid&&r.a.createElement("div",null,r.a.createElement(it.TextView,{tresourceid:this.state.tresourceid,start:parseInt(this.props.textPreviewStart),stop:parseInt(this.props.textPreviewEnd),context:!0})))}}]),a}(r.a.Component);var ct=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleRelatedDiscussion=n.handleToggleRelatedDiscussion.bind(Object(Z.a)(n)),n.handleSurface3Manifestations=n.handleSurface3Manifestations.bind(Object(Z.a)(n)),n.handleToggleShowQuery=n.handleToggleShowQuery.bind(Object(Z.a)(n)),n.handleToggleShowImages=n.handleToggleShowImages.bind(Object(Z.a)(n)),n.state={expressions:[],surfaceMap:{},showTextRegion:!1,showQuery:!1,query:""},n}return Object(Q.a)(a,[{key:"handleToggleShowQuery",value:function(){this.setState((function(e){return{showQuery:!e.showQuery}}))}},{key:"handleSurface3Manifestations",value:function(e,t){var a="";e instanceof Array?a=e.map((function(e){return{manifestation:e["@id"].replace("sctar:","http://scta.info/resource/"),manifestationTitle:e["@id"].replace("sctar:","http://scta.info/resource/").split("/resource/")[1],transcription:""}})):e&&(a=[{manifestation:e["@id"].replace("sctar:","http://scta.info/resource/"),manifestationTitle:e["@id"].replace("sctar:","http://scta.info/resource/").split("/resource/")[1],transcription:""}]),console.log("newManifestations",a);var n=this.props.surfaceid.split("/resource/")[1].split("/")[0],r=a?a.filter((function(e){return e.manifestation.includes(n)}))[0].manifestation:"";return{surface3Manifestations:a,surface3FocusedManifestation:r}}},{key:"handleToggleRelatedDiscussion",value:function(e){this.setState((function(t){var a=t.expressions.find((function(t){return t.expressionid===e}));return a.showComments=!a.showComments,{expressions:Object(A.a)(t.expressions)}}))}},{key:"handleToggleRelatedSurfaces",value:function(e){this.setState((function(t){var a=t.expressions.find((function(t){return t.expressionid===e}));return a.showRelatedSurfaces=!a.showRelatedSurfaces,{expressions:Object(A.a)(t.expressions)}}))}},{key:"handleToggleShowImages",value:function(e){this.setState((function(t){var a=t.expressions.find((function(t){return t.expressionid===e}));return a.showImages=!a.showImages,{expressions:Object(A.a)(t.expressions)}}))}},{key:"retrieveSurfaceInfo",value:function(e){var t=this,a=function(e){return["PREFIX sctap: <http://scta.info/property/>","CONSTRUCT","{","?expression sctap:hasManifestation ?manifestation2 .","?manifestation2 sctap:isOnSurface ?surface2 .","}","WHERE","{","?manifestation <http://scta.info/property/isOnSurface> <"+e+"> .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureBlock> .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://scta.info/property/totalOrderNumber> ?order .","?expression <http://scta.info/property/hasManifestation> ?manifestation2 .","?manifestation2 <http://scta.info/property/isOnSurface> ?surface2 .","?codex <http://scta.info/property/hasSurface> ?surface2 .","}"].join("")}(e);C(a).then((function(e){if(e.data["@graph"]){var n=e.data["@graph"];console.log("data",n);var r=[];n.forEach((function(e){if(!e["sctap:hasManifestation"])return null;var a=t.handleSurface3Manifestations(e["sctap:hasManifestation"],e["@id"].replace("sctar:","http://scta.info/resource/"));r.push({expressionid:e["@id"].replace("sctar:","http://scta.info/resource/"),manifestations:e["sctap:hasManifestation"],surface3Manifestations:a,showComments:!1,showRelatedSurfaces:!1,showImages:!1})}));var s={};n.forEach((function(e){e["sctap:isOnSurface"]&&(s[e["@id"].replace("sctar:","http://scta.info/resource/")]=e["sctap:isOnSurface"]["@id"].replace("sctar:","http://scta.info/resource/"))})),t.setState({expressions:r,surfaceMap:s,query:a})}}))}},{key:"componentDidMount",value:function(){this.retrieveSurfaceInfo(this.props.surfaceid)}},{key:"componentDidUpdate",value:function(e){this.props.surfaceid!==e.surfaceid&&this.retrieveSurfaceInfo(this.props.surfaceid)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},r.a.createElement("h1",null,"Page Info"),r.a.createElement("div",{style:{fontSize:"16px"}},r.a.createElement("h1",null,"Text objects on this page ",r.a.createElement(p.a,{size:"sm",className:"lbp-span-link",onClick:this.handleToggleShowQuery},this.state.showQuery?"Hide Proof":"Prove It!")),this.state.showQuery&&r.a.createElement("p",null,this.state.query),e.state.expressions.length>0?e.state.expressions.map((function(t){var a="";if(Array.isArray(t.manifestations))a=t.manifestations.map((function(t){var a=t["@id"].replace("sctar:","http://scta.info/resource/");return r.a.createElement("div",{key:a},r.a.createElement("span",null,a," ",r.a.createElement(i.b,{to:"/text?resourceid="+a},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("span",{style:{textIndent:"10px"}},"...Appearing on Surface ",e.state.surfaceMap[a]," ",r.a.createElement(i.b,{to:"/text?resourceid="+e.state.surfaceMap[a]},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("br",null))}));else if(t.manifestations){var n=t.manifestations["@id"].replace("sctar:","http://scta.info/resource/");a=r.a.createElement("div",{key:n},r.a.createElement("span",null,n," ",r.a.createElement(i.b,{to:"/text?resourceid="+n},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("span",{style:{textIndent:"10px"}},"...Appearing on Surface ",e.state.surfaceMap[n]," ",r.a.createElement(i.b,{to:"/text?resourceid="+e.state.surfaceMap[n]},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("br",null))}else a=[];return r.a.createElement("div",{key:t.expressionid},r.a.createElement("hr",null),r.a.createElement("p",null,t.expressionid," ",r.a.createElement(i.b,{to:"/text?resourceid="+t.expressionid},r.a.createElement(re.p,null))),r.a.createElement(p.a,{variant:"outline-primary",size:"sm",block:!0,onClick:function(){return e.handleToggleShowImages(t.expressionid)}},t.showImages?"Hide Images":"Show Images"),r.a.createElement("br",null),t.showImages&&t.surface3Manifestations&&t.surface3Manifestations.surface3Manifestations.length>0&&r.a.createElement(Se.Surface3Wrapper,{key:t.expressionid,manifestations:t.surface3Manifestations.surface3Manifestations,focusedManifestation:t.surface3Manifestations.surface3FocusedManifestation,annotationsDisplay:"paragraph",width:"501",hidden:!1}),t.showRelatedSurfaces?r.a.createElement("div",null,r.a.createElement(p.a,{variant:"outline-primary",size:"sm",block:!0,onClick:function(){e.handleToggleRelatedSurfaces(t.expressionid)}},"Hide Related Codices"),r.a.createElement("br",null),a):r.a.createElement("div",null,r.a.createElement(p.a,{variant:"outline-primary",size:"sm",block:!0,onClick:function(){e.handleToggleRelatedSurfaces(t.expressionid)}},"Show Related Codices"),r.a.createElement("br",null)))})):null))}}]),a}(r.a.Component);var ut=function(e){return r.a.createElement("div",{className:e.hidden?"hidden":"showing"},r.a.createElement("h1",null,"WorkGroupInfo"))};var pt=function(e){var t=Object(n.useState)("logeion"),a=Object(f.a)(t,1)[0];return r.a.createElement("div",{className:e.hidden?"hidden dict-container":"showing dict-container"},e.text&&1===e.text.split(" ").length&&r.a.createElement("div",{className:"dict-container2"},"logeion"===a?r.a.createElement("iframe",{className:"dict-iframe",title:"logeion",src:"https://logeion.uchicago.edu/"+e.text}):r.a.createElement("iframe",{className:"dict-iframe",title:"whitakerswords",src:"http://archives.nd.edu/cgi-bin/wordz.pl?keyword="+e.text})))};function dt(e){var t=[];switch(e){case"collection":t.push("textCitation"),t.push("textCompare"),t.push("comments"),t.push("search");break;case"workGroup":t.push("workGroupInfo"),t.push("comments"),t.push("search");break;case"person":t.push("personInfo"),t.push("comments"),t.push("search");break;case"codex":t.push("codex"),t.push("codexToc"),t.push("comments"),t.push("search");break;case"expressionType":t.push("comments"),t.push("search");break;case"text":t.push("textCitation"),t.push("textCompare"),t.push("comments"),t.push("search"),t.push("xml"),t.push("surface3"),t.push("textOutlineWrapper")}return t}var ht=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleToggleTextLinesView=n.handleToggleTextLinesView.bind(Object(Z.a)(n)),n.handleChangeManifestation=n.handleChangeManifestation.bind(Object(Z.a)(n)),n.state={windowLoad:"",mountStatus:{textCompare:!1,surface3:!1,comments:!1,xml:!1,search:!1,textOutline:!1,citation:!1},collationTableWithRange:!1},n}return Object(Q.a)(a,[{key:"handleToggleTextLinesView",value:function(e){this.props.handleToggleTextLinesView(this.props.windowId,e)}},{key:"handleChangeManifestation",value:function(e){var t=e.split("/resource/")[1].split("/")[1];this.props.handleChangeManifestation(this.props.windowId,t)}},{key:"componentDidMount",value:function(){this.setState({windowLoad:this.props.windowLoad})}},{key:"componentDidUpdate",value:function(e){var t={};if(this.props.resourceid!==e.resourceid)(t={textCompare:!1,surface3:!1,comments:!1,xml:!1,search:!1,textOutline:!1,citation:!1})[this.props.windowLoad]=!0,this.setState({windowLoad:this.props.windowLoad,mountStatus:t});else if(this.props.windowLoad!==e.windowLoad){var a=this.state.mountStatus;a[this.props.windowLoad]=!0,t=a,this.setState({windowLoad:this.props.windowLoad,mountStatus:t})}else t=this.state.mountStatus}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.windowType+" "+this.props.windowType+this.props.openWidthHeight},r.a.createElement(De,{handleTabChange:this.props.handleTabChange,handleClose:this.props.handleClose,handleMinimize:this.props.handleMinimize,handleMaximize:this.props.handleMaximize,handleMiddlize:this.props.handleMiddlize,windowType:this.props.windowType,openWidthHeight:this.props.openWidthHeight,windowId:this.props.windowId,windowLoad:this.props.windowLoad,focus:this.props.resourceid,handleSwitchWindow:this.props.handleSwitchWindow,handleDuplicateWindow:this.props.handleDuplicateWindow,altWindowState:this.props.altWindowState,focusSet:!!this.props.info,availableTabs:function(){var t=dt(e.props.resourceType);return[{name:"citation",desc:"Text Citation",show:t.includes("textCitation")||t.includes("textCitation")||t.includes("personInfo")||t.includes("codexToc")||t.includes("workGroupInfo"),icon:r.a.createElement(re.u,null)},{name:"surface3",desc:"Images",show:t.includes("surface3"),icon:r.a.createElement(re.x,null)},{name:"xml",desc:"Text XML Source",show:t.includes("xml"),icon:r.a.createElement(re.k,null)},{name:"textCompare",desc:"Text Comparisons",show:t.includes("textCompare")||t.includes("codex"),icon:r.a.createElement(re.t,null)},{name:"comments",desc:"Comments",show:t.includes("comments"),icon:r.a.createElement(re.m,null)},{name:"textOutlineWrapper",desc:"Text Outline",show:t.includes("textOutlineWrapper"),icon:r.a.createElement(re.a,null)},{name:"search",desc:"Text Search",show:t.includes("search"),icon:r.a.createElement(re.C,null)}]}()}),"surface2"!==this.state.windowLoad&&"dictionary"!==this.state.windowLoad&&r.a.createElement(Ne,{info:this.props.info,handleBlockFocusChange:this.props.handleBlockFocusChange,handleFocusChange:this.props.handleFocusChange,selectionRange:this.props.selectionRange}),function(){var t=dt(e.props.resourceType);return r.a.createElement("div",null,t.includes("textCompare")&&("textCompare"===e.state.windowLoad||e.state.mountStatus.textCompare)&&r.a.createElement(qe,{info:e.props.info,surfaceWidth:"bottomWindow"===e.props.windowType?"1000":"501",hidden:"textCompare"!==e.state.windowLoad,selectionRange:e.props.selectionRange,handleShowCollationOverlay:e.props.handleShowCollationOverlay,handleAddCtRelatedExpressions:e.props.handleAddCtRelatedExpressions}),t.includes("textCitation")&&("citation"===e.state.windowLoad||e.state.mountStatus.citation)&&r.a.createElement(st,{tresourceid:e.props.info.resourceid+e.props.mtFocus,resourceid:e.props.info.resourceid,manifestations:e.props.info.manifestations,handleFocusChange:e.props.handleFocusChange,hidden:"citation"!==e.state.windowLoad,selectionRange:e.props.selectionRange}),t.includes("personInfo")&&("citation"===e.state.windowLoad||e.state.mountStatus.citation)&&r.a.createElement(Ge,{resourceid:e.props.resourceid,hidden:"citation"!==e.state.windowLoad}),t.includes("workGroupInfo")&&("citation"===e.state.windowLoad||e.state.mountStatus.citation)&&r.a.createElement(ut,{resourceid:e.props.resourceid,hidden:"citation"!==e.state.windowLoad}),t.includes("codex")&&("textCompare"===e.state.windowLoad||e.state.mountStatus.textCompare)&&r.a.createElement(ct,{surfaceid:e.props.surfaceid,resourceid:e.props.resourceid,codexResourceType:e.props.codexResourceType,hidden:"textCompare"!==e.state.windowLoad}),t.includes("surface3")&&("surface3"===e.state.windowLoad||e.state.mountStatus.surface3)&&r.a.createElement(Se.Surface3Wrapper,{className:"surfaceWrapper",manifestations:e.props.info.manifestations,focusedManifestation:e.props.defaultManifestationSlug?e.props.resourceid+"/"+e.props.defaultManifestationSlug:e.props.resourceid+"/"+e.props.mtFocus.split("/")[1],annotationsDisplay:e.props.annotationsDisplay,handleToggleTextLinesView:e.handleToggleTextLinesView,handleChangeManifestation:e.handleChangeManifestation,width:"bottomWindow"===e.props.windowType?1e3:501,lineFocusId:e.props.lineFocusId,hidden:"surface3"!==e.state.windowLoad,startWord:e.props.selectionRange.wordRange&&e.props.selectionRange.wordRange.start,endWord:e.props.selectionRange.wordRange&&e.props.selectionRange.wordRange.end}),t.includes("comments")&&("comments"===e.state.windowLoad||e.state.mountStatus.comments)&&r.a.createElement($e,{resourceid:e.props.resourceid+e.props.mtFocus,expressionid:e.props.resourceid,hidden:"comments"!==e.state.windowLoad,selectionRange:e.props.selectionRange,userId:e.props.userId}),t.includes("xml")&&("xml"===e.state.windowLoad||e.state.mountStatus.xml)&&r.a.createElement(je,{tresourceid:e.props.info?e.props.info.resourceid+e.props.mtFocus:e.props.itemFocus.expression+e.props.mtFocus,hidden:"xml"!==e.state.windowLoad}),t.includes("textOutlineWrapper")&&r.a.createElement(he,{focusResourceid:e.props.info?e.props.info.resourceid:e.props.itemFocus.expression,resourceid:e.props.info.topLevel,title:e.props.info.topLevel,hidden:"textOutlineWrapper"!==e.state.windowLoad,mtFocus:e.props.mtFocus,collectionLink:!0}),t.includes("codexToc")&&r.a.createElement(ot,{resourceid:e.props.resourceid,codexResourceType:e.props.codexResourceType,hidden:"citation"!==e.state.windowLoad}),t.includes("search")&&r.a.createElement(X,{hidden:"search"!==e.state.windowLoad,searchEid:e.props.info?e.props.info.topLevel:"collection"===e.props.resourceType&&e.props.resourceid,searchAuthor:e.props.info?e.props.info.author:"person"===e.props.resourceType&&e.props.resourceid,searchEType:"expressionType"===e.props.resourceType&&e.props.resourceid,searchWorkGroup:"workGroup"===e.props.resourceType&&e.props.resourceid,searchType:"text",showSubmit:!0,showAdvancedParameters:!0,showLabels:!1,searchTerm:e.props.selectionRange&&e.props.selectionRange.text?'"'+e.props.selectionRange.text+'"':""}),"textPreview"===e.state.windowLoad&&e.props.textPreviewObjects.map((function(t,a){return r.a.createElement(lt,{key:a,textPreviewResourceId:t.id,textPreviewStart:t.range?t.range.split("-")[0]:null,textPreviewEnd:t.range?t.range.split("-")[1]:null,handleFocusChange:e.props.handleFocusChange,hidden:"textPreview"!==e.state.windowLoad,handleTextPreviewFocusChange:e.props.handleTextPreviewFocusChange,referringResource:e.props.info.ctranscription,referringSelectionRange:e.props.selectionRange})})),"dictionary"===e.state.windowLoad&&e.props.selectionRange.text&&r.a.createElement(pt,{text:e.props.selectionRange.text,hidden:"dictionary"!==e.state.windowLoad}),"collationTable"===e.state.windowLoad&&r.a.createElement("div",null,e.state.collationTableWithRange?r.a.createElement(Ie.CollationTable,{expressionIds:e.props.selectionRange.wordRange?[e.props.resourceid+"@"+e.props.selectionRange.wordRange.start+"-"+e.props.selectionRange.wordRange.end].concat(Object(A.a)(e.props.ctRelatedExpressions)):[e.props.resourceid].concat(Object(A.a)(e.props.ctRelatedExpressions)),handleOnSegDoubleClick:e.props.handleFocusChange}):r.a.createElement(Ie.CollationTable,{expressionIds:[e.props.resourceid].concat(Object(A.a)(e.props.ctRelatedExpressions)),handleOnSegDoubleClick:e.props.handleFocusChange}),r.a.createElement("p",{onClick:function(){e.setState({collationTableWithRange:!e.state.collationTableWithRange})}},e.state.collationTableWithRange?"Show without range constraint":"Show with range constraint")),"surface2"===e.state.windowLoad&&r.a.createElement(ke,{surfaceid:e.props.surfaceid,lineFocusId:e.props.lineFocusId,topLevel:e.props.info.topLevel,handleSurfaceFocusChange:e.props.handleSurfaceFocusChange,handleLineFocusChange:e.props.handleLineFocusChange,hidden:"surface2"!==e.state.windowLoad}))}())}}]),a}(r.a.Component),mt=a(45),ft=a(655),gt=function(e){var t=Object(n.useState)(),a=Object(f.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)(),l=Object(f.a)(i,2),c=l[0],u=l[1];Object(n.useEffect)((function(){p()}),[]);var p=function(){T()("https://api.ipify.org?format=json").then((function(e){o(e.data.ip),u(e.data.ip.split(".")[0]+"."+e.data.ip.split(".")[1]+"."+e.data.ip.split(".")[2])}))},d={"144.126.4":{name:"Loyola Notre Dame Library",logoUrl:"https://www.lndl.org/~/media/library/images/utility/lndl_logo.svg",linkUrl:"https://www.lndl.org"},"192.124.249":{name:"Loyola Notre Dame Library",logoUrl:"https://www.lndl.org/~/media/library/images/utility/lndl_logo.svg",linkUrl:"https://www.lndl.org"},"34.196.56":{name:"Universidad de los Andes",logoUrl:"https://uniandes.edu.co/caribe/sites/default/files/logo_negro_0.png",linkUrl:"https://uniandes.edu.co"}},h=function(){if(d[c])return d[c];var e=Math.floor(Math.random()*Object.keys(d).length),t=Object.keys(d)[e];return d[t]}();return s?r.a.createElement("div",{className:"nav-link"},r.a.createElement("span",null,r.a.createElement("a",{style:{color:"rgba(0, 0, 0, 0.5)"},href:"https://community.scta.info/members",target:"_blank",rel:"noopener noreferrer",title:"find out more about membership"},"Member Supported")," by: "),r.a.createElement("a",{href:h.linkUrl,target:"_blank",rel:"noopener noreferrer",title:"You are viewing content generously supported by "+h.name},r.a.createElement("img",{alt:"member logo",height:"25px",src:h.logoUrl}))):null},vt=Object(ft.a)()((function(e){var t=e.t;return r.a.createElement(mt.a,{bg:"light",variant:"light",expand:"lg",fixed:"bottom"},r.a.createElement(mt.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(mt.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Fe.a,null,e.previous&&r.a.createElement(i.c,{className:"nav-link",to:"/text?resourceid="+e.previous+e.mtFocus},t("Previous")),e.next&&r.a.createElement(i.c,{className:"nav-link",to:"/text?resourceid="+e.next+e.mtFocus},t("Next")),e.topLevel&&r.a.createElement(i.c,{className:"nav-link",to:"/text?resourceid="+e.topLevel},t("Text Home")),e.pdfView?r.a.createElement("span",{className:"nav-link",onClick:function(){return e.handleTogglePdfView()}},t("Web View")):r.a.createElement("span",{className:"nav-link",onClick:function(){return e.handleTogglePdfView()}},t("Print View")),r.a.createElement(gt,null))))})),Tt=a(72),Et=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).retrieveText=n.retrieveText.bind(Object(Z.a)(n)),n.handleShowToolTip=n.handleShowToolTip.bind(Object(Z.a)(n)),n.handleHideToolTip=n.handleHideToolTip.bind(Object(Z.a)(n)),n.handleHideFootnoteToolTip=n.handleHideFootnoteToolTip.bind(Object(Z.a)(n)),n.handleShowFootnoteToolTip=n.handleShowFootnoteToolTip.bind(Object(Z.a)(n)),n.handleOnToolTipClick=n.handleOnToolTipClick.bind(Object(Z.a)(n)),n.mounted="",n.state={fetching:!1,selectionRange:"",selectionCoords:"",dictionary:""},n}return Object(Q.a)(a,[{key:"retrieveText",value:function(e,t,a,n){var r,s=this,o=this;if(e){var i=this.props.doc,l=this.props.topLevel,c=i.split("/master/")[1],u=l.split("/resource/")[1],p="";p=i.includes("ipfs")?i:"https://exist.scta.info/exist/apps/scta-app/text/"+u+"/"+c;this.setState({fetching:!0}),(r=p,T.a.get("https://exist.scta.info/exist/apps/scta-app/xslt-conversion.xq?xmlurl="+r)).then((function(e){s.setState({fetching:!1}),document.getElementById("text").innerHTML="",document.getElementById("text").innerHTML=e.data,s.setEvents(o,a,n)})).catch((function(e){w(p,"/xslt/main_view.xsl").then((function(e){s.setState({fetching:!1}),document.getElementById("text").innerHTML="",document.getElementById("text").appendChild(e),s.setEvents(o,a,n)})).catch((function(e){console.log("something went wrong",e),document.getElementById("text").innerHTML="",document.getElementById("text").innerHTML="<p>Apologies, the document is not able to be loaded at this time</p>"}))}))}}},{key:"setEvents",value:function(e,t,a){function n(t){e.handleHideToolTip();var a=document.getSelection();if(window.getSelection().rangeCount>=1){var n=a&&a.getRangeAt(0),r=function(e){for(;e;){if(1===e.nodeType&&"p"===e.tagName.toLowerCase())return e;e=e.parentElement}}(n.commonAncestorContainer);if(r&&r.className.includes("plaoulparagraph")){var s=r.id,o=n.cloneContents();if(y()(o).find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove(),o.textContent.length>0){y()(r).clone().find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove();var i,l,c=S(o.textContent);0===n.startOffset?(i=n.startOffset,l=n.startContainer):(i=n.startOffset-1,l=n.startContainer);var u=function(e){var t=e.cloneContents();return y()(t).find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove(),S(t.textContent).split(" ").filter((function(e){return e})).length}(function(e,t,a,n,r){var s=e.ownerDocument.createRange();return s.setStart(t,a),s.setEnd(n,r),s}(r,r,0,l,i)),p={start:u+1,end:u+c.split(" ").filter((function(e){return e})).length},d=n.getBoundingClientRect(),h={text:c,wordRange:p,selectedElementTargetId:s};e.handleShowToolTip(h,d)}}}}y()(".paragraphnumber").click((function(t){t.preventDefault();var a=y()(this).parent("p").attr("id");e.props.setFocus(a),e.props.openWindow("window1")})),t&&O(t,!0),a&&e.markWithElement(a),y()(".js-show-figure-image").click((function(a){a.preventDefault();var n=y()(this).attr("id");e.props.setFocus(n),t&&O(t,!0)})),y()(".js-show-folio-image").click((function(t){t.preventDefault();var a=y()(this).attr("data-surfaceid"),n=y()(this).closest(".plaoulparagraph").attr("id");e.props.setFocus(n),e.props.handleSurfaceFocusChange("http://scta.info/resource/"+a),e.props.openWindow("window2","surface2")})),y()(".lbp-line-number").click((function(t){t.preventDefault();var a=y()(this).attr("data-surfaceid"),n=y()(this).attr("data-ln"),r=y()(this).closest(".plaoulparagraph").attr("id");e.props.setFocus(r),e.props.handleSurfaceFocusChange("http://scta.info/resource/"+a),e.props.handleLineFocusChange("http://scta.info/resource/"+a+"/"+n),e.props.openWindow("window2","surface2")})),y()(".appnote, .footnote").click((function(t){t.preventDefault(),y()(this).attr("data-tip","hello world");var a=y()(this).parent().children(".appnote, .footnote"),n=y()(a).attr("href"),r=y()(n).html(),s=this.getBoundingClientRect();e.setState({footnoteText:r,footnoteOffset:s}),e.handleShowFootnoteToolTip();var o=y()(this).parent().children(".note-display").attr("data-target-id");y()(".highlight").removeClass("highlight"),y()("#"+o).addClass("highlight"),y()("span[data-corresp="+o+"]").addClass("highlight")})),y()(document).on("click",".js-show-info",(function(t){if(t.target===this){t.preventDefault();var a=y()(this).attr("data-pid");e.props.setFocus(a),e.props.openWindow("window1")}})),t&&O(t,!0),y()(document).on("click",".show-line-witness",(function(t){t.preventDefault();var a=y()(this).attr("data-surfaceid"),n=y()(this).attr("data-ln");e.props.handleSurfaceFocusChange("http://scta.info/resource/"+a),e.props.handleLineFocusChange("http://scta.info/resource/"+a+"/"+n),e.props.openWindow("window2","surface2")})),y()(document).on("click",".js-show-reference-paragraph",(function(t){if(t.preventDefault(),"true"===y()(this).attr("data-bind-to-children")||t.target===this){var a=y()(this).attr("data-target-resource"),n=y()(this).attr("data-url").split(" "),r=y()(this).attr("data-target-range"),s=r?r.split(" "):null,o=n.map((function(e,t){return{id:e,range:s?s[t]:null}}));e.props.handleTextPreviewFocusChange(o),e.props.openWindow("window2","textPreview"),e.props.setFocus(a)}})),document.addEventListener("keyup",n),document.addEventListener("mouseup",n)}},{key:"markWithElement",value:function(e){this.markElementRemove();var t=document.getElementById(e.selectedElementTargetId);if(t&&e.wordRange){var a=function(e,t,a){for(var n,r,s,o,i,l,c,u=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT,k,!0),p=0,d=0;(c=u.nextNode())&&(!n||!o);){c.previousSibling&&c.previousSibling.getAttribute&&c.previousSibling&&"no"===c.previousSibling.getAttribute("data-break")&&(p+=1);var h=S(c.nodeValue).split(" ").filter((function(e){return e})),m=h.length;if(!n&&t+p>=d&&t+p<=d+m){n=c;var f=I(h,(s=t+p-d)-1);r=R(c.nodeValue,h[s-1],f,!0)}if(!o&&a+p>=d&&a+p<=d+m){o=c;var g=I(h,(l=a+p-d)-1);i=R(c.nodeValue,h[l-1],g,!1)}d+=m}var v=e.ownerDocument.createRange();return n?v.setStart(n,r):console.log("no container or invalid end offset"),o?v.setEnd(o,i):console.log("no container invalid end offset"),v}(t,e.wordRange.start,e.wordRange.end),n=a.extractContents(),r=document.createElement("mark");r.style.backgroundColor="#BBCEBE",r.appendChild(n),a.insertNode(r);var s=y()(r).clone();y()(s).find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove(),e.text=S(y()(s).text()),this.props.handleUpdateSelectionRange(e)}}},{key:"markElementRemove",value:function(){y()("mark").contents().unwrap()}},{key:"handleOnToolTipClick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"window1",a=this.state.selectionRange;console.log("selection range test",a),this.markWithElement(a);var n=a;this.props.setFocus(n.selectedElementTargetId+"@"+n.wordRange.start+"-"+n.wordRange.end),this.props.openWindow(t,e)}},{key:"handleHideToolTip",value:function(){Tt.a.hide(this.fooRef)}},{key:"handleHideFootnoteToolTip",value:function(){Tt.a.hide(this.foonoteRef)}},{key:"handleShowToolTip",value:function(e,t){this.mounted&&(this.setState({selectionRange:e,selectionCoords:t}),Tt.a.show(this.fooRef))}},{key:"handleShowFootnoteToolTip",value:function(){Tt.a.show(this.foonoteRef)}},{key:"componentDidMount",value:function(){this.mounted=!0;var e=this.props.scrollTo&&this.props.scrollTo.includes("/resource/")?this.props.scrollTo.split("/resource/")[1]:this.props.scrollTo;this.retrieveText(this.props.doc,this.props.topLevel,e,this.props.selectionRange)}},{key:"componentDidUpdate",value:function(e,t){if(e.doc!==this.props.doc){var a=this.props.scrollTo&&this.props.scrollTo.includes("/resource/")?this.props.scrollTo.split("/resource/")[1]:this.props.scrollTo;this.retrieveText(this.props.doc,this.props.topLevel,a,this.props.selectionRange)}else{if(this.props.scrollTo!==e.scrollTo)O(this.props.scrollTo&&this.props.scrollTo.includes("/resource/")?this.props.scrollTo.split("/resource/")[1]:this.props.scrollTo,!0),this.props.selectionRange.selectedElementTargetId&&this.props.selectionRange.wordRange?this.markWithElement(this.props.selectionRange):this.markElementRemove();else this.props.selectionRange.wordRange!==e.selectionRange.wordRange&&this.props.selectionRange.selectedElementTargetId?this.markWithElement(this.props.selectionRange):this.props.selectionRange.selectedElementTargetId||this.props.selectionRange.wordRange||this.markElementRemove()}}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=this.state.fetching?"none":"block";return r.a.createElement("div",null,this.state.fetching&&r.a.createElement("div",{style:{position:"fixed",top:"50%",left:"50%"}},r.a.createElement(D,null)),this.state.selectionRange&&r.a.createElement("p",{ref:function(t){return e.fooRef=t},"data-tip":"tooltip","data-for":"selection",style:{position:"fixed",top:this.state.selectionCoords.top+10,left:this.state.selectionCoords.left}}),this.state.footnoteText&&r.a.createElement("p",{ref:function(t){return e.foonoteRef=t},"data-tip":"tooltip","data-for":"footnote",style:{position:"fixed",top:this.state.footnoteOffset.top+10,left:this.state.footnoteOffset.left}}),r.a.createElement(Tt.a,{clickable:!0,place:"top",id:"selection"},this.state.selectionRange&&r.a.createElement(Fe.a,null,r.a.createElement(Fe.a.Link,{title:this.state.selectionRange.wordRange.start+"-"+this.state.selectionRange.wordRange.end,onClick:function(){e.handleOnToolTipClick("citation")}},r.a.createElement(re.u,null)),r.a.createElement(Fe.a.Link,{onClick:function(){e.handleOnToolTipClick("comments")}},r.a.createElement(re.m,null)),this.state.selectionRange.text&&1===this.state.selectionRange.text.split(" ").length&&r.a.createElement(Fe.a.Link,{onClick:function(){L(e.props.doc,e.state.selectionRange.text,e.state.selectionRange.selectedElementTargetId)}},r.a.createElement(re.o,null)),r.a.createElement(Fe.a.Link,{onClick:function(){e.handleOnToolTipClick("search")}},r.a.createElement(re.C,null)),this.state.selectionRange.text&&1===this.state.selectionRange.text.split(" ").length&&r.a.createElement(Fe.a.Link,{title:"look up word",onClick:function(){return e.handleOnToolTipClick("dictionary","window2")}},r.a.createElement(re.e,null)))),r.a.createElement(Tt.a,{id:"footnote",clickable:!0,place:"top"},r.a.createElement("p",{dangerouslySetInnerHTML:{__html:this.state.footnoteText}})),r.a.createElement("div",{id:"text",style:{display:t}}))}}]),a}(r.a.Component),yt=a(128);var bt=function(e){return e.item?r.a.createElement("tr",null,e.item.author&&r.a.createElement("td",null,r.a.createElement(i.b,{to:"/text?resourceid="+e.item.author},e.item.authorTitle)),r.a.createElement("td",null,r.a.createElement(i.b,{to:"/text?resourceid="+e.item.id},e.item.title)),e.item.questionTitle&&r.a.createElement("td",null,r.a.createElement(i.b,{to:"/text?resourceid="+e.item.id},e.item.questionTitle))):null},wt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).retrieveAuthorCollectionInfo=n.retrieveAuthorCollectionInfo.bind(Object(Z.a)(n)),n.handleItemFilter=n.handleItemFilter.bind(Object(Z.a)(n)),n.itemFilter=r.a.createRef(),n.mount=!1,n.state={authorTitle:"",authorArticles:[],textArticles:[],expressions:[],itemFilter:""},n}return Object(Q.a)(a,[{key:"handleItemFilter",value:function(e){var t=e.target.value;this.setState({itemFilter:t})}},{key:"arrangeItems",value:function(e,t){var a=this;e.then((function(e){var n=e.data["@graph"].filter((function(e){return e["@id"]===t.replace("http://scta.info/resource/","sctar:")}))[0];n||(n=e.data["@graph"].filter((function(e){return e["@id"]===t}))[0]);var r=n["dc:title"],s=null;Array.isArray(n["sctap:authorArticle"])?s=n["sctap:authorArticle"].map((function(t){return{id:t["@id"].replace("sctar:","http://scta.info/resource/"),title:e.data["@graph"].filter((function(e){return e["@id"]===t["@id"]}))[0]["dc:title"]}})):n["sctap:authorArticle"]&&(s=[{id:n["sctap:authorArticle"]["@id"].replace("sctar:","http://scta.info/resource/"),title:e.data["@graph"].filter((function(e){return e["@id"]===n["sctap:authorArticle"]["@id"]}))[0]["dc:title"]}]);var o=null;Array.isArray(n["sctap:textArticle"])?o=n.textArticle.map((function(t){return{id:t["@id"].replace("sctar:","http://scta.info/resource/"),title:e.data["@graph"].filter((function(e){return e["@id"]===t["@id"]}))[0]["dc:title"]}})):n["sctap:textArticle"]&&(o=[{id:n["sctap:textArticle"]["@id"].replace("sctar:","http://scta.info/resource/"),title:e.data["@graph"].filter((function(e){return e["@id"]===n["sctap:textArticle"]["@id"]}))[0]["dc:title"]}]);var i=null;Array.isArray(n["sctap:hasTopLevelExpression"])?i=n["sctap:hasTopLevelExpression"].map((function(t){return{id:t["@id"].replace("sctar:","http://scta.info/resource/"),title:e.data["@graph"].filter((function(e){return e["@id"]===t["@id"]}))[0]["dc:title"]}})):n["sctap:hasTopLevelExpression"]&&(i=[{id:n["sctap:hasTopLevelExpression"]["@id"].replace("sctar:","http://scta.info/resource/"),title:e.data["@graph"].filter((function(e){return e["@id"]===n["sctap:hasTopLevelExpression"]["@id"]}))[0]["dc:title"]}]),console.log("expressions",i),a.mount&&a.setState({authorArticles:s,textArticles:o,expressions:i,authorTitle:r})})).catch((function(e){console.log(e)}))}},{key:"retrieveAuthorCollectionInfo",value:function(e){var t=C(["PREFIX dc: <http://purl.org/dc/elements/1.1/>","PREFIX sctap: <http://scta.info/property/>","CONSTRUCT","{","?author dc:title ?authorTitle ;","sctap:hasTopLevelExpression ?expression ;","sctap:authorArticle ?authorArticle;","sctap:textArticle ?textArticle .","?authorArticle dc:title ?authorArticleTitle . ","?textArticle dc:title ?textArticleTitle . ","?expression dc:title ?topLevelExpressionTitle .","}","WHERE ","{","BIND(<"+e+"> as ?author) . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","OPTIONAL","{","?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?expression a <http://scta.info/resource/expression> .","?expression <http://scta.info/property/level> '1' .","?expression <http://purl.org/dc/elements/1.1/title> ?topLevelExpressionTitle .","}","OPTIONAL","{","?expression2 <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?textArticle <http://scta.info/property/isArticleOf> ?expression2 .","?textArticle <http://purl.org/dc/elements/1.1/title> ?textArticleTitle .","}","OPTIONAL","{","?authorArticle <http://scta.info/property/isArticleOf> ?author .","?authorArticle <http://purl.org/dc/elements/1.1/title> ?authorArticleTitle","}","}"].join(""));this.arrangeItems(t,e)}},{key:"componentDidUpdate",value:function(e){this.props.resourceid!==e.resourceid&&(this.refs.itemFilter?this.refs.itemFilter.value="":this.retrieveAuthorCollectionInfo(this.props.resourceid))}},{key:"componentDidMount",value:function(){this.mount=!0,this.retrieveAuthorCollectionInfo(this.props.resourceid)}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){var e=function(e){return e.map((function(e){return r.a.createElement(bt,{key:e.id,item:e})}))};return r.a.createElement(c.a,{className:"collectionBody"},r.a.createElement("h1",null,this.state.authorTitle),this.state.expressions&&r.a.createElement(c.a,null,r.a.createElement("h1",null,"Expressions"),r.a.createElement("br",null),r.a.createElement(yt.a,{striped:!0,bordered:!0,hover:!0,size:"sm"},r.a.createElement("tbody",null,e(this.state.expressions)))),this.state.authorArticles&&r.a.createElement(c.a,null,r.a.createElement("h1",null,"Author Related Articles"),r.a.createElement("br",null),r.a.createElement(yt.a,{striped:!0,bordered:!0,hover:!0,size:"sm"},r.a.createElement("tbody",null,e(this.state.authorArticles)))),this.state.textArticles&&r.a.createElement(c.a,null,r.a.createElement("h1",null,"Text Related Articles"),r.a.createElement("br",null),r.a.createElement(yt.a,{striped:!0,bordered:!0,hover:!0,size:"sm"},r.a.createElement("tbody",null,e(this.state.textArticles)))))}}]),a}(r.a.Component),xt=a(158),Ct=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).getVersionHistory=n.getVersionHistory.bind(Object(Z.a)(n)),n.handleToggleShowVersions=n.handleToggleShowVersions.bind(Object(Z.a)(n)),n.state={versions:[],currentVersion:"",showVersions:!1},n}return Object(Q.a)(a,[{key:"handleToggleShowVersions",value:function(){this.setState((function(e){return{showVersions:!e.showVersions}}))}},{key:"getVersionHistory",value:function(e){var t,a=this;C(["SELECT ?version ?version_shortId ?order_number ?version_label ?review ?doc","{","{","BIND(<"+(t=e)+"> as ?version) . ","?version <http://scta.info/property/shortId> ?version_shortId .","?version <http://scta.info/property/hasDocument> ?doc . ","?version <http://scta.info/property/versionOrderNumber> ?order_number .","?version <http://scta.info/property/versionLabel> ?version_label .","OPTIONAL {","?version <http://scta.info/property/hasReview> ?review .","}","}","UNION","{","<"+t+"> <http://scta.info/property/hasAncestor> ?version .","?version <http://scta.info/property/shortId> ?version_shortId .","?version <http://scta.info/property/hasDocument> ?doc . ","?version <http://scta.info/property/versionOrderNumber> ?order_number .","?version <http://scta.info/property/versionLabel> ?version_label .","OPTIONAL {","?version <http://scta.info/property/hasReview> ?review .","}","}","UNION","{","<"+t+"> <http://scta.info/property/hasDescendant> ?version .","?version <http://scta.info/property/shortId> ?version_shortId .","?version <http://scta.info/property/hasDocument> ?doc . ","?version <http://scta.info/property/versionOrderNumber> ?order_number .","?version <http://scta.info/property/versionLabel> ?version_label .","OPTIONAL {","?version <http://scta.info/property/hasReview> ?review .","}","}","}","ORDER BY DESC(?order_number)"].join("")).then((function(t){t.data.results.bindings.forEach((function(t,n){var r="https://dll-review-registry.scta.info/api/v1/reviews/?url="+t.doc.value+"?society=MAA";T()(r).then((function(n){var r=n.data,s={};r.length>0&&(s={img_url:r[0]["badge-url"],reviewid:r[0].id,ipfsHash:r[0]["ipfs-hash"],html_link:"https://dll-review-registry.scta.info/reviews/"+r[0].id+".html",rubric_link:r[0]["badge-rubric"],summary:r[0]["review-summary"]}),a.setState((function(a){var n={versionTranscription:t.version?t.version.value:"",versionLabel:t.version_label?t.version_label.value:"",versionOrderNumber:t.order_number?t.order_number.value:"",versionReview:t.review?t.review.value:"",versionDoc:t.doc?t.doc.value:"",versionReviewInfo:s};return{versions:[].concat(Object(A.a)(a.versions),[n]),currentVersion:e}}))}))}))}))}},{key:"componentDidMount",value:function(){this.props.transcriptionid&&this.getVersionHistory(this.props.transcriptionid)}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.props.transcriptionid!==e.transcriptionid&&(console.log("running fetch"),this.setState({versions:[]},(function(){a.getVersionHistory(a.props.transcriptionid)})))}},{key:"render",value:function(){var e=this,t=this.props.t;return function(){if(e.state.versions){if(e.state.versions.length>1)return r.a.createElement(xt.a,{variant:"info"},r.a.createElement("p",{onClick:e.handleToggleShowVersions,className:"small"},t("This Text Has Multiple Indexed Versions")),e.state.showVersions&&e.state.versions.map((function(a){var n=a.versionTranscription===e.state.currentVersion?"currentlyViewing":"",s=a.versionDoc.includes("github.com")&&a.versionDoc.replace("/raw/","/edit/"),o="https://github.com/scta-texts/"+(a.versionDoc.includes("github.com")&&a.versionDoc.split("/scta-texts/")[1].split("/")[0])+"issues";return r.a.createElement("p",{key:a.versionTranscription,className:n+" small"},n?r.a.createElement("span",null,a.versionLabel," ",t("(Currently Viewing)")):r.a.createElement("span",{className:"lbp-span-link",onClick:function(){e.props.handleFocusChange(a.versionTranscription)}},a.versionLabel),a.versionReviewInfo.html_link&&r.a.createElement("span",null," ",t("Peer Reviewed"),": ",r.a.createElement("a",{href:a.versionReviewInfo.html_link},r.a.createElement("img",{alt:"review",src:a.versionReviewInfo.img_url}))," "),r.a.createElement("span",{className:"small"}," ",t("Data Source"),": ",r.a.createElement("a",{href:a.versionDoc},a.versionDoc)," "),s&&r.a.createElement("span",{className:"small"}," | ",r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"}," Edit on ",r.a.createElement("img",{src:"github-octocat-logo.png",alt:"github",height:"25px"})," Github")," or ",r.a.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer"},"Create a GitHub Issue")))})));if(1===e.state.versions.length){var a=e.state.versions[0],n=a.versionDoc.includes("github.com")&&a.versionDoc.replace("/raw/","/edit/"),s="https://github.com/scta-texts/"+(a.versionDoc.includes("github.com")&&a.versionDoc.split("/scta-texts/")[1].split("/")[0])+"/issues";return r.a.createElement(xt.a,{className:"versioninfobox",variant:"info"},r.a.createElement("span",{className:"small"},t("Version"),": ",a.versionLabel,"|",t("Data Source"),": ",r.a.createElement("a",{href:a.versionDoc},a.versionDoc)),n&&r.a.createElement("span",{className:"small"}," | ",r.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"}," Edit on ",r.a.createElement("img",{src:"github-octocat-logo.png",alt:"github",height:"25px"})," Github")," or ",r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},"Create a GitHub Issue")))}return null}return null}()}}]),a}(r.a.Component),Ot=Object(ft.a)()(Ct),kt=a(275),St=a(120),It=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).retrieveCollectionInfo=n.retrieveCollectionInfo.bind(Object(Z.a)(n)),n.makeRequests=n.makeRequests.bind(Object(Z.a)(n)),n.handleFilter=n.handleFilter.bind(Object(Z.a)(n)),n.filter=r.a.createRef(),n.mount=!1,n.state={title:"",description:"",items:{},parts:{},filter:""},n}return Object(Q.a)(a,[{key:"handleFilter",value:function(e){var t=e.target.value;this.setState({filter:t})}},{key:"arrangeParts",value:function(e){var t=this,a=this;e.then((function(e){var n=e.data.results.bindings,r=n[0].title.value,s=n[0].description.value,o={};n.forEach((function(e){var t=e.part.value;o[t]={id:e.part.value,title:e.partTitle.value,type:e.partType.value,questionTitle:e.partQuestionTitle?e.partQuestionTitle.value:null,level:e.partLevel?e.partLevel.value:"unknown"}})),t.mount&&a.setState({title:r,description:s,parts:o})}))}},{key:"arrangeItems",value:function(e){var t=this,a=this;e.then((function(e){var n=e.data.results.bindings,r={};n.forEach((function(e){var t=e.item.value;r[t]={title:e.itemTitle.value,id:e.item.value,type:e.itemType.value,questionTitle:e.itemQuestionTitle?e.itemQuestionTitle.value:null,author:e.itemAuthor?e.itemAuthor.value:null,authorTitle:e.itemAuthorTitle?e.itemAuthorTitle.value:null,next:e.next?e.next.value:null,previous:e.previous?e.previous.value:null,cm:e.cm?e.cm.value:null,cmTitle:e.cmTitle?e.cmTitle.value:null,ct:e.ct?e.ct.value:null,topLevel:e.topLevel?e.topLevel.value:null,doc:e.doc?e.doc.value:null}})),t.mount&&a.setState({items:r})})).catch((function(e){console.log(e)}))}},{key:"retrieveWorkGroupInfo",value:function(e){var t=C(["SELECT DISTINCT ?item ?itemTitle ?itemAuthor ?itemAuthorTitle ?itemType ","WHERE { ","<"+e+"> <http://scta.info/property/hasExpression> ?item .","?item <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?itemType . ","?item <http://purl.org/dc/elements/1.1/title> ?itemTitle .","?item <http://www.loc.gov/loc.terms/relators/AUT> ?itemAuthor .","?itemAuthor <http://purl.org/dc/elements/1.1/title> ?itemAuthorTitle .","}","ORDER BY ?itemAuthorTitle"].join("")),a=C(oe(e));this.arrangeParts(a),this.arrangeItems(t)}},{key:"retrieveCollectionInfo",value:function(e,t,a){var n=C(["SELECT DISTINCT ?item ?itemTitle ?topLevel ?itemQuestionTitle ?cm ?cmTitle ?ct ?next ?previous ?itemType ?doc ","WHERE { ","<"+a+"> <http://scta.info/property/hasStructureItem> ?item .","?item <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .","?item <http://purl.org/dc/elements/1.1/title> ?itemTitle .","?item <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?itemType . ","OPTIONAL {","?item <http://scta.info/property/questionTitle> ?itemQuestionTitle .","}","OPTIONAL","{","?item <http://scta.info/property/next> ?next .","}","OPTIONAL","{","?item <http://scta.info/property/previous> ?previous .","}","?item <http://scta.info/property/hasCanonicalManifestation> ?cm .","?item <http://scta.info/property/totalOrderNumber> ?totalOrderNumber .","?cm <http://purl.org/dc/elements/1.1/title> ?cmTitle .","?cm <http://scta.info/property/hasCanonicalTranscription> ?ct .","?ct <http://scta.info/property/hasDocument> ?doc .","}","ORDER BY ?totalOrderNumber"].join("")),r=C(oe(e));this.arrangeParts(r),this.arrangeItems(n)}},{key:"makeRequests",value:function(e,t,a,n){"http://scta.info/resource/workGroup"===n?this.retrieveWorkGroupInfo(e,t,a):"http://scta.info/resource/structureCollection"===t&&this.retrieveCollectionInfo(e,t,a)}},{key:"componentDidMount",value:function(){this.mount=!0,this.setState({resourceid:this.props.resourceid}),this.makeRequests(this.props.resourceid,this.props.structureType,this.props.topLevel,this.props.type)}},{key:"componentDidUpdate",value:function(e){this.props.resourceid!==e.resourceid&&(this.setState({resourceid:this.props.resourceid,filter:""}),this.makeRequests(this.props.resourceid,this.props.structureType,this.props.topLevel,this.props.type))}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){return r.a.createElement(c.a,{className:"collectionBody"},this.state.title&&r.a.createElement("h1",null,this.state.title),this.state.title&&r.a.createElement("p",{style:{textAlign:"center"}},this.state.description),r.a.createElement(kt.a,null,r.a.createElement(St.a,{xs:9},r.a.createElement(c.a,null,r.a.createElement(he,{focusResourceid:this.state.resourceid,resourceid:this.state.resourceid,title:this.state.title,hidden:!1,mtFocus:"",collectionLink:!0,showAuthor:!0,showParentLink:!0,showChildren:!0,showFirstLevelChildren:!0})))),"http://scta.info/resource/scta"===this.state.resourceid&&r.a.createElement("div",null,r.a.createElement("h1",null,"Special Collections"),r.a.createElement("p",null,r.a.createElement(i.b,{to:"/res?resourceid=http://scta.info/resource/et-000004"},"Magnetica"),': A collection of texts on "Magnets"')))}}]),a}(r.a.Component),Rt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).mounted="",n.handleNext=n.handleNext.bind(Object(Z.a)(n)),n.handlePrevious=n.handlePrevious.bind(Object(Z.a)(n)),n.state={region:"full",surfaces:[]},n}return Object(Q.a)(a,[{key:"handleNext",value:function(){this.props.handleSurfaceFocusChange(this.state.next)}},{key:"handlePrevious",value:function(){this.props.handleSurfaceFocusChange(this.state.previous)}},{key:"retrieveSurfaceInfo",value:function(e){var t=this;C(["SELECT ?first ?last ?order ?surface","{","<"+e+"> <http://scta.info/property/isOnZone> ?zone . ","?zone <http://scta.info/property/isOnZone> ?zone2 .","?zone2 <http://scta.info/property/firstLine> ?first .","?zone2 <http://scta.info/property/lastLine> ?last .","?zone2 <http://scta.info/property/isPartOfSurface> ?surface .","?zone <http://scta.info/property/isOnZoneOrder> ?order .","}"].join("")).then((function(e){e.data.results.bindings.forEach((function(e){var a=e.surface.value,n=e.first.value,r=e.last.value,s=e.order.value;C(ie(a)).then((function(e){var o=e.data.results.bindings[0];if(o){var i="https://exist.scta.info/exist/apps/scta-app/folio-annotaiton-list-from-simpleXmlCoordinates.xq?surfaceid="+a.split("/resource/")[1]+"&coords=loose";T.a.get(i).then((function(e){t.mounted&&t.setState((function(t){var i={currentSurfaceId:a,surfaceTitle:o.surfaceTitle?o.surfaceTitle.value:"",canvas:o.canvas.value,imageurl:o.imageurl.value,next:o.next_surface?o.next_surface.value:"",previous:o.previous_surface?o.previous_surface.value:"",annotations:e.data?e.data.resources:"",surfaceid:a,firstLine:n,lastLine:r,order:s};return{surfaces:[].concat(Object(A.a)(t.surfaces),[i])}}))})).catch((function(e){t.mounted&&t.setState((function(e){var t={currentSurfaceId:a,surfaceTitle:o.surfaceTitle.value,canvas:o.canvas.value,imageurl:o.imageurl.value,next:o.next_surface?o.next_surface.value:"",previous:o.previous_surface?o.previous_surface.value:"",annotations:"",surfaceid:a,firstLine:n,lastLine:r,order:s};return{surfaces:[].concat(Object(A.a)(e.surfaces),[t])}}))}))}}))}))}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.props.manifestationid&&this.setState((function(e){return{surfaces:[]}}),this.retrieveSurfaceInfo(this.props.manifestationid))}},{key:"componentDidUpdate",value:function(e){this.props.manifestationid!==e.manifestationid&&this.setState((function(e){return{surfaces:[]}}),this.retrieveSurfaceInfo(this.props.manifestationid))}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(t){if(t.annotations&&"lines"===e.props.annotationsDisplay)return t.annotations.map((function(a,n){if(n+1>=t.firstLine&&n<t.lastLine){var s=a.resource.chars,o=a.on.split("#xywh=")[0],i=o.split("/")[o.split("/").length-1],l=a.on.split("#xywh=")[1],c=a.imageUrl,u=a.label;return r.a.createElement(we,{key:n,imageUrl:c,canvas:o,coords:l,canvasShort:i,text:s,label:u,number:n+1,targetLabel:e.props.targetLabel,surfaceButton:!1,displayWidth:e.props.width})}return null}));if(t.annotations&&"paragraph"===e.props.annotationsDisplay){var a=t.annotations.length?t.annotations[t.firstLine-1]:t.annotations,n=t.annotations.length?t.annotations[t.firstLine-1]:t.annotations,s=n?n.on.split("#xywh=")[0]:"",o=s.split("/")[s.split("/").length-1],i=n?n.on.split("#xywh=")[1]:"",l=i.split(",")[1],c=t.annotations.length?t.annotations[t.lastLine-1]:t.annotations,u=c?c.on.split("#xywh=")[1]:"",p=u.split(",")[1],d=u.split(",")[3],h=parseInt(p)+parseInt(d)-parseInt(l),m=(parseInt(i.split(",")[0])>10?parseInt(i.split(",")[0])-10:parseInt(i.split(",")[0]))+","+parseInt(l)+","+(parseInt(i.split(",")[2])+10)+","+(parseInt(h)+50),f=a?a.imageUrl:"",g="";if(e.props.lineFocusId)if(t.annotations.length)t.annotations.forEach((function(t,a){parseInt(e.props.lineFocusId.split("/")[e.props.lineFocusId.split("/").length-1])===a+1&&(g=t.on.split("#xywh=")[1])}));else{var v=t.annotations;1===parseInt(e.props.lineFocusId.split("/")[e.props.lineFocusId.split("/").length-1])&&(g=v.on.split("#xywh=")[1])}return f?r.a.createElement(we,{key:t.currentSurfaceId+"-"+t.order,imageUrl:f,canvas:s,coords:m,canvasShort:o,text:"",label:"",targetLabel:"",surfaceButton:!1,displayWidth:e.props.width,lineFocusCoords:g}):r.a.createElement("p",{key:t.currentSurfaceId+"-"+t.order},"Sorry, this image is not yet ready")}return r.a.createElement("img",{key:t.currentSurfaceId+"-"+t.order,alt:"manuscript",src:t.imageurl+"/full/"+e.props.width+",/0/default.jpg"})};return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},e.state.surfaces.sort((function(e,t){return e.order>t.order?1:t.order>e.order?-1:0})).map((function(e){return t(e)})),r.a.createElement(Ce,{imageurl:this.state.surfaces[0]?this.state.surfaces[0].imageurl:""}))}}]),a}(r.a.Component);Rt.defaultProps={width:"501"};var Lt=Rt,jt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleChangeManifestation=n.handleChangeManifestation.bind(Object(Z.a)(n)),n.handleToggleTextLinesView=n.handleToggleTextLinesView.bind(Object(Z.a)(n)),n.handleSetCustomExpressionId=n.handleSetCustomExpressionId.bind(Object(Z.a)(n)),n.handleGetCustomManifestations=n.handleGetCustomManifestations.bind(Object(Z.a)(n)),n.handleChangeCustomManifestation=n.handleChangeCustomManifestation.bind(Object(Z.a)(n)),n.state={focusedManifestation:"",annotationsDisplay:"lines",userAddedExpressionId:"",userAddedManifestations:[],focusedCustomManifestation:""},n}return Object(Q.a)(a,[{key:"handleChangeCustomManifestation",value:function(e){this.setState({focusedCustomManifestation:e})}},{key:"handleSetCustomExpressionId",value:function(e){this.setState({userAddedExpressionId:e})}},{key:"handleGetCustomManifestations",value:function(e){var t=this;e.preventDefault(),C(se(this.state.userAddedExpressionId)).then((function(e){var a=e.data.results.bindings.map((function(e){return{manifestation:e.manifestation.value,manifestationTitle:e.manifestationTitle.value,transcription:e.manifestationCTranscription?e.manifestationCTranscription.value:""}}));t.setState({userAddedManifestations:a,focusedCustomManifestation:e.data.results.bindings[0].cmanifestation.value})}))}},{key:"handleToggleTextLinesView",value:function(e){this.props.handleToggleTextLinesView?this.props.handleToggleTextLinesView(e):this.setState((function(t){return{annotationsDisplay:e}}))}},{key:"handleChangeManifestation",value:function(e){e.preventDefault(),this.props.handleChangeManifestation?this.props.handleChangeManifestation(e.target.value):this.setState({focusedManifestation:e.target.value})}},{key:"componentDidMount",value:function(){var e=this;this.props.manifestations&&this.setState((function(t){return{focusedManifestation:e.props.focusedManifestation,annotationsDisplay:e.props.annotationsDisplay}}))}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.focusedManifestation!==e.focusedManifestation&&this.setState((function(e){return{focusedManifestation:t.props.focusedManifestation}})),this.props.annotationsDisplay!==e.annotationsDisplay&&this.setState((function(e){return{annotationsDisplay:t.props.annotationsDisplay}}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},!this.props.hideSelectionList&&r.a.createElement("div",{className:"manifestationsList"},r.a.createElement(g.a.Control,{size:"sm",as:"select",onChange:this.handleChangeManifestation,value:this.state.focusedManifestation},e.props.manifestations.map((function(e){return r.a.createElement("option",{key:"title-"+e.manifestation,value:e.manifestation},e.manifestationTitle)})))),r.a.createElement("div",{className:"surfaceWrapper"},!this.props.hideDisplayChoice&&this.state.focusedManifestation&&r.a.createElement("div",{className:"image-display-choice"},r.a.createElement("p",null,r.a.createElement("span",{title:"Text Line View",onClick:function(){e.handleToggleTextLinesView("lines")}},r.a.createElement(re.v,null))),r.a.createElement("p",null,r.a.createElement("span",{title:"Paragraph View",onClick:function(){e.handleToggleTextLinesView("paragraph")}},r.a.createElement(re.w,null))),r.a.createElement("p",null,r.a.createElement("span",{title:"Full Surface View",onClick:function(){e.handleToggleTextLinesView("surface")}},r.a.createElement(re.s,null)))),r.a.createElement("div",{className:"imagesDisplay"},e.props.manifestations.map((function(t){return t.manifestation===e.state.focusedManifestation?r.a.createElement(Lt,{key:"surface-"+t.manifestation,manifestationid:t.manifestation,annotationsDisplay:e.state.annotationsDisplay,width:e.props.width,lineFocusId:e.props.lineFocusId}):null})))),this.state.userAddedManifestations.length>0&&r.a.createElement(a,{manifestations:this.state.userAddedManifestations,focusedManifestation:this.state.focusedCustomManifestation,annotationsDisplay:this.state.annotationsDisplay,handleToggleTextLinesView:this.props.handleToggleTextLinesView,handleChangeManifestation:this.handleChangeCustomManifestation,width:this.props.width,lineFocusId:"",hidden:!1,isDependentSurface3:!0}),!this.props.isDependentSurface3&&r.a.createElement("div",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.1)",borderTop:"1px solid rgba(0, 0, 0, 0.1)",marginTop:"5px",padding:"5px"}},r.a.createElement("p",{style:{fontSize:"12px"}},"Create custom user compare"),r.a.createElement(g.a,{onSubmit:this.handleGetCustomManifestations,inline:!0},r.a.createElement(Ae.a,{inline:"true",size:"sm",id:"text",type:"text",value:this.state.userAddedExpressionId,placeholder:"expression id",className:"mr-sm-2",onChange:function(t){e.handleSetCustomExpressionId(t.target.value)}}),r.a.createElement(p.a,{inline:"true",size:"sm",type:"submit",style:{margin:"2px"}},"Submit"))))}}]),a}(r.a.Component);jt.defaultProps={manifestations:[],hidden:!1,focusedManifestation:"",annotationsDisplay:"paragraph",width:"500"};var Ft=jt,Dt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).retrieveCodexInfo=n.retrieveCodexInfo.bind(Object(Z.a)(n)),n.handleSurfaceFocusChange=n.handleSurfaceFocusChange.bind(Object(Z.a)(n)),n.handleToggleShowContents=n.handleToggleShowContents.bind(Object(Z.a)(n)),n.state={items:{},title:"",focusedSurface:"",relatedCodices:[],showContents:!0,surface3Manifestations:[],surface3FocusedManifestation:""},n}return Object(Q.a)(a,[{key:"handleToggleShowContents",value:function(){this.setState((function(e){return{showContents:!e.showContents}}))}},{key:"handleSurfaceFocusChange",value:function(e){this.props.handleSetFocus(e)}},{key:"retrieveCodexInfo",value:function(e,t){var a=this;C("surface"===t?ue(e):"canvas"===t?pe(e):"manifest"===t?ce(e):le(e)).then((function(n){var r=n.data.results.bindings;if(r.length>0&&r[0].surface){var s=r.map((function(e){return e.expression?e.expression.value:""})).filter((function(e,t,a){return a.indexOf(e)===t})),o={};s.forEach((function(e){o[e]=[]})),r.forEach((function(e){var t={expression:e.expression.value,expressionTitle:e.item_expression_title.value,manifestation:e.manifestation.value,surface:e.surface.value,surfaceTitle:e.surface_title.value,questionTitle:e.item_expression_question_title?e.item_expression_question_title.value:""};o[e.expression.value].push(t)}));var i="";i="surface"===t?e:"canvas"===t?r[0].surfaceFocus.value:r[0].surface.value,a.setState({items:o,focusedSurface:i}),a.props.handleSurfaceFocusChange(i)}}))}},{key:"componentDidMount",value:function(){this.retrieveCodexInfo(this.props.resourceid,this.props.codexResourceType)}},{key:"componentDidUpdate",value:function(e){this.props.resourceid&&this.props.resourceid!==e.resourceid&&this.retrieveCodexInfo(this.props.resourceid,this.props.codexResourceType)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"codexImage"},r.a.createElement("h1",null,"Codex Pages"),e.state.surface3Manifestations.length>0?r.a.createElement(Ft,{manifestations:e.state.surface3Manifestations,focusedManifestation:e.state.surface3FocusedManifestation,annotationsDisplay:"paragraph",width:"501",hidden:!1}):e.state.focusedSurface?r.a.createElement(ke,{surfaceid:e.state.focusedSurface,lineFocusId:"",topLevel:e.props.topLevel,handleSurfaceFocusChange:e.handleSurfaceFocusChange,width:"501",annotationsDisplay:!1,hidden:!1}):null)}}]),a}(r.a.Component);var At=function(e){var t=Object(n.useState)([]),a=Object(f.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)((function(){var t;C(["SELECT ?expression ?eLongTitle ?expressionAuthor ?expressionAuthorTitle ?author ?authorTitle ","{","{","?expression <http://scta.info/property/expressionType> <"+(t=e.expressionTypeId)+"> .","}","UNION","{","?expression <http://scta.info/property/expressionType> ?expressionType .","?expressionType <http://scta.info/property/isMemberOf> <"+t+"> .","}","?expression <http://scta.info/property/longTitle> ?eLongTitle .","OPTIONAL {","?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","}","ORDER BY ?authorTitle"].join(" ")).then((function(e){var t=e.data.results.bindings;o(t)}))}),[e.expressionTypeId]),r.a.createElement(c.a,{className:"collectionBody"},r.a.createElement("h1",null,e.expressionTypeId),s.map((function(e){return r.a.createElement(c.a,null,r.a.createElement(he,{focusResourceid:e.expression.value,resourceid:e.expression.value,title:e.authorTitle?e.authorTitle.value+", "+e.eLongTitle.value:e.eLongTitle.value,hidden:!1,mtFocus:"",collectionLink:!0,showParentLink:!0}))})))},Nt=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).mount=!1,n.openWindow=n.openWindow.bind(Object(Z.a)(n)),n.setFocus=n.setFocus.bind(Object(Z.a)(n)),n.setFocus2=n.setFocus2.bind(Object(Z.a)(n)),n.handleTabChange=n.handleTabChange.bind(Object(Z.a)(n)),n.handleClose=n.handleClose.bind(Object(Z.a)(n)),n.handleMinimize=n.handleMinimize.bind(Object(Z.a)(n)),n.handleMaximize=n.handleMaximize.bind(Object(Z.a)(n)),n.handleMiddlize=n.handleMiddlize.bind(Object(Z.a)(n)),n.handleSwitchWindow=n.handleSwitchWindow.bind(Object(Z.a)(n)),n.handleDuplicateWindow=n.handleDuplicateWindow.bind(Object(Z.a)(n)),n.handleSurfaceFocusChange=n.handleSurfaceFocusChange.bind(Object(Z.a)(n)),n.handleLineFocusChange=n.handleLineFocusChange.bind(Object(Z.a)(n)),n.handleToggleTextLinesView=n.handleToggleTextLinesView.bind(Object(Z.a)(n)),n.handleChangeManifestation=n.handleChangeManifestation.bind(Object(Z.a)(n)),n.handleTextPreviewFocusChange=n.handleTextPreviewFocusChange.bind(Object(Z.a)(n)),n.handleShowCollationOverlay=n.handleShowCollationOverlay.bind(Object(Z.a)(n)),n.handleAddCtRelatedExpressions=n.handleAddCtRelatedExpressions.bind(Object(Z.a)(n)),n.handleTogglePdfView=n.handleTogglePdfView.bind(Object(Z.a)(n)),n.handleUpdateSelectionRange=n.handleUpdateSelectionRange.bind(Object(Z.a)(n)),n.state={ctRelatedExpressions:[],doc:"",focus:"",mtFocus:"",itemFocus:"",surfaceid:"",lineFocusId:"",textPreviewObjects:[],pdfView:!1,selectionRange:void 0,windows:{window1:{windowId:"window1",open:!0,windowLoad:"citation",position:"sideWindow",openWidthHeight:"middle",annotationsDisplay:"paragraph",defaultManifestationSlug:""},window2:{windowId:"window2",open:!1,windowLoad:"citation",position:"bottomWindow",openWidthHeight:"middle",annotationsDisplay:"paragraph",defaultManifestationSlug:""}}},n}return Object(Q.a)(a,[{key:"handleTogglePdfView",value:function(){this.setState((function(e){return{pdfView:!e.pdfView}}))}},{key:"handleToggleTextLinesView",value:function(e,t){this.setState((function(a){var n=a.windows;return n[e].annotationsDisplay=t,{windows:n}}))}},{key:"handleChangeManifestation",value:function(e,t){this.setState((function(a){var n=a.windows;return n[e].defaultManifestationSlug=t,{windows:n}}))}},{key:"openWindow",value:function(e,t){this.state.windows[e].open&&this.state.windows[e].windowLoad===t||this.setState((function(a){var n=a.windows;return n[e].open=!0,t&&(n[e].windowLoad=t),{windows:n}}))}},{key:"handleClose",value:function(e){this.setState((function(t){var a=t.windows;return a[e].open=!1,{windows:a}})),O(this.state.blockFocus,!0)}},{key:"handleMinimize",value:function(e){this.setState((function(t){var a=t.windows;return a[e].openWidthHeight="minimum",{windows:a}}))}},{key:"handleMaximize",value:function(e){this.setState((function(t){var a=t.windows;return a[e].openWidthHeight="maximum",{windows:a}}))}},{key:"handleMiddlize",value:function(e){this.setState((function(t){var a=t.windows;return a[e].openWidthHeight="middle",{windows:a}}))}},{key:"handleUpdateSelectionRange",value:function(e){var t=e;this.setState({selectionRange:t})}},{key:"handleSwitchWindow",value:function(e,t){this.setState((function(t){var a=t.windows;return"sideWindow"===a[e].position?a[e].position="bottomWindow":"bottomWindow"===a[e].position&&(a[e].position="sideWindow"),{windows:a}}))}},{key:"handleDuplicateWindow",value:function(e,t){this.setState((function(t){var a=t.windows,n="window1"===e?"window2":"window1";return"sideWindow"===a[e].position?(a[n].position="bottomWindow",a[n].open=!0):"bottomWindow"===a[e].position&&(a[n].position="sideWindow",a[n].open=!0),{windows:a}}))}},{key:"handleTabChange",value:function(e,t){this.setState((function(a){var n=a.windows;return n[t].windowLoad=e,{windows:n}}))}},{key:"handleSurfaceFocusChange",value:function(e){this.setState({surfaceid:e})}},{key:"handleLineFocusChange",value:function(e){this.setState({lineFocusId:e})}},{key:"handleTextPreviewFocusChange",value:function(e){this.setState({textPreviewObjects:e})}},{key:"handleShowCollationOverlay",value:function(){console.log("firing"),this.openWindow("window2","collationTable")}},{key:"handleAddCtRelatedExpressions",value:function(e){this.handleShowCollationOverlay(!0),this.setState((function(t){return{ctRelatedExpressions:[].concat(Object(A.a)(t.ctRelatedExpressions),[e])}}))}},{key:"setFocus",value:function(e){var t=e.split("@")[1]?"@"+e.split("@")[1]:"",a=(e=e.split("@")[0]).includes("http")?e+this.state.mtFocus+t:"http://scta.info/resource/"+e+this.state.mtFocus+t;this.props.handleUpdateUrlResource(a)}},{key:"setFocus2",value:function(e){this.props.handleUpdateUrlResource(e)}},{key:"retrieveFocusInfo",value:function(e){var t=e.includes("http")?e:"http://scta.info/resource/"+e,a=C(se(t));this.arrangeFocusInfo(a,t)}},{key:"arrangeFocusInfo",value:function(e,t){var a=this;e.then((function(e){var n=e.data.results.bindings[0],r=e.data.results.bindings.map((function(e){var t;return{manifestation:e.manifestation.value,manifestationTitle:e.manifestationTitle.value,transcription:e.manifestationCTranscription?e.manifestationCTranscription.value:"",transcriptionDoc:null===(t=e.manifestationCTranscriptionDoc)||void 0===t?void 0:t.value}}));a.mount&&n&&a.setState({focus:{resourceid:t,title:n.title.value,longTitle:n.longTitle?n.longTitle.value:"",author:n.author?n.author.value:"",authorTitle:n.authorTitle?n.authorTitle.value:"",structureType:n.structureType.value,inbox:n.inbox.value,next:n.next?n.next.value:"",previous:n.previous?n.previous.value:"",parent:n.parent?n.parent.value:"",cdoc:n.cdoc?n.cdoc.value:"",cxml:n.cxml?n.cxml.value:"",topLevel:n.topLevelExpression?n.topLevelExpression.value:"",cmanifestation:n.cmanifestation.value,ctranscription:n.ctranscription?n.ctranscription.value:"",manifestations:r}})}))}},{key:"setItemFocus",value:function(e){var t=e.includes("http")?e:"http://scta.info/resource/"+e,a=C(["SELECT DISTINCT ?title ?manifestation ?doc ?xml ?expression ?expressionShortId ?longTitle ?topLevelExpression ?next ?previous ?inbox ?t ","WHERE { ","BIND(<"+t+"> as ?t) . ","?t <http://purl.org/dc/elements/1.1/title> ?title .","?t <http://scta.info/property/isTranscriptionOf> ?manifestation .","?t <http://scta.info/property/hasDocument> ?doc . ","?t <http://scta.info/property/hasXML> ?xml . ","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?expressionTitle .","?expression <http://scta.info/property/shortId> ?expressionShortId .","?expression <http://scta.info/property/longTitle> ?longTitle .","?expression <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .","OPTIONAL {","?expression <http://scta.info/property/next> ?next .","}","OPTIONAL {","?expression <http://scta.info/property/previous> ?previous .","}","?expression <http://www.w3.org/ns/ldp#inbox> ?inbox . ","}","ORDER BY ?expressionTitle"].join(""));this.arrangeItemFocusInfo(a)}},{key:"arrangeItemFocusInfo",value:function(e){var t=this;e.then((function(e){var a=e.data.results.bindings[0];t.mount&&t.setState({itemFocus:{title:a.title.value,manifestation:a.manifestation.value,expression:a.expression.value,doc:a.doc.value,xml:a.xml.value,next:a.next?a.next.value:"",previous:a.previous?a.previous.value:"",inbox:a.inbox.value,topLevel:a.topLevelExpression.value,transcriptionid:a.t.value}})}))}},{key:"componentDidMount",value:function(){if(this.mount=!0,"person"===this.props.resourceType||"workGroup"===this.props.resourceType||"codex"===this.props.resourceType||"expressionType"===this.props.resourceType);else if("collection"===this.props.resourceType){this.retrieveFocusInfo(this.props.expressionid);var e=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[1]:"",t=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[2]:"";this.setState({mtFocus:"/"+e+"/"+t,itemFocus:""})}else if(this.props.itemTranscriptionId){this.setItemFocus(this.props.itemTranscriptionId);var a=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[1],n=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[2],r=this.props.tokenRange?{wordRange:this.props.tokenRange,selectedElementTargetId:this.props.expressionid&&this.props.expressionid.split("/resource/")[1]}:{};this.setState({mtFocus:"/"+a+"/"+n,selectionRange:r}),this.props.expressionid&&this.retrieveFocusInfo(this.props.expressionid)}}},{key:"componentDidUpdate",value:function(e){var t=this;if("person"===this.props.resourceType||"workGroup"===this.props.resourceType||"codex"===this.props.resourceType||"expressionType"===this.props.resourceType)this.props.resourceid!==e.resourceid&&this.setState({focus:"",mtFocus:""});else if("collection"===this.props.resourceType){if(this.props.resourceid!==e.resourceid){this.retrieveFocusInfo(this.props.expressionid);var a=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[1]:"",n=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[2]:"";this.setState({mtFocus:"/"+a+"/"+n,itemFocus:""})}}else{if(this.props.itemTranscriptionId!==e.itemTranscriptionId){this.setItemFocus(this.props.itemTranscriptionId);var r=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[1],s=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[2];this.setState((function(e){var a=e.windows;a.window1.defaultManifestationSlug="",a.window2.defaultManifestationSlug="";var n=t.props.tokenRange?Object(ae.a)(Object(ae.a)({},e.selectionRange),{},{wordRange:t.props.tokenRange,selectedElementTargetId:t.props.expressionid&&t.props.expressionid.split("/resource/")[1]}):{};return{mtFocus:"/"+r+"/"+s,selectionRange:n,windows:a,ctRelatedExpressions:[]}}))}this.props.expressionid!==e.expressionid&&(this.props.expressionid?(this.setState((function(e){return{selectionRange:t.props.tokenRange?Object(ae.a)(Object(ae.a)({},e.selectionRange),{},{wordRange:t.props.tokenRange,selectedElementTargetId:t.props.expressionid&&t.props.expressionid.split("/resource/")[1]}):{},ctRelatedExpressions:[]}})),this.retrieveFocusInfo(this.props.expressionid)):this.setState({focus:"",selectionRange:"",ctRelatedExpressions:[]})),this.props.tokenRange!==e.tokenRange&&this.setState((function(e){return{selectionRange:t.props.tokenRange?Object(ae.a)(Object(ae.a)({},e.selectionRange),{},{wordRange:t.props.tokenRange,selectedElementTargetId:t.props.expressionid&&t.props.expressionid.split("/resource/")[1]}):{},ctRelatedExpressions:[]}}))}}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){var e=this,t=["lbp-text"];this.state.windows.window1.open&&"middle"===this.state.windows.window1.openWidthHeight?t.push("skinnyText"):t.push("fullText"),this.state.windows.window2.open&&t.push("longText"),this.state.pdfView?t.push("hidden"):t.push("showing");return r.a.createElement("div",null,this.state.pdfView&&r.a.createElement(ne,{url:this.state.itemFocus.doc}),r.a.createElement(c.a,{className:t.join(" ")},"codex"===e.props.resourceType?r.a.createElement(Dt,{resourceid:e.props.resourceid,codexResourceType:e.props.codexResourceType,handleSetFocus:e.setFocus,handleSurfaceFocusChange:e.handleSurfaceFocusChange}):"person"===e.props.resourceType?r.a.createElement(wt,{resourceid:e.props.resourceid}):"workGroup"===e.props.resourceType?r.a.createElement(It,{resourceid:e.props.resourceid,type:"http://scta.info/resource/workGroup"}):"expressionType"===e.props.resourceType?r.a.createElement(At,{expressionTypeId:e.props.resourceid}):"collection"===e.props.resourceType?r.a.createElement("div",null,r.a.createElement("h1",null,e.state.resourceTitle),r.a.createElement("p",{style:{textAlign:"center"}},"By ",r.a.createElement(i.b,{to:"/text?resourceid="+e.state.focus.author},e.state.focus.authorTitle)),r.a.createElement(he,{focusResourceid:e.props.resourceid,resourceid:e.props.resourceid,title:e.state.focus.title,hidden:!1,mtFocus:"",collectionLink:!0,showParentLink:!0})):e.state.itemFocus&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ot,{transcriptionid:e.state.itemFocus.transcriptionid,handleFocusChange:e.setFocus2}),r.a.createElement(Et,{doc:e.state.itemFocus.doc,topLevel:e.state.itemFocus.topLevel,setFocus:e.setFocus,handleSurfaceFocusChange:e.handleSurfaceFocusChange,handleLineFocusChange:e.handleLineFocusChange,openWindow:e.openWindow,scrollTo:e.props.expressionid&&e.props.expressionid.split("/resource/")[1],handleTextPreviewFocusChange:e.handleTextPreviewFocusChange,handleUpdateSelectionRange:e.handleUpdateSelectionRange,selectionRange:e.state.selectionRange}))),this.state.itemFocus&&r.a.createElement(vt,{next:this.state.itemFocus&&this.state.itemFocus.next,previous:this.state.itemFocus&&this.state.itemFocus.previous,topLevel:this.state.itemFocus&&this.state.itemFocus.topLevel,handleClose:this.handleClose,pdfView:this.state.pdfView,handleTogglePdfView:this.handleTogglePdfView,mtFocus:this.state.mtFocus}),r.a.createElement("div",null,!this.state.pdfView&&Object.keys(e.state.windows).map((function(t){return e.state.windows[t].open?r.a.createElement(ht,{key:t,handleClose:e.handleClose,handleMinimize:e.handleMinimize,handleMaximize:e.handleMaximize,handleMiddlize:e.handleMiddlize,handleTabChange:e.handleTabChange,handleBlockFocusChange:e.setFocus,handleFocusChange:e.setFocus2,handleSurfaceFocusChange:e.handleSurfaceFocusChange,handleSwitchWindow:e.handleSwitchWindow,handleDuplicateWindow:e.handleDuplicateWindow,resourceid:e.state.focus?e.state.focus.resourceid:e.props.resourceid,resourceType:e.props.resourceType?e.props.resourceType:"text",windowType:e.state.windows[t].position,windowId:e.state.windows[t].windowId,windowLoad:e.state.windows[t].windowLoad,openWidthHeight:e.state.windows[t].openWidthHeight,surfaceid:e.state.surfaceid,lineFocusId:e.state.lineFocusId,info:e.state.focus,itemFocus:e.state.itemFocus,altWindowState:"window1"===e.state.windows[t].windowId?e.state.windows.window2.open:e.state.windows.window1.open,mtFocus:e.state.mtFocus,handleToggleTextLinesView:e.handleToggleTextLinesView,annotationsDisplay:e.state.windows[t].annotationsDisplay,handleChangeManifestation:e.handleChangeManifestation,defaultManifestationSlug:e.state.windows[t].defaultManifestationSlug,textPreviewObjects:e.state.textPreviewObjects,handleTextPreviewFocusChange:e.handleTextPreviewFocusChange,handleLineFocusChange:e.handleLineFocusChange,selectionRange:e.state.selectionRange,codexResourceType:e.props.codexResourceType,userId:e.props.userId,handleShowCollationOverlay:e.handleShowCollationOverlay,handleAddCtRelatedExpressions:e.handleAddCtRelatedExpressions,ctRelatedExpressions:e.state.ctRelatedExpressions}):null}))))}}]),a}(r.a.Component),Pt=(a(642),function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).retrieveText=n.retrieveText.bind(Object(Z.a)(n)),n}return Object(Q.a)(a,[{key:"retrieveText",value:function(e,t,a){var n=this;if(e){var r=this.props.doc,s="";if(r.includes("ipfs")||r.includes("zotero"))s=r;else s="https://exist.scta.info/exist/apps/scta-app/text/scta-articles/"+r.split("/master/")[1].split("/")[1];w(s,"http://scta.info/resource/timeline"===a?"/xslt/articles/timeline.xsl":"http://scta.info/resource/bibliography"===a?"/xslt/articles/bibliography.xsl":"http://scta.info/resource/biography"===a?"/xslt/articles/biography.xsl":"/xslt/articles/standard.xsl").then((function(e){document.getElementById("text").innerHTML="",document.getElementById("text").appendChild(e),y()(".appnote, .footnote").click((function(e){e.preventDefault()})),y()(".appnote, .footnote").parent().click((function(e){e.preventDefault();var t=y()(this).children(".appnote, .footnote"),a=y()(t).attr("href"),n=y()(a).html(),r=y()(this).children(".note-display").attr("data-target-id");r&&(y()("#"+r).toggleClass("highlight"),y()("span[data-corresp="+r+"]").toggleClass("highlight"));var s=y()(this).children(".note-display");s.toggleClass("hidden"),s.html(n)})),y()(document).on("click",".js-show-reference-paragraph",(function(e){e.preventDefault();var t=y()(this).attr("data-url"),a=y()(this).attr("data-target-paragraph");n.props.setFocus(a),n.props.handleTextPreviewFocusChange(t),n.props.openWindow("window2","textPreview")}))})).catch((function(e){console.log("something went wrong",e),document.getElementById("text").innerHTML="",document.getElementById("text").innerHTML="<p>Apologies, the document is not able to be loaded at this time</p>"}))}}},{key:"componentDidUpdate",value:function(e,t){e.doc!==this.props.doc?this.retrieveText(this.props.doc,this.props.scrollTo,this.props.articleType):this.props.scrollTo!==e.scrollTo&&O(this.props.scrollTo,!0)}},{key:"componentDidMount",value:function(){this.retrieveText(this.props.doc,this.props.scrollTo,this.props.articleType)}},{key:"render",value:function(){return r.a.createElement(c.a,null,r.a.createElement("div",{id:"text"}))}}]),a}(r.a.Component));var Mt=function(e){var t=Object(n.useState)([]),a=Object(f.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(""),u=Object(f.a)(l,2),p=u[0],d=u[1];return Object(n.useEffect)((function(){var t=C(["SELECT ?resource ?resourceTitle","{","?resource a <"+e.resourceTypeId+"> .","?resource <http://purl.org/dc/elements/1.1/title> ?resourceTitle","}","ORDER BY ?resourceTitle"].join(""));o("fetching"),t.then((function(e){o(e.data.results.bindings)}))}),[e.resourceTypeId]),r.a.createElement(c.a,{className:"collectionBody"},r.a.createElement("h1",null,e.resourceTypeId),r.a.createElement(g.a.Control,{as:"input",type:"text",placeholder:"filter",onChange:function(e){return d(e.target.value)},value:p}),"fetching"===s?r.a.createElement(D,null):s.map((function(e){return"http://scta.info/resource/"!==e.resource.value&&e.resourceTitle.value.toLowerCase().includes(p.toLowerCase())?r.a.createElement("p",{key:e.resource.value},r.a.createElement(i.b,{to:"/text?resourceid="+e.resource.value},e.resourceTitle.value)):null})))},_t=function(e){Object(J.a)(a,e);var t=Object(K.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).handleUpdateUrlResource=n.handleUpdateUrlResource.bind(Object(Z.a)(n)),n.state={displayType:"",resourceid:"",itemTranscriptionId:"",blockDivFocus:"",resourceTitle:"",author:"",authorTitle:"",tokenRange:""},n}return Object(Q.a)(a,[{key:"handleUpdateUrlResource",value:function(e){this.props.history.push({search:"?resourceid="+e})}},{key:"getInfo",value:function(e,t){var a,n,r=this;e.split("@")[1]&&(a={start:parseInt(e.split("@")[1].split("-")[0]),end:parseInt(e.split("@")[1].split("-")[1])}),e=e.split("@")[0],C(["SELECT DISTINCT ?type ?structureType ?level ?topLevel ?itemParent ?resourceTitle ?author ?authorTitle ?ctranscription ","WHERE { ","<"+(n=e)+"> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?type . ","OPTIONAL {","<"+n+"> <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL {","<"+n+"> <http://purl.org/dc/elements/1.1/title> ?resourceTitle .","}","OPTIONAL {","<"+n+"> <http://scta.info/property/structureType> ?structureType . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/level> ?level . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/isPartOfTopLevelManifestation> ?topLevel . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/isPartOfTopLevelTransription> ?topLevel . ","}","OPTIONAL {","{","<"+n+"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . ","}","UNION","{","<"+n+"> <http://scta.info/property/isPartOfStructureBlock> ?blockParent . ","?blockParent  <http://scta.info/property/isPartOfStructureItem> ?itemParent .","}","}","OPTIONAL {","{","<"+n+"> <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation . ","?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","UNION","{","<"+n+"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","UNION","{","<"+n+"> a <http://scta.info/resource/transcription> . ","BIND(<"+n+"> AS ?ctranscription) .","}","}","}"].join("")).then((function(t){var n=t.data.results.bindings.length>0?t.data.results.bindings[0]:"",s=n.type?n.type.value:null,o=n.structureType?n.structureType.value:null,i=n.topLevel?n.topLevel.value:e,l=n.itemParent?n.itemParent.value:null,c=n.resourceTitle?n.resourceTitle.value:"",u=n.author?n.author.value:"",p=n.authorTitle?n.authorTitle.value:"",d=n.ctranscription?n.ctranscription.value:"";if("http://scta.info/resource/person"===e)r.setState({displayType:"personList",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/codex"===e)r.setState({displayType:"codexList",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/expressionType"===e)r.setState({displayType:"expressionTypeList",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/expressionType"===s)r.setState({displayType:"expressionType",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/person"===s)r.setState({displayType:"person",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://scta.info/resource/article"===s){C(function(e){return["SELECT DISTINCT ?doc ?articleType ","WHERE { ","<"+e+"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","<"+e+"> <http://scta.info/property/articleType> ?articleType .","?ctranscription <http://scta.info/property/hasXML> ?doc . ","}"].join("")}(e)).then((function(t){r.setState({displayType:"article",articleDoc:t.data.results.bindings[0]?t.data.results.bindings[0].doc.value:"",articleType:t.data.results.bindings[0]?t.data.results.bindings[0].articleType.value:"",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c})}))}else if("http://scta.info/resource/codex"===s)r.setState({displayType:"codex",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://scta.info/resource/surface"===s)r.setState({displayType:"surface",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://iiif.io/api/presentation/2#Manifest"===s)r.setState({displayType:"manifest",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://iiif.io/api/presentation/2#Canvas"===s)r.setState({displayType:"canvas",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://scta.info/resource/workGroup"===s)r.setState({displayType:"workGroup",resourceid:e,structureType:o,topLevel:i,type:s,resourceTitle:c});else if("http://scta.info/resource/structureCollection"===o)r.setState({displayType:"collection",transcriptionid:d,resourceid:e,expressionid:"http://scta.info/resource/"+e.split("/resource/")[1].split("/")[0],structureType:o,topLevel:i,type:s,resourceTitle:c,author:u,authorTitle:p});else if("http://scta.info/resource/structureItem"===o)r.setState({itemTranscriptionId:d,displayType:"item",resourceid:e,expressionid:"http://scta.info/resource/"+e.split("/resource/")[1].split("/")[0],transcriptionid:d,resourceTitle:c,tokenRange:a});else if("http://scta.info/resource/structureElement"===o||"http://scta.info/resource/structureBlock"===o||"http://scta.info/resource/structureDivision"===o){C(function(e){return["SELECT DISTINCT ?ctranscription ?blockDivExpression ","WHERE { ","OPTIONAL","{","{","<"+e+"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . ","}","UNION","{","<"+e+">  <http://scta.info/property/isPartOfStructureBlock> ?blockParent .","?blockParent <http://scta.info/property/isPartOfStructureItem> ?itemParent . ","}","?itemParent <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> . ","{","{","?itemParent <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation . ","?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","UNION","{","?itemParent <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","}","}","OPTIONAL","{","{","<"+e+"> <http://scta.info/property/isManifestationOf> ?blockDivExpression . ","}","UNION","{","<"+e+"> <http://scta.info/property/isTranscriptionOf> ?blockDivManifestation . ","?blockDivManifestation <http://scta.info/property/isManifestationOf> ?blockDivExpression . ","}","}","}"].join("")}(e)).then((function(t){"http://scta.info/resource/transcription"===s?r.setState({itemTranscriptionId:l,resourceid:e,expressionid:t.data.results.bindings[0].blockDivExpression.value,transcriptionid:e,displayType:"item",resourceTitle:c,tokenRange:a}):"http://scta.info/resource/expression"===s?t.data.results.bindings[0].ctranscription?r.setState({itemTranscriptionId:t.data.results.bindings[0].ctranscription.value,resourceid:e,expressionid:e,transcriptionid:"this would be the focus transcription id",displayType:"item",resourceTitle:c,tokenRange:a}):r.setState({displayType:"notFound"}):r.setState({itemTranscriptionId:t.data.results.bindings[0].ctranscription.value,resourceid:e,expressionid:t.data.results.bindings[0].blockDivExpression.value,transcriptionid:"this would be the focus transcription id",displayType:"item",resourceTitle:c,tokenRange:a})}))}else{var h=e.split("/resource/")[0]+"/resource/"+e.split("/resource/")[1].split("/")[0];e!==h?(console.log("no record for "+e+". Trying second attempt with "+h),r.handleUpdateUrlResource(h)):(console.log("failed on second request"),r.setState({displayType:"notFound"}))}}))}},{key:"componentDidMount",value:function(){if(this.props.location){var e=ee.a.parse(this.props.location.search,{ignoreQueryPrefix:!0}).resourceid;e.includes("https://scta.info/")?this.handleUpdateUrlResource(e.replace("https://scta.info/","http://scta.info/")):this.getInfo(e)}}},{key:"componentDidUpdate",value:function(e){var t=ee.a.parse(this.props.location.search,{ignoreQueryPrefix:!0}).resourceid;t!==ee.a.parse(e.location.search,{ignoreQueryPrefix:!0}).resourceid&&(t.includes("https://scta.info/")?this.handleUpdateUrlResource(t.replace("https://scta.info/","http://scta.info/")):this.getInfo(t))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(te.a,null,r.a.createElement("title",null,this.state.resourceTitle),r.a.createElement("link",{rel:"schema.DC",href:"http://purl.org/dc/elements/1.1/"}),r.a.createElement("link",{rel:"schema.DCTERMS",href:"http://purl.org/dc/terms/"}),r.a.createElement("link",{rel:"schema.BIB",href:"http://purl.org/net/biblio#"}),"codex"===e.state.displayType?r.a.createElement("meta",{name:"BIB.type",content:"Manuscript"}):r.a.createElement("meta",{name:"DC.type",content:"document"}),r.a.createElement("meta",{name:"DC.identifier",content:this.state.resourceid}),r.a.createElement("meta",{name:"DC.title",content:this.state.resourceTitle}),r.a.createElement("meta",{name:"DC.creator",content:this.state.authorTitle}),r.a.createElement("meta",{name:"DC.Language",content:"la"}),r.a.createElement("meta",{name:"DC.Publisher",content:"SCTA"})),"personList"===e.state.displayType?r.a.createElement(Mt,{resourceTypeId:"http://scta.info/resource/person"}):"codexList"===e.state.displayType?r.a.createElement(Mt,{resourceTypeId:"http://scta.info/resource/codex"}):"expressionTypeList"===e.state.displayType?r.a.createElement(Mt,{resourceTypeId:"http://scta.info/resource/expressionType"}):"person"===e.state.displayType?r.a.createElement(Nt,{resourceid:e.state.resourceid,resourceType:"person",handleUpdateUrlResource:e.handleUpdateUrlResource,userId:e.props.userId}):"article"===e.state.displayType?r.a.createElement(Pt,{doc:e.state.articleDoc,articleType:e.state.articleType}):"workGroup"===e.state.displayType?r.a.createElement(Nt,{resourceid:e.state.resourceid,resourceType:"workGroup",handleUpdateUrlResource:e.handleUpdateUrlResource,userId:e.props.userId}):"collection"===e.state.displayType?r.a.createElement(Nt,{resourceid:e.state.resourceid,expressionid:e.state.expressionid,transcriptionid:e.state.transcriptionid,resourceType:"collection",handleUpdateUrlResource:e.handleUpdateUrlResource,userId:e.props.userId}):"item"===e.state.displayType?e.state.itemTranscriptionId?r.a.createElement(Nt,{resourceid:e.state.resourceid,expressionid:e.state.expressionid,transcriptionid:e.state.transcriptionid,tokenRange:e.state.tokenRange,itemTranscriptionId:e.state.itemTranscriptionId,handleUpdateUrlResource:e.handleUpdateUrlResource,userId:e.props.userId}):r.a.createElement("p",null,"Apologies, no transcriptions of this text are currently available."):"codex"===e.state.displayType||"surface"===e.state.displayType||"canvas"===e.state.displayType||"manifest"===e.state.displayType?r.a.createElement(Nt,{resourceid:e.state.resourceid,resourceType:"codex",codexResourceType:e.state.displayType,handleUpdateUrlResource:e.handleUpdateUrlResource,userId:e.props.userId}):"expressionType"===e.state.displayType?r.a.createElement(Nt,{resourceid:e.state.resourceid,resourceType:"expressionType",handleUpdateUrlResource:e.handleUpdateUrlResource,userId:e.props.userId}):"notFound"===e.state.displayType?r.a.createElement("p",null,"Apologies, this resource could not be found"):null)}}]),a}(r.a.Component);var Bt=function(){return r.a.createElement("div",{className:"About"},r.a.createElement("h1",null,"About"))};var Ut=function(e){var t=Object(n.useState)(e.user&&e.user.displayName),a=Object(f.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)(e.user&&e.user.photoURL),l=Object(f.a)(i,2),c=l[0],u=l[1];return Object(n.useEffect)((function(){o(e.user&&e.user.displayName),u(e.user&&e.user.photoURL)}),[e.user]),r.a.createElement("div",null,s?r.a.createElement("span",null,r.a.createElement("span",null,s)," ",r.a.createElement("img",{src:c,alt:"usrImage",height:"25px"})," ",r.a.createElement(p.a,{size:"sm",onClick:function(){return o(),u(),Ze.auth().signOut()}},"Logout")," "):r.a.createElement(p.a,{size:"sm",onClick:function(){return Ze.auth().signInWithPopup(Ke).then((function(e){o(e.additionalUserInfo.profile.name),u(e.additionalUserInfo.profile.picture)}))}},"Login"))};var Wt=function(e){var t=Object(h.a)().t;return r.a.createElement(mt.a,{bg:"dark",variant:"light",expand:"lg",fixed:"top",style:{borderBottom:"1px solid #dee2e6"}},r.a.createElement(Fe.a,null,r.a.createElement(i.c,{className:"nav-link",to:"/"},t("Title"))),r.a.createElement(mt.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(mt.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Fe.a,null,r.a.createElement(i.c,{className:"nav-link",to:"/res?resourceid=http://scta.info/resource/scta"},t("Texts")),r.a.createElement(i.c,{className:"nav-link",to:"/res?resourceid=http://scta.info/resource/person"},t("People")),r.a.createElement(i.c,{className:"nav-link",to:"/res?resourceid=http://scta.info/resource/codex"},t("Codices"))),r.a.createElement(Fe.a,null,r.a.createElement("a",{className:"nav-link",href:"https://secure.qgiv.com/for/givescta"},t("Donate")))),r.a.createElement(mt.a.Collapse,{id:"basic-navbar-nav-right",className:"float-right",style:{flexGrow:"0"}},r.a.createElement(Fe.a,null,r.a.createElement(Ut,{user:e.user}))))};var Ht=function(){var e=Object(h.a)().t;return r.a.createElement(mt.a,{bg:"light",variant:"light",expand:"lg",fixed:"bottom",style:{zIndex:"1"}},r.a.createElement(mt.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(mt.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Fe.a,{style:{display:"flex",justifyContent:"space-around",width:"100%"}},r.a.createElement(Fe.a.Link,{href:"http://github.com/lombardpress/lombardpress-webjs"},"Lbp-Web.js"),r.a.createElement(Fe.a.Link,{href:"http://lombardpress.org"},e("A LombardPress Publication")),r.a.createElement(Fe.a.Link,{href:"http://scta.info"},e("Powered by SCTA Data")," "),r.a.createElement(Fe.a.Link,{href:"http://jeffreycwitt.com"},e("Designed by Jeffrey C Witt")),r.a.createElement(gt,null))))},zt=(a(643),a(644),function(e){var t=e.user?e.user.uid:"";return r.a.createElement(n.Suspense,{fallback:r.a.createElement(D,null)},r.a.createElement(i.a,{forceRefresh:!1},r.a.createElement("div",null,r.a.createElement(Wt,{user:e.user}),r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/",exact:!0,render:function(e){return r.a.createElement(m,Object.assign({},e,{userId:t}))}}),r.a.createElement(l.a,{path:"/res",exact:!0,render:function(e){return r.a.createElement(_t,Object.assign({},e,{userId:t}))}}),r.a.createElement(l.a,{path:"/text",exact:!0,render:function(e){return r.a.createElement(_t,Object.assign({},e,{userId:t}))}}),r.a.createElement(l.a,{path:"/about",exact:!0,render:function(e){return r.a.createElement(Bt,Object.assign({},e,{userId:t}))}}),r.a.createElement(l.a,{path:"/search",exact:!0,render:function(e){return r.a.createElement(X,Object.assign({},e,{userId:t}))}}),r.a.createElement(l.a,{path:"/osd",exact:!0,render:function(e){return r.a.createElement(_t,Object.assign({},e,{userId:t}))}})),r.a.createElement(Ht,null))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var qt=a(157),Gt=a(97),Vt=a(277),Xt=a(278);qt.a.use(Vt.a).use(Xt.a).use(Gt.e).init({fallbackLng:"en",debug:!0,interpolation:{escapeValue:!1}});qt.a;var Yt=function(e){o.a.render(r.a.createElement(zt,{user:e}),document.getElementById("root"))};Ze.auth().onAuthStateChanged((function(e){if(e)console.log("log in"),Yt(e);else{console.log("log out");Yt({uid:"jeff"})}})),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[279,1,2]]]);
//# sourceMappingURL=main.5ecea55a.chunk.js.map