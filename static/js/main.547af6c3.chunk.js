(this["webpackJsonplombardpress-web.js"]=this["webpackJsonplombardpress-web.js"]||[]).push([[0],{110:function(e,t,n){e.exports=n(276)},273:function(e,t,n){},275:function(e,t,n){},276:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(55),i=n.n(s),o=n(9),l=n(41),c=n(15),p=n(97),u=n(18),h="https://sparql-docker.scta.info/ds/query",d=n(22);var m=function(e){var t=Object(d.b)().t;return r.a.createElement("div",{className:"Home"},r.a.createElement(c.a,{id:"lbp-home",fluid:!0},r.a.createElement(c.a,null,r.a.createElement(p.a,{id:"lbp-jumbo"},r.a.createElement("h1",null,t("Title")),r.a.createElement("p",null,t("Subtitle")),r.a.createElement(u.a,null,r.a.createElement(o.b,{className:"nav-link",to:"/text?resourceid=http://scta.info/resource/scta",style:{color:"black"}},t("Enter")))))))},f=n(6),v=n(20),g=n(17),T=n.n(g),E=n(8),y=n.n(E);function x(e){return new Promise((function(t){var n=new XMLHttpRequest;if(n.open("GET",e),"undefined"===typeof XSLTProcessor)try{n.responseType="msxml-document"}catch(a){console.log("error",a)}n.onload=function(){t(this.responseXML)},n.send()}))}function b(e,t){return new Promise((function(n,a){Promise.all([x(e),x(t)]).then((function(e){var t=new XSLTProcessor;if(t.importStylesheet(e[1]),e[0]){var r=t.transformToFragment(e[0],document);n(r)}else{var s=new Error("xml document could not be retrieved");a(s)}}))}))}function w(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}function O(e){return T.a.get(h,{params:{query:e,output:"json"}})}function C(e,t){var n=y()("#"+e);t&&(n.addClass("highlightNone"),y()(".paragraphnumber").removeClass("highlight2"),y()(".plaoulparagraph").removeClass("highlightNone"),y()(".lbp-quote").removeClass("highlightNone"),y()(".lbp-quote").removeClass("highlight"),y()(".lbp-ref").removeClass("highlightNone"),y()(".lbp-ref").removeClass("highlight"),y()(".plaoulparagraph").removeClass("highlight"),n.children(".paragraphnumber").addClass("highlight2"),n.addClass("highlight"),n[0]&&(n[0].className.includes("lbp-quote")||n[0].className.includes("lbp-ref")||setTimeout((function(){y()(".lbp-ref").removeClass("highlight"),y()(".lbp-quote").removeClass("highlight"),y()(".plaoulparagraph").removeClass("highlight"),n.addClass("highlightNone")}),2e3))),n.length>0&&y()("html, body").stop().animate({scrollTop:n.offset().top-100},1e3)}function S(e){var t=e.parentElement.className;return t.includes("paragraphnumber")||t.includes("lbp-line-number")||t.includes("appnote")||t.includes("paragraphnumber")||t.includes("footnote")||t.includes("lbp-reg")||t.includes("lbp-folionumber")||t.includes("js-show-folio-image")?NodeFilter.FILTER_REJECT:e.nodeValue?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}function k(e){return e=(e=(e=e.replace(/^[ ]+|[ ]+$/g,"")).replace(/[.,/#!$%^&*;:{}=\-_`~()"]/g,"")).replace(/\s+/gi," ")}function R(e,t){for(var n=0,a=0;a<=t;a++)e[a]===e[t]&&n++;return n}function I(e,t,n,a){var r=e.split(t,n).join(t);return a?r.length:r.length+t.length}function L(e,t,n){console.log(e,t,n),function(e,t,n){var a=e.replace("https://github.com","https://raw.githubusercontent.com").replace("/raw/","/");return T.a.get(a).then((function(e){var a='xml:id="'+n+'"',r=e.data.split(a),s=r[0].split("\n").length,i=r[1],o=new RegExp("\\W".concat(t,"\\W"),"gi");return s+i.split(o)[0].split("\n").length-1}))}(e,t,n).then((function(t){var n=e.replace("raw","edit")+"#L"+t;window.open(n,"gitHubEditWindow","height=750,width=750")}))}function j(e,t){var n=t.split("-")[0],a=t.split("-")[1];return e.split(" ").filter(Boolean).slice(n-1,a).join(" ")}var N=n(43);var P=function(){return r.a.createElement("div",{className:"spinner",style:{padding:"20px 5px"}},r.a.createElement(N.a,{animation:"grow",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")),r.a.createElement(N.a,{animation:"grow",variant:"primary"}),r.a.createElement(N.a,{animation:"grow",variant:"secondary"}),r.a.createElement(N.a,{animation:"grow",variant:"success"}),r.a.createElement(N.a,{animation:"grow",variant:"danger"}),r.a.createElement(N.a,{animation:"grow",variant:"warning"}),r.a.createElement(N.a,{animation:"grow",variant:"info"}))},F=n(21),A=function(e,t){if(t)switch(t.type){case"START_EXPRESSIONS_FETCH":return{};case"COMPLETE_EXPRESSIONS_FETCH":return Object(F.a)(t.expressions);default:return e}},M=function(e,t){var n="";e.searchWorkGroup&&(n=["<"+e.searchWorkGroup+"> <http://scta.info/property/hasExpression> ?expression ."].join(" "));var a="";e.expressionAuthorType&&(a=["?expression <http://www.loc.gov/loc.terms/relators/AUT> ?expressionAuthor . ","?expressionAuthor <http://scta.info/property/personType> <http://scta.info/resource/"+e.expressionAuthorType+"> ."].join(""));var r="";e.searchAuthor&&(r=["?expression <http://www.loc.gov/loc.terms/relators/AUT> <"+e.searchAuthor+"> ."].join(""));var s=["SELECT ?type ?expression ?expressionShortId ?expressionTitle ?author ?authorTitle ?workGroup ?workGroupTitle","WHERE { ","?expression a <http://scta.info/resource/expression> .","?expression a ?type .","?expression <http://scta.info/property/level> '1' . ",a,n,r,"?expression <http://scta.info/property/shortId> ?expressionShortId .","?expression <http://scta.info/property/shortId> ?expressionShortId .","?expression <http://purl.org/dc/elements/1.1/title> ?expressionTitle .","?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","?expression <http://purl.org/dc/terms/isPartOf> ?workGroup .","?workGroup <http://purl.org/dc/elements/1.1/title> ?workGroupTitle .","}","ORDER BY ?expressionTitle"].join("");t({type:"START_EXPRESSIONS_FETCH"}),T.a.get(h,{params:{query:s,output:"json"}}).then((function(e){var n=e.data.results.bindings.map((function(e){return{expression:e.expression.value,expressionShortId:e.expressionShortId?e.expressionShortId.value:"",expressionTitle:e.expressionTitle.value,workGroup:e.workGroup?e.workGroup.value:"",workGroupTitle:e.workGroupTitle?e.workGroupTitle.value:"",author:e.author?e.author.value:"",authorTitle:e.author?e.authorTitle.value:"",type:e.type.value}}));t({type:"COMPLETE_EXPRESSIONS_FETCH",expressions:n})}))},D=function(e,t){if(t)switch(t.type){case"START_AUTHORS_FETCH":return{};case"COMPLETE_AUTHORS_FETCH":return Object(F.a)(t.authors);default:return e}},_=function(e,t){var n="";e.searchWorkGroup&&(n="<"+e.searchWorkGroup+"> <http://scta.info/property/hasExpression> ?resource .");var a=["SELECT DISTINCT ?author ?authorTitle ?authorShortId ","WHERE { ","?author a <http://scta.info/resource/person> .","?resource a <http://scta.info/resource/expression> .","?resource <http://scta.info/property/level> '1' .",n,"?resource <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://scta.info/property/shortId> ?authorShortId .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","ORDER BY ?authorTitle"].join("");t({type:"START_AUTHORS_FETCH"}),T.a.get(h,{params:{query:a,output:"json"}}).then((function(e){var n=e.data.results.bindings.map((function(e){return{author:e.author.value,authorShortId:e.authorShortId.value,authorTitle:e.authorTitle.value}}));t(function(e){return{type:"COMPLETE_AUTHORS_FETCH",authors:e}}(n))}))},W=function(e,t){if(t)switch(t.type){case"START_WORK_GROUPS_LIST_FETCH":return{};case"COMPLETE_WORK_GROUPS_LIST_FETCH":return Object(F.a)(t.workGroups);default:return e}},U=function(e,t){var n="";e.searchAuthor&&(n=["?workGroup <http://scta.info/property/hasExpression> ?expression .","?expression <http://www.loc.gov/loc.terms/relators/AUT> <"+e.searchAuthor+"> ."].join(""));var a=["SELECT DISTINCT ?workGroup ?workGroupTitle ","WHERE { ","?workGroup a <http://scta.info/resource/workGroup> .","?workGroup <http://purl.org/dc/elements/1.1/title> ?workGroupTitle .",n,"}","ORDER BY ?workGroupTitle"].join(" ");t({type:"START_WORK_GROUPS_LIST_FETCH"}),T.a.get(h,{params:{query:a,output:"json"}}).then((function(e){var n=e.data.results.bindings.map((function(e){return{workGroup:e.workGroup.value,workGroupTitle:e.workGroupTitle.value}}));t(function(e){return{type:"COMPLETE_WORK_GROUPS_LIST_FETCH",workGroups:e}}(n))}))},B=function(e,t){if(t)switch(t.type){case"START_EXPRESSION_TYPES_LIST_FETCH":return{};case"COMPLETE_EXPRESSION_TYPES_LIST_FETCH":return Object(F.a)(t.expressionTypes);default:return e}},H=n(19),q=function(e){var t=Object(a.useState)(e.searchType?e.searchType:"text"),n=Object(f.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(e.searchTerm),l=Object(f.a)(o,2),c=l[0],p=l[1],d=Object(a.useState)(e.searchAuthor),m=Object(f.a)(d,2),g=m[0],E=m[1],y=Object(a.useState)(e.searchEid),x=Object(f.a)(y,2),b=x[0],w=x[1],O=Object(a.useState)(e.searchEType),C=Object(f.a)(O,2),S=C[0],k=C[1],R=Object(a.useState)(e.searchWorkGroup),I=Object(f.a)(R,2),L=I[0],j=I[1],N=Object(a.useState)(""),P=Object(f.a)(N,2),F=P[0],q=P[1],z=Object(a.useReducer)(B,[]),G=Object(f.a)(z,2),V=G[0],Q=G[1],Y=Object(a.useReducer)(A,[]),X=Object(f.a)(Y,2),J=X[0],Z=X[1],K=Object(a.useReducer)(D,[]),$=Object(f.a)(K,2),ee=$[0],te=$[1],ne=Object(a.useReducer)(W,[]),ae=Object(f.a)(ne,2),re=ae[0],se=ae[1],ie={searchTerm:c,searchAuthor:g,searchEid:b,searchWorkGroup:L,searchType:s,searchEType:S,resultsFilter:F},oe=Object(a.useState)(!1),le=Object(f.a)(oe,2),ce=le[0],pe=le[1];return Object(a.useEffect)((function(){i(e.searchType?e.searchType:"text")}),[e.searchType]),Object(a.useEffect)((function(){E(e.searchAuthor)}),[e.searchAuthor]),Object(a.useEffect)((function(){w(e.searchEid)}),[e.searchEid]),Object(a.useEffect)((function(){j(e.searchWorkGroup)}),[e.searchWorkGroup]),Object(a.useEffect)((function(){p(e.searchTerm)}),[e.searchTerm]),Object(a.useEffect)((function(){e.handleSetSearchParameters(ie)}),[c,g,b,L,s,S,F]),Object(a.useEffect)((function(){Z(M(ie,Z)),te(_(ie,te)),se(U(ie,se)),Q(function(e,t){var n=["SELECT DISTINCT ?expressionType ?expressionTypeTitle ","WHERE { ","?expressionType a <http://scta.info/resource/expressionType> .","?expressionType <http://purl.org/dc/elements/1.1/title> ?expressionTypeTitle .","}","ORDER BY ?expressionTypeTitle"].join(" ");t({type:"START_EXPRESSION_TYPES_LIST_FETCH"}),T.a.get(h,{params:{query:n,output:"json"}}).then((function(e){var n=e.data.results.bindings.map((function(e){return{expressionType:e.expressionType.value,expressionTypeTitle:e.expressionTypeTitle.value}}));t(function(e){return{type:"COMPLETE_EXPRESSION_TYPES_LIST_FETCH",expressionTypes:e}}(n))}))}(0,Q))}),[]),Object(a.useEffect)((function(){Z(M(ie,Z)),se(U(ie,se))}),[g]),Object(a.useEffect)((function(){Z(M(ie,Z)),te(_(ie,te))}),[L]),r.a.createElement("div",null,r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Search Term")),r.a.createElement(v.a.Control,{as:"input",type:"text",placeholder:"search term",onChange:function(e){return p(e.target.value)},value:ie.searchTerm})),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Filter Results")),r.a.createElement(v.a.Control,{as:"input",type:"secondary results filter",placeholder:"secondary results filter",onChange:function(e){return t=e.target.value,void q(t);var t},value:F})),ce&&r.a.createElement("div",null,r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Search Type")),r.a.createElement(v.a.Control,{as:"select",onChange:function(e){i(e.target.value)},value:ie.searchType},r.a.createElement("option",{value:"questionTitles"},"Questions Titles"),r.a.createElement("option",{value:"text"},"Text"))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Work Group")),r.a.createElement(v.a.Control,{as:"select",onChange:function(e){j(e.target.value)},value:ie.searchWorkGroup},r.a.createElement("option",{value:""},"All"),re&&re.map((function(e,t){return r.a.createElement("option",{key:e.workGroup+"-"+t,value:e.workGroup},e.workGroupTitle)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Expression Type")),r.a.createElement(v.a.Control,{as:"select",onChange:function(e){k(e.target.value)},value:ie.searchEType},r.a.createElement("option",{value:""},"All"),V&&V.map((function(e,t){return r.a.createElement("option",{key:e.expressionType+"-"+t,value:e.expressionType},e.expressionTypeTitle)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Author")),r.a.createElement(v.a.Control,{as:"select",onChange:function(e){E(e.target.value)},value:ie.searchAuthor},r.a.createElement("option",{value:""},"All"),ee&&ee.map((function(e,t){return r.a.createElement("option",{key:e.author+"-"+t,value:e.author},e.authorTitle)})))),r.a.createElement(H.a,{size:"sm",className:"mb-2"},r.a.createElement(H.a.Prepend,null,r.a.createElement(H.a.Text,null,"Text")),r.a.createElement(v.a.Control,{as:"select",onChange:function(e){w(e.target.value)},value:ie.searchEid},r.a.createElement("option",{value:""},"All"),J&&J.map((function(e,t){return r.a.createElement("option",{key:e.expression+"-"+t,value:e.expression},e.authorTitle,": ",e.expressionTitle)}))))),r.a.createElement(H.a.Prepend,{size:"sm",className:"mb-2"},e.children,e.showAdvancedParameters&&r.a.createElement(u.a,{className:"btn-sm",onClick:function(){pe(!ce)}},ce?"Hide":"Show"," More Filter Options")))};function z(e,t){var n="https://exist.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-expressionid.xq?query="+e+"&expressionid="+("all"===t?t:t.split("/resource/")[1]);return T.a.get(n)}function G(e){if(e&&0!==e.length){if(e.length>0){var t=e.map((function(e,t){var n=e.previous+" <span class='highlight'>"+e.hit+"</span> "+e.next,a=e.start+"-"+e.end;return r.a.createElement("div",{key:t},r.a.createElement("p",null,r.a.createElement(o.b,{to:"/text?resourceid=http://scta.info/resource/"+e.pid+"@"+a},e.pid+"@"+a)),r.a.createElement("p",{dangerouslySetInnerHTML:{__html:n}}))}));return r.a.createElement("div",null,r.a.createElement("p",null,e.length+" results"),t)}if(e){var n=e,a=n.previous+" <span class='highlight'>"+n.hit+"</span> "+n.next,s=n.start+"-"+n.end;return r.a.createElement("div",null,r.a.createElement("p",null,"1 results"),r.a.createElement("div",{key:e.pid},r.a.createElement("p",null,r.a.createElement(o.b,{to:"/text?resourceid=http://scta.info/resource/"+n.pid+"@"+s},n.pid+"@"+s)),r.a.createElement("p",{dangerouslySetInnerHTML:{__html:a}})))}return r.a.createElement("div",null,r.a.createElement("p",null,"No results"))}return r.a.createElement("div",null,r.a.createElement("p",null,"No results found"))}function V(e,t){if(e.length>0){var n=e.map((function(e,n){return r.a.createElement("div",{key:e.resource.value+"-"+n},r.a.createElement("p",null,r.a.createElement(o.b,{to:"/text?resourceid="+e.author.value},e.authorTitle.value),": ",r.a.createElement(o.b,{to:"/text?resourceid="+e.resource.value},e.longTitle.value)),r.a.createElement("p",null,e.qtitle.value.toLowerCase().replace(t.searchTerm.toLowerCase(),t.searchTerm.toUpperCase())))}));return r.a.createElement("div",null,r.a.createElement("p",null,n.length+" results"),n)}return r.a.createElement("div",null,r.a.createElement("p",null,"No results"))}var Q=function(e){var t=Object(a.useState)({}),n=Object(f.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)([]),l=Object(f.a)(o,2),p=l[0],h=l[1],d=Object(a.useState)([]),m=Object(f.a)(d,2),g=m[0],E=m[1];Object(a.useEffect)((function(){"questionTitles"===s.searchType?V(b(g,s.resultsFilter),s):"text"===s.searchType&&G(x(p,s.resultsFilter))}),[s.resultsFilter]);var y=function(e){if(e.preventDefault(),s.searchTerm)if("text"===s.searchType){if(h("fetching"),E([]),s.searchEid)z(s.searchTerm,s.searchEid).then((function(e){h(e.data.results)}));else if(s.searchAuthor){(function(e,t){var n="https://exist.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-authorid.xq?query="+e+"&authorid="+t.split("/resource/")[1];return T.a.get(n)})(s.searchTerm,s.searchAuthor).then((function(e){h(e.data.results)}))}else if(s.searchWorkGroup){(function(e,t){var n="https://exist.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-workGroupId.xq?query="+e+"&workGroupId="+t.split("/resource/")[1];return T.a.get(n)})(s.searchTerm,s.searchWorkGroup).then((function(e){h(e.data.results)}))}else{z(s.searchTerm,"all").then((function(e){h(e.data.results)}))}}else{var t=O(function(e){var t=e.searchTerm,n="";e.searchWorkGroup&&(n=["BIND(<"+e.searchWorkGroup+"> AS ?workGroup) .","?workGroup <http://scta.info/property/hasExpression> ?topLevel ."].join(" "));var a="";e.searchEType&&(a=["BIND(<"+e.searchEType+"> AS ?expressionType) .","{","?resource <http://scta.info/property/expressionType> ?expressionType .","}","UNION","{","?resource <http://scta.info/property/isMemberOf> ?ancestor .","?ancestor <http://scta.info/property/expressionType> ?expressionType .","}"].join(" "));var r="";e.searchAuthor&&(r="BIND(<"+e.searchAuthor+"> AS ?author).");var s="";return e.searchEid&&(s="BIND(<"+e.searchEid+"> AS ?topLevel)."),["SELECT ?resource ?qtitle ?resourceTitle ?structureType ?longTitle ?author ?authorTitle","WHERE","{","?resource <http://scta.info/property/questionTitle> ?qtitle  .","?resource <http://purl.org/dc/elements/1.1/title> ?resourceTitle .","?resource <http://scta.info/property/structureType> ?structureType .","?resource <http://scta.info/property/longTitle> ?longTitle .",a,s,"?resource <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .",r,"?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .",n,"FILTER (REGEX(STR(?qtitle), '"+t+"', 'i')) .","}"].join(" ")}(s));E("fetching"),h([]),t.then((function(e){E(e.data.results.bindings)}))}else h([])},x=function(e,t){var n=[];if(e&&0!==e.length){if(e.length>1)e.forEach((function(e){[e.previous.toLowerCase(),e.hit.toLowerCase(),e.next.toLowerCase()].join(" ").includes(t.toLowerCase())&&n.push(e)}));else if(e){var a=e,r=[a.previous.toLowerCase(),a.hit.toLowerCase(),a.next.toLowerCase()].join(" ");n=r.includes(t.toLowerCase())?e:""}}else n=[];return n},b=function(e,t){var n=[];return e&&0!==e.length?e.length>0&&e.forEach((function(e){e.qtitle&&e.qtitle.value.toLowerCase().includes(t.toLowerCase())&&n.push(e)})):n=[],n};return r.a.createElement(c.a,{className:e.hidden?"hidden":"showing"},r.a.createElement(v.a,{onSubmit:y},r.a.createElement(q,{handleSetSearchParameters:function(e){i(e)},searchAuthor:e.searchAuthor,searchEid:e.searchEid,searchEType:e.searchEType,searchWorkGroup:e.searchWorkGroup,showAdvancedParameters:e.showAdvancedParameters,showLabels:e.showLabels,searchType:e.searchType,searchTerm:e.searchTerm},e.showSubmit&&r.a.createElement(u.a,{onClick:y,className:"btn-sm",style:{marginRight:"5px"}},"Submit"))),function(e){return"fetching"===e||"fetching"===g?r.a.createElement(P,null):"questionTitles"===s.searchType?V(b(g,s.resultsFilter),s):"text"===s.searchType?G(x(e,s.resultsFilter)):void 0}(p))};Q.defaultProps={showLabels:!0,showAdvancedParameters:!0,searchAuthor:"",searchEid:"",showSubmit:!0};var Y=n(11),X=n(12),J=n(2),Z=n(14),K=n(13),$=n(62),ee=n.n($),te=n(100),ne=n(26),ae=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).getPdf=a.getPdf.bind(Object(J.a)(a)),a.state={status:"",pdf:""},a}return Object(X.a)(n,[{key:"getPdf",value:function(e){var t=this;T.a.get("https://print.lombardpress.org/api/v1/resource?url="+e).then((function(e){if(console.log(e),e.data.url){console.log("first condition passed",e.data.url);var n=e.data.url;t.setState({pdf:"https://print.lombardpress.org/api/v1/cache/"+n})}else t.setState({status:e.data.Status+"Please check back in a few minutes",pdf:""})}))}},{key:"componentDidMount",value:function(){var e=this.props.url;this.getPdf(e)}},{key:"componentDidUpdate",value:function(e){var t=this.props.url;t!==e.url&&this.getPdf(t)}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100%",height:"77vh",margin:"auto"}},this.state.pdf?r.a.createElement("object",{data:this.state.pdf,type:"application/pdf",width:"100%",height:"100%"},"alt : ",r.a.createElement("a",{href:this.state.pdf},this.state.pdf)):r.a.createElement("p",null,this.state.status))}}]),n}(r.a.Component),re=n(3);function se(e){return["SELECT DISTINCT ?title ?structureType ?cmanifestation ?cmanifestationTitle ?manifestation ?manifestationTitle ?ctranscription ?manifestationCTranscription ?cdoc ?cxml ?expressionShortId ?longTitle ?topLevelExpression ?next ?previous ?inbox ?author ?authorTitle ?parent ","WHERE { ","<"+e+"> <http://purl.org/dc/elements/1.1/title> ?title .","<"+e+"> <http://scta.info/property/structureType> ?structureType .","<"+e+"> <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation .","?cmanifestation <http://purl.org/dc/elements/1.1/title> ?cmanifestationTitle .","<"+e+"> <http://scta.info/property/hasManifestation> ?manifestation .","?manifestation <http://purl.org/dc/elements/1.1/title> ?manifestationTitle .","OPTIONAL {","?manifestation <http://scta.info/property/hasCanonicalTranscription> ?manifestationCTranscription .","?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .","?ctranscription <http://scta.info/property/hasDocument> ?cdoc . ","?ctranscription <http://scta.info/property/hasXML> ?cxml . ","}","<"+e+"> <http://scta.info/property/shortId> ?expressionShortId .","{","<"+e+"> <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .","}","UNION","{","<"+e+"> <http://scta.info/property/level> '1' .","BIND(<"+e+"> AS ?topLevelExpression) .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/longTitle> ?longTitle .","}","OPTIONAL {","?topLevelExpression <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/next> ?next .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/previous> ?previous .","}","OPTIONAL {","<"+e+"> <http://purl.org/dc/terms/isPartOf> ?parent .","}","<"+e+"> <http://www.w3.org/ns/ldp#inbox> ?inbox . ","}","ORDER BY ?title"].join("")}function ie(e){return["SELECT DISTINCT ?title ?description ?part ?partTitle ?partQuestionTitle ?partType ?partLevel ","WHERE { ","<"+e+"> <http://purl.org/dc/elements/1.1/title> ?title .","<"+e+"> <http://purl.org/dc/elements/1.1/description> ?description .","<"+e+"> <http://purl.org/dc/terms/hasPart> ?part .","?part <http://purl.org/dc/elements/1.1/title> ?partTitle .","?part <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?partType . ","OPTIONAL {","?part <http://scta.info/property/questionTitle> ?partQuestionTitle .","}","OPTIONAL {","?part <http://scta.info/property/level> ?partLevel .","}","OPTIONAL {","?part <http://scta.info/property/totalOrderNumber> ?totalOrderNumber .","}","}","ORDER BY ?totalOrderNumber"].join("")}function oe(e){return["SELECT DISTINCT ?surfaceTitle ?isurface ?isurfaceTitle ?icodexTitle ?canvas ?imageurl ?next_surface ?previous_surface ","{","<"+e+"> <http://purl.org/dc/elements/1.1/title> ?surfaceTitle .","<"+e+"> <http://scta.info/property/hasISurface> ?isurface .","OPTIONAL {","<"+e+"> <http://scta.info/property/next> ?next_surface .","}","OPTIONAL {","<"+e+"> <http://scta.info/property/previous> ?previous_surface .","}","OPTIONAL {","?isurface <http://purl.org/dc/elements/1.1/title> ?isurfaceTitle .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?icodex <http://purl.org/dc/elements/1.1/title> ?icodexTitle .","}","?isurface <http://scta.info/property/hasCanvas> ?canvas .","OPTIONAL{","?canvas <http://iiif.io/api/presentation/2#hasImageAnnotations> ?blank .","}","OPTIONAL{","?canvas <http://www.w3.org/2003/12/exif/ns#height> ?c_height .","}","?blank <http://www.w3.org/1999/02/22-rdf-syntax-ns#first> ?o .","?o <http://www.w3.org/ns/oa#hasBody> ?o2 .","OPTIONAL{","?o2 <http://rdfs.org/sioc/services#has_service> ?imageurl .","}","OPTIONAL{","?o2 <http://www.shared-canvas.org/ns/hasRelatedService> ?imageurl .","}","}"].join("")}function le(e){return["SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","BIND(<"+e+"> as ?codex) . ","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}function ce(e){return["SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","?icodex <http://scta.info/property/hasOfficialManifest> <"+e+"> .","?codex <http://scta.info/property/hasCodexItem> ?icodex .","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}function pe(e){return["SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","?codex <http://scta.info/property/hasSurface> <"+e+"> .","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}function ue(e){return["SELECT DISTINCT ?codex ?surfaceFocus ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status ","{","?isurfaceFocus <http://scta.info/property/hasCanvas> <"+e+"> .","?surfaceFocus <http://scta.info/property/hasISurface> ?isurfaceFocus .","?codex <http://scta.info/property/hasSurface> ?surfaceFocus .","?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .","OPTIONAL {","?icodex <http://scta.info/property/isCodexItemOf> ?codex .","?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .","?surface <http://scta.info/property/hasISurface> ?isurface .","?surface <http://scta.info/property/order> ?surface_order .","?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .","?manifestation <http://scta.info/property/isOnSurface> ?surface .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .","?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .","?expression <http://scta.info/property/status> ?status .","OPTIONAL {","?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .","}","}","}","ORDER BY ?surface_order"].join("")}var he=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleChildren=a.handleToggleChildren.bind(Object(J.a)(a)),a.mounted="",a.state={parts:[],showChildren:!1,isPartOf:{}},a}return Object(X.a)(n,[{key:"handleToggleChildren",value:function(e){e.preventDefault(),this.setState((function(e){return{showChildren:!e.showChildren}}))}},{key:"retrieveParts",value:function(e){var t=this;O(function(e){return["SELECT ?part ?title ?level ?order ?structureType ?questionTitle ?author ?authorTitle ?isPartOf ?isPartOfTitle ","{","<"+e+"> <http://purl.org/dc/terms/hasPart> ?part . ","?part <http://purl.org/dc/elements/1.1/title> ?title .","OPTIONAL {","?isPartOf <http://purl.org/dc/terms/hasPart> <"+e+"> .","?isPartOf <http://purl.org/dc/elements/1.1/title> ?isPartOfTitle .","}","OPTIONAL {","?part <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL","{","?part <http://scta.info/property/level> ?level .","}","OPTIONAL","{","?part <http://scta.info/property/structureType> ?structureType .","}","OPTIONAL","{","{","?part <http://scta.info/property/sectionOrderNumber> ?order .","}","UNION","{","?part <http://scta.info/property/isTranscriptionOf> ?mpart . ","?mpart <http://scta.info/property/isManifestationOf> ?epart . ","?epart <http://scta.info/property/sectionOrderNumber> ?order .","}","UNION","{","?part <http://scta.info/property/isManifestationOf> ?epart . ","?epart <http://scta.info/property/sectionOrderNumber> ?order .","}","}","OPTIONAL","{","?part <http://scta.info/property/questionTitle> ?questionTitle .","}","}","ORDER BY ?order"].join("")}(e)).then((function(e){var n=e.data.results.bindings.map((function(e){return{part:e.part.value,title:e.title.value,level:e.level?e.level.value:"",author:e.author?e.author.value:"",authorTitle:e.authorTitle?e.authorTitle.value:"",structureType:e.structureType?e.structureType.value:"",questionTitle:e.questionTitle?e.questionTitle.value:""}})),a={isPartOfId:"",isPartOfTitle:""};e.data.results.bindings[0]&&e.data.results.bindings[0].isPartOf&&(a.isPartOfId=e.data.results.bindings[0].isPartOf.value,a.isPartOfTitle=e.data.results.bindings[0].isPartOfTitle.value),t.mounted&&t.setState({parts:n,isPartOf:a})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.retrieveParts(this.props.resourceid),this.props.membersOf&&this.props.membersOf.includes(this.props.resourceid)&&this.setState({showChildren:!0})}},{key:"componentDidUpdate",value:function(e){this.props.resourceid!==e.resourceid&&this.retrieveParts(this.props.resourceid),this.props.resourceid===e.resourceid&&this.props.membersOf===e.membersOf||this.props.membersOf&&this.props.membersOf.includes(this.props.resourceid)&&this.setState({showChildren:!0})}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=5*this.props.level;return r.a.createElement("div",{id:"outline",style:{paddingLeft:t+"px"}},r.a.createElement("p",{className:this.props.bold},this.state.isPartOf.isPartOfId&&this.props.showParentLink&&r.a.createElement(o.b,{to:"/text?resourceid="+this.state.isPartOf.isPartOfId},r.a.createElement(re.g,null)),this.props.author&&this.props.showAuthor&&"1"===this.props.level&&r.a.createElement("span",null,r.a.createElement("span",null,this.props.authorTitle,": "),r.a.createElement(o.b,{to:"/text?resourceid="+this.props.author},r.a.createElement(re.p,null))),this.props.title,this.props.questionTitle&&r.a.createElement("span",null,": ",this.props.questionTitle),this.state.parts.length>0&&!this.state.showChildren&&r.a.createElement("span",{className:"outlineArrow",onClick:this.handleToggleChildren},r.a.createElement(re.f,null)),this.state.parts.length>0&&this.state.showChildren&&r.a.createElement("span",{className:"outlineArrow",onClick:this.handleToggleChildren},r.a.createElement(re.g,null)),this.props.resourceid&&r.a.createElement(o.b,{to:"/text?resourceid="+this.props.resourceid+this.props.mtFocus},r.a.createElement(re.p,null)),this.props.collectionLink&&r.a.createElement("a",{href:"https://mirador.scta.info?resourceid="+this.props.resourceid,target:"_blank",rel:"noopener noreferrer"}," ",r.a.createElement("img",{alt:"view in mirador",style:{width:"12px",height:"12px"},src:"https://projectmirador.org/img/mirador-logo.svg"}))),this.state.showChildren&&e.state.parts.map((function(t){var a="";return e.props.membersOf&&(e.props.membersOf.includes(t.part)||t.part===e.props.focusResourceid)&&(a="bold"),r.a.createElement(n,{bold:a,key:t.part,focusResourceid:e.props.focusResourceid,showChildren:e.state.showChildren,resourceid:t.part,title:t.title,level:t.level,author:t.author,authorTitle:t.authorTitle,structureType:t.structureType,membersOf:e.props.membersOf,questionTitle:t.questionTitle,mtFocus:e.props.mtFocus,showAuthor:e.props.showAuthor,collectionLink:"http://scta.info/resource/structureCollection"===t.structureType&&e.props.collectionLink,showParentLink:!1})})))}}]),n}(r.a.Component),de=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).mounted="",a.state={membersOf:[]},a}return Object(X.a)(n,[{key:"retrieveMembersOf",value:function(e){var t=this;O(function(e){return["SELECT ?memberOf","{","<"+e+"> <http://scta.info/property/isMemberOf> ?memberOf . ","}"].join("")}(e)).then((function(e){var n=e.data.results.bindings.map((function(e){return e.memberOf.value}));t.mounted&&t.setState({membersOf:n})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.retrieveMembersOf(this.props.focusResourceid)}},{key:"componentDidUpdate",value:function(e){this.props.focusResourceid!==e.focusResourceid&&this.retrieveMembersOf(this.props.focusResourceid)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},r.a.createElement(he,{key:this.props.resourceid,showChildren:!0,focusResourceid:this.props.focusResourceid,resourceid:this.props.resourceid,title:this.props.title,level:"1",structureType:"http://scta.info/resource/structureCollection",membersOf:this.state.membersOf,mtFocus:this.props.mtFocus,collectionLink:this.props.collectionLink,showAuthor:this.props.showAuthor,showParentLink:this.props.showParentLink}))}}]),n}(r.a.Component),me=n(50),fe=n.n(me),ve=n(49),ge=n.n(ve),Te=function(e){var t=Object(a.useState)(),n=Object(f.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)({w:"",h:""}),l=Object(f.a)(o,2),c=l[0],p=l[1],u=Object(a.useState)(ge()()),h=Object(f.a)(u,1)[0];Object(a.useEffect)((function(){e.coords&&p(E(e.coords.split(",")[2],e.coords.split(",")[3]))}),[e.coords]),Object(a.useEffect)((function(){T.a.get(e.imageurl+"/info.json").then((function(t){if(s){if(s.addTiledImage({tileSource:t.data}),e.coords){var n=g(e.coords,t.data.height,t.data.width),a=new fe.a.Rect(n.x,n.y,n.w,n.h);if(m(s,a),d(s,a),e.lineFocusCoords){var r=g(e.lineFocusCoords,t.data.height,t.data.width),o=new fe.a.Rect(r.x,r.y,r.w,r.h);d(s,o)}v(s,a),s.viewport.fitBounds(a)}}else{var l="osd-"+h,c=fe()({id:l,prefixUrl:"/img/openseadragon/",preserveViewport:!0,visibilityRatio:1,minZoomLevel:1,defaultZoomLevel:1,tileSources:[t.data],controlsFadeDelay:0,controlsFadeLength:25});if(e.coords){var p=g(e.coords,t.data.height,t.data.width),u=new fe.a.Rect(p.x,p.y,p.w,p.h);if(m(c,u),d(c,u),e.lineFocusCoords){var f=g(e.lineFocusCoords,t.data.height,t.data.width),T=new fe.a.Rect(f.x,f.y,f.w,f.h);d(c,T)}v(c,u)}i(c)}}))}),[e.imageurl,e.coords]);var d=function(e,t){e.addHandler("open",(function(){var n=ge()(),a=document.createElement("div");a.id="runtime-overlay-"+n,a.className="osdhighlight",e.addOverlay({element:a,location:t})}))},m=function(e,t){e.addHandler("open",(function(){e.viewport.fitBounds(t,!0)}))},v=function(e,t){e.viewport.goHome=function(){this.fitBounds(t)}},g=function(e,t,n){var a=e.split(","),r=t/n;return{x:parseInt(a[0])/n,y:parseInt(a[1])/t*r,w:parseInt(a[2])/n,h:parseInt(a[3])/t*r}},E=function(t,n){var a=e.displayWidth;return{w:a,h:a*(parseInt(n)/parseInt(t))}};return r.a.createElement("div",null,e.coords?r.a.createElement("div",{id:"osd-"+h,className:"open-seadragon-container",style:{height:c.h+"px",width:c.w+"px"}}):r.a.createElement("div",{id:"osd-"+h,className:"open-seadragon-container",style:{height:"100vh"}}))};Te.defaultProps={imageurl:"https://loris2.scta.info/vat/V145v.jpg",displayWidth:1e3};var Ee=Te;var ye=function(e){return r.a.createElement(Ee,{imageurl:e.imageUrl,coords:e.coords,displayWidth:e.displayWidth,lineFocusCoords:e.lineFocusCoords})};var xe=function(e){return r.a.createElement("div",{className:"text",style:{whiteSpace:"nowrap"}},e.number&&r.a.createElement("span",null,e.label.split("(")[0],"/"),e.number&&r.a.createElement("span",null,e.number),r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}))},be=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).state={searchText:""},a}return Object(X.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.targetLabel===this.props.label?"ImageTextWrapper target":"ImageTextWrapper"},r.a.createElement("div",{className:"labelImageWrapper"},r.a.createElement(ye,{imageUrl:this.props.imageUrl,canvas:this.props.canvas,coords:this.props.coords,canvasShort:this.props.canvasShort,displayWidth:this.props.displayWidth,lineFocusCoords:this.props.lineFocusCoords})),r.a.createElement(xe,{text:this.props.text,number:this.props.number,label:this.props.label}))}}]),n}(a.Component),we=function(e){var t=Object(a.useState)(""),n=Object(f.a)(t,2),s=n[0],i=n[1];return Object(a.useEffect)((function(){e.imageurl&&T.a.get(e.imageurl+"/info.json").then((function(e){var t=e.data.logo["@id"];i(t)})).catch((function(e){console.log("no logo found",e),i("")}))}),[e.imageurl]),r.a.createElement(r.a.Fragment,null,s&&r.a.createElement("img",{src:s,style:{margin:e.margin,height:e.height},alt:"imagelogo"}))};we.defaultProps={height:"20px",margin:"5px"};var Oe=we,Ce=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).mount=!1,a.handleNext=a.handleNext.bind(Object(J.a)(a)),a.handlePrevious=a.handlePrevious.bind(Object(J.a)(a)),a.handleLineFocusNext=a.handleLineFocusNext.bind(Object(J.a)(a)),a.handleLineFocusPrev=a.handleLineFocusPrev.bind(Object(J.a)(a)),a.isLineNumberLast=a.isLineNumberLast.bind(Object(J.a)(a)),a.isLineNumberFirst=a.isLineNumberFirst.bind(Object(J.a)(a)),a.handleToggleTextLines=a.handleToggleTextLines.bind(Object(J.a)(a)),a.handleToggleAllLines=a.handleToggleAllLines.bind(Object(J.a)(a)),a.state={currentSurfaceId:"",manifest:"",canvas:"",region:"full",width:"1000",next:"",previous:"",imageurl:"",annotationsDisplay:!0,showAllLines:!1},a}return Object(X.a)(n,[{key:"handleNext",value:function(){this.props.handleSurfaceFocusChange(this.state.next)}},{key:"handlePrevious",value:function(){this.props.handleSurfaceFocusChange(this.state.previous)}},{key:"handleToggleTextLines",value:function(){this.setState((function(e){return{annotationsDisplay:!e.annotationsDisplay}}))}},{key:"handleToggleAllLines",value:function(){this.setState((function(e){return{showAllLines:!e.showAllLines}}))}},{key:"retrieveSurfaceInfo",value:function(e){var t=this;O(oe(e)).then((function(n){var a=n.data.results.bindings[0];if(a){var r="https://exist.scta.info/exist/apps/scta-app/folio-annotaiton-list-from-simpleXmlCoordinates.xq?surfaceid="+e.split("/resource/")[1]+"&coords=loose";T.a.get(r).then((function(n){t.mount&&t.setState({currentSurfaceId:e,surfaceTitle:a.surfaceTitle.value,manifest:"",canvas:a.canvas.value,imageurl:a.imageurl.value,next:a.next_surface?a.next_surface.value:"",previous:a.previous_surface?a.previous_surface.value:"",annotations:n.data?n.data.resources:""})})).catch((function(n){console.log("failed retrieving annotationlist: ",n),t.mount&&t.setState({currentSurfaceId:e,surfaceTitle:a.surfaceTitle.value,manifest:"",canvas:a.canvas.value,imageurl:a.imageurl.value,next:a.next_surface?a.next_surface.value:"",previous:a.previous_surface?a.previous_surface.value:"",annotations:""})}))}}))}},{key:"handleLineFocusNext",value:function(){var e=parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1]),t=this.props.lineFocusId.split("/");t.pop(),t.push((e+1).toString()),this.props.handleLineFocusChange(t.join("/"))}},{key:"handleLineFocusPrev",value:function(){var e=parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1]),t=this.props.lineFocusId.split("/");t.pop(),t.push((e-1).toString()),this.props.handleLineFocusChange(t.join("/"))}},{key:"isLineNumberFirst",value:function(){return 1===parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1])}},{key:"isLineNumberLast",value:function(){var e=this.state.annotations?this.state.annotations.length:"";return parseInt(this.props.lineFocusId.split("/")[this.props.lineFocusId.split("/").length-1])===e}},{key:"componentDidMount",value:function(){this.mount=!0,this.props.surfaceid&&this.retrieveSurfaceInfo(this.props.surfaceid),this.setState({annotationsDisplay:this.props.annotationsDisplay})}},{key:"componentDidUpdate",value:function(e){this.props.surfaceid!==e.surfaceid&&this.retrieveSurfaceInfo(this.props.surfaceid)}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){var e=this,t=function(t,n){var a=t.resource.chars,s=t.on.split("#xywh=")[0],i=s.split("/")[s.split("/").length-1],o=t.on.split("#xywh=")[1],l=t.imageUrl,c=t.label;return e.state.showAllLines||parseInt(e.props.lineFocusId.split("/")[e.props.lineFocusId.split("/").length-1])===n+1||!e.props.lineFocusId?r.a.createElement(be,{key:n,imageUrl:l,canvas:s,coords:o,canvasShort:i,text:a,label:c,number:n+1,targetLabel:e.props.targetLabel,surfaceButton:!1,displayWidth:e.props.width?e.props.width:e.state.width}):null};return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},this.state.currentSurfaceId?r.a.createElement("div",null,r.a.createElement("div",{className:"surface-navigation"},r.a.createElement("p",null,this.state.surfaceTitle),this.props.handleSurfaceFocusChange&&r.a.createElement("div",null,this.state.previous&&r.a.createElement(u.a,{size:"sm",onClick:this.handlePrevious},"Previous Page"),this.state.next&&r.a.createElement(u.a,{size:"sm",onClick:this.handleNext},"Next Page")),this.props.handleLineFocusChange&&!this.state.showAllLines&&r.a.createElement("div",null,!this.isLineNumberFirst()&&r.a.createElement(u.a,{size:"sm",onClick:this.handleLineFocusPrev},"Previous Line"),!this.isLineNumberLast()&&r.a.createElement(u.a,{size:"sm",onClick:this.handleLineFocusNext},"Next Line")),r.a.createElement("div",null,this.props.lineFocusId&&r.a.createElement(u.a,{size:"sm",onClick:this.handleToggleAllLines},"Toggle All/Focus Lines"),this.state.annotations&&r.a.createElement(u.a,{size:"sm",onClick:this.handleToggleTextLines},"Toggle Show Text Lines")),r.a.createElement(Oe,{imageurl:this.state.imageurl})),function(){if(e.state.annotations&&e.state.annotationsDisplay){console.log("single annotation",e.state.annotations);var n=[];if(e.state.annotations.length)n=e.state.annotations.map((function(e,n){return t(e,n)}));else{var a=t(e.state.annotations,0);console.log(a),n=a}return console.log("test",n),n}return r.a.createElement(Ee,{imageurl:e.state.imageurl})}()):r.a.createElement("p",null,"No surface selected"))}}]),n}(r.a.Component);Ce.defaultProps={annotationsDisplay:!0};var Se=Ce,ke=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).mounted="",a.handleNext=a.handleNext.bind(Object(J.a)(a)),a.handlePrevious=a.handlePrevious.bind(Object(J.a)(a)),a.state={region:"full",surfaces:[]},a}return Object(X.a)(n,[{key:"handleNext",value:function(){this.props.handleSurfaceFocusChange(this.state.next)}},{key:"handlePrevious",value:function(){this.props.handleSurfaceFocusChange(this.state.previous)}},{key:"retrieveSurfaceInfo",value:function(e){var t=this;O(["SELECT ?first ?last ?order ?surface","{","<"+e+"> <http://scta.info/property/isOnZone> ?zone . ","?zone <http://scta.info/property/isOnZone> ?zone2 .","?zone2 <http://scta.info/property/firstLine> ?first .","?zone2 <http://scta.info/property/lastLine> ?last .","?zone2 <http://scta.info/property/isPartOfSurface> ?surface .","?zone <http://scta.info/property/isOnZoneOrder> ?order .","}"].join("")).then((function(e){e.data.results.bindings.forEach((function(e){var n=e.surface.value,a=e.first.value,r=e.last.value,s=e.order.value;O(oe(n)).then((function(e){var i=e.data.results.bindings[0];if(i){var o="https://exist.scta.info/exist/apps/scta-app/folio-annotaiton-list-from-simpleXmlCoordinates.xq?surfaceid="+n.split("/resource/")[1]+"&coords=loose";T.a.get(o).then((function(e){t.mounted&&t.setState((function(t){var o={currentSurfaceId:n,surfaceTitle:i.surfaceTitle?i.surfaceTitle.value:"",canvas:i.canvas.value,imageurl:i.imageurl.value,next:i.next_surface?i.next_surface.value:"",previous:i.previous_surface?i.previous_surface.value:"",annotations:e.data?e.data.resources:"",surfaceid:n,firstLine:a,lastLine:r,order:s};return{surfaces:[].concat(Object(F.a)(t.surfaces),[o])}}))})).catch((function(e){t.mounted&&t.setState((function(e){var t={currentSurfaceId:n,surfaceTitle:i.surfaceTitle.value,canvas:i.canvas.value,imageurl:i.imageurl.value,next:i.next_surface?i.next_surface.value:"",previous:i.previous_surface?i.previous_surface.value:"",annotations:"",surfaceid:n,firstLine:a,lastLine:r,order:s};return{surfaces:[].concat(Object(F.a)(e.surfaces),[t])}}))}))}}))}))}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.props.manifestationid&&this.setState((function(e){return{surfaces:[]}}),this.retrieveSurfaceInfo(this.props.manifestationid))}},{key:"componentDidUpdate",value:function(e){this.props.manifestationid!==e.manifestationid&&this.setState((function(e){return{surfaces:[]}}),this.retrieveSurfaceInfo(this.props.manifestationid))}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(t){if(t.annotations&&"lines"===e.props.annotationsDisplay)return t.annotations.map((function(n,a){if(a+1>=t.firstLine&&a<t.lastLine){var s=n.resource.chars,i=n.on.split("#xywh=")[0],o=i.split("/")[i.split("/").length-1],l=n.on.split("#xywh=")[1],c=n.imageUrl,p=n.label;return r.a.createElement(be,{key:a,imageUrl:c,canvas:i,coords:l,canvasShort:o,text:s,label:p,number:a+1,targetLabel:e.props.targetLabel,surfaceButton:!1,displayWidth:e.props.width})}return null}));if(t.annotations&&"paragraph"===e.props.annotationsDisplay){var n=t.annotations.length?t.annotations[t.firstLine-1]:t.annotations,a=t.annotations.length?t.annotations[t.firstLine-1]:t.annotations,s=a?a.on.split("#xywh=")[0]:"",i=s.split("/")[s.split("/").length-1],o=a?a.on.split("#xywh=")[1]:"",l=o.split(",")[1],c=t.annotations.length?t.annotations[t.lastLine-1]:t.annotations,p=c?c.on.split("#xywh=")[1]:"",u=p.split(",")[1],h=p.split(",")[3],d=parseInt(u)+parseInt(h)-parseInt(l),m=(parseInt(o.split(",")[0])>10?parseInt(o.split(",")[0])-10:parseInt(o.split(",")[0]))+","+parseInt(l)+","+(parseInt(o.split(",")[2])+10)+","+(parseInt(d)+50),f=n?n.imageUrl:"",v="";if(e.props.lineFocusId)if(t.annotations.length)t.annotations.forEach((function(t,n){parseInt(e.props.lineFocusId.split("/")[e.props.lineFocusId.split("/").length-1])===n+1&&(v=t.on.split("#xywh=")[1])}));else{var g=t.annotations;1===parseInt(e.props.lineFocusId.split("/")[e.props.lineFocusId.split("/").length-1])&&(v=g.on.split("#xywh=")[1])}return f?r.a.createElement(be,{key:t.currentSurfaceId+"-"+t.order,imageUrl:f,canvas:s,coords:m,canvasShort:i,text:"",label:"",targetLabel:"",surfaceButton:!1,displayWidth:e.props.width,lineFocusCoords:v}):r.a.createElement("p",{key:t.currentSurfaceId+"-"+t.order},"Sorry, this image is not yet ready")}return r.a.createElement("img",{key:t.currentSurfaceId+"-"+t.order,alt:"manuscript",src:t.imageurl+"/full/"+e.props.width+",/0/default.jpg"})};return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},e.state.surfaces.sort((function(e,t){return e.order>t.order?1:t.order>e.order?-1:0})).map((function(e){return t(e)})),r.a.createElement(Oe,{imageurl:this.state.surfaces[0]?this.state.surfaces[0].imageurl:""}))}}]),n}(r.a.Component);ke.defaultProps={width:"501"};var Re=ke,Ie=n(29),Le=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleChangeManifestation=a.handleChangeManifestation.bind(Object(J.a)(a)),a.handleToggleTextLinesView=a.handleToggleTextLinesView.bind(Object(J.a)(a)),a.handleSetCustomExpressionId=a.handleSetCustomExpressionId.bind(Object(J.a)(a)),a.handleGetCustomManifestations=a.handleGetCustomManifestations.bind(Object(J.a)(a)),a.handleChangeCustomManifestation=a.handleChangeCustomManifestation.bind(Object(J.a)(a)),a.state={focusedManifestation:"",annotationsDisplay:"lines",userAddedExpressionId:"",userAddedManifestations:[],focusedCustomManifestation:""},a}return Object(X.a)(n,[{key:"handleChangeCustomManifestation",value:function(e){this.setState({focusedCustomManifestation:e})}},{key:"handleSetCustomExpressionId",value:function(e){this.setState({userAddedExpressionId:e})}},{key:"handleGetCustomManifestations",value:function(e){var t=this;e.preventDefault(),O(se(this.state.userAddedExpressionId)).then((function(e){var n=e.data.results.bindings.map((function(e){return{manifestation:e.manifestation.value,manifestationTitle:e.manifestationTitle.value,transcription:e.manifestationCTranscription?e.manifestationCTranscription.value:""}}));t.setState({userAddedManifestations:n,focusedCustomManifestation:e.data.results.bindings[0].cmanifestation.value})}))}},{key:"handleToggleTextLinesView",value:function(e){this.props.handleToggleTextLinesView?this.props.handleToggleTextLinesView(e):this.setState((function(t){return{annotationsDisplay:e}}))}},{key:"handleChangeManifestation",value:function(e){e.preventDefault(),this.props.handleChangeManifestation?this.props.handleChangeManifestation(e.target.value):this.setState({focusedManifestation:e.target.value})}},{key:"componentDidMount",value:function(){var e=this;this.props.manifestations&&this.setState((function(t){return{focusedManifestation:e.props.focusedManifestation,annotationsDisplay:e.props.annotationsDisplay}}))}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.focusedManifestation!==e.focusedManifestation&&this.setState((function(e){return{focusedManifestation:t.props.focusedManifestation}})),this.props.annotationsDisplay!==e.annotationsDisplay&&this.setState((function(e){return{annotationsDisplay:t.props.annotationsDisplay}}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},!this.props.hideSelectionList&&r.a.createElement("div",{className:"manifestationsList"},r.a.createElement(v.a.Control,{size:"sm",as:"select",onChange:this.handleChangeManifestation,value:this.state.focusedManifestation},e.props.manifestations.map((function(e){return r.a.createElement("option",{key:"title-"+e.manifestation,value:e.manifestation},e.manifestationTitle)})))),r.a.createElement("div",{className:"surfaceWrapper"},!this.props.hideDisplayChoice&&this.state.focusedManifestation&&r.a.createElement("div",{className:"image-display-choice"},r.a.createElement("p",null,r.a.createElement("span",{title:"Text Line View",onClick:function(){e.handleToggleTextLinesView("lines")}},r.a.createElement(re.w,null))),r.a.createElement("p",null,r.a.createElement("span",{title:"Paragraph View",onClick:function(){e.handleToggleTextLinesView("paragraph")}},r.a.createElement(re.x,null))),r.a.createElement("p",null,r.a.createElement("span",{title:"Full Surface View",onClick:function(){e.handleToggleTextLinesView("surface")}},r.a.createElement(re.s,null)))),r.a.createElement("div",{className:"imagesDisplay"},e.props.manifestations.map((function(t){return t.manifestation===e.state.focusedManifestation?r.a.createElement(Re,{key:"surface-"+t.manifestation,manifestationid:t.manifestation,annotationsDisplay:e.state.annotationsDisplay,width:e.props.width,lineFocusId:e.props.lineFocusId}):null})))),this.state.userAddedManifestations.length>0&&r.a.createElement(n,{manifestations:this.state.userAddedManifestations,focusedManifestation:this.state.focusedCustomManifestation,annotationsDisplay:this.state.annotationsDisplay,handleToggleTextLinesView:this.props.handleToggleTextLinesView,handleChangeManifestation:this.handleChangeCustomManifestation,width:this.props.width,lineFocusId:"",hidden:!1,isDependentSurface3:!0}),!this.props.isDependentSurface3&&r.a.createElement("div",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.1)",borderTop:"1px solid rgba(0, 0, 0, 0.1)",marginTop:"5px",padding:"5px"}},r.a.createElement("p",{style:{fontSize:"12px"}},"Create custom user compare"),r.a.createElement(v.a,{onSubmit:this.handleGetCustomManifestations,inline:!0},r.a.createElement(Ie.a,{inline:"true",size:"sm",id:"text",type:"text",value:this.state.userAddedExpressionId,placeholder:"expression id",className:"mr-sm-2",onChange:function(t){e.handleSetCustomExpressionId(t.target.value)}}),r.a.createElement(u.a,{inline:"true",size:"sm",type:"submit",style:{margin:"2px"}},"Submit"))))}}]),n}(r.a.Component);Le.defaultProps={manifestations:[],hidden:!1,focusedManifestation:"",annotationsDisplay:"paragraph",width:"500"};var je=Le,Ne=n(280),Pe=n(104),Fe=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).mount=!1,a.retrieveXML=a.retrieveXML.bind(Object(J.a)(a)),a.state={xmlstring:""},a}return Object(X.a)(n,[{key:"retrieveXML",value:function(e){var t=this,n="https://exist.scta.info/exist/apps/scta-app/document/"+e.split("/resource/")[1];T.a.get(n).then((function(e){t.mount&&t.setState({xmlstring:e.data})}))}},{key:"componentDidMount",value:function(){this.mount=!0,this.props.tresourceid&&this.retrieveXML(this.props.tresourceid)}},{key:"componentDidUpdate",value:function(e){this.props.tresourceid!==e.tresourceid&&this.retrieveXML(this.props.tresourceid)}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},r.a.createElement(Ne.a,{language:"xml",style:Pe.docco,showLineNumbers:!0},this.state.xmlstring))}}]),n}(r.a.Component),Ae=n(16);var Me=function(e){return r.a.createElement(Ae.a,{variant:"tabs"},e.availableTabs&&e.availableTabs.map((function(t,n){return t.show?r.a.createElement(Ae.a.Item,{key:"tab-"+t.name},r.a.createElement(Ae.a.Link,{active:e.windowLoad===t.name,title:t.description,onClick:function(){e.handleTabChange(t.name,e.windowId)}},t.icon)):null})),"minimum"!==e.openWidthHeight&&r.a.createElement(Ae.a.Item,null,r.a.createElement(Ae.a.Link,{title:"Minimize Window",onClick:function(){e.handleMinimize(e.windowId)}},r.a.createElement(re.C,null))),"middle"!==e.openWidthHeight&&r.a.createElement(Ae.a.Item,null,r.a.createElement(Ae.a.Link,{title:"Half Size Window",onClick:function(){e.handleMiddlize(e.windowId)}},r.a.createElement(re.D,null))),"maximum"!==e.openWidthHeight&&r.a.createElement(Ae.a.Item,null,r.a.createElement(Ae.a.Link,{title:"Maximize Window",onClick:function(){e.handleMaximize(e.windowId)}},r.a.createElement(re.B,null))),"window1"!==e.windowId&&r.a.createElement(Ae.a.Item,null,r.a.createElement(Ae.a.Link,{title:"Close Window",onClick:function(){e.handleClose(e.windowId)}},r.a.createElement(re.A,null))),r.a.createElement(Ae.a.Item,null,!e.altWindowState&&r.a.createElement(Ae.a.Link,{title:"Clone Window",onClick:function(){e.handleDuplicateWindow(e.windowId,e.windowType)}},r.a.createElement(re.i,null))))};var De=function(e){var t=function(){e.selectionRange&&e.selectionRange.wordRange?e.handleBlockFocusChange(e.info.resourceid):e.handleBlockFocusChange(e.info.parent)};return e.info?r.a.createElement(Ae.a,{variant:"tabs"},r.a.createElement(Ae.a.Link,{onClick:function(){e.handleBlockFocusChange(e.info.resourceid)}},e.selectionRange&&e.selectionRange.wordRange?e.info.title+"@"+e.selectionRange.wordRange.start+"-"+e.selectionRange.wordRange.end:e.info.title),r.a.createElement(Ae.a.Item,null,e.info.previous&&"http://scta.info/resource/"!==e.info.previous&&r.a.createElement(Ae.a.Link,{title:"Move Up to Previous Sibling Resource",onClick:function(){e.handleBlockFocusChange(e.info.previous)}},r.a.createElement(re.b,null))),r.a.createElement(Ae.a.Item,null,e.info.next&&"http://scta.info/resource/"!==e.info.next&&r.a.createElement(Ae.a.Link,{title:"Move Up to Next Sibling Resource",onClick:function(){e.handleBlockFocusChange(e.info.next)}},r.a.createElement(re.c,null))),r.a.createElement(Ae.a.Item,null,e.info.resourceid!==e.info.topLevel&&"http://scta.info/resource/"!==e.info.parent&&r.a.createElement(Ae.a.Link,{title:"Move Up to Parent Resource",onClick:t},r.a.createElement(re.d,null)))):null},_e=n(105),We=n.n(_e),Ue=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleShow=a.handleToggleShow.bind(Object(J.a)(a)),a.handleToggleCompare=a.handleToggleCompare.bind(Object(J.a)(a)),a.mounted="",a.state={showCompare:!1,compareText:"",rawText:"",show:!0,levenshteinDistance:void 0,usedBase:void 0,usedCompareTranscription:void 0},a}return Object(X.a)(n,[{key:"handleToggleShow",value:function(){this.setState((function(e){return{show:!e.show}}))}},{key:"handleToggleCompare",value:function(){this.setState((function(e){return{showCompare:!e.showCompare}}))}},{key:"textClean",value:function(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").replace(/\s{2,}/g," ").toLowerCase()}},{key:"createCompare",value:function(e,t){var n=this;T.a.get("https://exist.scta.info/exist/apps/scta-app/csv-pct.xq?resourceid="+t).then((function(t){var a=t.data;n.props.isMainText&&n.props.targetRange?a=j(t.data,n.props.targetRange):"isQuotedBy"===n.props.relationLabel||"isReferencedBy"===n.props.relationLabel?a=t.data:n.props.isRelatedToRange&&(a=j(t.data,n.props.isRelatedToRange));var r=new We.a.diff_match_patch,s=function(e,t,n){var a=n.diff_wordsToChars_(e,t),r=a.chars1,s=a.chars2,i=a.lineArray,o=n.diff_main(r,s,!1);return n.diff_charsToLines_(o,i),o}(n.textClean(e),n.textClean(a),r);r.diff_cleanupSemantic(s);var i=r.diff_levenshtein(s),o=r.diff_prettyHtml(s);!0===n.mounted&&e?n.setState({compareText:o,rawText:a,levenshteinDistance:i,showCompare:n.props.showCompare,usedBase:n.props.base,usedCompareTranscription:n.props.compareTranscription}):n.mounted&&n.setState({rawText:a,showCompare:n.props.showCompare,usedBase:n.props.base,usedCompareTranscription:n.props.compareTranscription})})).catch((function(e){console.log("text request/comparison error",e)}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.setState({rawText:"",compareText:"",showCompare:this.props.showCompare}),this.props.show&&this.createCompare(this.props.base,this.props.compareTranscription)}},{key:"componentDidUpdate",value:function(e){!this.props.show||this.props.base===this.state.usedBase&&this.props.compareTranscription===this.state.usedCompareTranscription||this.createCompare(this.props.base,this.props.compareTranscription)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(){var t=[{manifestation:e.props.manifestation,manifestationTitle:e.props.manifestationTitle,transcription:""}];return r.a.createElement("div",null,r.a.createElement("span",{onClick:function(){e.setState((function(e){return{showImage:!e.showImage}}))}},r.a.createElement(re.z,null)),e.state.showImage&&r.a.createElement("div",null,r.a.createElement(je,{manifestations:t,focusedManifestation:e.props.manifestation,width:e.props.surfaceWidth,hideSelectionList:!0,isDependentSurface3:!0})))};return function(){var n=e.props.base===e.state.rawText;if(e.state.showCompare&&e.props.base&&e.state.compareText){var a=e.state.levenshteinDistance,s=5*a;return r.a.createElement("div",{style:{borderLeft:"5px solid rgba("+s+", 0, 255, 1)",paddingLeft:"5px"}},r.a.createElement("span",null,r.a.createElement(o.b,{to:"/text?resourceid="+e.props.compareTranscription+("isQuotedBy"!==e.props.relationLabel&&"isReferencedBy"!==e.props.relationLabel&&e.props.isRelatedToRange?"@"+e.props.isRelatedToRange:"")},e.props.manifestationTitle)," "),r.a.createElement("span",{className:"lbp-span-link",title:"show/hide",onClick:function(){return e.handleToggleShow()}},e.state.show?r.a.createElement(re.r,null):r.a.createElement(re.q,null)),r.a.createElement("span",{className:"lbp-span-link",title:"toggle comparison off",onClick:function(){return e.handleToggleCompare()}},r.a.createElement(re.H,null)),!n&&r.a.createElement("span",{className:"lbp-span-link",title:"set as base",onClick:function(){return e.props.handleChangeBase(e.state.rawText)}},r.a.createElement(re.F,null)),r.a.createElement("span",{style:{fontSize:"14px",paddingLeft:"4px"},title:"levenshtein distance"},a),r.a.createElement("div",{className:e.state.show?"unhidden":"hidden"},r.a.createElement("div",{ref:"text",dangerouslySetInnerHTML:{__html:e.state.compareText}}),t()))}return e.state.rawText?r.a.createElement("div",null,r.a.createElement("span",null,r.a.createElement(o.b,{to:"/text?resourceid="+e.props.compareTranscription+("isQuotedBy"!==e.props.relationLabel&&"isReferencedBy"!==e.props.relationLabel&&e.props.isRelatedToRange?"@"+e.props.isRelatedToRange:"")},e.props.manifestationTitle))," |",r.a.createElement("span",{className:"lbp-span-link",title:"show/hide",onClick:function(){return e.handleToggleShow()}},e.state.show?r.a.createElement(re.r,null):r.a.createElement(re.q,null)),r.a.createElement("span",{className:"lbp-span-link",title:"toggle comparison on",onClick:function(){return e.handleToggleCompare()}},r.a.createElement(re.G,null)),!n&&r.a.createElement("span",{className:"lbp-span-link",title:"set as base",onClick:function(){return e.props.handleChangeBase(e.state.rawText)}},r.a.createElement(re.F,null)),r.a.createElement("div",{className:e.state.show?"unhidden":"hidden"},r.a.createElement("div",{ref:"text",dangerouslySetInnerHTML:{__html:e.state.rawText}}),t())):r.a.createElement(P,null)}()}}]),n}(r.a.Component),Be=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleShowAll=a.handleToggleShowAll.bind(Object(J.a)(a)),a.mounted="",a.state={info:"",show:!1,baseText:""},a}return Object(X.a)(n,[{key:"handleToggleShowAll",value:function(){this.setState((function(e){return{show:!e.show}}))}},{key:"arrangeTextInfo",value:function(e,t){var n=this;e.then((function(e){var a=e.data.results.bindings[0],r=e.data.results.bindings.map((function(e){return{manifestation:e.manifestation.value,manifestationTitle:e.manifestationTitle.value,transcription:e.manifestationCTranscription?e.manifestationCTranscription.value:""}}));!0===n.mounted&&a&&n.setState({info:{resourceid:t,title:a.title.value,structureType:a.structureType.value,inbox:a.inbox.value,next:a.next?a.next.value:"",previous:a.previous?a.previous.value:"",cdoc:a.cdoc?a.cdoc.value:"",cxml:a.cxml?a.cxml.value:"",topLevel:a.topLevelExpression.value,cmanifestation:a.cmanifestation?a.cmanifestation.value:"",ctranscription:a.ctranscription?a.ctranscription.value:"",manifestations:r}})}))}},{key:"getTextInfo",value:function(e){var t=O(se(e));this.arrangeTextInfo(t,e)}},{key:"componentDidMount",value:function(){this.mounted=!0,this.setState({show:this.props.show}),this.props.isMainText?this.setState({info:this.props.info}):this.getTextInfo(this.props.expressionid)}},{key:"componentDidUpdate",value:function(e){this.props.info.resourceid===e.info.resourceid&&this.props.info.relatedExpressions===e.info.relatedExpressions||(this.props.isMainText?this.setState({info:this.props.info}):this.getTextInfo(this.props.expressionid))}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.1)",padding:"5px"}},r.a.createElement("div",{style:{fontSize:"12px"}},this.props.isMainText&&r.a.createElement("span",null,"[Target] "),r.a.createElement("span",null,this.props.relationLabel),this.props.referringResource&&this.props.referringResource!==this.props.info.resourceid&&r.a.createElement("span",null," (",r.a.createElement(o.b,{to:"/text?resourceid="+this.props.referringResource},"via"),")")),r.a.createElement("div",null,this.state.info.resourceid?r.a.createElement(o.b,{to:"/text?resourceid="+this.state.info.resourceid+("isQuotedBy"!==this.props.relationLabel&&"isReferencedBy"!==this.props.relationLabel&&this.props.isRelatedToRange?"@"+this.props.isRelatedToRange:"")},this.props.authorTitle||this.props.longTitle?r.a.createElement("span",null," ",this.props.authorTitle," ",this.props.longTitle):this.state.info.resourceid):this.props.authorTitle||this.props.longTitle?r.a.createElement("span",null," ",this.props.authorTitle," ",this.props.longTitle):this.state.info.resourceid,this.state.info.resourceid&&r.a.createElement("span",{onClick:function(){return e.handleToggleShowAll()}},this.state.show?r.a.createElement(re.r,null):r.a.createElement(re.q,null))),r.a.createElement("div",{className:this.state.show?"unhidden":"hidden",style:{paddingLeft:"10px"}},e.props.isMainText&&"http://scta.info/resource/structureCollection"===e.props.info.structureType?r.a.createElement("p",null,"Text too big to display; move down the text hierarchy to focus on a smaller section"):e.state.info.manifestations?e.state.info.manifestations.map((function(t){return r.a.createElement(Ue,{key:t.transcription,base:e.props.baseText,compareTranscription:t.transcription,manifestationTitle:t.manifestationTitle,manifestation:t.manifestation,handleChangeBase:e.props.handleChangeBase,show:e.state.show,showCompare:!!e.props.isMainText,surfaceWidth:e.props.surfaceWidth,isRelatedToRange:e.props.isRelatedToRange,targetRange:e.props.targetRange,isMainText:e.props.isMainText,relationLabel:e.props.relationLabel})})):void 0))}}]),n}(r.a.Component);var He=function(e){var t=Object(a.useState)([]),n=Object(f.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(".02"),l=Object(f.a)(o,2),c=l[0],p=l[1],u=Object(a.useState)(".02"),h=Object(f.a)(u,2),d=h[0],m=h[1];return Object(a.useEffect)((function(){var t=function(e){return T.a.get("http://localhost:3030/ds/query",{params:{query:e,output:"json"}})}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".05",n=["SELECT ?s ?start ?other ?text ?cosineScore ","WHERE {","BIND (<"+e+"> as ?start) . ","{","?s <http://www.w3.org/ns/oa#hasSource> ?start .","?s <http://www.w3.org/ns/oa#hasTarget> ?other .","?s <http://www.w3.org/ns/oa#hasBody> ?bn .","?bn <http://www.w3.org/1999/02/22-rdf-syntax-ns#value> ?text .","}","UNION","{","?s <http://www.w3.org/ns/oa#hasSource> ?other .","?s <http://www.w3.org/ns/oa#hasTarget> ?start . ","?s <http://www.w3.org/ns/oa#hasBody> ?bn .","?bn <http://www.w3.org/1999/02/22-rdf-syntax-ns#value> ?text .","}","?s <http://scta.info/property/cosineScore> ?cosineScore .","FILTER (?cosineScore >= "+t+") ","}","ORDER BY DESC(?cosineScore) ","LIMIT 100"].join(" ");return n}(e.resourceid,d)),n=[];t.then((function(e){e.data.results.bindings.forEach((function(e){n.push({id:e.other.value,relationLabel:"ngram: "+e.text.value,referringResource:"",author:"",authorTitle:"",longTitle:"",show:!1,isRelatedToRange:""})})),i(n)}))}),[e.resourceid,d]),r.a.createElement("div",null,r.a.createElement("input",{type:"text",value:c,onChange:function(e){return p(e.target.value)}}),r.a.createElement("button",{onClick:function(){m(c)}},"Re-run Query with new minimum"),"retrieving"===s?r.a.createElement(P,null):function(){var t=s.map((function(t,n){return r.a.createElement("div",{key:n+"-ngram-"+t.id},r.a.createElement(Be,{info:e.info,expressionid:t.id,relationLabel:t.relationLabel,referringResource:t.referringResource,author:t.author,authorTitle:t.authorTitle,longTitle:t.longTitle,isMainText:!1,handleChangeBase:e.handleChangeBase,baseText:e.baseText,show:t.show,surfaceWidth:e.surfaceWidth,isRelatedToRange:t.isRelatedToRange}))}));return t}())},qe=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleCompare=a.handleToggleCompare.bind(Object(J.a)(a)),a.handleChangeBase=a.handleChangeBase.bind(Object(J.a)(a)),a.handleCustomUpdateRelatedExpressions=a.handleCustomUpdateRelatedExpressions.bind(Object(J.a)(a)),a.handleSetCustomExpressionId=a.handleSetCustomExpressionId.bind(Object(J.a)(a)),a.getText=a.getText.bind(Object(J.a)(a)),a.mounted="",a.state={expressions:[],page:1,intendedPage:1,pagesize:10,nextPage:2,previousPage:void 0,offset:0,rangeStart:1,rangeEnd:20,baseText:"",customExpressionId:"",customExpressionObject:{}},a}return Object(X.a)(n,[{key:"handleSetCustomExpressionId",value:function(e){this.setState({customExpressionId:e})}},{key:"handleCustomUpdateRelatedExpressions",value:function(e){e.preventDefault();var t={resourceid:this.state.customExpressionId,relationLabel:"user added comparison"};this.setState({customExpressionObject:t})}},{key:"handleChangeBase",value:function(e){this.setState({baseText:e})}},{key:"handleToggleCompare",value:function(e){this.setState((function(t){var n=Object(ne.a)({},t.expressions);return n[e].show=!n[e].show,{expressions:n}}))}},{key:"getText",value:function(e){var t=this,n=this;T.a.get("https://exist.scta.info/exist/apps/scta-app/csv-pct.xq?resourceid="+e).then((function(e){if(t.mounted){var a=e.data;if(t.props.selectionRange.wordRange){var r=n.props.selectionRange.wordRange.start+"-"+n.props.selectionRange.wordRange.end;a=j(e.data,r)}n.setState({baseText:a})}}))}},{key:"getRelatedExpressions",value:function(e,t,n){var a=this,r=(t-1)*n,s=this.props.selectionRange&&this.props.selectionRange.wordRange?this.props.selectionRange.wordRange.start:"",i=this.props.selectionRange&&this.props.selectionRange.wordRange?this.props.selectionRange.wordRange.end:"";O(function(e,t,n,a,r){var s,i,o;return a&&r&&(s=["FILTER (?isRelatedToRangeEnd <="+r+")","FILTER (?isRelatedToRangeStart >="+a+")"].join(" ")),["SELECT DISTINCT ?isRelatedTo ?label ?element ?longTitle ?author ?authorTitle ?isRelatedToRangeStart ?isRelatedToRangeEnd ","WHERE","{ ","BIND (<"+e+"> as ?resource)","{","?resource ?o ?isRelatedTo .","?o a <http://scta.info/resource/textRelation> .","FILTER (?o != <http://scta.info/property/quotes>)","FILTER (?o != <http://scta.info/property/quotedBy>)","FILTER (?o != <http://scta.info/property/references>)","FILTER (?o != <http://scta.info/property/referencedBy>)","?o <http://www.w3.org/1999/02/22-rdf-syntax-ns#label> ?label . ","?isRelatedTo a <http://scta.info/resource/expression> .","}","UNION","{","{","?resource <http://scta.info/property/structureType> <http://scta.info/resource/structureElement> .","BIND (?resource as ?element)","}","UNION","{","?element <http://scta.info/property/isMemberOf> ?resource .","}","{",i=a||r?["?element <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?isRelatedTo .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .",s].join(" "):["{","?element <http://scta.info/property/source> ?isRelatedTo .","FILTER (!isBlank(?isRelatedTo)) .","}","UNION","{","?element <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?isRelatedTo .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .","}"].join(" "),"?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> .","BIND ('quotes' as ?label) .","}","UNION","{",i,"?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> .","BIND ('refs' as ?label) .","}","}","UNION","{","{","BIND (?resource as ?element)","}","UNION","{","?element <http://scta.info/property/isMemberOf> ?resource .","}","{",o=a||r?["?isRelatedTo <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?element .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .",s].join(" "):["{","?isRelatedTo <http://scta.info/property/source> ?element .","}","UNION","{","?isRelatedTo <http://scta.info/property/source> ?bn .","?bn <http://scta.info/property/source> ?element .","?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .","?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .","}"].join(" "),"?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> .","BIND ('isQuotedBy' as ?label) .","}","UNION","{",o,"?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> .","BIND ('isReferencedBy' as ?label) .","}","}","?isRelatedTo <http://scta.info/property/longTitle> ?longTitle .","?isRelatedTo <http://scta.info/property/isMemberOf> ?mem .","?mem <http://scta.info/property/level> '1' .","OPTIONAL","{","?mem <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle","}","}","ORDER BY ?authorTitle","LIMIT "+n,"OFFSET "+t].join(" ")}(e,r,n,s,i)).then((function(e){var r=e.data.results.bindings,s=[];s.push({id:a.props.info.resourceid,authorTitle:a.props.info.authorTitle,longTitle:a.props.info.longTitle,show:!1}),r.forEach((function(e){s.push({id:e.isRelatedTo.value,relationLabel:e.label.value,referringResource:e.element?e.element.value:"",author:e.author?e.author.value:"",authorTitle:e.authorTitle?e.authorTitle.value:"",longTitle:e.longTitle?e.longTitle.value:"",show:!1,isRelatedToRange:e.isRelatedToRangeStart&&e.isRelatedToRangeEnd?e.isRelatedToRangeStart.value+"-"+e.isRelatedToRangeEnd.value:""})})),a.mounted&&a.setState({expressions:s,intendedPage:t,nextPage:t+1,previousPage:t>1?t-1:void 0,offset:(t-1)*n,rangeStart:(t-1)*n+1,rangeEnd:n*t})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.props.info&&(this.getRelatedExpressions(this.props.info.resourceid,this.state.page,this.state.pagesize),"http://scta.info/resource/structureCollection"!==this.props.info.structureType&&this.getText(this.props.info.ctranscription))}},{key:"componentDidUpdate",value:function(e,t){if(e.info.resourceid!==this.props.info.resourceid||t.page!==this.state.page||e.selectionRange!==this.props.selectionRange){var n=e.info.resourceid!==this.props.info.resourceid?1:this.state.page;this.getRelatedExpressions(this.props.info.resourceid,n,this.state.pagesize),"http://scta.info/resource/structureCollection"!==this.props.info.structureType&&this.getText(this.props.info.ctranscription)}if(t.customExpressionObject!==this.state.customExpressionObject){var a=this.state.customExpressionObject,r={id:a.resourceid,relationLabel:a.relationLabel};this.setState((function(e){return{expressions:[].concat(Object(F.a)(e.expressions),[r])}}))}}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=function(){return r.a.createElement("div",null,(Object.keys(e.state.expressions).length>e.state.pagesize||e.state.rangeEnd>e.state.pagesize)&&r.a.createElement("p",{className:"small"},e.state.previousPage&&r.a.createElement("span",null,r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return e.setState({page:e.state.previousPage})}},"Previous ",e.state.previousPage),r.a.createElement("span",null," | ")),r.a.createElement("span",null,"Current Page: "),r.a.createElement(Ie.a,{style:{width:"40px",display:"inline"},inline:"true",size:"sm",id:"text",type:"text",onChange:function(t){return e.setState({intendedPage:t.target.value})},value:e.state.intendedPage}),r.a.createElement(u.a,{style:{display:"inline"},inline:"true",size:"sm",onClick:function(t){return e.setState({page:parseInt(e.state.intendedPage)})}},"Go"),r.a.createElement("span",null,"(",e.state.rangeStart," - ",e.state.rangeEnd,")"),Object.keys(e.state.expressions).length>e.state.pagesize&&r.a.createElement("span",null,r.a.createElement("span",null," | "),r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return e.setState({page:e.state.nextPage})}},"Next: ",e.state.nextPage))))};return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},r.a.createElement("h4",null,"Text Comparisons"),t(),r.a.createElement("p",{className:"small"},r.a.createElement("a",{href:"https://lombardpress.org/adfontes/",target:"_blank",rel:"noopener noreferrer"},"Advanced Index and Filtering")),r.a.createElement("hr",null),e.state.expressions.map((function(t,n){var a=e.props.info.resourceid===t.id;return r.a.createElement("div",{key:n+"-"+t.id},r.a.createElement(Be,{info:e.props.info,expressionid:t.id,relationLabel:t.relationLabel,referringResource:t.referringResource,author:t.author,authorTitle:t.authorTitle,longTitle:t.longTitle,isMainText:a,handleChangeBase:e.handleChangeBase,baseText:e.state.baseText,show:t.show,surfaceWidth:e.props.surfaceWidth,isRelatedToRange:t.isRelatedToRange,targetRange:e.props.selectionRange&&e.props.selectionRange.wordRange?e.props.selectionRange.wordRange.start+"-"+e.props.selectionRange.wordRange.end:""}))})),r.a.createElement("hr",null),t(),r.a.createElement("div",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.1)",padding:"5px"}},r.a.createElement("p",{style:{fontSize:"12px"}},"Create custom user compare"),r.a.createElement(v.a,{onSubmit:this.handleCustomUpdateRelatedExpressions,inline:"true"},r.a.createElement(Ie.a,{inline:"true",size:"sm",id:"text",type:"text",value:this.state.customExpressionId,placeholder:"expression id",className:"mr-sm-2",onChange:function(t){e.handleSetCustomExpressionId(t.target.value)}}),r.a.createElement(u.a,{inline:"true",size:"sm",type:"submit",style:{margin:"2px"}},"Submit"))),r.a.createElement("hr",null),r.a.createElement("div",null,r.a.createElement("p",null,"Other Comparison/Connection Visualizations"),r.a.createElement("p",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://lombardpress.org/collation-vizualizer/index.html?id="+this.props.info.resourceid},"Collation Overlay")),r.a.createElement("p",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://scta.github.io/networks-explorer/?resourceid="+this.props.info.resourceid},"View Reference Connections")),r.a.createElement("p",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://scta.github.io/networks-explorer/topicconnections.html?resourceid="+this.props.info.resourceid},"View Topic Connections"))),r.a.createElement("div",null,r.a.createElement(He,{info:this.props.info,handleChangeBase:this.handleChangeBase,baseText:this.state.baseText,surfaceWidth:this.props.surfaceWidth,resourceid:this.props.info.resourceid})))}}]),n}(r.a.Component);var ze=function(e){var t=Object(a.useState)(),n=Object(f.a)(t,2),s=n[0],i=n[1],l=Object(a.useState)(),p=Object(f.a)(l,2),u=p[0],h=p[1],d=Object(a.useState)(),m=Object(f.a)(d,2),v=m[0],g=m[1],E=Object(a.useState)(),y=Object(f.a)(E,2),x=y[0],b=y[1],w=Object(a.useState)(),C=Object(f.a)(w,2),S=C[0],k=C[1],R=Object(a.useState)([]),I=Object(f.a)(R,2),L=I[0],j=I[1],N=Object(a.useState)([]),P=Object(f.a)(N,2),F=P[0],A=P[1];Object(a.useEffect)((function(){var t;j([]),A([]),h(""),g(""),b(""),k(""),i(""),O(["SELECT ?author ?authorTitle ?wikidataid","{","BIND(<"+e.resourceid+"> AS ?author) .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","OPTIONAL {","?author <http://www.w3.org/2002/07/owl#sameAs> ?wikidataid .","FILTER(regex(str(?wikidataid), 'http://www.wikidata.org' ))","}","}","ORDER BY ?authorTitle"].join(" ")).then((function(e){var t=e.data.results.bindings;if(t.length>0){var n=t[0].authorTitle&&t[0].authorTitle.value,a=t[0].wikidataid&&t[0].wikidataid.value;i(n),a&&D(a)}})),O(["select ?personTitle ?author ?authorTitle (count(?ref) as ?count)","where {","?ref <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementName> .","?ref <http://scta.info/property/isInstanceOf> <"+(t=e.resourceid)+"> .","<"+t+"> <http://purl.org/dc/elements/1.1/title> ?personTitle .","?ref <http://scta.info/property/isPartOfTopLevelExpression> ?refTopLevel .","?refTopLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","GROUP BY ?author ?authorTitle ?personTitle"].join("")).then((function(e){var t=e.data.results.bindings;if(t.length>0&&"0"!==t[0].count.value){t.sort(M);var n=t.map((function(e){return r.a.createElement("p",{key:e.author.value},r.a.createElement(o.b,{to:"/text?resourceid="+e.author.value},e.authorTitle.value),":",e.count.value)}));j(n)}})),O(function(e){return["select ?author ?authorTitle (count(?ref) as ?count)","where {","?sourceTopLevel <http://www.loc.gov/loc.terms/relators/AUT> <"+e+"> .","?sourceTopLevel <http://scta.info/property/level> '1' .","?ref <http://scta.info/property/isPartOfTopLevelExpression> ?sourceTopLevel .","?ref <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementName> .","?ref <http://scta.info/property/isInstanceOf> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","GROUP BY ?author ?authorTitle"].join("")}(e.resourceid)).then((function(e){var t=e.data.results.bindings;if(t.length>0&&"0"!==t[0].count.value){t.sort(M);var n=t.map((function(e,t){return r.a.createElement("p",{key:t+"-"+e.author.value},r.a.createElement(o.b,{to:"/text?resourceid="+e.author.value},e.authorTitle.value),":",e.count.value)}));A(n)}}))}),[e.resourceid]);var M=function(e,t){var n=e.authorTitle.value.toUpperCase(),a=t.authorTitle.value.toUpperCase();return n<a?-1:n>a?1:0},D=function(e){var t=e.split("/entity/")[1];T.a.get("https://www.wikidata.org/w/api.php?origin=*&action=wbgetentities&ids="+t+"&format=json").then((function(e){var n=e.data.entities[t].claims.P18&&e.data.entities[t].claims.P18[0].mainsnak.datavalue.value,a=e.data.entities[t].descriptions.en&&e.data.entities[t].descriptions.en.value,r=e.data.entities[t].claims.P569&&e.data.entities[t].claims.P569[0].mainsnak.datavalue.value.time,s=e.data.entities[t].claims.P570&&e.data.entities[t].claims.P570[0].mainsnak.datavalue.value.time;T.a.get("https://commons.wikimedia.org/w/api.php?origin=*&action=query&prop=imageinfo&iiprop=url&redirects&format=json&titles=File:"+n).then((function(e){var t=e.data.query.pages,n=Object.keys(t)[0],i=e.data.query.pages[n].imageinfo&&e.data.query.pages[n].imageinfo[0].url;h(i),g(a),b(parseInt(r)),k(parseInt(s))}))}))};return r.a.createElement("div",{className:e.hidden?"hidden":"showing"},r.a.createElement(c.a,null,r.a.createElement("h1",null,"PersonInfo for ",s," ",x&&"("+x+"-"+S+")"),r.a.createElement("div",{style:{display:"flex",justifyContent:"left"}},u&&r.a.createElement("img",{alt:"author",src:u,width:"100px"}),r.a.createElement("p",{style:{marginLeft:"10px"}},v," ",v&&"(wikidata)")),r.a.createElement("div",null,r.a.createElement("h1",null,"Discussed/Mentioned By Frequency"),L),r.a.createElement("div",null,r.a.createElement("h1",null,"Discusses/Mentions Frequency"),F)))};var Ge=function(e){var t=Object(d.b)().t,n=Object(a.useState)(e.comment),s=Object(f.a)(n,2),i=s[0],o=s[1],l=Object(a.useState)(e.motivation||"commenting"),c=Object(f.a)(l,2),p=c[0],h=c[1],m=e.selectionRange&&e.selectionRange.text?e.selectionRange.text:"",g=Object(a.useState)(e.selectionRange&&e.selectionRange.textEdited?e.selectionRange.textEdited:m),T=Object(f.a)(g,2),E=T[0],y=T[1],x=Object(a.useState)(e.noTarget||!1),b=Object(f.a)(x,2),w=b[0],O=b[1],C=Object(a.useState)(e.orderNumber),S=Object(f.a)(C,2),k=S[0],R=S[1];Object(a.useEffect)((function(){var t=e.selectionRange&&e.selectionRange.text?e.selectionRange.text:"";y(e.selectionRange&&e.selectionRange.textEdited?e.selectionRange.textEdited:t)}),[e.selectionRange]),Object(a.useEffect)((function(){"commenting"===p&&y(e.selectionRange?e.selectionRange.text:"")}),[p]);var I=e.selectionRange&&e.selectionRange.wordRange?e.selectionRange.wordRange.start+"-"+e.selectionRange.wordRange.end:"";return r.a.createElement(v.a,{onSubmit:function(t){t.preventDefault();var n=p;e.submitComment(i,n,E,e.selectionRange,k,w),o("")}},"editing"===p&&r.a.createElement("div",null,r.a.createElement("span",null,"Suggest Edit for :",r.a.createElement("i",null,e.selectionRange.text," "),r.a.createElement("span",{className:"lbp-span-link",title:"leave simple comment on text",onClick:function(){h("commenting")}}," ",r.a.createElement(re.l,null)," "),r.a.createElement("span",null," (",I,") ")),r.a.createElement(Ie.a,{as:"textarea",type:"text",id:"editedText",rows:"3",value:E,placeholder:t("comment"),className:"mr-sm-2",onChange:function(e){y(e.target.value)}})),r.a.createElement("div",null,e.selectionRange&&e.selectionRange.text&&r.a.createElement("div",null,"editing"===p?r.a.createElement("span",null,"Leave comment on edit"):r.a.createElement("span",null,"Comment on:",r.a.createElement("i",null,e.selectionRange.text," "),r.a.createElement("span",{className:"lbp-span-link",title:"edit text",onClick:function(){h("editing")}}," ",r.a.createElement(re.o,null)," "),r.a.createElement("span",null," (",I,") "))),r.a.createElement(Ie.a,{as:"textarea",type:"text",id:"comment",rows:"3",value:i,placeholder:t("comment"),className:"mr-sm-2",onChange:function(e){o(e.target.value)}}),r.a.createElement("span",null,"Position: ",r.a.createElement(v.a.Text,{as:"input",inline:"true",type:"input",id:"orderNumber",value:k,className:"mr-sm-2",onChange:function(e){R(e.target.value)},style:{border:0,width:"25px",display:"inline"}})),r.a.createElement("span",null,"Has Target: ",r.a.createElement("input",{type:"checkbox",inline:"true",label:"has target",checked:!w,onChange:function(e){O(!w)},style:{display:"inline"}}))),r.a.createElement(u.a,{size:"sm",type:"submit",block:!0,style:{margin:"2px"}},t("Submit")))};var Ve=function(e){var t=Object(d.b)().t,n=Object(a.useState)(!1),s=Object(f.a)(n,2),i=s[0],l=s[1],c="string"===typeof e.comment.target?e.comment.target:e.comment.target.source,p=void 0,u=void 0;e.comment.target.selector&&(p=e.comment.target.selector.filter((function(e){return"TextQuoteSelector"===e.type}))[0].exact,c=(u=e.comment.target.selector.filter((function(e){return"TextPositionSelector"===e.type}))[0]).start?c+"@"+u.start+"-"+u.end:c);var h={text:p,textEdited:e.comment.body.editedValue,wordRange:u};return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("span",null,e.orderNumber),": ",t("For"),": ",r.a.createElement(o.b,{to:"/text?resourceid="+c},c)),i?r.a.createElement(Ge,{submitComment:function(t,n,a,r,s,i){e.updateComment(e.comment.id,t,a,n,r,s,i),l(!1)},comment:e.comment.body.value,selectionRange:h,motivation:e.comment.motivation,noTarget:!e.comment.target,orderNumber:e.orderNumber}):r.a.createElement("p",null,p&&r.a.createElement("span",null,"Comment on: ",r.a.createElement("i",null,p)),r.a.createElement("br",null),"editing"===e.comment.motivation&&r.a.createElement("span",null,"Suggested Correction: ",e.comment.body.editedValue,r.a.createElement("br",null)),r.a.createElement("span",null,function(e){var t=e.match(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gi);if(t){var n=[e.split(t[0])[0]];return t.forEach((function(a,s){var i=r.a.createElement(o.b,{key:a,to:"/res?resourceid="+a},a),l=r.a.createElement("span",{key:"s-"+a,className:"lbp-span-link",title:"Copy Resource Url Clipboard",onClick:function(e){e.preventDefault(),w(a)}},r.a.createElement(re.h,null));n.push(i),n.push(l);var c=e.split(a)[1].split(t[s+1])[0];n.push(c)})),n}return e}(e.comment.body.value)),r.a.createElement("br",null),r.a.createElement("span",null,"Submitted: ")," ",e.comment.created&&e.comment.created.split("T")[0]," |",r.a.createElement("span",{className:"lbp-span-link",onClick:function(){e.removeComment(e.comment.id)}},r.a.createElement(re.I,null)," ")," |",r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return l(!0)}}," ",r.a.createElement(re.o,null))),r.a.createElement("hr",null))},Qe=function(e){var t=Object(a.useState)(""),n=Object(f.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(""),l=Object(f.a)(o,2),c=l[0],p=l[1],u=Object(a.useState)(!1),h=Object(f.a)(u,2),d=h[0],m=h[1];return r.a.createElement("div",null,r.a.createElement("span",{className:"lbp-span-link",onClick:function(){return m(!d)}},"Import ",r.a.createElement(re.J,null)),d&&r.a.createElement("div",null,r.a.createElement("span",{className:"lbp-span-link"},r.a.createElement(re.J,null)," Load from local file"),r.a.createElement("br",null),r.a.createElement("input",{type:"file",id:"files",name:"files[]",onChange:function(t){var n=new FileReader;n.readAsText(t.target.files[0]);var a=t.target.files[0].name;n.onload=function(t){var r=n.result;e.handleImportList(JSON.parse(r),a)}}}),r.a.createElement("br",null),r.a.createElement("span",{className:"lbp-span-link"},r.a.createElement(re.j,null)," Load from Cloud"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),T.a.get(c).then((function(t){console.log("data",t),e.handleImportList(t.data,c)}))}},r.a.createElement("input",{type:"text",value:c,onChange:function(e){p(e.target.value)}}),r.a.createElement("input",{type:"submit"})),r.a.createElement("span",{className:"lbp-span-link"},r.a.createElement(re.y,null)," Create New List"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.handleImportList([],s),i("")}},r.a.createElement("input",{type:"text",value:s,onChange:function(e){i(e.target.value)}}),r.a.createElement("input",{type:"submit"}))),r.a.createElement("br",null),r.a.createElement("a",{href:function(){var t=JSON.stringify(e.currentList,null,2);return"data:application/json;charset=utf-8,"+encodeURI(t)}(),download:e.currentListName.split(".json")[0]+"-"+(new Date).toISOString().slice(0,10)},r.a.createElement("span",{className:"lbp-span-link"},"Export ",r.a.createElement(re.n,null))))};var Ye=function(e){var t=Object(d.b)().t,n=Object(a.useState)(JSON.parse(localStorage.getItem("sctaCommentsState2"))||{local:[]}),s=Object(f.a)(n,2),i=s[0],l=s[1],p=Object(a.useState)("local"),h=Object(f.a)(p,2),m=h[0],v=h[1],g=Object(a.useState)(!0),T=Object(f.a)(g,2),E=T[0],y=T[1],x=Object(a.useState)(""),b=Object(f.a)(x,2),O=b[0],C=b[1],S=Object(a.useState)([]),k=Object(f.a)(S,2),R=k[0],I=k[1],L=Object(a.useState)(!1),j=Object(f.a)(L,2),N=j[0],P=j[1],F=function(e){var t=i[m].filter((function(t){return t.id!==e}));i[m]=t,l(Object(ne.a)({},i))},A=function(e,t,n,a,r,s,o){var c=i[m].filter((function(t){return t.id===e}))[0];c.body.value=t,c.body.editedValue=n,c.motivation=a,c.orderNumber=s,c.target=!o&&c.target;var p=i[m].indexOf(c);if(s>=i[m].length)for(var u=s-i[m].length+1;u--;)i[m].push(void 0);i[m].splice(s,0,i[m].splice(p,1)[0]),l(Object(ne.a)({},i))};Object(a.useEffect)((function(){I(M())}),[e.resourceid]);var M=function(){if(i[m].length>0){var t=i[m].map((function(t){return t.body.value&&t.body.value.includes(e.resourceid)?"string"===typeof t.target?t.target:t.target.source:void 0}));return t=t.filter((function(e){return void 0!==e}))}return[]};return Object(a.useEffect)((function(){localStorage.setItem("sctaCommentsState2",JSON.stringify(i))})),r.a.createElement(c.a,{className:e.hidden?"hidden":"showing"},r.a.createElement(Ge,{submitComment:function(t,n,a,r,s,o){var c="http://inbox.scta.info/notifications/"+ge()(),p=new Date,u=[{type:"TextQuoteSelector",exact:r&&r.text},{type:"TextPositionSelector",start:r&&r.wordRange&&r.wordRange.start,end:r&&r.wordRange&&r.wordRange.end}],h={"@context":"http://www.w3.org/ns/anno.jsonld",id:c,type:"Annotation",created:p.toISOString(),motivation:n,body:{type:"TextualBody",value:t},target:!o&&{source:e.resourceid,selector:u}};"editing"===n?h.body.editedValue=a:delete h.body.editedValue,i[m].splice(s,0,h),l(Object(ne.a)({},i)),C("")},selectionRange:e.selectionRange,textEdit:e.textEdit,orderNumber:i[m].length}),r.a.createElement(u.a,{size:"sm",style:{margin:"2px"},block:!0,onClick:function(){return P(!N)}},r.a.createElement(re.t,null)," Filters"),N&&r.a.createElement("div",null,r.a.createElement("span",null,"Select Annotation List"),r.a.createElement(Ie.a,{size:"sm",as:"select",onChange:function(e){v(e.target.value)},value:m},i&&Object.keys(i).map((function(e,t){return r.a.createElement("option",{key:e,value:e},e)}))),r.a.createElement(Ie.a,{size:"sm",style:{margin:"10px 0"},type:"text",value:O,placeholder:t("filter comments by text"),className:"mr-sm-2",onChange:function(e){C(e.target.value)}}),r.a.createElement(u.a,{id:"btnAllCommentsToggle",size:"sm",style:{margin:"2px"},block:!0,onClick:function(){return y(!E)}},t(E?"Show All Comments":"Show Comments For Focused Passage"))),r.a.createElement("hr",null),R.length>0&&r.a.createElement("div",null,r.a.createElement("span",null,"Discussed By:"),R.map((function(e){return r.a.createElement("div",null,r.a.createElement(o.b,{key:e,to:"/res?resourceid="+e},e),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Resource Url Clipboard",onClick:function(t){t.preventDefault(),w(e)}},r.a.createElement(re.h,null)))})),r.a.createElement("hr",null)),r.a.createElement("div",null,i[m].length>0&&i[m].slice(0).map((function(t,n){var a="string"===typeof t.target?t.target:t.target.source;return E?a&&a.includes(e.expressionid)&&t.body.value&&t.body.value.includes(O)?r.a.createElement("div",{key:n},r.a.createElement(Ve,{comment:t,focused:!0,removeComment:F,updateComment:A,handleOnClickComment:e.handleOnClickComment,orderNumber:i[m].indexOf(t)})):null:a&&a.includes(e.expressionid)&&t.body.value&&t.body.value.includes(O)?r.a.createElement("div",{key:n,style:{borderLeft:"1px solid black"}},r.a.createElement(Ve,{comment:t,removeComment:F,updateComment:A,orderNumber:i[m].indexOf(t)})):t.body.value&&t.body.value.includes(O)?r.a.createElement("div",{key:n},r.a.createElement(Ve,{comment:t,removeComment:F,updateComment:A,orderNumber:i[m].indexOf(t)})):null}))),r.a.createElement(Qe,{currentList:i[m],currentListName:m,handleImportList:function(e,t){try{var n=e,a=t||ge()();i[a]=n,l(Object(ne.a)({},i))}catch(r){console.log("error",r)}}}))},Xe=n(4),Je=n.n(Xe),Ze=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).mounted="",a.state={eurl:"",etitle:"",murl:"",mtitle:"",turl:"",fetching:!1},a}return Object(X.a)(n,[{key:"retrieveCitation",value:function(e){var t,n=this;e&&(this.setState({fetching:!0}),O(["SELECT DISTINCT ?manifestation ?manifestationTitle ?manifestationSurface ?surfaceTitle ?codexTitle ?datasource ?eLongTitle ?author ?authorTitle ?expression ?editor ?editorTitle","{","<"+(t=e)+"> <http://scta.info/property/isTranscriptionOf> ?manifestation .","<"+t+"> <http://scta.info/property/hasXML> ?datasource . ","?manifestation <http://purl.org/dc/elements/1.1/title> ?manifestationTitle .","{","?manifestation <http://scta.info/property/isPartOfTopLevelManifestation> ?topLevelManifestation .","}","UNION","{","?manifestation <http://scta.info/property/level> '1' .","BIND (?manifestation AS ?topLevelManifestation) .","}","OPTIONAL {","?topLevelManifestation <http://scta.info/property/editor> ?editor .","?editor <http://purl.org/dc/elements/1.1/title> ?editorTitle .","}","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","{","?expression <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .","}","UNION","{","?expression <http://scta.info/property/level> '1' .","BIND (?expression AS ?topLevelExpression) .","}","OPTIONAL {","?expression <http://scta.info/property/longTitle> ?eLongTitle","}","OPTIONAL {","?topLevelExpression <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL","{","{","?manifestation <http://scta.info/property/isOnZone> ?bn . ","?bn <http://scta.info/property/isOnZone> ?zone .","?zone <http://scta.info/property/isPartOfSurface> ?manifestationSurface .","}","UNION","{","?manifestation <http://scta.info/property/hasStructureBlock> ?block .","?block <http://scta.info/property/isOnSurface> ?manifestationSurface .","}","UNION","{","?manifestation <http://scta.info/property/hasStructureItem> ?item .","?item <http://scta.info/property/isOnSurface> ?manifestationSurface .","}","?manifestationSurface <http://purl.org/dc/elements/1.1/title> ?surfaceTitle .","?manifestationSurface <http://scta.info/property/order> ?surface_order .","?codex <http://scta.info/property/hasSurface> ?manifestationSurface .","?codex <http://purl.org/dc/elements/1.1/title> ?codexTitle .","}","}","ORDER BY ?surface_order"].join("")).then((function(t){var a=t.data.results.bindings;if(a.length>0){var r=a[0],s=r.expression?r.expression.value:"",i=r.manifestation?r.manifestation.value:"",o=r.eLongTitle?r.eLongTitle.value:"",l=r.authorTitle?r.authorTitle.value:"",c=r.author?r.author.value:"",p=r.editorTitle?r.editorTitle.value:"",u=r.editor?r.editor.value:"",h=r.datasource?r.datasource.value:"",d=r.codexTitle?r.codexTitle.value:"",m=r.surfaceTitle?r.surfaceTitle.value:"",f=a[a.length-1].surfaceTitle?a[a.length-1].surfaceTitle.value:"";n.mounted&&n.setState({author:c,authorTitle:l,editor:u,editorTitle:p,eurl:s,etitle:o,murl:i,mtitle:m!==f?d+", "+m+"-"+f:d+", "+m,turl:e,datasource:h,fetching:!1})}})))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.retrieveCitation(this.props.tresourceid)}},{key:"componentDidUpdate",value:function(e){this.props.tresourceid!==e.tresourceid&&this.retrieveCitation(this.props.tresourceid)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=this.state.authorTitle+", "+this.state.etitle+"("+this.state.mtitle+") Data source: "+this.state.datasource+".",n=this.props.selectionRange&&this.props.selectionRange.wordRange&&this.props.selectionRange.wordRange.start+"-"+this.props.selectionRange.wordRange.end;return r.a.createElement(c.a,null,r.a.createElement("h4",null,"Citation"),this.state.fetching?r.a.createElement(P,null):r.a.createElement("div",null,r.a.createElement("p",{className:"etitle"},this.state.authorTitle,", ",this.state.etitle," ",n&&n&&"@ "+n," (",r.a.createElement("a",{href:this.state.eurl,target:"_blank",rel:"noopener noreferrer"},this.state.eurl,n&&"@"+n)," ",r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),w(n?e.state.eurl+"@"+n:e.state.eurl)}},r.a.createElement(re.h,null)),")"),r.a.createElement("p",{className:"mtitle"},this.state.editor&&r.a.createElement("span",null,"Ed. ",this.state.editorTitle,", "),this.state.mtitle&&this.state.mtitle+" ","(",r.a.createElement("a",{href:this.state.murl,target:"_blank",rel:"noopener noreferrer"},this.state.murl,n&&"@"+n),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),w(n?e.state.murl+"@"+n:e.state.murl)}},r.a.createElement(re.h,null)),")"),r.a.createElement("p",{className:"ttitle"},r.a.createElement("span",null,"Transcription Resource: "),r.a.createElement("a",{href:this.state.turl,target:"_blank",rel:"noopener noreferrer"},this.state.turl,n&&"@"+n),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),w(n?e.state.turl+"@"+n:e.state.turl)}},r.a.createElement(re.h,null)),r.a.createElement("br",null),r.a.createElement("span",null,"Data source: "),r.a.createElement("a",{href:this.state.datasource,target:"_blank",rel:"noopener noreferrer"}," ",this.state.datasource),r.a.createElement("span",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(t){t.preventDefault(),w(e.state.datasource)}},r.a.createElement(re.h,null))),r.a.createElement("p",{className:"lbp-span-link",title:"Copy Citation to Clipboard",onClick:function(e){e.preventDefault(),w(t)}},r.a.createElement(re.h,null)," Copy Full Citation to Clipboard")))}}]),n}(r.a.Component),Ke=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).toggleCitationExplanation=a.toggleCitationExplanation.bind(Object(J.a)(a)),a.state={showCitationExplanation:!1},a}return Object(X.a)(n,[{key:"toggleCitationExplanation",value:function(){this.setState((function(e){return{showCitationExplanation:!e.showCitationExplanation}}))}},{key:"render",value:function(){return r.a.createElement(c.a,{className:"CitationExplanation"},r.a.createElement("p",{onClick:this.toggleCitationExplanation},this.state.showCitationExplanation?r.a.createElement("span",null,r.a.createElement(re.f,null),"Hide Explanation of Citation Practices"):r.a.createElement("span",null,r.a.createElement(re.g,null),"View Explanation of Citation Practices")," "),this.state.showCitationExplanation&&r.a.createElement("div",null,r.a.createElement("p",null,"The citation of a text that has survived through a historical succession of manifestations is a complicated endeavor. Today, when transcriptions of these manifestations can be published as data, separate from any presentation, and thereby can be presented in a variety of ways, a full citation inevitably becomes even more complex. In order to identify the content hierarchy of the text, the specifical material or born digital manifestation of that text, and the data sources used to represent and display that manifestation, specificity and precision are needed."),r.a.createElement("p",null,"Full citations therefore identify three aspects of the text currently being viewed."),r.a.createElement("p",{className:"etitle"},"First (blue) it identifies the idea of the paragraph in question situated within the conceptual hierarchy of the text."),r.a.createElement("p",{className:"mtitle"},"Second (red) it identifies the manifestation of the text in a historical or born digital edition."),r.a.createElement("p",{className:"ttitle"},"Third (purple) it identifies the transcription and transcription data source used to power the current text presentation.")))}}]),n}(r.a.Component),$e=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).toggleAlternativeManifestations=a.toggleAlternativeManifestations.bind(Object(J.a)(a)),a.state={showAlternativeManifestations:!0},a}return Object(X.a)(n,[{key:"toggleAlternativeManifestations",value:function(){this.setState((function(e){return{showAlternativeManifestations:!e.showAlternativeManifestations}}))}},{key:"render",value:function(){var e=this,t=this.props.selectionRange&&this.props.selectionRange.wordRange&&this.props.selectionRange.wordRange.start+"-"+this.props.selectionRange.wordRange.end;return r.a.createElement(c.a,{className:"ManifestationList"},this.props.optionalDisplay?r.a.createElement("h4",{onClick:this.toggleAlternativeManifestations},this.state.showAlternativeManifestations?r.a.createElement("span",null,r.a.createElement(re.f,null),"Hide Alternative Manifestations"):r.a.createElement("span",null,r.a.createElement(re.g,null),"View Alternative Manifestations")," "):r.a.createElement("h4",null,"Available Manifestations"),this.state.showAlternativeManifestations&&function(){if(e.props.manifestations)return e.props.manifestations.map((function(n){return e.props.tresourceid.includes(n.manifestation)?r.a.createElement("p",{key:n.manifestation},n.manifestationTitle,t&&"@"+t," (Currrent Focus)"):r.a.createElement("p",{key:n.manifestation},r.a.createElement(o.b,{to:t?"/text?resourceid="+n.manifestation+"@"+t:"/text?resourceid="+n.manifestation},n.manifestationTitle,t&&"@"+t))}))}())}}]),n}(r.a.Component);Ze.propTypes={tresourceid:Je.a.string.isRequired,manifestations:Je.a.array,hidden:Je.a.bool,handleFocusChange:Je.a.func};var et=function(e){return r.a.createElement(c.a,{className:e.hidden?"CitationWrapper hidden":"CitationWrapper showing"},r.a.createElement(Ze,{tresourceid:e.tresourceid,selectionRange:e.selectionRange}),r.a.createElement(Ke,null),r.a.createElement("hr",null),r.a.createElement($e,{tresourceid:e.tresourceid,manifestations:e.manifestations,selectionRange:e.selectionRange}))};var tt=function(e){var t=Object(a.useState)([]),n=Object(f.a)(t,2),s=n[0],i=n[1];return Object(a.useEffect)((function(){var t,n;t=e.resourceid,O("surface"===(n=e.codexResourceType)?pe(t):"canvas"===n?ue(t):"manifest"===n?ce(t):le(t)).then((function(e){console.log("id",t,"type",n,"data",e);var a=e.data.results.bindings;if(a.length>0&&a[0].surface){var r=a.map((function(e){return e.expression?e.expression.value:""})).filter((function(e,t,n){return n.indexOf(e)===t})),s={};r.forEach((function(e){s[e]=[]})),a.forEach((function(e){var t={expression:e.expression.value,expressionTitle:e.item_expression_title.value,manifestation:e.manifestation.value,surface:e.surface.value,surfaceTitle:e.surface_title.value,questionTitle:e.item_expression_question_title?e.item_expression_question_title.value:""};s[e.expression.value].push(t)})),i(s)}}))}),[e.resourceid]),r.a.createElement("div",{className:e.hidden?"hidden":"showing"},function(){var e=Object.keys(s).map((function(e){return r.a.createElement("p",{key:s[e][0].expression},r.a.createElement("span",null,r.a.createElement(o.b,{to:"/text?resourceid="+s[e][0].surface},s[e][0].surfaceTitle),"-",r.a.createElement(o.b,{to:"/text?resourceid="+s[e][s[e].length-1].surface},s[e][s[e].length-1].surfaceTitle)),": ",r.a.createElement(o.b,{to:"/text?resourceid="+s[e][0].manifestation},s[e][0].expressionTitle),": ",s[e][0].questionTitle&&s[e][0].questionTitle)}));return e}())},nt=n(106),at=n.n(nt);var rt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleShowTokenPosition=a.handleToggleShowTokenPosition.bind(Object(J.a)(a)),a.mounted=!1,a.state={tresourceid:"",longTitle:null,showTokenPosition:!1},a}return Object(X.a)(n,[{key:"handleToggleShowTokenPosition",value:function(){this.setState((function(e){return{showTokenPosition:!e.showTokenPosition}}))}},{key:"getTranscriptionId",value:function(e){var t,n=this;O(["SELECT DISTINCT ?ctranscription ?longTitle ","WHERE { ","{","<"+(t=e)+"> <http://scta.info/property/hasCanonicalManifestation> ?manifestation .","?manifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .","}","UNION","{","BIND(<"+t+"> AS ?ctranscription ) . ","?ctranscription a <http://scta.info/resource/transcription> .","}","UNION","{","<"+t+"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .","}","?ctranscription <http://scta.info/property/isTranscriptionOf> ?m .","?m <http://scta.info/property/isManifestationOf> ?e .","?e <http://scta.info/property/longTitle> ?longTitle .","}"].join(" ")).then((function(e){n.mounted&&n.setState({tresourceid:e.data.results.bindings[0].ctranscription.value,longTitle:e.data.results.bindings[0].longTitle.value})})).catch((function(e){n.setState({tresourceid:""})}))}},{key:"componentDidMount",value:function(){this.mounted=!0,this.getTranscriptionId(this.props.textPreviewResourceId)}},{key:"componentDidUpdate",value:function(e){e.textPreviewResourceId!==this.props.textPreviewResourceId&&this.getTranscriptionId(this.props.textPreviewResourceId)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=this.props.textPreviewStart&&this.props.textPreviewEnd?this.state.tresourceid+"@"+this.props.textPreviewStart+"-"+this.props.textPreviewEnd:this.state.tresourceid,n=this.props.referringSelectionRange&&this.props.referringSelectionRange.wordRange&&this.props.referringSelectionRange.wordRange.start+"-"+this.props.referringSelectionRange.wordRange.end;return r.a.createElement(c.a,{className:this.props.hidden?"hidden":"showing"},r.a.createElement("p",null,"Go to: ",r.a.createElement(o.b,{onClick:function(){e.props.handleTextPreviewFocusChange([{id:e.props.referringResource,range:n}])},to:"/text?resourceid="+t},this.state.longTitle)),this.state.tresourceid&&r.a.createElement("div",null,r.a.createElement(at.a,{tresourceid:this.state.tresourceid,start:parseInt(this.props.textPreviewStart),stop:parseInt(this.props.textPreviewEnd),context:!0,showTokenPosition:this.state.showTokenPosition}),r.a.createElement("span",{className:"lbp-span-link",alt:"show word token position",onClick:this.handleToggleShowTokenPosition},this.state.showTokenPosition?r.a.createElement(re.H,null):r.a.createElement(re.G,null))))}}]),n}(r.a.Component);var st=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleRelatedDiscussion=a.handleToggleRelatedDiscussion.bind(Object(J.a)(a)),a.handleSurface3Manifestations=a.handleSurface3Manifestations.bind(Object(J.a)(a)),a.handleToggleShowQuery=a.handleToggleShowQuery.bind(Object(J.a)(a)),a.handleToggleShowImages=a.handleToggleShowImages.bind(Object(J.a)(a)),a.state={expressions:[],surfaceMap:{},showTextRegion:!1,showQuery:!1,query:""},a}return Object(X.a)(n,[{key:"handleToggleShowQuery",value:function(){this.setState((function(e){return{showQuery:!e.showQuery}}))}},{key:"handleSurface3Manifestations",value:function(e,t){console.log("test",e,t);var n="";"object"===typeof e?n=e.map((function(e){return{manifestation:e,manifestationTitle:e.split("/resource/")[1],transcription:""}})):e&&(n=[{manifestation:e,manifestationTitle:e.split("/resource/")[1],transcription:""}]);var a=this.props.surfaceid.split("/resource/")[1].split("/")[0],r=n?n.filter((function(e){return e.manifestation.includes(a)}))[0].manifestation:"";return{surface3Manifestations:n,surface3FocusedManifestation:r}}},{key:"handleToggleRelatedDiscussion",value:function(e){this.setState((function(t){var n=t.expressions.find((function(t){return t.expressionid===e}));return n.showComments=!n.showComments,{expressions:Object(F.a)(t.expressions)}}))}},{key:"handleToggleRelatedSurfaces",value:function(e){this.setState((function(t){var n=t.expressions.find((function(t){return t.expressionid===e}));return n.showRelatedSurfaces=!n.showRelatedSurfaces,{expressions:Object(F.a)(t.expressions)}}))}},{key:"handleToggleShowImages",value:function(e){this.setState((function(t){var n=t.expressions.find((function(t){return t.expressionid===e}));return n.showImages=!n.showImages,{expressions:Object(F.a)(t.expressions)}}))}},{key:"retrieveSurfaceInfo",value:function(e){var t=this,n=function(e){return["CONSTRUCT","{","?expression <http://scta.info/property/hasManifestation> ?manifestation2 .","?manifestation2 <http://scta.info/property/isOnSurface> ?surface2 .","}","WHERE","{","?manifestation <http://scta.info/property/isOnSurface> <"+e+"> .","?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureBlock> .","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://scta.info/property/totalOrderNumber> ?order .","?expression <http://scta.info/property/hasManifestation> ?manifestation2 .","?manifestation2 <http://scta.info/property/isOnSurface> ?surface2 .","?codex <http://scta.info/property/hasSurface> ?surface2 .","}"].join("")}(e);O(n).then((function(e){if(e.data["@graph"]){var a=e.data["@graph"],r=[];a.forEach((function(e){if(console.log("e",e),!e.hasManifestation)return null;var n=t.handleSurface3Manifestations(e.hasManifestation,e["@id"]);console.log("test",n),r.push({expressionid:e["@id"],manifestations:e.hasManifestation,surface3Manifestations:n,showComments:!1,showRelatedSurfaces:!1,showImages:!1})}));var s={};a.forEach((function(e){e.isOnSurface&&(s[e["@id"]]=e.isOnSurface)})),console.log("expressions",r),t.setState({expressions:r,surfaceMap:s,query:n})}}))}},{key:"componentDidMount",value:function(){this.retrieveSurfaceInfo(this.props.surfaceid)}},{key:"componentDidUpdate",value:function(e){this.props.surfaceid!==e.surfaceid&&this.retrieveSurfaceInfo(this.props.surfaceid)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.hidden?"hidden":"showing"},r.a.createElement("h1",null,"Page Info"),r.a.createElement("div",{style:{fontSize:"16px"}},r.a.createElement("h1",null,"Text objects on this page ",r.a.createElement(u.a,{size:"sm",className:"lbp-span-link",onClick:this.handleToggleShowQuery},this.state.showQuery?"Hide Proof":"Prove It!")),this.state.showQuery&&r.a.createElement("p",null,this.state.query),e.state.expressions.length>0?e.state.expressions.map((function(t){var n="";return n="object"===typeof t.hasManifestation?t.hasManifestation.map((function(t){return r.a.createElement("div",{key:t},r.a.createElement("span",null,t," ",r.a.createElement(o.b,{to:"/text?resourceid="+t},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("span",{style:{textIndent:"10px"}},"...Appearing on Surface ",e.state.surfaceMap[t]," ",r.a.createElement(o.b,{to:"/text?resourceid="+e.state.surfaceMap[t]},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("br",null))})):t.hasManifestation?r.a.createElement("div",{key:t.hasManifestation},r.a.createElement("span",null,t.hasManifestation," ",r.a.createElement(o.b,{to:"/text?resourceid="+t.hasManifestation},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("span",{style:{textIndent:"10px"}},"...Appearing on Surface ",e.state.surfaceMap[t.hasManifestation]," ",r.a.createElement(o.b,{to:"/text?resourceid="+e.state.surfaceMap[t.hasManifestation]},r.a.createElement(re.p,null))),r.a.createElement("br",null),r.a.createElement("br",null)):[],r.a.createElement("div",{key:t.expressionid},r.a.createElement("hr",null),r.a.createElement("p",null,t.expressionid," ",r.a.createElement(o.b,{to:"/text?resourceid="+t.expressionid},r.a.createElement(re.p,null))),r.a.createElement(u.a,{variant:"outline-primary",size:"sm",block:!0,onClick:function(){return e.handleToggleShowImages(t.expressionid)}},t.showImages?"Hide Images":"Show Images"),r.a.createElement("br",null),t.showImages&&t.surface3Manifestations&&t.surface3Manifestations.surface3Manifestations.length>0&&r.a.createElement(je,{key:t.expressionid,manifestations:t.surface3Manifestations.surface3Manifestations,focusedManifestation:t.surface3Manifestations.surface3FocusedManifestation,annotationsDisplay:"paragraph",width:"501",hidden:!1}),t.showRelatedSurfaces?r.a.createElement("div",null,r.a.createElement(u.a,{variant:"outline-primary",size:"sm",block:!0,onClick:function(){e.handleToggleRelatedSurfaces(t.expressionid)}},"Hide Related Codices"),r.a.createElement("br",null),n):r.a.createElement("div",null,r.a.createElement(u.a,{variant:"outline-primary",size:"sm",block:!0,onClick:function(){e.handleToggleRelatedSurfaces(t.expressionid)}},"Show Related Codices"),r.a.createElement("br",null)))})):null))}}]),n}(r.a.Component);var it=function(e){return r.a.createElement("div",{className:e.hidden?"hidden":"showing"},r.a.createElement("h1",null,"WorkGroupInfo"))};var ot=function(e){var t=Object(a.useState)("logeion"),n=Object(f.a)(t,1)[0];return r.a.createElement("div",{className:e.hidden?"hidden dict-container":"showing dict-container"},e.text&&1===e.text.split(" ").length&&r.a.createElement("div",{className:"dict-container2"},"logeion"===n?r.a.createElement("iframe",{className:"dict-iframe",title:"logeion",src:"https://logeion.uchicago.edu/"+e.text}):r.a.createElement("iframe",{className:"dict-iframe",title:"whitakerswords",src:"http://archives.nd.edu/cgi-bin/wordz.pl?keyword="+e.text})))};function lt(e){var t=[];switch(e){case"collection":t.push("textCitation"),t.push("textCompare"),t.push("comments"),t.push("search");break;case"workGroup":t.push("workGroupInfo"),t.push("comments"),t.push("search");break;case"person":t.push("personInfo"),t.push("comments"),t.push("search");break;case"codex":t.push("codex"),t.push("codexToc"),t.push("comments"),t.push("search");break;case"expressionType":t.push("comments"),t.push("search");break;case"text":t.push("textCitation"),t.push("textCompare"),t.push("comments"),t.push("search"),t.push("xml"),t.push("surface3"),t.push("textOutlineWrapper")}return t}var ct=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleToggleTextLinesView=a.handleToggleTextLinesView.bind(Object(J.a)(a)),a.handleChangeManifestation=a.handleChangeManifestation.bind(Object(J.a)(a)),a.state={windowLoad:"",mountStatus:{textCompare:!1,surface3:!1,comments:!1,xml:!1,search:!1,textOutline:!1,citation:!1}},a}return Object(X.a)(n,[{key:"handleToggleTextLinesView",value:function(e){this.props.handleToggleTextLinesView(this.props.windowId,e)}},{key:"handleChangeManifestation",value:function(e){var t=e.split("/resource/")[1].split("/")[1];this.props.handleChangeManifestation(this.props.windowId,t)}},{key:"componentDidMount",value:function(){this.setState({windowLoad:this.props.windowLoad})}},{key:"componentDidUpdate",value:function(e){var t={};if(this.props.resourceid!==e.resourceid)(t={textCompare:!1,surface3:!1,comments:!1,xml:!1,search:!1,textOutline:!1,citation:!1})[this.props.windowLoad]=!0,this.setState({windowLoad:this.props.windowLoad,mountStatus:t});else if(this.props.windowLoad!==e.windowLoad){var n=this.state.mountStatus;n[this.props.windowLoad]=!0,t=n,this.setState({windowLoad:this.props.windowLoad,mountStatus:t})}else t=this.state.mountStatus}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.windowType+" "+this.props.windowType+this.props.openWidthHeight},r.a.createElement(Me,{handleTabChange:this.props.handleTabChange,handleClose:this.props.handleClose,handleMinimize:this.props.handleMinimize,handleMaximize:this.props.handleMaximize,handleMiddlize:this.props.handleMiddlize,windowType:this.props.windowType,openWidthHeight:this.props.openWidthHeight,windowId:this.props.windowId,windowLoad:this.props.windowLoad,focus:this.props.resourceid,handleSwitchWindow:this.props.handleSwitchWindow,handleDuplicateWindow:this.props.handleDuplicateWindow,altWindowState:this.props.altWindowState,focusSet:!!this.props.info,availableTabs:function(){var t=lt(e.props.resourceType);return[{name:"citation",desc:"Text Citation",show:t.includes("textCitation")||t.includes("textCitation")||t.includes("personInfo")||t.includes("codexToc")||t.includes("workGroupInfo"),icon:r.a.createElement(re.v,null)},{name:"surface3",desc:"Images",show:t.includes("surface3"),icon:r.a.createElement(re.z,null)},{name:"xml",desc:"Text XML Source",show:t.includes("xml"),icon:r.a.createElement(re.k,null)},{name:"textCompare",desc:"Text Comparisons",show:t.includes("textCompare")||t.includes("codex"),icon:r.a.createElement(re.u,null)},{name:"comments",desc:"Comments",show:t.includes("comments"),icon:r.a.createElement(re.m,null)},{name:"textOutlineWrapper",desc:"Text Outline",show:t.includes("textOutlineWrapper"),icon:r.a.createElement(re.a,null)},{name:"search",desc:"Text Search",show:t.includes("search"),icon:r.a.createElement(re.E,null)}]}()}),"surface2"!==this.state.windowLoad&&"dictionary"!==this.state.windowLoad&&r.a.createElement(De,{info:this.props.info,handleBlockFocusChange:this.props.handleBlockFocusChange,selectionRange:this.props.selectionRange}),function(){var t=lt(e.props.resourceType);return r.a.createElement("div",null,t.includes("textCompare")&&("textCompare"===e.state.windowLoad||e.state.mountStatus.textCompare)&&r.a.createElement(qe,{info:e.props.info,surfaceWidth:"bottomWindow"===e.props.windowType?"1000":"501",hidden:"textCompare"!==e.state.windowLoad,selectionRange:e.props.selectionRange}),t.includes("textCitation")&&("citation"===e.state.windowLoad||e.state.mountStatus.citation)&&r.a.createElement(et,{tresourceid:e.props.info.resourceid+e.props.mtFocus,manifestations:e.props.info.manifestations,handleFocusChange:e.props.handleFocusChange,hidden:"citation"!==e.state.windowLoad,selectionRange:e.props.selectionRange}),t.includes("personInfo")&&("citation"===e.state.windowLoad||e.state.mountStatus.citation)&&r.a.createElement(ze,{resourceid:e.props.resourceid,hidden:"citation"!==e.state.windowLoad}),t.includes("workGroupInfo")&&("citation"===e.state.windowLoad||e.state.mountStatus.citation)&&r.a.createElement(it,{resourceid:e.props.resourceid,hidden:"citation"!==e.state.windowLoad}),t.includes("codex")&&("textCompare"===e.state.windowLoad||e.state.mountStatus.textCompare)&&r.a.createElement(st,{surfaceid:e.props.surfaceid,resourceid:e.props.resourceid,codexResourceType:e.props.codexResourceType,hidden:"textCompare"!==e.state.windowLoad}),t.includes("surface3")&&("surface3"===e.state.windowLoad||e.state.mountStatus.surface3)&&r.a.createElement(je,{manifestations:e.props.info.manifestations,focusedManifestation:e.props.defaultManifestationSlug?e.props.resourceid+"/"+e.props.defaultManifestationSlug:e.props.resourceid+"/"+e.props.mtFocus.split("/")[1],annotationsDisplay:e.props.annotationsDisplay,handleToggleTextLinesView:e.handleToggleTextLinesView,handleChangeManifestation:e.handleChangeManifestation,width:"bottomWindow"===e.props.windowType?"1000":"501",lineFocusId:e.props.lineFocusId,hidden:"surface3"!==e.state.windowLoad}),t.includes("comments")&&("comments"===e.state.windowLoad||e.state.mountStatus.comments)&&r.a.createElement(Ye,{resourceid:e.props.resourceid+e.props.mtFocus,expressionid:e.props.resourceid,hidden:"comments"!==e.state.windowLoad,selectionRange:e.props.selectionRange}),t.includes("xml")&&("xml"===e.state.windowLoad||e.state.mountStatus.xml)&&r.a.createElement(Fe,{tresourceid:e.props.info?e.props.info.resourceid+e.props.mtFocus:e.props.itemFocus.expression+e.props.mtFocus,hidden:"xml"!==e.state.windowLoad}),t.includes("textOutlineWrapper")&&r.a.createElement(de,{focusResourceid:e.props.info?e.props.info.resourceid:e.props.itemFocus.expression,resourceid:e.props.info.topLevel,title:e.props.info.topLevel,hidden:"textOutlineWrapper"!==e.state.windowLoad,mtFocus:e.props.mtFocus,collectionLink:!0}),t.includes("codexToc")&&r.a.createElement(tt,{resourceid:e.props.resourceid,codexResourceType:e.props.codexResourceType,hidden:"citation"!==e.state.windowLoad}),t.includes("search")&&r.a.createElement(Q,{hidden:"search"!==e.state.windowLoad,searchEid:e.props.info?e.props.info.topLevel:"collection"===e.props.resourceType&&e.props.resourceid,searchAuthor:e.props.info?e.props.info.author:"person"===e.props.resourceType&&e.props.resourceid,searchEType:"expressionType"===e.props.resourceType&&e.props.resourceid,searchWorkGroup:"workGroup"===e.props.resourceType&&e.props.resourceid,searchType:"text",showSubmit:!0,showAdvancedParameters:!0,showLabels:!1,searchTerm:e.props.selectionRange&&e.props.selectionRange.text?'"'+e.props.selectionRange.text+'"':""}),"textPreview"===e.state.windowLoad&&e.props.textPreviewObjects.map((function(t,n){return r.a.createElement(rt,{key:n,textPreviewResourceId:t.id,textPreviewStart:t.range?t.range.split("-")[0]:null,textPreviewEnd:t.range?t.range.split("-")[1]:null,handleFocusChange:e.props.handleFocusChange,hidden:"textPreview"!==e.state.windowLoad,handleTextPreviewFocusChange:e.props.handleTextPreviewFocusChange,referringResource:e.props.info.ctranscription,referringSelectionRange:e.props.selectionRange})})),"dictionary"===e.state.windowLoad&&e.props.selectionRange.text&&r.a.createElement(ot,{text:e.props.selectionRange.text,hidden:"dictionary"!==e.state.windowLoad}),"surface2"===e.state.windowLoad&&r.a.createElement(Se,{surfaceid:e.props.surfaceid,lineFocusId:e.props.lineFocusId,topLevel:e.props.info.topLevel,handleSurfaceFocusChange:e.props.handleSurfaceFocusChange,handleLineFocusChange:e.props.handleLineFocusChange,hidden:"surface2"!==e.state.windowLoad}))}())}}]),n}(r.a.Component),pt=n(32),ut=Object(d.c)()((function(e){var t=e.t;return r.a.createElement(pt.a,{bg:"light",variant:"light",expand:"lg",fixed:"bottom"},r.a.createElement(pt.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(pt.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Ae.a,null,e.previous&&r.a.createElement(o.c,{className:"nav-link",to:"/text?resourceid="+e.previous+e.mtFocus},t("Previous")),e.next&&r.a.createElement(o.c,{className:"nav-link",to:"/text?resourceid="+e.next+e.mtFocus},t("Next")),e.topLevel&&r.a.createElement(o.c,{className:"nav-link",to:"/text?resourceid="+e.topLevel},t("Text Home")),e.pdfView?r.a.createElement("span",{className:"nav-link",onClick:function(){return e.handleTogglePdfView()}},t("Web View")):r.a.createElement("span",{className:"nav-link",onClick:function(){return e.handleTogglePdfView()}},t("Print View")))))})),ht=n(44),dt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).retrieveText=a.retrieveText.bind(Object(J.a)(a)),a.handleShowToolTip=a.handleShowToolTip.bind(Object(J.a)(a)),a.handleHideToolTip=a.handleHideToolTip.bind(Object(J.a)(a)),a.handleHideFootnoteToolTip=a.handleHideFootnoteToolTip.bind(Object(J.a)(a)),a.handleShowFootnoteToolTip=a.handleShowFootnoteToolTip.bind(Object(J.a)(a)),a.handleOnToolTipClick=a.handleOnToolTipClick.bind(Object(J.a)(a)),a.mounted="",a.state={fetching:!1,selectionRange:"",selectionCoords:"",dictionary:""},a}return Object(X.a)(n,[{key:"retrieveText",value:function(e,t,n,a){var r,s=this,i=this;if(e){var o=this.props.doc,l=this.props.topLevel,c=o.split("/master/")[1],p=l.split("/resource/")[1],u="";u=o.includes("ipfs")?o:"https://exist.scta.info/exist/apps/scta-app/text/"+p+"/"+c;this.setState({fetching:!0}),(r=u,T.a.get("https://exist.scta.info/exist/apps/scta-app/xslt-conversion.xq?xmlurl="+r)).then((function(e){s.setState({fetching:!1}),document.getElementById("text").innerHTML="",document.getElementById("text").innerHTML=e.data,s.setEvents(i,n,a)})).catch((function(e){b(u,"/xslt/main_view.xsl").then((function(e){s.setState({fetching:!1}),document.getElementById("text").innerHTML="",document.getElementById("text").appendChild(e),s.setEvents(i,n,a)})).catch((function(e){console.log("something went wrong",e),document.getElementById("text").innerHTML="",document.getElementById("text").innerHTML="<p>Apologies, the document is not able to be loaded at this time</p>"}))}))}}},{key:"setEvents",value:function(e,t,n){function a(t){e.handleHideToolTip();var n=document.getSelection();if(window.getSelection().rangeCount>=1){var a=n&&n.getRangeAt(0),r=function(e){for(;e;){if(1===e.nodeType&&"p"===e.tagName.toLowerCase())return e;e=e.parentElement}}(a.commonAncestorContainer);if(r&&r.className.includes("plaoulparagraph")){var s=r.id,i=a.cloneContents();if(y()(i).find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove(),i.textContent.length>0){y()(r).clone().find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove();var o,l,c=k(i.textContent);0===a.startOffset?(o=a.startOffset,l=a.startContainer):(o=a.startOffset-1,l=a.startContainer);var p=function(e){var t=e.cloneContents();return y()(t).find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove(),k(t.textContent).split(" ").filter((function(e){return e})).length}(function(e,t,n,a,r){var s=e.ownerDocument.createRange();return s.setStart(t,n),s.setEnd(a,r),s}(r,r,0,l,o)),u={start:p+1,end:p+c.split(" ").filter((function(e){return e})).length},h=a.getBoundingClientRect(),d={text:c,wordRange:u,selectedElementTargetId:s};e.handleShowToolTip(d,h)}}}}y()(".paragraphnumber").click((function(t){t.preventDefault();var n=y()(this).parent("p").attr("id");e.props.setFocus(n),e.props.openWindow("window1")})),t&&C(t,!0),n&&e.markWithElement(n),y()(".js-show-folio-image").click((function(t){t.preventDefault();var n=y()(this).attr("data-surfaceid"),a=y()(this).closest(".plaoulparagraph").attr("id");e.props.setFocus(a),e.props.handleSurfaceFocusChange("http://scta.info/resource/"+n),e.props.openWindow("window2","surface2")})),y()(".lbp-line-number").click((function(t){t.preventDefault();var n=y()(this).attr("data-surfaceid"),a=y()(this).attr("data-ln"),r=y()(this).closest(".plaoulparagraph").attr("id");e.props.setFocus(r),e.props.handleSurfaceFocusChange("http://scta.info/resource/"+n),e.props.handleLineFocusChange("http://scta.info/resource/"+n+"/"+a),e.props.openWindow("window2","surface2")})),y()(".appnote, .footnote").click((function(t){t.preventDefault(),y()(this).attr("data-tip","hello world");var n=y()(this).parent().children(".appnote, .footnote"),a=y()(n).attr("href"),r=y()(a).html(),s=this.getBoundingClientRect();e.setState({footnoteText:r,footnoteOffset:s}),e.handleShowFootnoteToolTip();var i=y()(this).parent().children(".note-display").attr("data-target-id");y()(".highlight").removeClass("highlight"),y()("#"+i).addClass("highlight"),y()("span[data-corresp="+i+"]").addClass("highlight")})),y()(document).on("click",".js-show-info",(function(t){t.preventDefault();var n=y()(this).attr("data-pid");e.props.setFocus(n),e.props.openWindow("window1")})),t&&C(t,!0),y()(document).on("click",".show-line-witness",(function(t){t.preventDefault();var n=y()(this).attr("data-surfaceid"),a=y()(this).attr("data-ln");e.props.handleSurfaceFocusChange("http://scta.info/resource/"+n),e.props.handleLineFocusChange("http://scta.info/resource/"+n+"/"+a),e.props.openWindow("window2","surface2")})),y()(document).on("click",".js-show-reference-paragraph",(function(t){t.preventDefault();var n=y()(this).attr("data-target-resource"),a=y()(this).attr("data-url").split(" "),r=y()(this).attr("data-target-range"),s=r?r.split(" "):null,i=a.map((function(e,t){return{id:e,range:s?s[t]:null}}));e.props.handleTextPreviewFocusChange(i),e.props.openWindow("window2","textPreview"),e.props.setFocus(n)})),document.addEventListener("keyup",a),document.addEventListener("mouseup",a)}},{key:"markWithElement",value:function(e){this.markElementRemove();var t=document.getElementById(e.selectedElementTargetId);if(t&&e.wordRange){var n=function(e,t,n){for(var a,r,s,i,o,l,c,p=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT,S,!0),u=0,h=0;(c=p.nextNode())&&(!a||!i);){c.previousSibling&&c.previousSibling.getAttribute&&c.previousSibling&&"no"===c.previousSibling.getAttribute("data-break")&&(u+=1);var d=k(c.nodeValue).split(" ").filter((function(e){return e})),m=d.length;if(!a&&t+u>=h&&t+u<=h+m){a=c;var f=R(d,(s=t+u-h)-1);r=I(c.nodeValue,d[s-1],f,!0)}if(!i&&n+u>=h&&n+u<=h+m){i=c;var v=R(d,(l=n+u-h)-1);o=I(c.nodeValue,d[l-1],v,!1)}h+=m}var g=e.ownerDocument.createRange();return a?g.setStart(a,r):console.log("no container or invalid end offset"),i?g.setEnd(i,o):console.log("no container invalid end offset"),g}(t,e.wordRange.start,e.wordRange.end),a=n.extractContents(),r=document.createElement("mark");r.style.backgroundColor="#BBCEBE",r.appendChild(a),n.insertNode(r);var s=y()(r).clone();y()(s).find(".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg").remove(),e.text=k(y()(s).text()),this.props.handleUpdateSelectionRange(e)}}},{key:"markElementRemove",value:function(){y()("mark").contents().unwrap()}},{key:"handleOnToolTipClick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"window1",n=this.state.selectionRange;console.log("selection range test",n),this.markWithElement(n);var a=n;this.props.setFocus(a.selectedElementTargetId+"@"+a.wordRange.start+"-"+a.wordRange.end),this.props.openWindow(t,e)}},{key:"handleHideToolTip",value:function(){ht.a.hide(this.fooRef)}},{key:"handleHideFootnoteToolTip",value:function(){ht.a.hide(this.foonoteRef)}},{key:"handleShowToolTip",value:function(e,t){this.mounted&&(this.setState({selectionRange:e,selectionCoords:t}),ht.a.show(this.fooRef))}},{key:"handleShowFootnoteToolTip",value:function(){ht.a.show(this.foonoteRef)}},{key:"componentDidMount",value:function(){this.mounted=!0;var e=this.props.scrollTo&&this.props.scrollTo.includes("/resource/")?this.props.scrollTo.split("/resource/")[1]:this.props.scrollTo;this.retrieveText(this.props.doc,this.props.topLevel,e,this.props.selectionRange)}},{key:"componentDidUpdate",value:function(e,t){if(e.doc!==this.props.doc){var n=this.props.scrollTo&&this.props.scrollTo.includes("/resource/")?this.props.scrollTo.split("/resource/")[1]:this.props.scrollTo;this.retrieveText(this.props.doc,this.props.topLevel,n,this.props.selectionRange)}else{if(this.props.scrollTo!==e.scrollTo)C(this.props.scrollTo&&this.props.scrollTo.includes("/resource/")?this.props.scrollTo.split("/resource/")[1]:this.props.scrollTo,!0),this.props.selectionRange.selectedElementTargetId&&this.props.selectionRange.wordRange?this.markWithElement(this.props.selectionRange):this.markElementRemove();else this.props.selectionRange.wordRange!==e.selectionRange.wordRange&&this.props.selectionRange.selectedElementTargetId?this.markWithElement(this.props.selectionRange):this.props.selectionRange.selectedElementTargetId||this.props.selectionRange.wordRange||this.markElementRemove()}}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=this,t=this.state.fetching?"none":"block";return r.a.createElement("div",null,this.state.fetching&&r.a.createElement("div",{style:{position:"fixed",top:"50%",left:"50%"}},r.a.createElement(P,null)),this.state.selectionRange&&r.a.createElement("p",{ref:function(t){return e.fooRef=t},"data-tip":"tooltip","data-for":"selection",style:{position:"fixed",top:this.state.selectionCoords.top+10,left:this.state.selectionCoords.left}}),this.state.footnoteText&&r.a.createElement("p",{ref:function(t){return e.foonoteRef=t},"data-tip":"tooltip","data-for":"footnote",style:{position:"fixed",top:this.state.footnoteOffset.top+10,left:this.state.footnoteOffset.left}}),r.a.createElement(ht.a,{clickable:!0,place:"top",id:"selection"},this.state.selectionRange&&r.a.createElement(Ae.a,null,r.a.createElement(Ae.a.Link,{title:this.state.selectionRange.wordRange.start+"-"+this.state.selectionRange.wordRange.end,onClick:function(){e.handleOnToolTipClick("citation")}},r.a.createElement(re.v,null)),r.a.createElement(Ae.a.Link,{onClick:function(){e.handleOnToolTipClick("comments")}},r.a.createElement(re.m,null)),this.state.selectionRange.text&&1===this.state.selectionRange.text.split(" ").length&&r.a.createElement(Ae.a.Link,{onClick:function(){L(e.props.doc,e.state.selectionRange.text,e.state.selectionRange.selectedElementTargetId)}},r.a.createElement(re.o,null)),r.a.createElement(Ae.a.Link,{onClick:function(){e.handleOnToolTipClick("search")}},r.a.createElement(re.E,null)),this.state.selectionRange.text&&1===this.state.selectionRange.text.split(" ").length&&r.a.createElement(Ae.a.Link,{title:"look up word",onClick:function(){return e.handleOnToolTipClick("dictionary","window2")}},r.a.createElement(re.e,null)))),r.a.createElement(ht.a,{id:"footnote",clickable:!0,place:"top"},r.a.createElement("p",{dangerouslySetInnerHTML:{__html:this.state.footnoteText}})),r.a.createElement("div",{id:"text",style:{display:t}}))}}]),n}(r.a.Component),mt=n(64);var ft=function(e){return e.item?r.a.createElement("tr",null,e.item.author&&r.a.createElement("td",null,r.a.createElement(o.b,{to:"/text?resourceid="+e.item.author},e.item.authorTitle)),r.a.createElement("td",null,r.a.createElement(o.b,{to:"/text?resourceid="+e.item.id},e.item.title)),e.item.questionTitle&&r.a.createElement("td",null,r.a.createElement(o.b,{to:"/text?resourceid="+e.item.id},e.item.questionTitle))):null},vt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).retrieveAuthorCollectionInfo=a.retrieveAuthorCollectionInfo.bind(Object(J.a)(a)),a.handleItemFilter=a.handleItemFilter.bind(Object(J.a)(a)),a.itemFilter=r.a.createRef(),a.mount=!1,a.state={authorTitle:"",authorArticles:[],textArticles:[],expressions:[],itemFilter:""},a}return Object(X.a)(n,[{key:"handleItemFilter",value:function(e){var t=e.target.value;this.setState({itemFilter:t})}},{key:"arrangeItems",value:function(e,t){var n=this;e.then((function(e){var a=e.data["@graph"].filter((function(e){return e["@id"]===t}))[0],r=a["http://purl.org/dc/elements/1.1/title"],s=null;Array.isArray(a.authorArticle)?s=a.authorArticle.map((function(t){return{id:t,title:e.data["@graph"].filter((function(e){return e["@id"]===t}))[0]["http://purl.org/dc/elements/1.1/title"]}})):a.authorArticle&&(s=[{id:a.authorArticle,title:e.data["@graph"].filter((function(e){return e["@id"]===a.authorArticle}))[0]["http://purl.org/dc/elements/1.1/title"]}]);var i=null;Array.isArray(a.textArticle)?i=a.textArticle.map((function(t){return{id:t,title:e.data["@graph"].filter((function(e){return e["@id"]===t}))[0]["http://purl.org/dc/elements/1.1/title"]}})):a.textArticle&&(i=[{id:a.textArticle,title:e.data["@graph"].filter((function(e){return e["@id"]===a.textArticle}))[0]["http://purl.org/dc/elements/1.1/title"]}]);var o=null;Array.isArray(a.hasTopLevelExpression)?o=a.hasTopLevelExpression.map((function(t){return{id:t,title:e.data["@graph"].filter((function(e){return e["@id"]===t}))[0]["http://purl.org/dc/elements/1.1/title"]}})):a.hasTopLevelExpression&&(o=[{id:a.hasTopLevelExpression,title:e.data["@graph"].filter((function(e){return e["@id"]===a.hasTopLevelExpression}))[0]["http://purl.org/dc/elements/1.1/title"]}]),n.mount&&n.setState({authorArticles:s,textArticles:i,expressions:o,authorTitle:r})})).catch((function(e){console.log(e)}))}},{key:"retrieveAuthorCollectionInfo",value:function(e){var t=O(["CONSTRUCT","{","?author  <http://purl.org/dc/elements/1.1/title> ?authorTitle ;","<http://scta.info/resource/hasTopLevelExpression> ?expression ;","<http://scta.info/property/authorArticle> ?authorArticle;","<http://scta.info/property/textArticle> ?textArticle .","?authorArticle <http://purl.org/dc/elements/1.1/title> ?authorArticleTitle . ","?textArticle <http://purl.org/dc/elements/1.1/title> ?textArticleTitle . ","?expression <http://purl.org/dc/elements/1.1/title> ?topLevelExpressionTitle .","}","WHERE ","{","BIND(<"+e+"> as ?author) . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","OPTIONAL","{","?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?expression a <http://scta.info/resource/expression> .","?expression <http://scta.info/property/level> '1' .","?expression <http://purl.org/dc/elements/1.1/title> ?topLevelExpressionTitle .","}","OPTIONAL","{","?expression2 <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?textArticle <http://scta.info/property/isArticleOf> ?expression2 .","?textArticle <http://purl.org/dc/elements/1.1/title> ?textArticleTitle .","}","OPTIONAL","{","?authorArticle <http://scta.info/property/isArticleOf> ?author .","?authorArticle <http://purl.org/dc/elements/1.1/title> ?authorArticleTitle","}","}"].join(""));this.arrangeItems(t,e)}},{key:"componentDidUpdate",value:function(e){this.props.resourceid!==e.resourceid&&(this.refs.itemFilter?this.refs.itemFilter.value="":this.retrieveAuthorCollectionInfo(this.props.resourceid))}},{key:"componentDidMount",value:function(){this.mount=!0,this.retrieveAuthorCollectionInfo(this.props.resourceid)}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){var e=function(e){return e.map((function(e){return r.a.createElement(ft,{key:e.id,item:e})}))};return r.a.createElement(c.a,{className:"collectionBody"},r.a.createElement("h1",null,this.state.authorTitle),this.state.expressions&&r.a.createElement(c.a,null,r.a.createElement("h1",null,"Expressions"),r.a.createElement("br",null),r.a.createElement(mt.a,{striped:!0,bordered:!0,hover:!0,size:"sm"},r.a.createElement("tbody",null,e(this.state.expressions)))),this.state.authorArticles&&r.a.createElement(c.a,null,r.a.createElement("h1",null,"Author Related Articles"),r.a.createElement("br",null),r.a.createElement(mt.a,{striped:!0,bordered:!0,hover:!0,size:"sm"},r.a.createElement("tbody",null,e(this.state.authorArticles)))),this.state.textArticles&&r.a.createElement(c.a,null,r.a.createElement("h1",null,"Text Related Articles"),r.a.createElement("br",null),r.a.createElement(mt.a,{striped:!0,bordered:!0,hover:!0,size:"sm"},r.a.createElement("tbody",null,e(this.state.textArticles)))))}}]),n}(r.a.Component),gt=n(73),Tt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).getVersionHistory=a.getVersionHistory.bind(Object(J.a)(a)),a.handleToggleShowVersions=a.handleToggleShowVersions.bind(Object(J.a)(a)),a.state={versions:[],currentVersion:"",showVersions:!1},a}return Object(X.a)(n,[{key:"handleToggleShowVersions",value:function(){this.setState((function(e){return{showVersions:!e.showVersions}}))}},{key:"getVersionHistory",value:function(e){var t,n=this;O(["SELECT ?version ?version_shortId ?order_number ?version_label ?review ?doc","{","{","BIND(<"+(t=e)+"> as ?version) . ","?version <http://scta.info/property/shortId> ?version_shortId .","?version <http://scta.info/property/hasDocument> ?doc . ","?version <http://scta.info/property/versionOrderNumber> ?order_number .","?version <http://scta.info/property/versionLabel> ?version_label .","OPTIONAL {","?version <http://scta.info/property/hasReview> ?review .","}","}","UNION","{","<"+t+"> <http://scta.info/property/hasAncestor> ?version .","?version <http://scta.info/property/shortId> ?version_shortId .","?version <http://scta.info/property/hasDocument> ?doc . ","?version <http://scta.info/property/versionOrderNumber> ?order_number .","?version <http://scta.info/property/versionLabel> ?version_label .","OPTIONAL {","?version <http://scta.info/property/hasReview> ?review .","}","}","UNION","{","<"+t+"> <http://scta.info/property/hasDescendant> ?version .","?version <http://scta.info/property/shortId> ?version_shortId .","?version <http://scta.info/property/hasDocument> ?doc . ","?version <http://scta.info/property/versionOrderNumber> ?order_number .","?version <http://scta.info/property/versionLabel> ?version_label .","OPTIONAL {","?version <http://scta.info/property/hasReview> ?review .","}","}","}","ORDER BY DESC(?order_number)"].join("")).then((function(t){t.data.results.bindings.forEach((function(t,a){var r="https://dll-review-registry.scta.info/api/v1/reviews/?url="+t.doc.value+"?society=MAA";T()(r).then((function(a){var r=a.data,s={};r.length>0&&(s={img_url:r[0]["badge-url"],reviewid:r[0].id,ipfsHash:r[0]["ipfs-hash"],html_link:"https://dll-review-registry.scta.info/reviews/"+r[0].id+".html",rubric_link:r[0]["badge-rubric"],summary:r[0]["review-summary"]}),n.setState((function(n){var a={versionTranscription:t.version?t.version.value:"",versionLabel:t.version_label?t.version_label.value:"",versionOrderNumber:t.order_number?t.order_number.value:"",versionReview:t.review?t.review.value:"",versionDoc:t.doc?t.doc.value:"",versionReviewInfo:s};return{versions:[].concat(Object(F.a)(n.versions),[a]),currentVersion:e}}))}))}))}))}},{key:"componentDidMount",value:function(){this.props.transcriptionid&&this.getVersionHistory(this.props.transcriptionid)}},{key:"componentDidUpdate",value:function(e,t){var n=this;this.props.transcriptionid!==e.transcriptionid&&(console.log("running fetch"),this.setState({versions:[]},(function(){n.getVersionHistory(n.props.transcriptionid)})))}},{key:"render",value:function(){var e=this,t=this.props.t;return function(){if(e.state.versions){if(e.state.versions.length>1)return r.a.createElement(gt.a,{variant:"info"},r.a.createElement("p",{onClick:e.handleToggleShowVersions,className:"small"},t("This Text Has Multiple Indexed Versions")),e.state.showVersions&&e.state.versions.map((function(n){var a=n.versionTranscription===e.state.currentVersion?"currentlyViewing":"",s=n.versionDoc.includes("github.com")&&n.versionDoc.replace("/raw/","/edit/"),i="https://github.com/scta-texts/"+(n.versionDoc.includes("github.com")&&n.versionDoc.split("/scta-texts/")[1].split("/")[0])+"issues";return r.a.createElement("p",{key:n.versionTranscription,className:a+" small"},a?r.a.createElement("span",null,n.versionLabel," ",t("(Currently Viewing)")):r.a.createElement("span",{className:"lbp-span-link",onClick:function(){e.props.handleFocusChange(n.versionTranscription)}},n.versionLabel),n.versionReviewInfo.html_link&&r.a.createElement("span",null," ",t("Peer Reviewed"),": ",r.a.createElement("a",{href:n.versionReviewInfo.html_link},r.a.createElement("img",{alt:"review",src:n.versionReviewInfo.img_url}))," "),r.a.createElement("span",{className:"small"}," ",t("Data Source"),": ",r.a.createElement("a",{href:n.versionDoc},n.versionDoc)," "),s&&r.a.createElement("span",{className:"small"}," | ",r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"}," Edit on ",r.a.createElement("img",{src:"github-octocat-logo.png",alt:"github",height:"25px"})," Github")," or ",r.a.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},"Create a GitHub Issue")))})));if(1===e.state.versions.length){var n=e.state.versions[0],a=n.versionDoc.includes("github.com")&&n.versionDoc.replace("/raw/","/edit/"),s="https://github.com/scta-texts/"+(n.versionDoc.includes("github.com")&&n.versionDoc.split("/scta-texts/")[1].split("/")[0])+"/issues";return r.a.createElement(gt.a,{variant:"info"},r.a.createElement("span",{className:"small"},t("Version"),": ",n.versionLabel,"|",t("Data Source"),": ",r.a.createElement("a",{href:n.versionDoc},n.versionDoc)),a&&r.a.createElement("span",{className:"small"}," | ",r.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"}," Edit on ",r.a.createElement("img",{src:"github-octocat-logo.png",alt:"github",height:"25px"})," Github")," or ",r.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},"Create a GitHub Issue")))}return null}return null}()}}]),n}(r.a.Component),Et=Object(d.c)()(Tt),yt=n(107),xt=n(58),bt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).retrieveCollectionInfo=a.retrieveCollectionInfo.bind(Object(J.a)(a)),a.makeRequests=a.makeRequests.bind(Object(J.a)(a)),a.handleFilter=a.handleFilter.bind(Object(J.a)(a)),a.filter=r.a.createRef(),a.mount=!1,a.state={title:"",description:"",items:{},parts:{},filter:""},a}return Object(X.a)(n,[{key:"handleFilter",value:function(e){var t=e.target.value;this.setState({filter:t})}},{key:"arrangeParts",value:function(e){var t=this,n=this;e.then((function(e){var a=e.data.results.bindings,r=a[0].title.value,s=a[0].description.value,i={};a.forEach((function(e){var t=e.part.value;i[t]={id:e.part.value,title:e.partTitle.value,type:e.partType.value,questionTitle:e.partQuestionTitle?e.partQuestionTitle.value:null,level:e.partLevel?e.partLevel.value:"unknown"}})),t.mount&&n.setState({title:r,description:s,parts:i})}))}},{key:"arrangeItems",value:function(e){var t=this,n=this;e.then((function(e){var a=e.data.results.bindings,r={};a.forEach((function(e){var t=e.item.value;r[t]={title:e.itemTitle.value,id:e.item.value,type:e.itemType.value,questionTitle:e.itemQuestionTitle?e.itemQuestionTitle.value:null,author:e.itemAuthor?e.itemAuthor.value:null,authorTitle:e.itemAuthorTitle?e.itemAuthorTitle.value:null,next:e.next?e.next.value:null,previous:e.previous?e.previous.value:null,cm:e.cm?e.cm.value:null,cmTitle:e.cmTitle?e.cmTitle.value:null,ct:e.ct?e.ct.value:null,topLevel:e.topLevel?e.topLevel.value:null,doc:e.doc?e.doc.value:null}})),t.mount&&n.setState({items:r})})).catch((function(e){console.log(e)}))}},{key:"retrieveWorkGroupInfo",value:function(e){var t=O(["SELECT DISTINCT ?item ?itemTitle ?itemAuthor ?itemAuthorTitle ?itemType ","WHERE { ","<"+e+"> <http://scta.info/property/hasExpression> ?item .","?item <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?itemType . ","?item <http://purl.org/dc/elements/1.1/title> ?itemTitle .","?item <http://www.loc.gov/loc.terms/relators/AUT> ?itemAuthor .","?itemAuthor <http://purl.org/dc/elements/1.1/title> ?itemAuthorTitle .","}","ORDER BY ?itemAuthorTitle"].join("")),n=O(ie(e));this.arrangeParts(n),this.arrangeItems(t)}},{key:"retrieveCollectionInfo",value:function(e,t,n){var a=O(["SELECT DISTINCT ?item ?itemTitle ?topLevel ?itemQuestionTitle ?cm ?cmTitle ?ct ?next ?previous ?itemType ?doc ","WHERE { ","<"+n+"> <http://scta.info/property/hasStructureItem> ?item .","?item <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .","?item <http://purl.org/dc/elements/1.1/title> ?itemTitle .","?item <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?itemType . ","OPTIONAL {","?item <http://scta.info/property/questionTitle> ?itemQuestionTitle .","}","OPTIONAL","{","?item <http://scta.info/property/next> ?next .","}","OPTIONAL","{","?item <http://scta.info/property/previous> ?previous .","}","?item <http://scta.info/property/hasCanonicalManifestation> ?cm .","?item <http://scta.info/property/totalOrderNumber> ?totalOrderNumber .","?cm <http://purl.org/dc/elements/1.1/title> ?cmTitle .","?cm <http://scta.info/property/hasCanonicalTranscription> ?ct .","?ct <http://scta.info/property/hasDocument> ?doc .","}","ORDER BY ?totalOrderNumber"].join("")),r=O(ie(e));this.arrangeParts(r),this.arrangeItems(a)}},{key:"makeRequests",value:function(e,t,n,a){"http://scta.info/resource/workGroup"===a?this.retrieveWorkGroupInfo(e,t,n):"http://scta.info/resource/structureCollection"===t&&this.retrieveCollectionInfo(e,t,n)}},{key:"componentDidMount",value:function(){this.mount=!0,this.setState({resourceid:this.props.resourceid}),this.makeRequests(this.props.resourceid,this.props.structureType,this.props.topLevel,this.props.type)}},{key:"componentDidUpdate",value:function(e){this.props.resourceid!==e.resourceid&&(this.setState({resourceid:this.props.resourceid,filter:""}),this.makeRequests(this.props.resourceid,this.props.structureType,this.props.topLevel,this.props.type))}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){return r.a.createElement(c.a,{className:"collectionBody"},this.state.title&&r.a.createElement("h1",null,this.state.title),this.state.title&&r.a.createElement("p",{style:{textAlign:"center"}},this.state.description),r.a.createElement(yt.a,null,r.a.createElement(xt.a,{xs:9},r.a.createElement(c.a,null,r.a.createElement(de,{focusResourceid:this.state.resourceid,resourceid:this.state.resourceid,title:this.state.title,hidden:!1,mtFocus:"",collectionLink:!0,showAuthor:!0,showParentLink:!0})))))}}]),n}(r.a.Component),wt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).retrieveCodexInfo=a.retrieveCodexInfo.bind(Object(J.a)(a)),a.handleSurfaceFocusChange=a.handleSurfaceFocusChange.bind(Object(J.a)(a)),a.handleToggleShowContents=a.handleToggleShowContents.bind(Object(J.a)(a)),a.state={items:{},title:"",focusedSurface:"",relatedCodices:[],showContents:!0,surface3Manifestations:[],surface3FocusedManifestation:""},a}return Object(X.a)(n,[{key:"handleToggleShowContents",value:function(){this.setState((function(e){return{showContents:!e.showContents}}))}},{key:"handleSurfaceFocusChange",value:function(e){this.props.handleSetFocus(e)}},{key:"retrieveCodexInfo",value:function(e,t){var n=this;O("surface"===t?pe(e):"canvas"===t?ue(e):"manifest"===t?ce(e):le(e)).then((function(a){var r=a.data.results.bindings;if(r.length>0&&r[0].surface){var s=r.map((function(e){return e.expression?e.expression.value:""})).filter((function(e,t,n){return n.indexOf(e)===t})),i={};s.forEach((function(e){i[e]=[]})),r.forEach((function(e){var t={expression:e.expression.value,expressionTitle:e.item_expression_title.value,manifestation:e.manifestation.value,surface:e.surface.value,surfaceTitle:e.surface_title.value,questionTitle:e.item_expression_question_title?e.item_expression_question_title.value:""};i[e.expression.value].push(t)}));var o="";o="surface"===t?e:"canvas"===t?r[0].surfaceFocus.value:r[0].surface.value,n.setState({items:i,focusedSurface:o}),n.props.handleSurfaceFocusChange(o)}}))}},{key:"componentDidMount",value:function(){this.retrieveCodexInfo(this.props.resourceid,this.props.codexResourceType)}},{key:"componentDidUpdate",value:function(e){this.props.resourceid&&this.props.resourceid!==e.resourceid&&this.retrieveCodexInfo(this.props.resourceid,this.props.codexResourceType)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"codexImage"},r.a.createElement("h1",null,"Codex Pages"),e.state.surface3Manifestations.length>0?r.a.createElement(je,{manifestations:e.state.surface3Manifestations,focusedManifestation:e.state.surface3FocusedManifestation,annotationsDisplay:"paragraph",width:"501",hidden:!1}):e.state.focusedSurface?r.a.createElement(Se,{surfaceid:e.state.focusedSurface,lineFocusId:"",topLevel:e.props.topLevel,handleSurfaceFocusChange:e.handleSurfaceFocusChange,width:"501",annotationsDisplay:!1,hidden:!1}):null)}}]),n}(r.a.Component);var Ot=function(e){var t=Object(a.useState)([]),n=Object(f.a)(t,2),s=n[0],i=n[1];return Object(a.useEffect)((function(){var t;O(["SELECT ?expression ?eLongTitle ?expressionAuthor ?expressionAuthorTitle ?author ?authorTitle ","{","{","?expression <http://scta.info/property/expressionType> <"+(t=e.expressionTypeId)+"> .","}","UNION","{","?expression <http://scta.info/property/expressionType> ?expressionType .","?expressionType <http://scta.info/property/isMemberOf> <"+t+"> .","}","?expression <http://scta.info/property/longTitle> ?eLongTitle .","OPTIONAL {","?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author . ","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","}","ORDER BY ?authorTitle"].join(" ")).then((function(e){var t=e.data.results.bindings;i(t)}))}),[e.expressionTypeId]),r.a.createElement(c.a,{className:"collectionBody"},r.a.createElement("h1",null,e.expressionTypeId),s.map((function(e){return r.a.createElement(c.a,null,r.a.createElement(de,{focusResourceid:e.expression.value,resourceid:e.expression.value,title:e.authorTitle?e.authorTitle.value+", "+e.eLongTitle.value:e.eLongTitle.value,hidden:!1,mtFocus:"",collectionLink:!0,showParentLink:!0}))})))},Ct=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).mount=!1,a.openWindow=a.openWindow.bind(Object(J.a)(a)),a.setFocus=a.setFocus.bind(Object(J.a)(a)),a.setFocus2=a.setFocus2.bind(Object(J.a)(a)),a.handleTabChange=a.handleTabChange.bind(Object(J.a)(a)),a.handleClose=a.handleClose.bind(Object(J.a)(a)),a.handleMinimize=a.handleMinimize.bind(Object(J.a)(a)),a.handleMaximize=a.handleMaximize.bind(Object(J.a)(a)),a.handleMiddlize=a.handleMiddlize.bind(Object(J.a)(a)),a.handleSwitchWindow=a.handleSwitchWindow.bind(Object(J.a)(a)),a.handleDuplicateWindow=a.handleDuplicateWindow.bind(Object(J.a)(a)),a.handleSurfaceFocusChange=a.handleSurfaceFocusChange.bind(Object(J.a)(a)),a.handleLineFocusChange=a.handleLineFocusChange.bind(Object(J.a)(a)),a.handleToggleTextLinesView=a.handleToggleTextLinesView.bind(Object(J.a)(a)),a.handleChangeManifestation=a.handleChangeManifestation.bind(Object(J.a)(a)),a.handleTextPreviewFocusChange=a.handleTextPreviewFocusChange.bind(Object(J.a)(a)),a.handleTogglePdfView=a.handleTogglePdfView.bind(Object(J.a)(a)),a.handleUpdateSelectionRange=a.handleUpdateSelectionRange.bind(Object(J.a)(a)),a.state={doc:"",focus:"",mtFocus:"",itemFocus:"",surfaceid:"",lineFocusId:"",textPreviewObjects:[],pdfView:!1,selectionRange:void 0,windows:{window1:{windowId:"window1",open:!0,windowLoad:"citation",position:"sideWindow",openWidthHeight:"middle",annotationsDisplay:"paragraph",defaultManifestationSlug:""},window2:{windowId:"window2",open:!1,windowLoad:"citation",position:"bottomWindow",openWidthHeight:"middle",annotationsDisplay:"paragraph",defaultManifestationSlug:""}}},a}return Object(X.a)(n,[{key:"handleTogglePdfView",value:function(){this.setState((function(e){return{pdfView:!e.pdfView}}))}},{key:"handleToggleTextLinesView",value:function(e,t){this.setState((function(n){var a=n.windows;return a[e].annotationsDisplay=t,{windows:a}}))}},{key:"handleChangeManifestation",value:function(e,t){this.setState((function(n){var a=n.windows;return a[e].defaultManifestationSlug=t,{windows:a}}))}},{key:"openWindow",value:function(e,t){this.state.windows[e].open&&this.state.windows[e].windowLoad===t||this.setState((function(n){var a=n.windows;return a[e].open=!0,t&&(a[e].windowLoad=t),{windows:a}}))}},{key:"handleClose",value:function(e){this.setState((function(t){var n=t.windows;return n[e].open=!1,{windows:n}})),C(this.state.blockFocus,!0)}},{key:"handleMinimize",value:function(e){this.setState((function(t){var n=t.windows;return n[e].openWidthHeight="minimum",{windows:n}}))}},{key:"handleMaximize",value:function(e){this.setState((function(t){var n=t.windows;return n[e].openWidthHeight="maximum",{windows:n}}))}},{key:"handleMiddlize",value:function(e){this.setState((function(t){var n=t.windows;return n[e].openWidthHeight="middle",{windows:n}}))}},{key:"handleUpdateSelectionRange",value:function(e){var t=e;this.setState({selectionRange:t})}},{key:"handleSwitchWindow",value:function(e,t){this.setState((function(t){var n=t.windows;return"sideWindow"===n[e].position?n[e].position="bottomWindow":"bottomWindow"===n[e].position&&(n[e].position="sideWindow"),{windows:n}}))}},{key:"handleDuplicateWindow",value:function(e,t){this.setState((function(t){var n=t.windows,a="window1"===e?"window2":"window1";return"sideWindow"===n[e].position?(n[a].position="bottomWindow",n[a].open=!0):"bottomWindow"===n[e].position&&(n[a].position="sideWindow",n[a].open=!0),{windows:n}}))}},{key:"handleTabChange",value:function(e,t){this.setState((function(n){var a=n.windows;return a[t].windowLoad=e,{windows:a}}))}},{key:"handleSurfaceFocusChange",value:function(e){this.setState({surfaceid:e})}},{key:"handleLineFocusChange",value:function(e){this.setState({lineFocusId:e})}},{key:"handleTextPreviewFocusChange",value:function(e){this.setState({textPreviewObjects:e})}},{key:"setFocus",value:function(e){var t=e.split("@")[1]?"@"+e.split("@")[1]:"",n=(e=e.split("@")[0]).includes("http")?e+this.state.mtFocus+t:"http://scta.info/resource/"+e+this.state.mtFocus+t;this.props.handleUpdateUrlResource(n)}},{key:"setFocus2",value:function(e){this.props.handleUpdateUrlResource(e)}},{key:"retrieveFocusInfo",value:function(e){var t=e.includes("http")?e:"http://scta.info/resource/"+e,n=O(se(t));this.arrangeFocusInfo(n,t)}},{key:"arrangeFocusInfo",value:function(e,t){var n=this;e.then((function(e){var a=e.data.results.bindings[0],r=e.data.results.bindings.map((function(e){return{manifestation:e.manifestation.value,manifestationTitle:e.manifestationTitle.value,transcription:e.manifestationCTranscription?e.manifestationCTranscription.value:""}}));n.mount&&a&&n.setState({focus:{resourceid:t,title:a.title.value,longTitle:a.longTitle?a.longTitle.value:"",author:a.author?a.author.value:"",authorTitle:a.authorTitle?a.authorTitle.value:"",structureType:a.structureType.value,inbox:a.inbox.value,next:a.next?a.next.value:"",previous:a.previous?a.previous.value:"",parent:a.parent?a.parent.value:"",cdoc:a.cdoc?a.cdoc.value:"",cxml:a.cxml?a.cxml.value:"",topLevel:a.topLevelExpression?a.topLevelExpression.value:"",cmanifestation:a.cmanifestation.value,ctranscription:a.ctranscription?a.ctranscription.value:"",manifestations:r}})}))}},{key:"setItemFocus",value:function(e){var t=e.includes("http")?e:"http://scta.info/resource/"+e,n=O(["SELECT DISTINCT ?title ?manifestation ?doc ?xml ?expression ?expressionShortId ?longTitle ?topLevelExpression ?next ?previous ?inbox ?t ","WHERE { ","BIND(<"+t+"> as ?t) . ","?t <http://purl.org/dc/elements/1.1/title> ?title .","?t <http://scta.info/property/isTranscriptionOf> ?manifestation .","?t <http://scta.info/property/hasDocument> ?doc . ","?t <http://scta.info/property/hasXML> ?xml . ","?manifestation <http://scta.info/property/isManifestationOf> ?expression .","?expression <http://purl.org/dc/elements/1.1/title> ?expressionTitle .","?expression <http://scta.info/property/shortId> ?expressionShortId .","?expression <http://scta.info/property/longTitle> ?longTitle .","?expression <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .","OPTIONAL {","?expression <http://scta.info/property/next> ?next .","}","OPTIONAL {","?expression <http://scta.info/property/previous> ?previous .","}","?expression <http://www.w3.org/ns/ldp#inbox> ?inbox . ","}","ORDER BY ?expressionTitle"].join(""));this.arrangeItemFocusInfo(n)}},{key:"arrangeItemFocusInfo",value:function(e){var t=this;e.then((function(e){var n=e.data.results.bindings[0];t.mount&&t.setState({itemFocus:{title:n.title.value,manifestation:n.manifestation.value,expression:n.expression.value,doc:n.doc.value,xml:n.xml.value,next:n.next?n.next.value:"",previous:n.previous?n.previous.value:"",inbox:n.inbox.value,topLevel:n.topLevelExpression.value,transcriptionid:n.t.value}})}))}},{key:"componentDidMount",value:function(){if(this.mount=!0,"person"===this.props.resourceType||"workGroup"===this.props.resourceType||"codex"===this.props.resourceType||"expressionType"===this.props.resourceType);else if("collection"===this.props.resourceType){this.retrieveFocusInfo(this.props.expressionid);var e=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[1]:"",t=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[2]:"";this.setState({mtFocus:"/"+e+"/"+t,itemFocus:""})}else if(this.props.itemTranscriptionId){this.setItemFocus(this.props.itemTranscriptionId);var n=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[1],a=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[2],r=this.props.tokenRange?{wordRange:this.props.tokenRange,selectedElementTargetId:this.props.expressionid&&this.props.expressionid.split("/resource/")[1]}:{};this.setState({mtFocus:"/"+n+"/"+a,selectionRange:r}),this.props.expressionid&&this.retrieveFocusInfo(this.props.expressionid)}}},{key:"componentDidUpdate",value:function(e){var t=this;if("person"===this.props.resourceType||"workGroup"===this.props.resourceType||"codex"===this.props.resourceType||"expressionType"===this.props.resourceType)this.props.resourceid!==e.resourceid&&this.setState({focus:"",mtFocus:""});else if("collection"===this.props.resourceType){if(this.props.resourceid!==e.resourceid){this.retrieveFocusInfo(this.props.expressionid);var n=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[1]:"",a=this.props.transcriptionid?this.props.transcriptionid.split("/resource/")[1].split("/")[2]:"";this.setState({mtFocus:"/"+n+"/"+a,itemFocus:""})}}else{if(this.props.itemTranscriptionId!==e.itemTranscriptionId){this.setItemFocus(this.props.itemTranscriptionId);var r=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[1],s=this.props.itemTranscriptionId.split("/resource/")[1].split("/")[2];this.setState((function(e){var n=e.windows;n.window1.defaultManifestationSlug="",n.window2.defaultManifestationSlug="";var a=t.props.tokenRange?Object(ne.a)(Object(ne.a)({},e.selectionRange),{},{wordRange:t.props.tokenRange,selectedElementTargetId:t.props.expressionid&&t.props.expressionid.split("/resource/")[1]}):{};return{mtFocus:"/"+r+"/"+s,selectionRange:a,windows:n}}))}this.props.expressionid!==e.expressionid&&(this.props.expressionid?(this.setState((function(e){return{selectionRange:t.props.tokenRange?Object(ne.a)(Object(ne.a)({},e.selectionRange),{},{wordRange:t.props.tokenRange,selectedElementTargetId:t.props.expressionid&&t.props.expressionid.split("/resource/")[1]}):{}}})),this.retrieveFocusInfo(this.props.expressionid)):this.setState({focus:"",selectionRange:""})),this.props.tokenRange!==e.tokenRange&&this.setState((function(e){return{selectionRange:t.props.tokenRange?Object(ne.a)(Object(ne.a)({},e.selectionRange),{},{wordRange:t.props.tokenRange,selectedElementTargetId:t.props.expressionid&&t.props.expressionid.split("/resource/")[1]}):{}}}))}}},{key:"componentWillUnmount",value:function(){this.mount=!1}},{key:"render",value:function(){var e=this,t=["lbp-text"];this.state.windows.window1.open&&"middle"===this.state.windows.window1.openWidthHeight?t.push("skinnyText"):t.push("fullText"),this.state.windows.window2.open&&t.push("longText"),this.state.pdfView?t.push("hidden"):t.push("showing");return r.a.createElement("div",null,this.state.pdfView&&r.a.createElement(ae,{url:this.state.itemFocus.doc}),r.a.createElement(c.a,{className:t.join(" ")},"codex"===e.props.resourceType?r.a.createElement(wt,{resourceid:e.props.resourceid,codexResourceType:e.props.codexResourceType,handleSetFocus:e.setFocus,handleSurfaceFocusChange:e.handleSurfaceFocusChange}):"person"===e.props.resourceType?r.a.createElement(vt,{resourceid:e.props.resourceid}):"workGroup"===e.props.resourceType?r.a.createElement(bt,{resourceid:e.props.resourceid,type:"http://scta.info/resource/workGroup"}):"expressionType"===e.props.resourceType?r.a.createElement(Ot,{expressionTypeId:e.props.resourceid}):"collection"===e.props.resourceType?r.a.createElement("div",null,r.a.createElement("h1",null,e.state.resourceTitle),r.a.createElement("p",{style:{textAlign:"center"}},"By ",r.a.createElement(o.b,{to:"/text?resourceid="+e.state.focus.author},e.state.focus.authorTitle)),r.a.createElement(de,{focusResourceid:e.props.resourceid,resourceid:e.props.resourceid,title:e.state.focus.title,hidden:!1,mtFocus:"",collectionLink:!0,showParentLink:!0})):e.state.itemFocus&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,{transcriptionid:e.state.itemFocus.transcriptionid,handleFocusChange:e.setFocus2}),r.a.createElement(dt,{doc:e.state.itemFocus.doc,topLevel:e.state.itemFocus.topLevel,setFocus:e.setFocus,handleSurfaceFocusChange:e.handleSurfaceFocusChange,handleLineFocusChange:e.handleLineFocusChange,openWindow:e.openWindow,scrollTo:e.props.expressionid&&e.props.expressionid.split("/resource/")[1],handleTextPreviewFocusChange:e.handleTextPreviewFocusChange,handleUpdateSelectionRange:e.handleUpdateSelectionRange,selectionRange:e.state.selectionRange}))),this.state.itemFocus&&r.a.createElement(ut,{next:this.state.itemFocus&&this.state.itemFocus.next,previous:this.state.itemFocus&&this.state.itemFocus.previous,topLevel:this.state.itemFocus&&this.state.itemFocus.topLevel,handleClose:this.handleClose,pdfView:this.state.pdfView,handleTogglePdfView:this.handleTogglePdfView,mtFocus:this.state.mtFocus}),r.a.createElement("div",null,!this.state.pdfView&&Object.keys(e.state.windows).map((function(t){return e.state.windows[t].open?r.a.createElement(ct,{key:t,handleClose:e.handleClose,handleMinimize:e.handleMinimize,handleMaximize:e.handleMaximize,handleMiddlize:e.handleMiddlize,handleTabChange:e.handleTabChange,handleBlockFocusChange:e.setFocus,handleFocusChange:e.setFocus2,handleSurfaceFocusChange:e.handleSurfaceFocusChange,handleSwitchWindow:e.handleSwitchWindow,handleDuplicateWindow:e.handleDuplicateWindow,resourceid:e.state.focus?e.state.focus.resourceid:e.props.resourceid,resourceType:e.props.resourceType?e.props.resourceType:"text",windowType:e.state.windows[t].position,windowId:e.state.windows[t].windowId,windowLoad:e.state.windows[t].windowLoad,openWidthHeight:e.state.windows[t].openWidthHeight,surfaceid:e.state.surfaceid,lineFocusId:e.state.lineFocusId,info:e.state.focus,itemFocus:e.state.itemFocus,altWindowState:"window1"===e.state.windows[t].windowId?e.state.windows.window2.open:e.state.windows.window1.open,mtFocus:e.state.mtFocus,handleToggleTextLinesView:e.handleToggleTextLinesView,annotationsDisplay:e.state.windows[t].annotationsDisplay,handleChangeManifestation:e.handleChangeManifestation,defaultManifestationSlug:e.state.windows[t].defaultManifestationSlug,textPreviewObjects:e.state.textPreviewObjects,handleTextPreviewFocusChange:e.handleTextPreviewFocusChange,handleLineFocusChange:e.handleLineFocusChange,selectionRange:e.state.selectionRange,codexResourceType:e.props.codexResourceType}):null}))))}}]),n}(r.a.Component),St=(n(273),function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).retrieveText=a.retrieveText.bind(Object(J.a)(a)),a}return Object(X.a)(n,[{key:"retrieveText",value:function(e,t,n){var a=this;if(e){var r=this.props.doc,s="";if(r.includes("ipfs")||r.includes("zotero"))s=r;else s="https://exist.scta.info/exist/apps/scta-app/text/scta-articles/"+r.split("/master/")[1].split("/")[1];b(s,"http://scta.info/resource/timeline"===n?"/xslt/articles/timeline.xsl":"http://scta.info/resource/bibliography"===n?"/xslt/articles/bibliography.xsl":"http://scta.info/resource/biography"===n?"/xslt/articles/biography.xsl":"/xslt/articles/standard.xsl").then((function(e){document.getElementById("text").innerHTML="",document.getElementById("text").appendChild(e),y()(".appnote, .footnote").click((function(e){e.preventDefault()})),y()(".appnote, .footnote").parent().click((function(e){e.preventDefault();var t=y()(this).children(".appnote, .footnote"),n=y()(t).attr("href"),a=y()(n).html(),r=y()(this).children(".note-display").attr("data-target-id");r&&(y()("#"+r).toggleClass("highlight"),y()("span[data-corresp="+r+"]").toggleClass("highlight"));var s=y()(this).children(".note-display");s.toggleClass("hidden"),s.html(a)})),y()(document).on("click",".js-show-reference-paragraph",(function(e){e.preventDefault();var t=y()(this).attr("data-url"),n=y()(this).attr("data-target-paragraph");a.props.setFocus(n),a.props.handleTextPreviewFocusChange(t),a.props.openWindow("window2","textPreview")}))})).catch((function(e){console.log("something went wrong",e),document.getElementById("text").innerHTML="",document.getElementById("text").innerHTML="<p>Apologies, the document is not able to be loaded at this time</p>"}))}}},{key:"componentDidUpdate",value:function(e,t){e.doc!==this.props.doc?this.retrieveText(this.props.doc,this.props.scrollTo,this.props.articleType):this.props.scrollTo!==e.scrollTo&&C(this.props.scrollTo,!0)}},{key:"componentDidMount",value:function(){this.retrieveText(this.props.doc,this.props.scrollTo,this.props.articleType)}},{key:"render",value:function(){return r.a.createElement(c.a,null,r.a.createElement("div",{id:"text"}))}}]),n}(r.a.Component));var kt=function(e){var t=Object(a.useState)([]),n=Object(f.a)(t,2),s=n[0],i=n[1],l=Object(a.useState)(""),p=Object(f.a)(l,2),u=p[0],h=p[1];return Object(a.useEffect)((function(){var t=O(["SELECT ?resource ?resourceTitle","{","?resource a <"+e.resourceTypeId+"> .","?resource <http://purl.org/dc/elements/1.1/title> ?resourceTitle","}","ORDER BY ?resourceTitle"].join(""));i("fetching"),t.then((function(e){i(e.data.results.bindings)}))}),[e.resourceTypeId]),r.a.createElement(c.a,{className:"collectionBody"},r.a.createElement("h1",null,e.resourceTypeId),r.a.createElement(v.a.Control,{as:"input",type:"text",placeholder:"filter",onChange:function(e){return h(e.target.value)},value:u}),"fetching"===s?r.a.createElement(P,null):s.map((function(e){return"http://scta.info/resource/"!==e.resource.value&&e.resourceTitle.value.includes(u)?r.a.createElement("p",{key:e.resource.value},r.a.createElement(o.b,{to:"/text?resourceid="+e.resource.value},e.resourceTitle.value)):null})))},Rt=function(e){Object(Z.a)(n,e);var t=Object(K.a)(n);function n(e){var a;return Object(Y.a)(this,n),(a=t.call(this,e)).handleUpdateUrlResource=a.handleUpdateUrlResource.bind(Object(J.a)(a)),a.state={displayType:"",resourceid:"",itemTranscriptionId:"",blockDivFocus:"",resourceTitle:"",author:"",authorTitle:"",tokenRange:""},a}return Object(X.a)(n,[{key:"handleUpdateUrlResource",value:function(e){this.props.history.push({search:"?resourceid="+e})}},{key:"getInfo",value:function(e){var t,n,a=this;e.split("@")[1]&&(t={start:parseInt(e.split("@")[1].split("-")[0]),end:parseInt(e.split("@")[1].split("-")[1])}),e=e.split("@")[0],O(["SELECT DISTINCT ?type ?structureType ?level ?topLevel ?itemParent ?resourceTitle ?author ?authorTitle ?ctranscription ","WHERE { ","<"+(n=e)+"> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?type . ","OPTIONAL {","<"+n+"> <http://www.loc.gov/loc.terms/relators/AUT> ?author .","?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .","}","OPTIONAL {","<"+n+"> <http://purl.org/dc/elements/1.1/title> ?resourceTitle .","}","OPTIONAL {","<"+n+"> <http://scta.info/property/structureType> ?structureType . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/level> ?level . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/isPartOfTopLevelManifestation> ?topLevel . ","}","OPTIONAL {","<"+n+"> <http://scta.info/property/isPartOfTopLevelTransription> ?topLevel . ","}","OPTIONAL {","{","<"+n+"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . ","}","UNION","{","<"+n+"> <http://scta.info/property/isPartOfStructureBlock> ?blockParent . ","?blockParent  <http://scta.info/property/isPartOfStructureItem> ?itemParent .","}","}","OPTIONAL {","{","<"+n+"> <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation . ","?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","UNION","{","<"+n+"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","UNION","{","<"+n+"> a <http://scta.info/resource/transcription> . ","BIND(<"+n+"> AS ?ctranscription) .","}","}","}"].join("")).then((function(n){var r=n.data.results.bindings.length>0?n.data.results.bindings[0]:"",s=r.type?r.type.value:null,i=r.structureType?r.structureType.value:null,o=r.topLevel?r.topLevel.value:e,l=r.itemParent?r.itemParent.value:null,c=r.resourceTitle?r.resourceTitle.value:"",p=r.author?r.author.value:"",u=r.authorTitle?r.authorTitle.value:"",h=r.ctranscription?r.ctranscription.value:"";if("http://scta.info/resource/person"===e)a.setState({displayType:"personList",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/codex"===e)a.setState({displayType:"codexList",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/expressionType"===e)a.setState({displayType:"expressionTypeList",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/expressionType"===s)a.setState({displayType:"expressionType",resourceid:e,structureType:"",topLevel:"",type:"",resourceTitle:""});else if("http://scta.info/resource/person"===s)a.setState({displayType:"person",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://scta.info/resource/article"===s){O(function(e){return["SELECT DISTINCT ?doc ?articleType ","WHERE { ","<"+e+"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","<"+e+"> <http://scta.info/property/articleType> ?articleType .","?ctranscription <http://scta.info/property/hasXML> ?doc . ","}"].join("")}(e)).then((function(t){a.setState({displayType:"article",articleDoc:t.data.results.bindings[0]?t.data.results.bindings[0].doc.value:"",articleType:t.data.results.bindings[0]?t.data.results.bindings[0].articleType.value:"",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c})}))}else if("http://scta.info/resource/codex"===s)a.setState({displayType:"codex",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://scta.info/resource/surface"===s)a.setState({displayType:"surface",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://iiif.io/api/presentation/2#Manifest"===s)a.setState({displayType:"manifest",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://iiif.io/api/presentation/2#Canvas"===s)a.setState({displayType:"canvas",resourceid:e,structureType:"",topLevel:"",type:s,resourceTitle:c});else if("http://scta.info/resource/workGroup"===s)a.setState({displayType:"workGroup",resourceid:e,structureType:i,topLevel:o,type:s,resourceTitle:c});else if("http://scta.info/resource/structureCollection"===i)a.setState({displayType:"collection",transcriptionid:h,resourceid:e,expressionid:"http://scta.info/resource/"+e.split("/resource/")[1].split("/")[0],structureType:i,topLevel:o,type:s,resourceTitle:c,author:p,authorTitle:u});else if("http://scta.info/resource/structureItem"===i)a.setState({itemTranscriptionId:h,displayType:"item",resourceid:e,expressionid:"http://scta.info/resource/"+e.split("/resource/")[1].split("/")[0],transcriptionid:h,resourceTitle:c,tokenRange:t});else if("http://scta.info/resource/structureElement"===i||"http://scta.info/resource/structureBlock"===i||"http://scta.info/resource/structureDivision"===i){O(function(e){return["SELECT DISTINCT ?ctranscription ?blockDivExpression ","WHERE { ","OPTIONAL","{","{","<"+e+"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . ","}","UNION","{","<"+e+">  <http://scta.info/property/isPartOfStructureBlock> ?blockParent .","?blockParent <http://scta.info/property/isPartOfStructureItem> ?itemParent . ","}","?itemParent <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> . ","{","{","?itemParent <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation . ","?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","UNION","{","?itemParent <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . ","}","}","}","OPTIONAL","{","{","<"+e+"> <http://scta.info/property/isManifestationOf> ?blockDivExpression . ","}","UNION","{","<"+e+"> <http://scta.info/property/isTranscriptionOf> ?blockDivManifestation . ","?blockDivManifestation <http://scta.info/property/isManifestationOf> ?blockDivExpression . ","}","}","}"].join("")}(e)).then((function(n){"http://scta.info/resource/transcription"===s?a.setState({itemTranscriptionId:l,resourceid:e,expressionid:n.data.results.bindings[0].blockDivExpression.value,transcriptionid:e,displayType:"item",resourceTitle:c,tokenRange:t}):"http://scta.info/resource/expression"===s?n.data.results.bindings[0].ctranscription?a.setState({itemTranscriptionId:n.data.results.bindings[0].ctranscription.value,resourceid:e,expressionid:e,transcriptionid:"this would be the focus transcription id",displayType:"item",resourceTitle:c,tokenRange:t}):a.setState({displayType:"notFound"}):a.setState({itemTranscriptionId:n.data.results.bindings[0].ctranscription.value,resourceid:e,expressionid:n.data.results.bindings[0].blockDivExpression.value,transcriptionid:"this would be the focus transcription id",displayType:"item",resourceTitle:c,tokenRange:t})}))}else a.setState({displayType:"notFound"})}))}},{key:"componentDidMount",value:function(){if(this.props.location){var e=ee.a.parse(this.props.location.search,{ignoreQueryPrefix:!0}).resourceid;e.includes("https://scta.info/")?this.handleUpdateUrlResource(e.replace("https://scta.info/","http://scta.info/")):this.getInfo(e)}}},{key:"componentDidUpdate",value:function(e){var t=ee.a.parse(this.props.location.search,{ignoreQueryPrefix:!0}).resourceid;t!==ee.a.parse(e.location.search,{ignoreQueryPrefix:!0}).resourceid&&(t.includes("https://scta.info/")?this.handleUpdateUrlResource(t.replace("https://scta.info/","http://scta.info/")):this.getInfo(t))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(te.a,null,r.a.createElement("title",null,this.state.resourceTitle),r.a.createElement("link",{rel:"schema.DC",href:"http://purl.org/dc/elements/1.1/"}),r.a.createElement("link",{rel:"schema.DCTERMS",href:"http://purl.org/dc/terms/"}),r.a.createElement("link",{rel:"schema.BIB",href:"http://purl.org/net/biblio#"}),"codex"===e.state.displayType?r.a.createElement("meta",{name:"BIB.type",content:"Manuscript"}):r.a.createElement("meta",{name:"DC.type",content:"document"}),r.a.createElement("meta",{name:"DC.identifier",content:this.state.resourceid}),r.a.createElement("meta",{name:"DC.title",content:this.state.resourceTitle}),r.a.createElement("meta",{name:"DC.creator",content:this.state.authorTitle}),r.a.createElement("meta",{name:"DC.Language",content:"la"}),r.a.createElement("meta",{name:"DC.Publisher",content:"SCTA"})),"personList"===e.state.displayType?r.a.createElement(kt,{resourceTypeId:"http://scta.info/resource/person"}):"codexList"===e.state.displayType?r.a.createElement(kt,{resourceTypeId:"http://scta.info/resource/codex"}):"expressionTypeList"===e.state.displayType?r.a.createElement(kt,{resourceTypeId:"http://scta.info/resource/expressionType"}):"person"===e.state.displayType?r.a.createElement(Ct,{resourceid:e.state.resourceid,resourceType:"person",handleUpdateUrlResource:e.handleUpdateUrlResource}):"article"===e.state.displayType?r.a.createElement(St,{doc:e.state.articleDoc,articleType:e.state.articleType}):"workGroup"===e.state.displayType?r.a.createElement(Ct,{resourceid:e.state.resourceid,resourceType:"workGroup",handleUpdateUrlResource:e.handleUpdateUrlResource}):"collection"===e.state.displayType?r.a.createElement(Ct,{resourceid:e.state.resourceid,expressionid:e.state.expressionid,transcriptionid:e.state.transcriptionid,resourceType:"collection",handleUpdateUrlResource:e.handleUpdateUrlResource}):"item"===e.state.displayType?e.state.itemTranscriptionId?r.a.createElement(Ct,{resourceid:e.state.resourceid,expressionid:e.state.expressionid,transcriptionid:e.state.transcriptionid,tokenRange:e.state.tokenRange,itemTranscriptionId:e.state.itemTranscriptionId,handleUpdateUrlResource:e.handleUpdateUrlResource}):r.a.createElement("p",null,"Apologies, no transcriptions of this text are currently available."):"codex"===e.state.displayType||"surface"===e.state.displayType||"canvas"===e.state.displayType||"manifest"===e.state.displayType?r.a.createElement(Ct,{resourceid:e.state.resourceid,resourceType:"codex",codexResourceType:e.state.displayType,handleUpdateUrlResource:e.handleUpdateUrlResource}):"expressionType"===e.state.displayType?r.a.createElement(Ct,{resourceid:e.state.resourceid,resourceType:"expressionType",handleUpdateUrlResource:e.handleUpdateUrlResource}):"notFound"===e.state.displayType?r.a.createElement("p",null,"Apologies, this resource could not be found"):null)}}]),n}(r.a.Component);var It=function(){return r.a.createElement("div",{className:"About"},r.a.createElement("h1",null,"About"))};var Lt=function(){var e=Object(d.b)().t;return r.a.createElement(pt.a,{bg:"dark",variant:"light",expand:"lg",fixed:"top"},r.a.createElement(Ae.a,null,r.a.createElement(o.c,{className:"nav-link",to:"/"},e("Title"))),r.a.createElement(pt.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(pt.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Ae.a,null,r.a.createElement(o.c,{className:"nav-link",to:"/res?resourceid=http://scta.info/resource/scta"},e("Texts")),r.a.createElement(o.c,{className:"nav-link",to:"/res?resourceid=http://scta.info/resource/person"},e("People")),r.a.createElement(o.c,{className:"nav-link",to:"/res?resourceid=http://scta.info/resource/codex"},e("Codices"))),r.a.createElement(Ae.a,null,r.a.createElement("a",{className:"nav-link",href:"https://scta.info/donate"},e("Donate")))))};var jt=function(){var e=Object(d.b)().t;return r.a.createElement(pt.a,{bg:"light",variant:"light",expand:"lg",fixed:"bottom",style:{zIndex:"1"}},r.a.createElement(pt.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(pt.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Ae.a,{style:{display:"flex",justifyContent:"space-around",width:"100%"}},r.a.createElement(Ae.a.Link,{href:"http://github.com/lombardpress/lombardpress-webjs"},"Lbp-Web.js"),r.a.createElement(Ae.a.Link,{href:"http://lombardpress.org"},e("A LombardPress Publication")),r.a.createElement(Ae.a.Link,{href:"http://scta.info"},e("Powered by SCTA Data")," "),r.a.createElement(Ae.a.Link,{href:"http://jeffreycwitt.com"},e("Designed by Jeffrey C Witt")))))},Nt=(n(274),n(275),function(){return r.a.createElement(a.Suspense,{fallback:r.a.createElement(P,null)},r.a.createElement(o.a,{forceRefresh:!1},r.a.createElement("div",null,r.a.createElement(Lt,null),r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/",exact:!0,component:m}),r.a.createElement(l.a,{path:"/res",exact:!0,component:Rt}),r.a.createElement(l.a,{path:"/text",exact:!0,component:Rt}),r.a.createElement(l.a,{path:"/about",exact:!0,component:It}),r.a.createElement(l.a,{path:"/search",exact:!0,component:Q}),r.a.createElement(l.a,{path:"/osd",exact:!0,component:Ee})),r.a.createElement(jt,null))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Pt=n(72),Ft=n(108),At=n(109);Pt.a.use(Ft.a).use(At.a).use(d.a).init({fallbackLng:"en",debug:!0,interpolation:{escapeValue:!1}});Pt.a;i.a.render(r.a.createElement(Nt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[110,1,2]]]);
//# sourceMappingURL=main.547af6c3.chunk.js.map