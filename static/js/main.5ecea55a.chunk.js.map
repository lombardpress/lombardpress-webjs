{"version":3,"sources":["components/config.js","components/Home.js","components/utils.js","components/Spinner.js","reducers/searchExpressionsListReducer.js","actions/searchExpressionsListActions.js","reducers/searchAuthorsListReducer.js","actions/searchAuthorsListActions.js","reducers/searchWorkGroupsListReducer.js","actions/searchWorkGroupsListActions.js","reducers/searchExpressionTypesListReducer.js","components/Search3Parameters.js","actions/searchExpressionTypesListActions.js","components/searchUtils.js","components/Search3.js","queries/questionTitleQuery.js","components/Print.js","components/Queries.js","components/TextOutline.js","components/TextOutlineWrapper.js","components/OSDInstance.js","components/Image.js","components/LineText.js","components/ImageTextWrapper.js","components/ImageLogo.js","components/Surface2.js","components/XmlView.js","components/Window/WindowNavBar.js","components/NextPrevBar.js","components/TextCompareItem.js","components/TextCompare.js","queries/ngramRelatedQuery.js","components/NgramDisplay.js","components/TextCompareWrapper.js","components/PersonInfo.js","queries/personInfoQuery.js","components/Comments2TagSuggestions.js","components/Comment2Create.js","components/Comment2Item.js","components/Comments2ImportExport.js","firebase/firebase.js","components/Comments2.js","components/Citation.js","components/CitationExplanation.js","components/ManifestationList.js","components/CitationWrapper.js","components/CodexToc.js","components/TextPreviewWrapper.js","queries/TextPreviewWrapperQueries.js","components/SurfaceInfo.js","queries/SurfaceInfoQuery.js","components/WorkGroupInfo.js","components/Dictionary.js","components/Window/WindowUtil.js","components/Window/Window2.js","components/MemberBanner.js","components/TextNavBar.js","components/Text.js","components/Item.js","components/AuthorCollection.js","components/VersionChain.js","components/Collection.js","components/Surface3.js","components/Surface3Wrapper.js","components/Codex.js","components/ExpressionType.js","queries/expressionTypeQuery.js","components/TextWrapper.js","components/TextArticle.js","components/ResourceTypeList.js","queries/resourceTypeQuery.js","components/TextSwitch.js","components/About.js","components/LoginPage.js","components/NavBar.js","components/Footer.js","components/AppRouter.js","serviceWorker.js","i18n.js","index.js"],"names":["sparqlEndpoint","Home","props","t","useTranslation","console","log","className","Container","id","fluid","Jumbotron","Button","to","style","color","loadXMLDoc","url","Promise","resolve","req","XMLHttpRequest","open","XSLTProcessor","responseType","e","onload","this","responseXML","send","convertXMLDoc","xmlurl","xslurl","reject","all","then","data","xsltProcessor","importStylesheet","resultDocument","transformToFragment","document","reason","Error","copyToClipboard","string","dummy","createElement","body","appendChild","value","select","execCommand","removeChild","runQuery","query","Axios","get","params","scrollToParagraph","hash","highlight","element","$","addClass","removeClass","children","includes","setTimeout","length","stop","animate","scrollTop","offset","top","nodeFilterCheck","node","check","parentElement","NodeFilter","FILTER_REJECT","nodeValue","FILTER_ACCEPT","cleanText","selectedText","replace","getInstanceNumber","wordArray","wordPosition","number","i","getStringBeforeWord","text","word","instanceNumber","first","splitText","split","join","goToGitHubEdit","selectedElementTargetId","newRawUrl","d","findElement","newLineCount","afterText","regexp","RegExp","getLineNumber","editUrl","window","textReduce","wordRange","wordTokenStart","wordTokenEnd","filter","Boolean","slice","Spinner","animation","role","variant","searchExpressionsListReducer","state","action","type","expressions","fetchExpressionsList","searchParameters","dispatch","workGroupSparql","searchWorkGroup","expressionAuthorTypeSparql","expressionAuthorType","authorSparql","searchAuthor","res","searchWorks","results","bindings","map","result","expression","expressionShortId","expressionTitle","workGroup","workGroupTitle","author","authorTitle","searchAuthorsListReducer","authors","fetchAuthorsList","authorShortId","completeAuthorsFetch","searchWorkGroupsListReducer","workGroups","fetchWorkGroupsList","authorQuery","completeWorkGroupsListFetch","searchExpressionTypesListReducer","expressionTypes","Search3Parameters","useState","searchType","setSearchType","searchTerm","setSearchTerm","setSearchAuthor","searchEid","setSearchEid","searchEType","setSearchEType","setSearchWorkGroup","resultsFilter","setResultsFilter","useReducer","searchExpressionTypesList","searchExpressionTypesListDispatch","searchExpressionsList","searchExpressionsListDispatch","searchAuthorsList","searchAuthorsListDispatch","searchWorkGroupsList","searchWorkGroupsListDispatch","displayAllParameters","setDisplayAllParameters","availableFigureTagsList","sort","useEffect","handleSetSearchParameters","searchExpressionsListActions","searchAuthorsListActions","searchWorkGroupsListActions","expressionType","expressionTypeTitle","completeExpressionTypesListFetch","searchExpressionTypesListActions","InputGroup","size","Prepend","Text","Form","Control","as","placeholder","onChange","target","ft","content","key","showAdvancedParameters","onClick","retrieveSearchResults","searchETypeId","workGroupShortId","expressionTypeShortId","queryParameters","push","displayTextResults","idTitleMap","textResults","r","textString","previous","hit","next","range","start","end","longTitle","pid","dangerouslySetInnerHTML","__html","displayQuestionResults","displayResults","resource","qtitle","toLowerCase","toUpperCase","Search3","setSearchParameters","setResults","questionResults","setQuestionResults","setIdTitleMap","setOffset","showMore","setShowMore","filterQuestionResults","filterResults","getValueLongTitlesAndAuthors","forEach","b","createIdTitleMap","Array","isArray","moreResults","handleRunSearch","preventDefault","workGroupQuery","expressionTypeQuery","eidQuery","questionTitleQuery","newResults","combinedString","hidden","onSubmit","parameters","showLabels","showSubmit","marginRight","figureResults","imgurl","src","alt","displayFigureResults","defaultProps","Print","getPdf","bind","status","pdf","printApiUrlBase","hashWithExtension","setState","Status","prevProps","newUrl","width","height","href","React","Component","basicInfoQuery","itemExpressionUri","partsInfoQuery","resourceurl","getSurfaceInfo","surfaceid","getCodexInfo","codexid","getCodexInfoFromManifest","manifestid","getCodexInfoFromSurface","getCodexInfoFromCanvas","canvasid","TextOutline","handleToggleChildren","mounted","parts","showChildren","isPartOf","prevState","resourceid","getChildParts","newData","part","title","level","structureType","questionTitle","isPartOfId","isPartOfTitle","retrieveParts","membersOf","displayChildren","p","bold","focusResourceid","showFirstLevelChildren","mtFocus","showAuthor","collectionLink","showParentLink","indent","rel","TextOutlineWrapper","getMembersOf","memberOf","retrieveMembersOf","OSDInstance","instance","setInstance","w","h","viewerWidthHeight","setViewerWidthHeight","uuidv4","viewerId","coords","computeViewerWidthHeight","imageurl","addTiledImage","tileSource","sc","getScalarCoordinates","rect","OpenSeadragon","Rect","x","y","setBounds","setOverlay","lineFocusCoords","lsc","linerect","setGoHome","viewport","fitBounds","prefixUrl","preserveViewport","visibilityRatio","minZoomLevel","defaultZoomLevel","tileSources","controlsFadeDelay","controlsFadeLength","addHandler","elt","addOverlay","location","goHome","inputCoords","imageH","imageW","ar","parseInt","displayWidth","Image","imageUrl","LineText","label","ImageTextWrapper","searchText","targetLabel","canvas","canvasShort","ImageLogo","logoUrl","setLogoUrl","logo","catch","error","margin","Surface2","mount","handleNext","handlePrevious","handleLineFocusNext","handleLineFocusPrev","isLineNumberLast","isLineNumberFirst","handleToggleTextLines","handleToggleAllLines","currentSurfaceId","manifest","region","annotationsDisplay","showAllLines","handleSurfaceFocusChange","alUrl","d2","surfaceTitle","next_surface","previous_surface","annotations","resources","currentLineNumber","lineFocusId","newLineArray","pop","toString","handleLineFocusChange","previousLineArray","total","retrieveSurfaceInfo","displayImage","chars","on","surfaceButton","imageTextWrappers","displayImages","XmlView","retrieveXML","xmlstring","tresourceid","language","docco","showLineNumbers","WindowNavBar","Nav","availableTabs","idx","show","Item","name","Link","active","windowLoad","desc","handleTabChange","windowId","icon","openWidthHeight","handleMinimize","handleMiddlize","handleMaximize","handleClose","altWindowState","handleDuplicateWindow","windowType","NextPrevBar","customResourceTarget","setCustomResourceTarget","showCustomResourceTarget","setShowCustomResourceTarget","handleUpArrow","selectionRange","handleBlockFocusChange","info","parent","topLevel","display","justifyContent","FormControl","onKeyPress","charCode","handleFocusChange","handelOnEnterPress","TextCompareItem","handleToggleShow","handleToggleCompare","showCompare","showCompareType","compareText","rawText","levenshteinDistance","undefined","usedBase","usedCompareTranscription","showImage","punctuationless","base","transcription","reducedText","isMainText","targetRange","relationLabel","isRelatedToRange","dmp","Diff","diff_match_patch","diff","diff_main","textClean","diff_cleanupSemantic","diff_levenshtein","compareDisplayHtml","getHtmlDiff","compare","diff_prettyHtml","compareTranscription","showImages","createCompare","newManifestations","manifestation","manifestationTitle","manifestations","focusedManifestation","surfaceWidth","hideSelectionList","isDependentSurface3","startWord","endWord","isBase","levenNum","heatColor","borderLeft","paddingLeft","handleChangeBase","compareTranscriptionDoc","fontSize","ref","displayComparison","TextCompare","handleToggleShowAll","handleToggleShowAllImages","baseText","manifestationCTranscription","transcriptionDoc","manifestationCTranscriptionDoc","inbox","cdoc","cxml","topLevelExpression","cmanifestation","ctranscription","arrangeTextInfo","getTextInfo","expressionid","relatedExpressions","padding","referringResource","handleShowCollationOverlay","fullEid","handleAddCtRelatedExpressions","m","runNgramQuery","createExpressionsList","count","NgramDisplay","setRelatedExpressions","intersectionTotal","setIntersectionTotal","tokenizedText","ngramArray","ngramId","ngramIds","ngramFragmentQuery","ngramRelatedQuery","displayExpressions","index","marked","markedExpressions","find","parentBlock","marginLeft","TextCompareWrapper","handleCustomUpdateRelatedExpressions","handleSetCustomExpressionId","handleToggleAllChildren","handleToggleAllChildrenImages","getText","expressionsCumulative","page","intendedPage","pagesize","nextPage","previousPage","rangeStart","rangeEnd","customExpressionId","customExpressionObject","showAllChildren","showAllChildrenImages","expressionObject","newExpressions","_this","rangeFilter","getRelatedExpressions","bindings2","isRelatedTo","isRelatedToRangeStart","isRelatedToRangeEnd","concat","startPage","newExpression","displayPagination","Object","keys","inline","PersonInfo","setAuthorTitle","authorImageUrl","setAuthorImageUrl","authorDescription","setAuthorDescription","birthDate","setAuthorBirthDate","deathDate","setAuthorDeathDate","mentionedByFrequency","setMentionedByFrequency","mentionsFrequency","setMentionsFrequency","personid","pd","personTitle","wikidataid","getWikiDataInfo","fd","sortFrequencyResults","item","getPersonMentionsFrequency","a","nameA","nameB","wikidataShortId","wd","imageslug","entities","claims","P18","mainsnak","datavalue","description","descriptions","P569","time","P570","d3","pages","imageinfo","Comments2TagSuggestions","tags","tagFilter","setTagFilter","handleOnClickTag","placeHolderText","tagsList","Comment2Create","comment","setComment","motivation","setMotivation","editedTextDefault","textEdited","editedText","setEditedText","noTarget","setNoTarget","orderNumber","inputTags","setInputTags","rows","checked","newInputTags","ot","handleDropTag","availableTagsList","commentType","submitComment","block","Comment2Item","editable","setEditable","source","selectedFragment","selectedFragmentRange","selector","exact","editedValue","getTagOrderNumber","annoid","annoShortId","order","update","updateComment","tagsWithOrder","fullTag","getTagsWithOrderNumbers","link","match","strings","l","linkComponent","linkCopy","prunedString","addSCTALinksToValue","created","removeComment","ImportExport","newListUrl","setNewListUrl","showImport","setShowImport","pdfStatus","setPdfStatus","handleGetPdfStatus","post","printApiEndpoint","currentList","reader","FileReader","readAsText","files","fileName","list","handleImportList","JSON","parse","stringify","encodeURI","packageData","download","currentListName","Date","toISOString","firebase","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","db","googleAuthProvider","GoogleAuthProvider","Comments2","lists","setLists","filterTags","setFilterTags","setAnnotations","setTags","showFocusComments","setShowFocusComments","commentFilter","setCommentFilter","mentionedBy","setMentionedBy","userId","setUserId","tagsToDelete","setTagsToDelete","showManageTags","setShowManageTags","once","snapshot","dbResult","val","generateTagList","akey","tagsPerComment","tagsOrderMap","tagid","tagsNewList","nt","generateAnnoTagBlock","tagsBlock","prefixedId","handleAddSingleFilterTag","clonedAnnotations","affectedTags","clonedTags","at","targetComment","getMentionedBy","c","set","generateFullList","fullList","newAnnotations","every","k","annoId","dateObject","annotation","esource","annotationsNewList","textEdit","disabled","newFilterTags","handleDropFilterTag","displayComments","focused","handleOnClickComment","newTagsToDelete","handleDropTagToDelete","tagsToRemove","modifiedAnnos","annosToModify","alert","handleRemoveTags","Comments2ImportExport","listname","parsedList","Citation","eurl","etitle","murl","mtitle","turl","fetching","transcriptionid","allBindings","manifestationid","eLongTitle","editorTitle","editor","datasource","codexTitle","retrieveCitation","fullCitationString","CitationExplanation","toggleCitationExplanation","showCitationExplanation","ManifestationList","toggleAlternativeManifestations","showAlternativeManifestations","optionalDisplay","displayManifestations","propTypes","PropTypes","isRequired","array","bool","func","CitationWrapper","CodexToc","items","setItems","codexResourceType","surface","unique","v","indexOf","expressionList","item_expression_title","surface_title","item_expression_question_title","displayItems","TextPreviewWrapper","handleToggleShowTokenPosition","showTokenPosition","textPreviewResourceId","getTranscriptionId","textPreviewStart","textPreviewEnd","referringRange","referringSelectionRange","handleTextPreviewFocusChange","context","SurfaceInfo","handleToggleRelatedDiscussion","handleSurface3Manifestations","handleToggleShowQuery","handleToggleShowImages","surfaceMap","showTextRegion","showQuery","eid","codexSlug","surface3FocusedManifestation","surface3Manifestations","showComments","showRelatedSurfaces","mShort","handleToggleRelatedSurfaces","WorkGroupInfo","Dictionary","dictionary","getAvailableComponents","resourceType","showComponents","Window2","handleToggleTextLinesView","handleChangeManifestation","mountStatus","textCompare","surface3","comments","xml","search","textOutline","citation","collationTableWithRange","view","manifestationSlug","newMountStatus","tempNewMount","focus","handleSwitchWindow","focusSet","displayComponents","getAvailableTabs","defaultManifestationSlug","itemFocus","textPreviewObjects","expressionIds","ctRelatedExpressions","handleOnSegDoubleClick","displayChild","MemberBanner","ipAddress","setIpAddress","ipAddressRange","setIpAddressRange","getIp","ip","ipRangeLogoMap","memberInfo","indexValue","Math","floor","random","keyValue","getMemberInfo","linkUrl","withTranslation","Navbar","bg","expand","fixed","Toggle","aria-controls","Collapse","pdfView","handleTogglePdfView","retrieveText","handleShowToolTip","handleHideToolTip","handleHideFootnoteToolTip","handleShowFootnoteToolTip","handleOnToolTipClick","selectionCoords","doc","scrollTo","docFragment","topLevelFragment","getElementById","innerHTML","setEvents","mark","sel","getSelection","rangeCount","rng","getRangeAt","pAncestor","nodeType","tagName","getContainingP","commonAncestorContainer","cnt","cloneContents","remove","textContent","clone","startOffset","startContainer","selectionText","precedingTextLength","n","getRangeWordCount","root","endContainer","endOffset","ownerDocument","createRange","setStart","setEnd","oRect","getBoundingClientRect","click","attr","setFocus","openWindow","markWithElement","figureid","paragraphid","closest","ln","html","footnoteOffset","footnoteText","targetText","targetParagraph","splitTargetId","splitTargetRange","targetObjects","addEventListener","markElementRemove","container","startWordOffset","endWordOffset","nodeIter","createNodeIterator","SHOW_TEXT","breaks","wordLength","nextNode","previousSibling","getAttribute","nodeTextArray","newWordLength","toRange","extractContents","backgroundColor","insertNode","handleUpdateSelectionRange","contents","unwrap","s","ReactTooltip","hide","fooRef","foonoteRef","scrollToNew","displayText","position","left","data-tip","data-for","clickable","place","AuthorCollection","retrieveAuthorCollectionInfo","handleItemFilter","itemFilter","createRef","authorArticles","textArticles","itemsPromise","textArticle","err","authorCollectionInfo","arrangeItems","refs","Table","striped","bordered","hover","VersionChain","getVersionHistory","handleToggleShowVersions","versions","currentVersion","showVersions","transcriptionUri","reviewUrl","reviewObject","img_url","reviewid","ipfsHash","html_link","rubric_link","summary","newVersion","versionTranscription","version","versionLabel","version_label","versionOrderNumber","order_number","versionReview","review","versionDoc","versionReviewInfo","Alert","currentlyViewing","gitHubEdit","gitHubIssues","displayAlert","Collection","retrieveCollectionInfo","makeRequests","handleFilter","partsPromise","partsObject","pId","partTitle","partType","partQuestionTitle","partLevel","itemsObject","itemId","itemTitle","itemType","itemQuestionTitle","itemAuthor","itemAuthorTitle","cm","cmTitle","ct","expressionsInfo","partsInfo","arrangeParts","collectionInfo","newResourceId","retrieveWorkGroupInfo","Row","Col","xs","Surface3","surfaces","d1","z","firstLine","lastLine","last","newSurface","fl","flcanvas","flcanvasShort","flcoords","ll","llcoords","lly","llh","llbottom","Surface3Wrapper","handleGetCustomManifestations","handleChangeCustomManifestation","userAddedExpressionId","userAddedManifestations","focusedCustomManifestation","hideDisplayChoice","marginTop","Codex","retrieveCodexInfo","handleToggleShowContents","focusedSurface","relatedCodices","showContents","handleSetFocus","surfaceFocus","ExpressionType","setExpressions","expressionTypeId","TextWrapper","setFocus2","windows","window1","window2","blockFocus","altWindowId","expressionId","fullid","handleUpdateUrlResource","newid","arrangeFocusInfo","arrangeItemFocusInfo","itemFocusInfo","retrieveFocusInfo","mFocus","tFocus","itemTranscriptionId","setItemFocus","tokenRange","textClassNames","resourceTitle","TextArticle","articleType","toggleClass","noteDisplay","ResourceTypeList","setResources","setFilter","resourceTypeId","TextSwitch","displayType","blockDivFocus","history","attemptNumber","itemParent","getArticleTranscriptionDoc","articleDoc","getItemTranscriptionFromBlockDiv","blockDivExpression","secondTryResourceId","Qs","ignoreQueryPrefix","getInfo","Helmet","About","LoginPage","user","displayName","userDisplayName","setUserDisplayName","photoURL","userPicture","setPicture","auth","signOut","signInWithPopup","additionalUserInfo","profile","picture","NavBar","borderBottom","flexGrow","Footer","AppRouter","uid","fallback","forceRefresh","path","render","hostname","i18n","use","Backend","LanguageDetector","initReactI18next","init","fallbackLng","debug","interpolation","escapeValue","renderApp","ReactDOM","onAuthStateChanged","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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GAwB7B,MAvBe,CACZ,gMACA,IACE,SAAWA,EAAU,kBACrB,gEACA,aACA,6DACA,iEACA,+DACA,8DACA,oEACA,oEACA,uGACA,+EACA,6EACA,+EACA,2DACA,aACG,0FACF,IACF,IACD,IACA,2BAA2B1M,KAAK,IAG9B,SAAS2M,GAAyBC,GAyBtC,MAxBY,CACZ,gMACA,IACE,4DAA8DA,EAAa,MAC3E,4DACA,gEACA,aACA,6DACA,iEACA,+DACA,8DACA,oEACA,oEACA,uGACA,+EACA,6EACA,+EACA,2DACA,aACG,0FACF,IACF,IACD,IACA,2BAA2B5M,KAAK,IAI1B,SAAS6M,GAAwBL,GAwBxC,MAvBe,CACZ,gMACA,IACE,kDAAoDA,EAAY,MAChE,gEACA,aACA,6DACA,iEACA,+DACA,8DACA,oEACA,oEACA,uGACA,+EACA,6EACA,+EACA,2DACA,aACG,0FACF,IACF,IACD,IACA,2BAA2BxM,KAAK,IAI9B,SAAS8M,GAAuBC,GA0BpC,MAzBY,CACZ,8MACA,IACE,yDAA2DA,EAAW,MACtE,yEACA,gEACA,gEACA,aACA,6DACA,iEACA,+DACA,8DACA,oEACA,oEACA,uGACA,+EACA,6EACA,+EACA,2DACA,aACG,0FACF,IACF,IACD,IACA,2BAA2B/M,KAAK,I,IC9oBvBgN,G,kDArOb,WAAYhT,GAAO,IAAD,8BAChB,cAAMA,IACDiT,qBAAuB,EAAKA,qBAAqB5B,KAA1B,gBAC5B,EAAK6B,QAAU,GACf,EAAKzL,MAAQ,CACX0L,MAAO,GACPC,cAAc,EACdC,SAAU,IAPI,E,wDAelB,SAAqB9R,GACnBA,EAAEyO,iBACFvO,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAACF,cAAeE,EAAUF,mB,2BAGrC,SAAcG,GAAY,IAAD,OAELnQ,ED4mBZ,SAAuBmQ,GA6CzB,MA5CY,CACZ,iHACA,IACE,IAAMA,EAAa,gDACnB,yDACA,aACE,iDAAmDA,EAAa,MAChE,qEACF,IACA,aACE,8DACA,iEACF,IACA,WACA,IACA,mDACA,IACA,WACA,IACA,mEACA,IACA,WACA,IACE,IACE,gEACF,IACA,QACA,IACE,gEACA,iEACA,iEACF,IACA,QACA,IACE,gEACA,iEACF,IACF,IACA,WACA,IACA,mEACA,IACF,IACA,gCAAgCvN,KAAK,ICxpBdwN,CAAcD,IAC/BtR,MAAK,SAACC,GAOd,IAAMuR,EAAUvR,EAAKA,KAAKsG,QAAQC,SAASC,KAAI,SAACtC,GAE9C,MAAO,CACLsN,KAAMtN,EAAEsN,KAAK1Q,MACb2Q,MAAOvN,EAAEuN,MAAM3Q,MACf4Q,MAAOxN,EAAEwN,MAAQxN,EAAEwN,MAAM5Q,MAAQ,GACjCiG,OAAQ7C,EAAE6C,OAAS7C,EAAE6C,OAAOjG,MAAQ,GACpCkG,YAAa9C,EAAE8C,YAAc9C,EAAE8C,YAAYlG,MAAQ,GACnD6Q,cAAezN,EAAEyN,cAAgBzN,EAAEyN,cAAc7Q,MAAQ,GACzD8Q,cAAe1N,EAAE0N,cAAgB1N,EAAE0N,cAAc9Q,MAAQ,OAIzDqQ,EAAW,CAACU,WAAY,GAAIC,cAAe,IAC3C9R,EAAKA,KAAKsG,QAAQC,SAAS,IACzBvG,EAAKA,KAAKsG,QAAQC,SAAS,GAAG4K,WAClCA,EAASU,WAAa7R,EAAKA,KAAKsG,QAAQC,SAAS,GAAG4K,SAASrQ,MAC7DqQ,EAASW,cAAgB9R,EAAKA,KAAKsG,QAAQC,SAAS,GAAGuL,cAAchR,OAKnE,EAAKkQ,SACP,EAAKxB,SAAS,CAACyB,MAAOM,EAASJ,SAAUA,S,+BAI/C,WAEE5R,KAAKyR,SAAU,EACfzR,KAAKwS,cAAcxS,KAAKzB,MAAMuT,YAE1B9R,KAAKzB,MAAMkU,WACTzS,KAAKzB,MAAMkU,UAAUjQ,SAASxC,KAAKzB,MAAMuT,aAC3C9R,KAAKiQ,SAAS,CAAC0B,cAAc,M,gCAsBnC,SAAmBxB,GACbnQ,KAAKzB,MAAMuT,aAAe3B,EAAU2B,YACtC9R,KAAKwS,cAAcxS,KAAKzB,MAAMuT,YAE5B9R,KAAKzB,MAAMuT,aAAe3B,EAAU2B,YAAc9R,KAAKzB,MAAMkU,YAActC,EAAUsC,WACnFzS,KAAKzB,MAAMkU,WACTzS,KAAKzB,MAAMkU,UAAUjQ,SAASxC,KAAKzB,MAAMuT,aAC3C9R,KAAKiQ,SAAS,CAAC0B,cAAc,M,kCASrC,WACE3R,KAAKyR,SAAU,I,oBAEjB,WAAS,IAAD,OACAiB,EAAkB,WA+BtB,OA9Bc,EAAK1M,MAAM0L,MAAMzK,KAAI,SAAC0L,GAClC,IAAIC,EAAO,GAOX,OANI,EAAKrU,MAAMkU,YACT,EAAKlU,MAAMkU,UAAUjQ,SAASmQ,EAAEV,OAASU,EAAEV,OAAS,EAAK1T,MAAMsU,mBACjED,EAAO,QAIJ,kBAACrB,EAAD,CACPqB,KAAMA,EACNtH,IAAKqH,EAAEV,KACPY,gBAAiB,EAAKtU,MAAMsU,gBAC5BlB,aAAc,EAAK3L,MAAM2L,aACzBmB,wBAAwB,EACxBhB,WAAYa,EAAEV,KACdC,MAAOS,EAAET,MACTC,MAAOQ,EAAER,MACT3K,OAAQmL,EAAEnL,OACVC,YAAakL,EAAElL,YACf2K,cAAeO,EAAEP,cACjBK,UAAW,EAAKlU,MAAMkU,UACtBJ,cAAeM,EAAEN,cACjBU,QAAS,EAAKxU,MAAMwU,QACpBC,WAAY,EAAKzU,MAAMyU,WACvBC,eAAoC,kDAApBN,EAAEP,eAAoE,EAAK7T,MAAM0U,eACjGC,gBAAgB,QAOdC,EAA4B,EAAnBnT,KAAKzB,MAAM4T,MAC1B,OACE,yBAAKrT,GAAG,UAAUK,MAAO,CAAC,YAAegU,EAAS,OAChD,uBAAGvU,UAAWoB,KAAKzB,MAAMqU,MACvB5S,KAAKgG,MAAM4L,SAASU,YAActS,KAAKzB,MAAM2U,gBAAmB,kBAAC,IAAD,CAAMhU,GAAI,oBAAsBc,KAAKgG,MAAM4L,SAASU,YAAY,kBAAC,KAAD,OAChItS,KAAKzB,MAAMiJ,QAAUxH,KAAKzB,MAAMyU,YAAmC,MAArBhT,KAAKzB,MAAM4T,OACzD,8BACE,8BAAOnS,KAAKzB,MAAMkJ,YAAlB,MACA,kBAAC,IAAD,CAAMvI,GAAI,oBAAsBc,KAAKzB,MAAMiJ,QAAQ,kBAAC,KAAD,QAGtDxH,KAAKzB,MAAM2T,MACXlS,KAAKzB,MAAM8T,eAAiB,mCAASrS,KAAKzB,MAAM8T,gBAE/CrS,KAAKzB,MAAMuU,wBACb,oCACE9S,KAAKgG,MAAM0L,MAAMhP,OAAS,IAAM1C,KAAKgG,MAAM2L,cAAiB,0BAAM/S,UAAU,eAAe4M,QAASxL,KAAKwR,sBAAsB,kBAAC,KAAD,OAC/HxR,KAAKgG,MAAM0L,MAAMhP,OAAS,GAAK1C,KAAKgG,MAAM2L,cAAiB,0BAAM/S,UAAU,eAAe4M,QAASxL,KAAKwR,sBAAsB,kBAAC,KAAD,QAK/HxR,KAAKzB,MAAMuT,YAAc,kBAAC,IAAD,CAAM5S,GAAI,oBAAsBc,KAAKzB,MAAMuT,WAAa9R,KAAKzB,MAAMwU,SAAU,kBAAC,KAAD,OACtG/S,KAAKzB,MAAM0U,gBAAkB,uBAAG1C,KAAM,wCAA0CvQ,KAAKzB,MAAMuT,WAAY3G,OAAO,SAASiI,IAAI,uBAA9F,IAAqH,yBAAK7D,IAAI,kBAAkBpQ,MAAO,CAACkR,MAAO,OAAQC,OAAQ,QAAShB,IAAI,uDAEzNtP,KAAKzB,MAAMuU,wBAA6C9S,KAAKgG,MAAM2L,eAA/Be,S,GAtKnBlC,IAAMC,WCmFjB4C,G,kDAlFb,WAAY9U,GAAO,IAAD,8BAChB,cAAMA,IACDkT,QAAU,GACf,EAAKzL,MAAQ,CACXyM,UAAW,IAJG,E,qDAOlB,SAAkBX,GAAY,IAAD,OACLnQ,EF2qBf,SAAsBmQ,GAMxB,MALY,CACZ,mBACA,IACE,IAAMA,EAAa,wDACrB,KAAKvN,KAAK,IEhrBgB+O,CAAaxB,IAC9BtR,MAAK,SAACC,GAClB,IAAMuR,EAAUvR,EAAKA,KAAKsG,QAAQC,SAASC,KAAI,SAACtC,GAC9C,OAAOA,EAAE4O,SAAShS,SAEhB,EAAKkQ,SACP,EAAKxB,SAAS,CAACwC,UAAWT,S,+BAIhC,WACEhS,KAAKyR,SAAU,EACfzR,KAAKwT,kBAAkBxT,KAAKzB,MAAMsU,mB,gCAEpC,SAAmB1C,GACbnQ,KAAKzB,MAAMsU,kBAAoB1C,EAAU0C,iBAC3C7S,KAAKwT,kBAAkBxT,KAAKzB,MAAMsU,mB,kCAGtC,WACE7S,KAAKyR,SAAU,I,oBAEjB,WACE,OACE,yBAAK7S,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WAE7C,kBAAC,GAAD,CACExD,IAAKtL,KAAKzB,MAAMuT,WAChBH,cAAc,EACdmB,uBAAwB9S,KAAKzB,MAAMuU,uBACnCD,gBAAiB7S,KAAKzB,MAAMsU,gBAC5Bf,WAAY9R,KAAKzB,MAAMuT,WACvBI,MAAOlS,KAAKzB,MAAM2T,MAClBC,MAAO,IACPC,cAAe,gDACfK,UAAWzS,KAAKgG,MAAMyM,UACtBM,QAAS/S,KAAKzB,MAAMwU,QACpBE,eAAgBjT,KAAKzB,MAAM0U,eAC3BD,WAAYhT,KAAKzB,MAAMyU,WACvBE,eAAgBlT,KAAKzB,MAAM2U,sB,GAhDJ1C,IAAMC,W,wCCLjCgD,GAAc,SAAClV,GACnB,MAAgCgK,qBAAhC,mBAAOmL,EAAP,KAAiBC,EAAjB,KACA,EAAkDpL,mBAAS,CAAEqL,EAAG,GAAIC,EAAG,KAAvE,mBAAOC,EAAP,KAA0BC,EAA1B,KACA,EAAmBxL,mBAASyL,QAArBC,EAAP,oBACAhK,qBAAU,WACJ1L,EAAM2V,QACRH,EAAqBI,EAAyB5V,EAAM2V,OAAO5P,MAAM,KAAK,GAAI/F,EAAM2V,OAAO5P,MAAM,KAAK,OAGnG,CAAC/F,EAAM2V,SACVjK,qBAAU,WACRpI,IAAMC,IAAIvD,EAAM6V,SAAW,cAAc5T,MAAK,SAACmE,GAC7C,GAAI+O,GAKF,GAHAA,EAASW,cAAc,CACrBC,WAAY3P,EAAElE,OAEZlC,EAAM2V,OAAQ,CAGhB,IAAMK,EAAKC,EAAqBjW,EAAM2V,OAAQvP,EAAElE,KAAK6P,OAAQ3L,EAAElE,KAAK4P,OAC9DoE,EAAO,IAAIC,KAAcC,KAAKJ,EAAGK,EAAGL,EAAGM,EAAGN,EAAGX,EAAGW,EAAGV,GAGzD,GAFAiB,EAAUpB,EAAUe,GACpBM,EAAWrB,EAAUe,GACjBlW,EAAMyW,gBAAgB,CACxB,IAAMC,EAAMT,EAAqBjW,EAAMyW,gBAAiBrQ,EAAElE,KAAK6P,OAAQ3L,EAAElE,KAAK4P,OACxE6E,EAAW,IAAIR,KAAcC,KAAKM,EAAIL,EAAGK,EAAIJ,EAAGI,EAAIrB,EAAGqB,EAAIpB,GACjEkB,EAAWrB,EAAUwB,GAGvBC,EAAUzB,EAAUe,GACpBf,EAAS0B,SAASC,UAAUZ,QAG3B,CACH,IAAM3V,EAAK,OAASmV,EACdP,EAAWgB,KAAc,CAC7B5V,GAAIA,EACJwW,UAAW,sBACXC,kBAAkB,EAClBC,gBAAiB,EACjBC,aAAc,EACdC,iBAAkB,EAClBC,YAAa,CAAChR,EAAElE,MAChBmV,kBAAmB,EACnBC,mBAAoB,KAEtB,GAAItX,EAAM2V,OAAQ,CAGhB,IAAMK,EAAKC,EAAqBjW,EAAM2V,OAAQvP,EAAElE,KAAK6P,OAAQ3L,EAAElE,KAAK4P,OAC9DoE,EAAO,IAAIC,KAAcC,KAAKJ,EAAGK,EAAGL,EAAGM,EAAGN,EAAGX,EAAGW,EAAGV,GAGzD,GAFAiB,EAAUpB,EAAUe,GACpBM,EAAWrB,EAAUe,GACjBlW,EAAMyW,gBAAgB,CACxB,IAAMC,EAAMT,EAAqBjW,EAAMyW,gBAAiBrQ,EAAElE,KAAK6P,OAAQ3L,EAAElE,KAAK4P,OACxE6E,EAAW,IAAIR,KAAcC,KAAKM,EAAIL,EAAGK,EAAIJ,EAAGI,EAAIrB,EAAGqB,EAAIpB,GACjEkB,EAAWrB,EAAUwB,GAEvBC,EAAUzB,EAAUe,GAEtBd,EAAYD,SAIf,CAACnV,EAAM6V,SAAU7V,EAAM2V,SAE1B,IAAMa,EAAa,SAACrB,EAAUe,GAC5Bf,EAASoC,WAAW,QAAQ,WAC1B,IAAMhX,EAAKkV,OACL+B,EAAMjV,SAASM,cAAc,OACnC2U,EAAIjX,GAAK,mBAAqBA,EAC9BiX,EAAInX,UAAY,eAChB8U,EAASsC,WAAW,CAClB7T,QAAS4T,EACTE,SAAUxB,QAIVK,EAAY,SAACpB,EAAUe,GAC3Bf,EAASoC,WAAW,QAAQ,WAC1BpC,EAAS0B,SAASC,UAAUZ,GAAM,OAGhCU,EAAY,SAACzB,EAAUe,GAE3Bf,EAAS0B,SAASc,OAAS,WAEzBlW,KAAKqV,UAAUZ,KAGbD,EAAuB,SAAC2B,EAAaC,EAAQC,GACjD,IAAMnC,EAASiC,EAAY7R,MAAM,KAM3BgS,EAAKF,EAASC,EAKpB,MAAO,CAAEzB,EAVC2B,SAASrC,EAAO,IAMRmC,EAICxB,EATT0B,SAASrC,EAAO,IAMPkC,EAAUE,EAGA1C,EARnB2C,SAASrC,EAAO,IAMRmC,EAEqBxC,EAP7B0C,SAASrC,EAAO,IAMPkC,EAAUE,IAGzBnC,EAA2B,SAACP,EAAGC,GACnC,IAAM2C,EAAejY,EAAMiY,aAE3B,MAAO,CAAE5C,EAAG4C,EAAc3C,EADR2C,GAAgBD,SAAS1C,GAAK0C,SAAS3C,MAG3D,OACE,6BAKIrV,EAAM2V,OAAS,yBAAKpV,GAAI,OAASmV,EAAUrV,UAAU,2BAA2BO,MAAO,CAAEmR,OAAQwD,EAAkBD,EAAI,KAAMxD,MAAOyD,EAAkBF,EAAI,QACtJ,yBAAK9U,GAAI,OAASmV,EAAUrV,UAAU,2BAA2BO,MAAO,CAAEmR,OAAQ,aAO9FmD,GAAYhE,aAAe,CACzB2E,SAAU,yCACVoC,aAAc,KAUD/C,UCnGAgD,OAtCf,SAAelY,GAcb,OAEI,kBAAC,GAAD,CAAa6V,SAAU7V,EAAMmY,SAAUxC,OAAQ3V,EAAM2V,OAAQsC,aAAcjY,EAAMiY,aAAcxB,gBAAiBzW,EAAMyW,mBCT7G2B,OAVf,SAAkBpY,GAChB,OACE,yBAAKK,UAAU,OAAOO,MAAO,CAAC,WAAc,WAC3CZ,EAAMuF,QAAU,8BAAOvF,EAAMqY,MAAMtS,MAAM,KAAK,GAA9B,KAChB/F,EAAMuF,QAAU,8BAAOvF,EAAMuF,QAC9B,0BAAM8I,wBAAyB,CAACC,OAAQtO,EAAM0F,UCkCnC4S,G,kDAjCb,WAAYtY,GAAQ,IAAD,8BACjB,cAAMA,IACDyH,MAAQ,CACX8Q,WAAY,IAHG,E,0CAMnB,WASE,OACE,yBAAKlY,UAAWoB,KAAKzB,MAAMwY,cAAgB/W,KAAKzB,MAAMqY,MAAQ,0BAA4B,oBACxF,yBAAKhY,UAAU,qBACf,kBAAC,GAAD,CACE8X,SAAU1W,KAAKzB,MAAMmY,SACrBM,OAAQhX,KAAKzB,MAAMyY,OACnB9C,OAAQlU,KAAKzB,MAAM2V,OACnB+C,YAAajX,KAAKzB,MAAM0Y,YACxBT,aAAcxW,KAAKzB,MAAMiY,aACzBxB,gBAAiBhV,KAAKzB,MAAMyW,mBAG9B,kBAAC,GAAD,CAAU/Q,KAAMjE,KAAKzB,MAAM0F,KAAMH,OAAQ9D,KAAKzB,MAAMuF,OAAQ8S,MAAO5W,KAAKzB,MAAMqY,a,GA5BvDnG,aCHzByG,GAAY,SAAC3Y,GACjB,MAA8BgK,mBAAS,IAAvC,mBAAO4O,EAAP,KAAgBC,EAAhB,KAaA,OAZAnN,qBAAU,WAEJ1L,EAAM6V,UACRvS,IAAMC,IAAIvD,EAAM6V,SAAW,cAAc5T,MAAK,SAACmE,GAC7C,IAAM0S,EAAO1S,EAAElE,KAAK4W,KAAK,OACzBD,EAAWC,MACVC,OAAM,SAACC,GACR7Y,QAAQC,IAAI,gBAAiB4Y,GAC7BH,EAAW,SAGd,CAAC7Y,EAAM6V,WAER,oCAAG+C,GAAW,yBAAK7H,IAAK6H,EAAShY,MAAO,CAACqY,OAAQjZ,EAAMiZ,OAAQlH,OAAQ/R,EAAM+R,QAASf,IAAI,gBAI9F2H,GAAUzH,aAAe,CACvBa,OAAQ,OACRkH,OAAQ,OAYKN,UCvBTO,G,kDACJ,WAAYlZ,GAAO,IAAD,8BAChB,cAAMA,IACDmZ,OAAQ,EACb,EAAKC,WAAa,EAAKA,WAAW/H,KAAhB,gBAClB,EAAKgI,eAAiB,EAAKA,eAAehI,KAApB,gBACtB,EAAKiI,oBAAsB,EAAKA,oBAAoBjI,KAAzB,gBAC3B,EAAKkI,oBAAsB,EAAKA,oBAAoBlI,KAAzB,gBAC3B,EAAKmI,iBAAmB,EAAKA,iBAAiBnI,KAAtB,gBACxB,EAAKoI,kBAAoB,EAAKA,kBAAkBpI,KAAvB,gBACzB,EAAKqI,sBAAwB,EAAKA,sBAAsBrI,KAA3B,gBAC7B,EAAKsI,qBAAuB,EAAKA,qBAAqBtI,KAA1B,gBAC5B,EAAK5J,MAAQ,CACXmS,iBAAkB,GAClBC,SAAU,GACVpB,OAAQ,GACRqB,OAAQ,OACRhI,MAAO,OACP/D,KAAM,GACNF,SAAU,GACVgI,SAAU,GACVkE,oBAAoB,EACpBC,cAAc,GArBA,E,8CAyBlB,WAEEvY,KAAKzB,MAAMia,yBAAyBxY,KAAKgG,MAAMsG,Q,4BAEjD,WAEEtM,KAAKzB,MAAMia,yBAAyBxY,KAAKgG,MAAMoG,Y,mCAGjD,WAEEpM,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAACyG,oBAAqBzG,EAAUyG,yB,kCAG3C,WACEtY,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAAC0G,cAAe1G,EAAU0G,mB,iCAGrC,SAAoBxH,GAAW,IAAD,OAMRpP,EAASmP,GAAeC,IAChCvQ,MAAK,SAACmE,GAChB,IAAMsJ,EAAItJ,EAAElE,KAAKsG,QAAQC,SAAS,GAElC,GAAIiH,EAAE,CAEJ,IAAMwK,EAAQ,4GAA8G1H,EAAUzM,MAAM,cAAc,GAAK,gBAC/JzC,IAAMC,IAAI2W,GAAOjY,MAAK,SAACkY,GACjB,EAAKhB,OACL,EAAKzH,SAAS,CACZkI,iBAAkBpH,EAClB4H,aAAc1K,EAAE0K,aAAapX,MAC7B6W,SAbK,GAcLpB,OAAQ/I,EAAE+I,OAAOzV,MACjB6S,SAAUnG,EAAEmG,SAAS7S,MACrB+K,KAAM2B,EAAE2K,aAAe3K,EAAE2K,aAAarX,MAAQ,GAC9C6K,SAAU6B,EAAE4K,iBAAmB5K,EAAE4K,iBAAiBtX,MAAQ,GAC1DuX,YAAaJ,EAAGjY,KAAOiY,EAAGjY,KAAKsY,UAAY,QAGhDzB,OAAM,SAACC,GACR7Y,QAAQC,IAAI,qCAAsC4Y,GAC9C,EAAKG,OACP,EAAKzH,SAAS,CACdkI,iBAAkBpH,EAClB4H,aAAc1K,EAAE0K,aAAapX,MAC7B6W,SA3BS,GA4BTpB,OAAQ/I,EAAE+I,OAAOzV,MACjB6S,SAAUnG,EAAEmG,SAAS7S,MACrB+K,KAAM2B,EAAE2K,aAAe3K,EAAE2K,aAAarX,MAAQ,GAC9C6K,SAAU6B,EAAE4K,iBAAmB5K,EAAE4K,iBAAiBtX,MAAQ,GAC1DuX,YAAa,c,iCAYzB,WACE,IAAME,EAAoBzC,SAASvW,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAKtE,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,IAC1GwW,EAAelZ,KAAKzB,MAAM0a,YAAY3U,MAAM,KAClD4U,EAAaC,MACbD,EAAapN,MAAMkN,EAAoB,GAAGI,YAC1CpZ,KAAKzB,MAAM8a,sBAAsBH,EAAa3U,KAAK,Q,iCAErD,WACE,IAAMyU,EAAoBzC,SAASvW,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAKtE,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,IAC1G4W,EAAoBtZ,KAAKzB,MAAM0a,YAAY3U,MAAM,KACvDgV,EAAkBH,MAClBG,EAAkBxN,MAAMkN,EAAoB,GAAGI,YAC/CpZ,KAAKzB,MAAM8a,sBAAsBC,EAAkB/U,KAAK,Q,+BAE1D,WAGE,OAAmB,IAFAgS,SAASvW,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAKtE,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,M,8BAS3G,WACE,IAAM6W,EAAQvZ,KAAKgG,MAAM8S,YAAc9Y,KAAKgG,MAAM8S,YAAYpW,OAAS,GAEvE,OADmB6T,SAASvW,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAKtE,KAAKzB,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,MACtF6W,I,+BAOrB,WACEvZ,KAAK0X,OAAQ,EACP1X,KAAKzB,MAAMwS,WACb/Q,KAAKwZ,oBAAoBxZ,KAAKzB,MAAMwS,WAEtC/Q,KAAKiQ,SAAS,CAACqI,mBAAoBtY,KAAKzB,MAAM+Z,uB,gCAEhD,SAAmBnI,GACbnQ,KAAKzB,MAAMwS,YAAcZ,EAAUY,WACvC/Q,KAAKwZ,oBAAoBxZ,KAAKzB,MAAMwS,a,kCAGtC,WACE/Q,KAAK0X,OAAQ,I,oBAGf,WAAU,IAAD,OACD+B,EAAe,SAAC5F,EAAG9P,GACvB,IAAME,EAAO4P,EAAE7G,SAAS0M,MAClB1C,EAASnD,EAAE8F,GAAGrV,MAAM,UAAU,GAC9B2S,EAAcD,EAAO1S,MAAM,KAAK0S,EAAO1S,MAAM,KAAK5B,OAAS,GAC3DwR,EAASL,EAAE8F,GAAGrV,MAAM,UAAU,GAC9BoS,EAAW7C,EAAE6C,SACbE,EAAQ/C,EAAE+C,MAChB,OAAI,EAAK5Q,MAAMuS,cAAiBhC,SAAS,EAAKhY,MAAM0a,YAAY3U,MAAM,KAAK,EAAK/F,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,MAASqB,EAAI,IAAS,EAAKxF,MAAM0a,YAErJ,kBAAC,GAAD,CAAkB3N,IAAKvH,EACrB2S,SAAUA,EACVM,OAAQA,EACR9C,OAAQA,EACR+C,YAAaA,EACbhT,KAAMA,EACN2S,MAAOA,EACP9S,OAAQC,EAAI,EACZgT,YAAa,EAAKxY,MAAMwY,YACxB6C,eAAe,EACfpD,aAAc,EAAKjY,MAAM8R,MAAQ,EAAK9R,MAAM8R,MAAQ,EAAKrK,MAAMqK,QAK1D,MAyBX,OACE,kBAACxR,EAAA,EAAD,CAAWD,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WACpD9O,KAAKgG,MAAMmS,iBACV,6BACE,yBAAKvZ,UAAU,sBACb,2BAAIoB,KAAKgG,MAAM2S,cACb3Y,KAAKzB,MAAMia,0BACX,6BACCxY,KAAKgG,MAAMoG,UAAY,kBAACnN,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAASxL,KAAK4X,gBAAhC,iBACvB5X,KAAKgG,MAAMsG,MAAQ,kBAACrN,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAASxL,KAAK2X,YAAhC,cAGpB3X,KAAKzB,MAAM8a,wBAA0BrZ,KAAKgG,MAAMuS,cAChD,8BACEvY,KAAKgY,qBAAuB,kBAAC/Y,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAASxL,KAAK8X,qBAAhC,kBAC5B9X,KAAK+X,oBAAsB,kBAAC9Y,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAASxL,KAAK6X,qBAAhC,cAG/B,6BAEC7X,KAAKzB,MAAM0a,aAAe,kBAACha,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAASxL,KAAKkY,sBAAhC,0BACzBlY,KAAKgG,MAAM8S,aAAgB,kBAAC7Z,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAASxL,KAAKiY,uBAAhC,2BAE7B,kBAAC,GAAD,CAAW7D,SAAUpU,KAAKgG,MAAMoO,YA5ClB,WACpB,GAAI,EAAKpO,MAAM8S,aAAe,EAAK9S,MAAMsS,mBAAmB,CAC1D,IAAIuB,EAAoB,GACxB,GAAK,EAAK7T,MAAM8S,YAAYpW,OAK1BmX,EAAoB,EAAK7T,MAAM8S,YAAY7R,KAAI,SAAC4M,EAAG9P,GACjD,OAAO0V,EAAa5F,EAAG9P,WAJzB8V,EADoBJ,EAAa,EAAKzT,MAAM8S,YAAa,GAQ3D,OAAOe,EAMP,OAAO,kBAAC,GAAD,CAAazF,SAAU,EAAKpO,MAAMoO,WA4BtC0F,IACM,uD,GA7NMtJ,IAAMC,WAoO7BgH,GAAShI,aAAe,CACtB6I,oBAAoB,GAEPb,U,uCC9KAsC,G,kDA7Db,WAAYxb,GAAO,IAAD,8BAChB,cAAMA,IACDmZ,OAAQ,EACb,EAAKsC,YAAc,EAAKA,YAAYpK,KAAjB,gBACnB,EAAK5J,MAAQ,CACXiU,UAAW,IALG,E,+CAQlB,SAAYC,GAAa,IAAD,OAChB9Z,EAAS,wDAA0D8Z,EAAY5V,MAAM,cAAc,GACzGzC,IAAMC,IAAI1B,GAAQI,MAAK,SAACmE,GAClB,EAAK+S,OACP,EAAKzH,SAAS,CAACgK,UAAWtV,EAAElE,Y,+BAKlC,WACET,KAAK0X,OAAQ,EAGT1X,KAAKzB,MAAM2b,aACbla,KAAKga,YAAYha,KAAKzB,MAAM2b,e,gCAIhC,SAAmB/J,GACbnQ,KAAKzB,MAAM2b,cAAgB/J,EAAU+J,aACvCla,KAAKga,YAAYha,KAAKzB,MAAM2b,e,kCAGhC,WACEla,KAAK0X,OAAQ,I,oBAGf,WACE,OACE,yBAAK9Y,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WAC/C,kBAAC,KAAD,CAAmBqL,SAAS,MAAMhb,MAAOib,SAAOC,iBAAe,GAC5Dra,KAAKgG,MAAMiU,gB,GAzCEzJ,IAAMC,W,SCwDb6J,OA1Df,SAAsB/b,GAgBpB,OACA,kBAACgc,GAAA,EAAD,CAAKzU,QAAQ,QAfEvH,EAAMic,eAAiBjc,EAAMic,cAAcvT,KAAI,SAACzI,EAAGic,GAC9D,OAAIjc,EAAEkc,KAEF,kBAACH,GAAA,EAAII,KAAL,CAAUrP,IAAK,OAAS9M,EAAEoc,MACxB,kBAACL,GAAA,EAAIM,KAAL,CAAUC,OAAQvc,EAAMwc,aAAevc,EAAEoc,KAAM1I,MAAO1T,EAAEwc,KAAMxP,QAAS,WAAOjN,EAAM0c,gBAAgBzc,EAAEoc,KAAMrc,EAAM2c,YAAa1c,EAAE2c,OAK9H,QAUc,YAA1B5c,EAAM6c,iBACP,kBAACb,GAAA,EAAII,KAAL,KACE,kBAACJ,GAAA,EAAIM,KAAL,CAAU3I,MAAM,kBAAkB1G,QAAS,WAAOjN,EAAM8c,eAAe9c,EAAM2c,YAAY,kBAAC,KAAD,QAEhE,WAA1B3c,EAAM6c,iBACP,kBAACb,GAAA,EAAII,KAAL,KACE,kBAACJ,GAAA,EAAIM,KAAL,CAAU3I,MAAM,mBAAmB1G,QAAS,WAAOjN,EAAM+c,eAAe/c,EAAM2c,YAAY,kBAAC,KAAD,QAGjE,YAA1B3c,EAAM6c,iBACP,kBAACb,GAAA,EAAII,KAAL,KACE,kBAACJ,GAAA,EAAIM,KAAL,CAAU3I,MAAM,kBAAkB1G,QAAS,WAAOjN,EAAMgd,eAAehd,EAAM2c,YAAY,kBAAC,KAAD,QAGvE,YAAnB3c,EAAM2c,UAEP,kBAACX,GAAA,EAAII,KAAL,KACE,kBAACJ,GAAA,EAAIM,KAAL,CAAU3I,MAAM,eAAe1G,QAAS,WAAOjN,EAAMid,YAAYjd,EAAM2c,YAAY,kBAAC,KAAD,QAUrF,kBAACX,GAAA,EAAII,KAAL,MACIpc,EAAMkd,gBAAkB,kBAAClB,GAAA,EAAIM,KAAL,CAAU3I,MAAM,eAAe1G,QAAS,WAAOjN,EAAMmd,sBAAsBnd,EAAM2c,SAAU3c,EAAMod,cAAe,kBAAC,KAAD,U,SCyB/HC,OA3Ef,SAAqBrd,GACnB,MAAwDgK,mBAAS,IAAjE,mBAAOsT,EAAP,KAA6BC,EAA7B,KACA,EAAgEvT,oBAAS,GAAzE,mBAAOwT,EAAP,KAAiCC,EAAjC,KACMC,EAAgB,WAChB1d,EAAM2d,gBAAkB3d,EAAM2d,eAAe7W,UAC/C9G,EAAM4d,uBAAuB5d,EAAM6d,KAAKtK,YAGxCvT,EAAM4d,uBAAuB5d,EAAM6d,KAAKC,SA8D5C,OA9BM9d,EAAM6d,KAEN,kBAAC7B,GAAA,EAAD,CAAKzU,QAAQ,QACb,kBAACyU,GAAA,EAAIM,KAAL,CAAUrP,QAAS,WAAOjN,EAAM4d,uBAAuB5d,EAAM6d,KAAKtK,cA/BlEvT,EAAM2d,gBAAkB3d,EAAM2d,eAAe7W,UACxC9G,EAAM6d,KAAKlK,MAAQ,IAAM3T,EAAM2d,eAAe7W,UAAUmH,MAAQ,IAAMjO,EAAM2d,eAAe7W,UAAUoH,IAGrGlO,EAAM6d,KAAKlK,OA4BhB,kBAACqI,GAAA,EAAII,KAAL,KACIpc,EAAM6d,KAAKhQ,UAAoC,+BAAxB7N,EAAM6d,KAAKhQ,UAA+C,kBAACmO,GAAA,EAAIM,KAAL,CAAU3I,MAAM,uCAAuC1G,QAAS,WAAOjN,EAAM4d,uBAAuB5d,EAAM6d,KAAKhQ,YAAY,kBAAC,KAAD,QAEhN,kBAACmO,GAAA,EAAII,KAAL,KACIpc,EAAM6d,KAAK9P,MAA4B,+BAApB/N,EAAM6d,KAAK9P,MAA0C,kBAACiO,GAAA,EAAIM,KAAL,CAAU3I,MAAM,mCAAmC1G,QAAS,WAAOjN,EAAM4d,uBAAuB5d,EAAM6d,KAAK9P,QAAQ,kBAAC,KAAD,QAE/L,kBAACiO,GAAA,EAAII,KAAL,KACIpc,EAAM6d,KAAKtK,aAAevT,EAAM6d,KAAKE,UAAoC,+BAAtB/d,EAAM6d,KAAKC,QAC7D,kBAAC9B,GAAA,EAAIM,KAAL,CAAU3I,MAAM,6BAA6B1G,QAASyQ,GAAe,kBAAC,KAAD,QAEzEF,EACC,yBAAK5c,MAAO,CAACod,QAAS,OAAQC,eAAgB,gBAAiBnM,MAAO,SACpE,kBAACkK,GAAA,EAAII,KAAL,KAAU,kBAACJ,GAAA,EAAIM,KAAL,KAAU,0BAAMrP,QAAS,WAAOwQ,GAA4B,KAAS,kBAAC,KAAD,SAC/E,kBAACS,GAAA,EAAD,CAAatd,MAAO,CAACkR,MAAO,OAAQnK,KAAK,OAAO3E,MAAOsa,EAAsB5Q,YAAY,0BAA0BrM,UAAU,UAAU8d,WAAa,SAAC5c,IAtCpI,SAACA,GAC1B,GAAmB,KAAfA,EAAE6c,SAAiB,CACrB,IAAIxR,EAASrL,EAAEqL,OAAO5J,MAClB4J,EAAO3I,SAAS,+BAClB2I,EAASA,EAAOzH,QAAQ,8BAA+B,8BAEhDyH,EAAO3I,SAAS,UACvB2I,EAASA,EAAOzH,QAAQ,SAAU,8BAE3ByH,EAAO3I,SAAS,gCAIvB2I,EAAS,6BAA+BA,GAE1C5M,EAAMqe,kBAAkBzR,GACxB2Q,EAAwB,KAsB0Ie,CAAmB/c,IAAMoL,SAAU,SAACpL,GAAOgc,EAAwBhc,EAAEqL,OAAO5J,WAG1O,kBAACgZ,GAAA,EAAII,KAAL,CAAUnP,QAAS,WAAOwQ,GAA4B,KAAQ,kBAACzB,GAAA,EAAIM,KAAL,eAAiB,kBAAC,KAAD,SAO5E,M,+BCoMEiC,G,kDA3Pb,WAAYve,GAAO,IAAD,8BAChB,cAAMA,IACDwe,iBAAmB,EAAKA,iBAAiBnN,KAAtB,gBACxB,EAAKoN,oBAAsB,EAAKA,oBAAoBpN,KAAzB,gBAC3B,EAAK6B,QAAU,GACf,EAAKzL,MAAQ,CACXiX,aAAa,EACbC,gBAAiB,QACjBC,YAAa,GACbC,QAAS,GACT1C,MAAM,EACN2C,yBAAqBC,EACrBC,cAAUD,EACVE,8BAA0BF,EAC1BG,WAAW,GAdG,E,oDAiBlB,WACEzd,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJ6I,MAAO7I,EAAU6I,W,iCAIvB,WACE1a,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJoL,aAAcpL,EAAUoL,kB,uBAK9B,SAAUhZ,GAER,IAAIyZ,EAAkBzZ,EAAKP,QAAQ,6CAA6C,IAWhF,OAHAga,GAFAA,GADAA,GADAA,GADAA,GADAA,EAAkBA,EAAgBha,QAAQ,KAAM,MACdA,QAAQ,MAAO,MACfA,QAAQ,MAAO,MACfA,QAAQ,MAAO,MACfA,QAAQ,KAAM,MAEdA,QAAQ,UAAU,MAEXwJ,gB,2BAM3C,SAAcyQ,EAAMC,GAAe,IAAD,OAChC/b,IAAMC,IAAI,qEAAuE8b,GAC1Epd,MAAK,SAACyD,GACL,IAAI4Z,EAAc5Z,EAAKxD,KACnB,EAAKlC,MAAMuf,YAAc,EAAKvf,MAAMwf,YACtCF,EAAczY,EAAWnB,EAAKxD,KAAM,EAAKlC,MAAMwf,aAGX,eAA7B,EAAKxf,MAAMyf,eAA+D,mBAA7B,EAAKzf,MAAMyf,cAC/DH,EAAc5Z,EAAKxD,KAEZ,EAAKlC,MAAM0f,mBAClBJ,EAAczY,EAAWnB,EAAKxD,KAAM,EAAKlC,MAAM0f,mBAQjD,IAWMC,EAAM,IAAIC,KAAKC,iBAGbC,EAAOH,EAAII,UAAU,EAAKC,UAAUZ,GAAO,EAAKY,UAAUV,IAGlEK,EAAIM,qBAAqBH,GACzB,IAAMhB,EAAsBa,EAAIO,iBAAiBJ,GAI3CK,EAAqD,UAA/B,EAAK1Y,MAAMkX,gBAA+ByB,uBAAYhB,EAAME,GAAae,QAAUV,EAAIW,gBAAgBR,IAC9G,IAAjB,EAAK5M,SAAoBkM,EAI3B,EAAK1N,SAAS,CAACkN,YAAauB,EAAoBtB,QAASS,EAAaR,oBAAqBA,EAAqBJ,YAAa,EAAK1e,MAAM0e,YACtIC,gBAAiB,EAAK3e,MAAM2e,gBAAiBK,SAAU,EAAKhf,MAAMof,KAAMH,yBAA0B,EAAKjf,MAAMugB,uBAEzG,EAAKrN,SAIX,EAAKxB,SAAS,CAACmN,QAASS,EAAaZ,YAAa,EAAK1e,MAAM0e,YAC3DM,SAAU,EAAKhf,MAAMof,KAAMH,yBAA0B,EAAKjf,MAAMugB,0BAEnExH,OAAM,SAACC,GACR7Y,QAAQC,IAAI,gCAAiC4Y,Q,+BAIvD,WACEvX,KAAKyR,SAAU,EAEfzR,KAAKiQ,SAAS,CAACmN,QAAS,GAAID,YAAa,GAAIF,YAAajd,KAAKzB,MAAM0e,YAAaC,gBAAiBld,KAAKzB,MAAM2e,gBAAiBO,UAAWzd,KAAKzB,MAAMwgB,aAGjJ/e,KAAKzB,MAAMmc,MACb1a,KAAKgf,cAAchf,KAAKzB,MAAMof,KAAM3d,KAAKzB,MAAMugB,wB,gCAInD,SAAmB3O,IAMbnQ,KAAKzB,MAAMmc,MAIV1a,KAAKzB,MAAMof,OAAS3d,KAAKgG,MAAMuX,UAAYvd,KAAKzB,MAAMugB,uBAAyB9e,KAAKgG,MAAMwX,0BAG3Fxd,KAAKgf,cAAchf,KAAKzB,MAAMof,KAAM3d,KAAKzB,MAAMugB,sBAI7C9e,KAAKzB,MAAMwgB,aAAe5O,EAAU4O,YACtC/e,KAAKiQ,SAAS,CAACwN,UAAWzd,KAAKzB,MAAMwgB,e,kCAO3C,WACI/e,KAAKyR,SAAU,I,oBAInB,WAAS,IAAD,OAGAgI,EAAe,WACnB,IAAMwF,EAAoB,CAAC,CACzBC,cAAe,EAAK3gB,MAAM2gB,cAC1BC,mBAAoB,EAAK5gB,MAAM4gB,mBAC/BvB,cAAe,KAEjB,OACM,6BACE,0BAAMpS,QAAS,WAAO,EAAKyE,UAAS,SAAC4B,GAAc,MAAO,CAAC4L,WAAY5L,EAAU4L,gBAAgB,kBAAC,KAAD,OAChG,EAAKzX,MAAMyX,WACV,6BACE,kBAAC,mBAAD,CACA2B,eAAgBH,EAChBI,qBAAsB,EAAK9gB,MAAM2gB,cACjC7O,MAAOkG,SAAS,EAAKhY,MAAM+gB,cAC3BC,mBAAmB,EACnBC,qBAAqB,EACrBC,UAAY,EAAKlhB,MAAMuf,YAAc,EAAKvf,MAAMwf,aAAgBxH,SAAS,EAAKhY,MAAMwf,YAAYzZ,MAAM,KAAK,IAC3Gob,QAAU,EAAKnhB,MAAMuf,YAAc,EAAKvf,MAAMwf,aAAgBxH,SAAS,EAAKhY,MAAMwf,YAAYzZ,MAAM,KAAK,SA4DvH,OAnD0B,WACxB,IAAMqb,EAAS,EAAKphB,MAAMof,OAAS,EAAK3X,MAAMoX,QAC9C,GAAI,EAAKpX,MAAMiX,aAAe,EAAK1e,MAAMof,MAAQ,EAAK3X,MAAMmX,YAAY,CACtE,IAAMyC,EAAW,EAAK5Z,MAAMqX,oBACtBwC,EAAuB,EAAXD,EAClB,OACE,yBAAKzgB,MAAO,CAAC2gB,WAAY,kBAAoBD,EAAY,eAAgBE,YAAa,QACpF,8BAAM,kBAAC,IAAD,CAAM7gB,GAAI,oBAAsB,EAAKX,MAAMugB,sBAAsD,eAA7B,EAAKvgB,MAAMyf,eAA+D,mBAA7B,EAAKzf,MAAMyf,eAAsC,EAAKzf,MAAM0f,iBAAoB,IAAM,EAAK1f,MAAM0f,iBAAmB,KAAM,EAAK1f,MAAM4gB,oBAA5P,KACA,qCACA,0BAAMvgB,UAAU,gBAAgBsT,MAAM,YAAY1G,QAAS,kBAAM,EAAKuR,qBAAqB,EAAK/W,MAAM0U,KAAO,kBAAC,KAAD,MAAgB,kBAAC,KAAD,OAC7H,qCACA,0BAAM9b,UAAU,gBAAgBsT,MAAM,wBAAwB1G,QAAS,kBAAM,EAAKwR,wBAAuB,kBAAC,KAAD,QACvG2C,GAAU,sCACVA,GAAU,0BAAM/gB,UAAU,gBAAgBsT,MAAM,cAAc1G,QAAS,kBAAM,EAAKjN,MAAMyhB,iBAAiB,EAAKha,MAAMoX,WAAU,kBAAC,KAAD,OAC/H,EAAK7e,MAAM0hB,yBAA2B,qCACtC,EAAK1hB,MAAM0hB,yBAA2B,0BAAMrhB,UAAU,gBAAgBsT,MAAM,iBAAiB1G,QAAS,WAAOhH,EAAe,EAAKjG,MAAM0hB,wBAAwB3b,MAAM,KAAK,GAAI,GAAI,EAAK/F,MAAM0hB,wBAAwB3b,MAAM,KAAK,MAAO,kBAAC,KAAD,OACxO,qCACA,0BAAMnF,MAAO,CAAC+gB,SAAU,OAAQH,YAAa,OAAQ7N,MAAM,wBAAwB0N,GACnF,yBAAKhhB,UAAW,EAAKoH,MAAM0U,KAAO,WAAa,UAC7C,yBAAKyF,IAAI,OAAOvT,wBAAyB,CAAEC,OAAQ,EAAK7G,MAAMmX,eAC7D1D,MAMJ,OAAI,EAAKzT,MAAMoX,QAGhB,6BACE,8BAAM,kBAAC,IAAD,CAAMle,GAAI,oBAAsB,EAAKX,MAAMugB,sBAAsD,eAA7B,EAAKvgB,MAAMyf,eAA+D,mBAA7B,EAAKzf,MAAMyf,eAAsC,EAAKzf,MAAM0f,iBAAoB,IAAM,EAAK1f,MAAM0f,iBAAmB,KAAM,EAAK1f,MAAM4gB,qBAD9P,KAEE,qCACA,0BAAMvgB,UAAU,gBAAgBsT,MAAM,YAAY1G,QAAS,kBAAM,EAAKuR,qBAAqB,EAAK/W,MAAM0U,KAAO,kBAAC,KAAD,MAAgB,kBAAC,KAAD,OAC7H,qCACA,0BAAM9b,UAAU,gBAAgBsT,MAAM,uBAAuB1G,QAAS,kBAAM,EAAKwR,wBAAuB,kBAAC,KAAD,QACtG2C,GAAU,sCACVA,GAAU,0BAAM/gB,UAAU,gBAAgBsT,MAAM,cAAc1G,QAAS,kBAAM,EAAKjN,MAAMyhB,iBAAiB,EAAKha,MAAMoX,WAAU,kBAAC,KAAD,OAC/H,EAAK7e,MAAM0hB,yBAA2B,qCACtC,EAAK1hB,MAAM0hB,yBAA2B,0BAAMrhB,UAAU,gBAAgBsT,MAAM,iBAAiB1G,QAAS,WAAOhH,EAAe,EAAKjG,MAAM0hB,wBAAwB3b,MAAM,KAAK,GAAI,GAAI,EAAK/F,MAAM0hB,wBAAwB3b,MAAM,KAAK,MAAO,kBAAC,KAAD,OACxO,yBAAK1F,UAAW,EAAKoH,MAAM0U,KAAO,WAAa,UAC7C,yBAAKyF,IAAI,OAAOvT,wBAAyB,CAAEC,OAAQ,EAAK7G,MAAMoX,WAC7D3D,MAMA,kBAAC,EAAD,MAKT2G,O,GA5OwB5P,IAAMC,WC4KrB4P,G,kDAnLb,WAAY9hB,GAAO,IAAD,8BAChB,cAAMA,IACD+hB,oBAAsB,EAAKA,oBAAoB1Q,KAAzB,gBAC3B,EAAK2Q,0BAA4B,EAAKA,0BAA0B3Q,KAA/B,gBACjC,EAAK6B,QAAU,GACf,EAAKzL,MAAQ,CACXoW,KAAM,GACN1B,MAAM,EACNqE,YAAY,EACZyB,SAAU,IATI,E,uDAalB,WACExgB,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJ6I,MAAO7I,EAAU6I,W,uCAIvB,WACE1a,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJkN,YAAalN,EAAUkN,iB,6BAO7B,SAAgB3C,EAAMtK,GAAY,IAAD,OAC/BsK,EAAK5b,MAAK,SAACmE,GACT,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAAS,GACnCoY,EAAiBza,EAAElE,KAAKsG,QAAQC,SAASC,KAAI,SAACgH,GAAO,IAAD,EACxD,MAAO,CACLiR,cAAejR,EAAEiR,cAAc3d,MAC/B4d,mBAAoBlR,EAAEkR,mBAAmB5d,MACzCqc,cAAe3P,EAAEwS,4BAA8BxS,EAAEwS,4BAA4Blf,MAAQ,GACrFmf,iBAAgB,UAAEzS,EAAE0S,sCAAJ,aAAE,EAAkCpf,WAGnC,IAAjB,EAAKkQ,SAAoBzK,GAC3B,EAAKiJ,SAAS,CACZmM,KAAM,CACJtK,WAAYA,EACZI,MAAOlL,EAASkL,MAAM3Q,MACtB6Q,cAAepL,EAASoL,cAAc7Q,MACtCqf,MAAO5Z,EAAS4Z,MAAMrf,MACtB+K,KAAMtF,EAASsF,KAAOtF,EAASsF,KAAK/K,MAAQ,GAC5C6K,SAAUpF,EAASoF,SAAWpF,EAASoF,SAAS7K,MAAQ,GACxDsf,KAAM7Z,EAAS6Z,KAAO7Z,EAAS6Z,KAAKtf,MAAQ,GAC5Cuf,KAAM9Z,EAAS8Z,KAAO9Z,EAAS8Z,KAAKvf,MAAQ,GAC5C+a,SAAUtV,EAAS+Z,mBAAmBxf,MACtCyf,eAAgBha,EAASga,eAAiBha,EAASga,eAAezf,MAAQ,GAC1E0f,eAAgBja,EAASia,eAAiBja,EAASia,eAAe1f,MAAQ,GAC1E6d,eAAgBA,U,yBAM1B,SAAYtgB,GACV,IAAMsd,EAAOza,EAAS+O,GAAe5R,IACrCkB,KAAKkhB,gBAAgB9E,EAAMtd,K,+BAE7B,WACEkB,KAAKyR,SAAU,EAIfzR,KAAKiQ,SAAS,CAACyK,KAAM1a,KAAKzB,MAAMmc,OAChC1a,KAAKiQ,SAAS,CAAC8O,WAAY/e,KAAKzB,MAAMwgB,aAKlC/e,KAAKzB,MAAMuf,WACb9d,KAAKiQ,SAAS,CAACmM,KAAMpc,KAAKzB,MAAM6d,OAGhCpc,KAAKmhB,YAAYnhB,KAAKzB,MAAM6iB,gB,gCAGhC,SAAmBjR,GAEZnQ,KAAKzB,MAAM6d,KAAKtK,aAAe3B,EAAUiM,KAAKtK,YAAgB9R,KAAKzB,MAAM6d,KAAKiF,qBAAuBlR,EAAUiM,KAAKiF,qBACnHrhB,KAAKzB,MAAMuf,WACb9d,KAAKiQ,SAAS,CAACmM,KAAMpc,KAAKzB,MAAM6d,OAGhCpc,KAAKmhB,YAAYnhB,KAAKzB,MAAM6iB,eAK5BphB,KAAKzB,MAAMmc,OAASvK,EAAUuK,MAChC1a,KAAKsgB,sBAIHtgB,KAAKzB,MAAMwgB,aAAe5O,EAAU4O,YACtC/e,KAAKugB,8B,kCAGT,WACEvgB,KAAKyR,SAAU,I,oBAEjB,WAAS,IAAD,OAiCR,OACE,yBAAKtS,MAAO,CAAC,aAAgB,+BAAgCmiB,QAAS,QAKpE,yBAAKniB,MAAO,CAAC+gB,SAAU,SACpBlgB,KAAKzB,MAAMuf,YAAc,2CAC1B,8BAAO9d,KAAKzB,MAAMyf,eAChBhe,KAAKzB,MAAMgjB,mBAAqBvhB,KAAKzB,MAAMgjB,oBAAsBvhB,KAAKzB,MAAM6d,KAAKtK,YAChF,mCAAQ,kBAAC,IAAD,CAAM5S,GAAI,oBAAsBc,KAAKzB,MAAMgjB,mBAA3C,OAAR,MAEL,6BACGvhB,KAAKgG,MAAMoW,KAAKtK,WACjB,kBAAC,IAAD,CAAM5S,GAAI,oBAAsBc,KAAKgG,MAAMoW,KAAKtK,YAA4C,eAA7B9R,KAAKzB,MAAMyf,eAA+D,mBAA7Bhe,KAAKzB,MAAMyf,eAAsChe,KAAKzB,MAAM0f,iBAAoB,IAAMje,KAAKzB,MAAM0f,iBAAmB,KAC7Nje,KAAKzB,MAAMkJ,aAAezH,KAAKzB,MAAMmO,UAAY,kCAAQ1M,KAAKzB,MAAMkJ,YAAnB,IAAiCzH,KAAKzB,MAAMmO,WAAoB1M,KAAKgG,MAAMoW,KAAKtK,YAEpI9R,KAAKzB,MAAMkJ,aAAezH,KAAKzB,MAAMmO,UAAY,kCAAQ1M,KAAKzB,MAAMkJ,YAAnB,IAAiCzH,KAAKzB,MAAMmO,WAAoB1M,KAAKgG,MAAMoW,KAAKtK,WAEjI,qCACC9R,KAAKgG,MAAMoW,KAAKtK,YAAc,0BAAMlT,UAAU,gBAAgB4M,QAAS,kBAAM,EAAK8U,wBAAwBtgB,KAAKgG,MAAM0U,KAAO,kBAAC,KAAD,MAAgB,kBAAC,KAAD,OAC7I,qCACC1a,KAAKzB,MAAM6iB,cAAgB,0BAAMxiB,UAAU,gBAAgBsT,MAAM,yBAAyB1G,QAASxL,KAAKzB,MAAMuf,WAAa9d,KAAKzB,MAAMijB,2BAA6B,WAIlK,IAAMC,EAAyC,eAA7B,EAAKljB,MAAMyf,eAA+D,mBAA7B,EAAKzf,MAAMyf,eAAuC,EAAKzf,MAAM0f,iBAAoB,EAAK1f,MAAM6iB,aAAe,IAAM,EAAK7iB,MAAM0f,iBAAmB,EAAK1f,MAAM6iB,aACzN,EAAK7iB,MAAMmjB,8BAA8BD,KAAW,kBAAC,KAAD,OAEtD,qCACA,uBAAGlR,KAAM,qCAAuCvQ,KAAKgG,MAAMoW,KAAKtK,WAAY3G,OAAO,SAASiI,IAAI,uBAAsB,yBAAK7D,IAAI,kBAAkBpQ,MAAO,CAACkR,MAAO,OAAQC,OAAQ,QAAShB,IAAI,sDAE/L,yBAAK1Q,UAAWoB,KAAKgG,MAAM0U,KAAO,WAAa,SAAUvb,MAAO,CAAC,YAAe,SA7D5E,EAAKZ,MAAMuf,YAAgD,kDAAlC,EAAKvf,MAAM6d,KAAKhK,cACpC,kHAEA,EAAKpM,MAAMoW,KAAKgD,eACT,EAAKpZ,MAAMoW,KAAKgD,eAAenY,KAAI,SAAC0a,GAChD,OACE,kBAAC,GAAD,CACArW,IAAKqW,EAAE/D,cACPD,KAAM,EAAKpf,MAAMiiB,SACjB1B,qBAAsB6C,EAAE/D,cACxBqC,wBAAyB0B,EAAEjB,iBAC3BvB,mBAAoBwC,EAAExC,mBACtBD,cAAeyC,EAAEzC,cACjBc,iBAAkB,EAAKzhB,MAAMyhB,iBAC7BtF,KAAM,EAAK1U,MAAM0U,KACjBuC,aAAa,EAAK1e,MAAMuf,YAAa,GACrCZ,gBAAiB,EAAK3e,MAAMuf,WAAa,eAAiB,QAC1DwB,aAAc,EAAK/gB,MAAM+gB,aACzBrB,iBAAkB,EAAK1f,MAAM0f,iBAC7BF,YAAa,EAAKxf,MAAMwf,YACxBD,WAAY,EAAKvf,MAAMuf,WACvBE,cAAe,EAAKzf,MAAMyf,cAC1Be,WAAY,EAAK/Y,MAAM+Y,qBAnBxB,Q,GAnHevO,IAAMC,WCkHzB,SAASmR,GAAchgB,GAG5B,OADqBC,IAAMC,IADJ,mCACwB,CAAEC,OAAQ,CAAE,MAASH,EAAO,OAAU,UC3GvF,IAAMigB,GAAwB,SAAC7a,GAC7B,IAAMb,EAAc,GAapB,OAZAa,EAASgH,SAAQ,SAAC9B,GAAO,IAAD,MACtB/F,EAAY2F,KAAK,CACfhN,GAAIoN,EAAEf,OAAO5J,MACbyc,cAAe,uBAAyB9R,EAAE4V,MAAMvgB,MAChDggB,kBAAmB,GACnB/Z,OAAM,UAAE0E,EAAE1E,cAAJ,aAAE,EAAUjG,MAClBkG,YAAW,UAAEyE,EAAEzE,mBAAJ,aAAE,EAAelG,MAC5BmL,UAAS,UAAER,EAAEQ,iBAAJ,aAAE,EAAanL,MACxBmZ,MAAM,EACNuD,iBAAkB,QAGf9X,GAqFM4b,OAlFf,SAAsBxjB,GACpB,MAAoDgK,mBAAS,IAA7D,mBAAO8Y,EAAP,KAA2BW,EAA3B,KACA,EAAkDzZ,mBAAS,GAA3D,mBAAO0Z,EAAP,KAA0BC,EAA1B,KA8DA,OA7DAjY,qBAAU,WAER,GAAI1L,EAAMiiB,UAAYjiB,EAAMwf,YAAY,CACtCrf,QAAQC,IAAI,WACZ,IAAMwjB,E9B0WL,SAAmBle,GAExB,IAAIyZ,EAAkBzZ,EAAKP,QAAQ,6CAA6C,IAWhF,OAHAga,GAFAA,GADAA,GADAA,GADAA,GADAA,EAAkBA,EAAgBha,QAAQ,KAAM,MACdA,QAAQ,MAAO,MACfA,QAAQ,MAAO,MACfA,QAAQ,MAAO,MACfA,QAAQ,KAAM,MAEdA,QAAQ,UAAU,MAEXwJ,c8BtXfqR,CAAUhgB,EAAMiiB,UAAUlc,MAAM,KAChD8d,EAAa,GACnB1jB,QAAQC,IAAI,WAAYJ,EAAMiiB,UAC9B9hB,QAAQC,IAAI,gBAAiBwjB,GAE7B,IAAK,IAAIpe,EAAI,EAAGA,EAAKoe,EAAczf,OAAS,EAAIqB,IAAI,CAClD,IAAMse,EAAO,2CAAuCF,EAAczc,MAAM3B,EAAIA,EAAI,GAAIQ,KAAK,IAA5E,KACb6d,EAAWtW,KAAKuW,GAEGT,GDkDpB,SAA4BU,GAAiC,IAAvBL,EAAsB,uDAAF,EACzDrgB,EAAK,kIAEmB0gB,EAFnB,gzBAgBmBL,EAhBnB,mDAkBZ,OAAOrgB,ECrEiC2gB,CAAmBH,EAAW7d,KAAK,KAAM0d,IAC/DzhB,MAAK,SAACmE,GACjB,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAC1Bb,EAAc0b,GAAsB7a,GAC1Cgb,EAAsB7b,WAKrB,IAAK5H,EAAMwf,YAAY,CACL6D,GD1DpB,SAA2B9iB,GAA2B,IAAvBmjB,EAAsB,uDAAF,EA0EhDrgB,EAAK,0IAEkB9C,EAFlB,w6BAkBiBmjB,EAlBjB,mDAqBd,OAAOrgB,ECrCiC4gB,CAAkBjkB,EAAMuT,WAAYmQ,IAC1DzhB,MAAK,SAACmE,GACjB,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAC1Bb,EAAc0b,GAAsB7a,GAC1Cgb,EAAsB7b,SAGzB,CAAC5H,EAAMuT,WAAYvT,EAAMiiB,SAAUjiB,EAAMwf,YAAakE,IAgCvD,6BACE,6BACA,wDAEE,6BACA,0BAAM9iB,MAAO,CAAC,SAAY,SAA1B,iCAAkE8iB,EAAlE,IACG,0BAAMrjB,UAAU,gBAAgBsT,MAAM,kCAAkC1G,QAAS,kBAAM0W,EAAqBD,EAAoB,KAAhI,OACAA,EAAoB,GAAK,0CAAK,0BAAMrjB,UAAU,gBAAgBsT,MAAM,kCAAkC1G,QAAS,kBAAM0W,EAAqBD,EAAoB,KAAhI,QAFjC,MAQsB,eAAvBZ,EAAsC,kBAAC,EAAD,MA3ChB,WACzB,IAAMoB,EAAqBpB,EAAmBpa,KAAI,SAAClD,EAAG2e,GACpD,IAAMC,EAASpkB,EAAMqkB,kBAAkBC,MAAK,SAAC/iB,GAAD,OAAOA,EAAEgjB,cAAgB/e,EAAEjF,MACvE,OAEA,yBAAKwM,IAAKoX,EAAQ,UAAY3e,EAAEjF,IAC7B6jB,GAAU,0BAAMxjB,MAAO,CAAC+gB,SAAU,OAAQH,YAAa,MAAOgD,WAAY,MAAOjD,WAAY,qBAAnF,sBAA2H,kBAAC,IAAD,CAAM5gB,GAAI,oBAAsByjB,EAAO7jB,IAAK6jB,EAAO7jB,KACpL,kBAAC,GAAD,CACCsd,KAAM7d,EAAM6d,KACZgF,aAAcrd,EAAEjF,GAChBkf,cAAeja,EAAEia,cACjBuD,kBAAmBxd,EAAEwd,kBACrB/Z,OAAQzD,EAAEyD,OACVC,YAAa1D,EAAE0D,YACfiF,UAAW3I,EAAE2I,UACboR,YAAY,EACZkC,iBAAkBzhB,EAAMyhB,iBACxBQ,SAAUjiB,EAAMiiB,SAChB9F,KAAM3W,EAAE2W,KACR4E,aAAc/gB,EAAM+gB,aACpBrB,iBAAkBla,EAAEka,iBACpByD,8BAA+BnjB,EAAMmjB,8BACrCF,2BAA4BjjB,EAAMijB,iCAK5C,OAAOiB,EAgB+CA,KCyL3CO,G,kDA3Rb,WAAYzkB,GAAQ,IAAD,8BACjB,cAAMA,IACDye,oBAAsB,EAAKA,oBAAoBpN,KAAzB,gBAC3B,EAAKoQ,iBAAmB,EAAKA,iBAAiBpQ,KAAtB,gBACxB,EAAKqT,qCAAuC,EAAKA,qCAAqCrT,KAA1C,gBAC5C,EAAKsT,4BAA8B,EAAKA,4BAA4BtT,KAAjC,gBACnC,EAAKuT,wBAA0B,EAAKA,wBAAwBvT,KAA7B,gBAC/B,EAAKwT,8BAAgC,EAAKA,8BAA8BxT,KAAnC,gBACrC,EAAKyT,QAAU,EAAKA,QAAQzT,KAAb,gBACf,EAAK6B,QAAU,GACf,EAAKzL,MAAQ,CACXG,YAAa,GACbmd,sBAAuB,GACvBC,KAAM,EACNC,aAAc,EACdC,SAAU,GACVC,SAAU,EACVC,kBAAcrG,EACdxa,OAAQ,EACR8gB,WAAY,EACZC,SAAU,GACVrD,SAAU,GACVsD,mBAAoB,GACpBC,uBAAwB,GACxBC,iBAAiB,EACjBC,uBAAuB,GAzBR,E,2DA6BnB,WACEjkB,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJmS,iBAAkBnS,EAAUmS,sB,2CAIlC,WACEhkB,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJoS,uBAAwBpS,EAAUoS,4B,yCAIxC,SAA4BH,GAC1B9jB,KAAKiQ,SAAS,CAAE6T,mBAAoBA,M,kDAEtC,SAAqChkB,GACnCA,EAAEyO,iBACF,IAAM2V,EAAmB,CACvBpS,WAAY9R,KAAKgG,MAAM8d,mBACvB9F,cAAe,yBAEjBhe,KAAKiQ,SAAS,CAAE8T,uBAAwBG,M,8BAE1C,SAAiB9G,GACfpd,KAAKiQ,SAAS,CAAEuQ,SAAUpD,M,iCAG5B,SAAoBgE,GAClBphB,KAAKiQ,UAAS,SAAC4B,GACb,IAAMsS,EAAc,gBAAQtS,EAAU1L,aAEtC,OADAge,EAAe/C,GAAc1G,MAAQyJ,EAAe/C,GAAc1G,KAC3D,CACLvU,YAAage,Q,qBAInB,SAAQlD,GAAiB,IAAD,OAChBmD,EAAQpkB,KACd6B,IAAMC,IAAI,qEAAuEmf,GAC9EzgB,MAAK,SAACyD,GACL,GAAI,EAAKwN,QAAS,CAChB,IAAIoM,EAAc5Z,EAAKxD,KACrB,GAAI,EAAKlC,MAAM2d,eAAe7W,UAAU,CACtC,IAAMA,EAAY+e,EAAM7lB,MAAM2d,eAAe7W,UAAUmH,MAAQ,IAAM4X,EAAM7lB,MAAM2d,eAAe7W,UAAUoH,IAC1GoR,EAAczY,EAAWnB,EAAKxD,KAAM4E,GAExC+e,EAAMnU,SAAS,CAAEuQ,SAAU3C,U,mCAUnC,SAAsB/L,EAAYyR,EAAME,GAAW,IAAD,OAC1C3gB,GAAUygB,EAAO,GAAKE,EACtBG,EAAc5jB,KAAKzB,MAAM2d,gBAAkBlc,KAAKzB,MAAM2d,eAAe7W,UAAarF,KAAKzB,MAAM2d,eAAe7W,UAAUmH,MAAQ,GAC9HqX,EAAY7jB,KAAKzB,MAAM2d,gBAAkBlc,KAAKzB,MAAM2d,eAAe7W,UAAarF,KAAKzB,MAAM2d,eAAe7W,UAAUoH,IAAM,GACrG9K,EhBpGvB,SAA+BgP,EAAmB7N,EAAQ2gB,EAAUG,EAAYC,GAErF,IAAIQ,EAuMF,OAtMET,GAAcC,IACjBQ,EAAc,CAAC,kCAAoCR,EAAW,IAChD,oCAAsCD,EAAa,KAAKrf,KAAK,MAuH/D,CACd,yIACA,QACA,KACE,UAAYoM,EAAqB,oBACjC,IACE,IAAMA,EAAqB,uBAC3B,mDACA,uDACA,yDACA,yDACA,2DACA,kEACA,2DACA,IACA,QACF,IACE,IACA,IAAMA,EAAqB,8FACzB,UAAYA,EAAqB,mBACnC,KACA,QACA,IACE,oDAAsDA,EAAqB,QAC7E,IACA,KA7IEiT,GAAeC,EAeF,CAAC,oDAChB,wDACA,+EACA,2EACAQ,GAAa9f,KAAK,KAlBL,CACb,IACE,6DACA,oCACF,IACA,QACA,IACA,oDACA,wDACA,+EACA,2EACA,KAAKA,KAAK,KAmIN,IACE,iHACA,+BACF,IACA,QACA,IACE,+GACA,6BACF,IACF,KACJ,KACA,QACA,KACA,KACE,UAAYoM,EAAqB,oBACjC,KACA,SACA,KACA,oDAAsDA,EAAqB,QAC3E,IA3IEiT,GAAeC,EAaH,CAAC,wDACjB,oDACA,+EACA,2EACAQ,GAAa9f,KAAK,KAhBF,CAAC,IACT,6DACF,IACE,QACF,IACE,wDACA,oDACA,+EACA,2EACF,KAAKA,KAAK,KAmId,IACA,sHACA,oCACA,KACA,QACA,KACE,mHACA,uCACF,IACA,WACA,IACE,iFAGF,IACF,IACA,mEACA,8DACA,gDACA,YACA,KACE,8DACA,iEACF,KACF,KACA,wBACA,SAAWkf,EACX,UAAY3gB,GACZyB,KAAK,KgBpGiC+f,CAAsBxS,EAAYhP,EAAQ2gB,EAAUG,EAAYC,IAEjFrjB,MAAK,SAACmE,GACvBjG,QAAQC,IAAI,4CAA6CgG,GACzD,IAAM4f,EAAY5f,EAAElE,KAAKsG,QAAQC,SAC3Bb,EAAc,GAIlBA,EAAY2F,KAAK,CACfhN,GAAI,EAAKP,MAAM6d,KAAKtK,WACpBrK,YAAa,EAAKlJ,MAAM6d,KAAK3U,YAC7BiF,UAAW,EAAKnO,MAAM6d,KAAK1P,UAC3BgO,MAAM,IAGV6J,EAAUvW,SAAQ,SAAC9B,GACjB/F,EAAY2F,KAAK,CACfhN,GAAIoN,EAAEsY,YAAYjjB,MAClByc,cAAe9R,EAAE0K,MAAMrV,MACvBggB,kBAAmBrV,EAAE/J,QAAU+J,EAAE/J,QAAQZ,MAAQ,GACjDiG,OAAQ0E,EAAE1E,OAAS0E,EAAE1E,OAAOjG,MAAQ,GACpCkG,YAAayE,EAAEzE,YAAcyE,EAAEzE,YAAYlG,MAAQ,GACnDmL,UAAWR,EAAEQ,UAAYR,EAAEQ,UAAUnL,MAAQ,GAC7CmZ,MAAM,EACNuD,iBAAkB/R,EAAEuY,uBAAyBvY,EAAEwY,oBAAsBxY,EAAEuY,sBAAsBljB,MAAQ,IAAM2K,EAAEwY,oBAAoBnjB,MAAQ,GACzIuhB,YAAa5W,EAAE4W,YAAc5W,EAAE4W,YAAYvhB,MAAQ,QAKnD,EAAKkQ,SACT,EAAKxB,UAAS,SAAC4B,GACb,MAAO,CACL1L,YAAaA,EAGbmd,sBAAuBzR,EAAUyR,sBAAsBqB,OAAOxe,GAC9Dqd,aAAcD,EACdG,SAAUH,EAAO,EACjBI,aAAcJ,EAAO,EAAIA,EAAO,OAAIjG,EACpCxa,QAASygB,EAAO,GAAKE,EACrBG,YAAcL,EAAO,GAAKE,EAAY,EACtCI,SAAUJ,EAAWF,W,+BAM7B,WACEvjB,KAAKyR,SAAU,EACXzR,KAAKzB,MAAM6d,OACbpc,KAAKskB,sBAAsBtkB,KAAKzB,MAAM6d,KAAKtK,WAAY9R,KAAKgG,MAAMud,KAAMvjB,KAAKgG,MAAMyd,UAC7C,kDAAlCzjB,KAAKzB,MAAM6d,KAAKhK,eAClBpS,KAAKqjB,QAAQrjB,KAAKzB,MAAM6d,KAAK6E,mB,gCAInC,SAAmB9Q,EAAW0B,GAE5B,GAAI1B,EAAUiM,KAAKtK,aAAe9R,KAAKzB,MAAM6d,KAAKtK,YAAcD,EAAU0R,OAASvjB,KAAKgG,MAAMud,MAAQpT,EAAU+L,iBAAmBlc,KAAKzB,MAAM2d,eAAgB,CAC5J,IAAM0I,EAAYzU,EAAUiM,KAAKtK,aAAe9R,KAAKzB,MAAM6d,KAAKtK,WAAa,EAAI9R,KAAKgG,MAAMud,KAC5FvjB,KAAKskB,sBAAsBtkB,KAAKzB,MAAM6d,KAAKtK,WAAY8S,EAAW5kB,KAAKgG,MAAMyd,UACvC,kDAAlCzjB,KAAKzB,MAAM6d,KAAKhK,eAClBpS,KAAKqjB,QAAQrjB,KAAKzB,MAAM6d,KAAK6E,gBAIjC,GAAIpP,EAAUkS,yBAA2B/jB,KAAKgG,MAAM+d,uBAAwB,CAC1E,IAAM7X,EAAIlM,KAAKgG,MAAM+d,uBACfc,EAAgB,CACpB/lB,GAAIoN,EAAE4F,WACNkM,cAAe9R,EAAE8R,eAEnBhe,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACL1L,YAAY,GAAD,mBAAO0L,EAAU1L,aAAjB,CAA8B0e,W,kCAKjD,WACE7kB,KAAKyR,SAAU,I,oBAEjB,WAAU,IAAD,OA+BDqT,EAAoB,WACxB,OACE,8BAEGC,OAAOC,KAAK,EAAKhf,MAAMG,aAAazD,OAAS,EAAKsD,MAAMyd,UAAY,EAAKzd,MAAM6d,SAAW,EAAK7d,MAAMyd,WACxG,uBAAG7kB,UAAU,SACV,EAAKoH,MAAM2d,cACV,8BACE,0BAAM/kB,UAAU,gBAAgB4M,QAAS,kBAAM,EAAKyE,SAAS,CAAEsT,KAAM,EAAKvd,MAAM2d,iBAAhF,YAA2G,EAAK3d,MAAM2d,cACtH,sCAGJ,gDACA,kBAAClH,GAAA,EAAD,CAAatd,MAAO,CAACkR,MAAO,OAAQkM,QAAS,UAAW0I,OAAO,OAAOta,KAAK,KAAK7L,GAAG,OAAOoH,KAAK,OAAOgF,SAAU,SAACpL,GAAD,OAAO,EAAKmQ,SAAS,CAAEuT,aAAc1jB,EAAEqL,OAAO5J,SAAUA,MAAO,EAAKyE,MAAMwd,eAC1L,kBAACvkB,EAAA,EAAD,CAAQE,MAAO,CAACod,QAAS,UAAU0I,OAAO,OAAOta,KAAK,KAAKa,QAAS,SAAC1L,GAAD,OAAO,EAAKmQ,SAAS,CAAEsT,KAAMhN,SAAS,EAAKvQ,MAAMwd,kBAArH,MAEA,kCAAQ,EAAKxd,MAAM4d,WAAnB,MAAkC,EAAK5d,MAAM6d,SAA7C,KACCkB,OAAOC,KAAK,EAAKhf,MAAMG,aAAazD,OAAS,EAAKsD,MAAMyd,UACvD,8BACE,qCACA,0BAAM7kB,UAAU,gBAAgB4M,QAAS,kBAAM,EAAKyE,SAAS,CAAEsT,KAAM,EAAKvd,MAAM0d,aAAhF,SAAoG,EAAK1d,MAAM0d,cASzH,OACE,kBAAC7kB,EAAA,EAAD,CAAWD,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WACnD,gDACCgW,IACD,uBAAGlmB,UAAU,SAAQ,uBAAG2R,KAAK,qCAAqCpF,OAAO,SAASiI,IAAI,uBAAjE,iCACrB,uBAAGxU,UAAU,sBAAsB4M,QAASxL,KAAKmjB,yBAAjD,uBACCnjB,KAAKgG,MAAMge,iBAAmB,uBAAGplB,UAAU,sBAAsB4M,QAASxL,KAAKojB,+BAAjD,8BAC/B,6BAhEkB,EAAKpd,MAAMG,YAAYc,KAAI,SAAClD,EAAG2e,GACjD,IAAM5E,EAAa,EAAKvf,MAAM6d,KAAKtK,aAAe/N,EAAEjF,GACpD,OACE,yBAAKwM,IAAKoX,EAAQ,IAAM3e,EAAEjF,IACvB,kBAAC,GAAD,CACCsd,KAAM,EAAK7d,MAAM6d,KACjBgF,aAAcrd,EAAEjF,GAChBkf,cAAeja,EAAEia,cACjBuD,kBAAmBxd,EAAEwd,kBACrB/Z,OAAQzD,EAAEyD,OACVC,YAAa1D,EAAE0D,YACfiF,UAAW3I,EAAE2I,UACboR,WAAYA,EACZkC,iBAAkB,EAAKA,iBACvBQ,SAAU,EAAKxa,MAAMwa,SACrB9F,OAAM,EAAK1U,MAAMge,iBAAyBjgB,EAAE2W,KAC5CqE,aAAY,EAAK/Y,MAAMie,uBAA+BlgB,EAAE2W,KACxD4E,aAAc,EAAK/gB,MAAM+gB,aACzBrB,iBAAkBla,EAAEka,iBACpBF,YAAc,EAAKxf,MAAM2d,gBAAkB,EAAK3d,MAAM2d,eAAe7W,UAAa,EAAK9G,MAAM2d,eAAe7W,UAAUmH,MAAQ,IAAM,EAAKjO,MAAM2d,eAAe7W,UAAUoH,IAAM,GAC9KiV,8BAA+B,EAAKnjB,MAAMmjB,8BAC1CF,2BAA4B,EAAKjjB,MAAMijB,iCA6C7C,6BACCsD,IACD,yBAAK3lB,MAAO,CAAE,aAAgB,+BAAgCmiB,QAAS,QACrE,uBAAGniB,MAAO,CAAE+gB,SAAU,SAAtB,8BACA,kBAACpV,EAAA,EAAD,CAAMiE,SAAU/O,KAAKijB,qCAAsCgC,OAAO,QAChE,kBAACxI,GAAA,EAAD,CAAawI,OAAO,OAAOta,KAAK,KAAK7L,GAAG,OAAOoH,KAAK,OAAO3E,MAAOvB,KAAKgG,MAAM8d,mBAAoB7Y,YAAY,gBAAgBrM,UAAU,UAAUsM,SAAU,SAACpL,GAAQ,EAAKojB,4BAA4BpjB,EAAEqL,OAAO5J,UAC9M,kBAACtC,EAAA,EAAD,CAAQgmB,OAAO,OAAOta,KAAK,KAAKzE,KAAK,SAAS/G,MAAO,CAAEqY,OAAQ,QAA/D,YAIJ,6BACA,6BACE,yEACA,2BAAG,uBAAGrM,OAAO,SAASiI,IAAI,sBAAsB7C,KAAM,8DAAgEvQ,KAAKzB,MAAM6d,KAAKtK,YAAnI,sBAEH,2BAAG,uBAAG3G,OAAO,SAASiI,IAAI,sBAAsB7C,KAAM,wDAA0DvQ,KAAKzB,MAAM6d,KAAKtK,YAA7H,+BACH,2BAAG,uBAAG3G,OAAO,SAASiI,IAAI,sBAAsB7C,KAAM,6EAA+EvQ,KAAKzB,MAAM6d,KAAKtK,YAAlJ,4BAEL,6BACA,kBAAC,GAAD,CAAcsK,KAAMpc,KAAKzB,MAAM6d,KAC7B4D,iBAAkBhgB,KAAKggB,iBACvBQ,SAAUxgB,KAAKgG,MAAMwa,SACrBlB,aAActf,KAAKzB,MAAM+gB,aACzBxN,WAAY9R,KAAKzB,MAAM6d,KAAKtK,WAC5B8Q,kBAAmB5iB,KAAKgG,MAAMsd,sBAC9B5B,8BAA+B1hB,KAAKzB,MAAMmjB,8BAC1CF,2BAA4BxhB,KAAKzB,MAAMijB,2BACvCzD,YAAc/d,KAAKzB,MAAM2d,gBAAkBlc,KAAKzB,MAAM2d,eAAe7W,UAAarF,KAAKzB,MAAM2d,eAAe7W,UAAUmH,MAAQ,IAAMxM,KAAKzB,MAAM2d,eAAe7W,UAAUoH,IAAM,W,GAhRvJ+D,IAAMC,WCqIxByU,OAzIf,SAAoB3mB,GAClB,MAAsCgK,qBAAtC,mBAAOd,EAAP,KAAoB0d,EAApB,KACA,EAA4C5c,qBAA5C,mBAAO6c,EAAP,KAAuBC,EAAvB,KACA,EAAkD9c,qBAAlD,mBAAO+c,EAAP,KAA0BC,EAA1B,KACA,EAAwChd,qBAAxC,mBAAOid,EAAP,KAAkBC,EAAlB,KACA,EAAwCld,qBAAxC,mBAAOmd,EAAP,KAAkBC,EAAlB,KACA,EAAwDpd,mBAAS,IAAjE,mBAAOqd,EAAP,KAA6BC,EAA7B,KACA,EAAkDtd,mBAAS,IAA3D,mBAAOud,EAAP,KAA0BC,EAA1B,KACA9b,qBAAU,WAUN,ICZwC+b,EDGxCH,EAAwB,IACxBE,EAAqB,IACrBV,EAAkB,IAClBE,EAAqB,IACrBE,EAAmB,IACnBE,EAAmB,IACnBR,EAAe,IAGIxjB,EC1BT,CACZ,0CACA,IACI,SDuBwCpD,EAAMuT,WCvBtB,kBACxB,iEACA,aACE,+DACA,8DACF,IACH,IACD,yBAAyBvN,KAAK,MDiBjB/D,MAAK,SAACylB,GACf,IAAMjf,EAAWif,EAAGxlB,KAAKsG,QAAQC,SACjC,GAAIA,EAAStE,OAAS,EAAE,CACtB,IAAMwjB,EAAclf,EAAS,GAAGS,aAAeT,EAAS,GAAGS,YAAYlG,MACjE4kB,EAAanf,EAAS,GAAGmf,YAAcnf,EAAS,GAAGmf,WAAW5kB,MACpE4jB,EAAee,GACfC,GAAcC,EAAgBD,OAGVxkB,ECpBZ,CACV,mEACA,UAEA,2GACH,mDAPyCqkB,EDsBuBznB,EAAMuT,YCfP,MAC5D,IAAMkU,EAAW,2DACjB,6EACA,qEACA,iEACA,IACA,8CACAzhB,KAAK,KDSS/D,MAAK,SAAC6lB,GACpB,IAAMrf,EAAWqf,EAAG5lB,KAAKsG,QAAQC,SAGjC,GAAIA,EAAStE,OAAS,GAAiC,MAA5BsE,EAAS,GAAG8a,MAAMvgB,MAAc,CAGzDyF,EAASgD,KAAKsc,GACd,IAAMvf,EAAUC,EAASC,KAAI,SAACsf,GAE5B,OACE,uBAAGjb,IAAKib,EAAK/e,OAAOjG,OAClB,kBAAC,IAAD,CAAMrC,GAAI,oBAAsBqnB,EAAK/e,OAAOjG,OAAQglB,EAAK9e,YAAYlG,OADvE,IAEIglB,EAAKzE,MAAMvgB,UAInBskB,EAAwB9e,OAOPpF,EC3BpB,SAAoCqkB,GAgB3C,MAZc,CACV,sDACA,UACE,gEAAkEA,EAAW,MAC7E,0DACA,gFACA,2GACA,0DACA,iEACF,IACA,iCACAzhB,KAAK,IDY2BiiB,CAA2BjoB,EAAMuT,aAClDtR,MAAK,SAAC6lB,GACjB,IAAMrf,EAAWqf,EAAG5lB,KAAKsG,QAAQC,SAGjC,GAAIA,EAAStE,OAAS,GAAiC,MAA5BsE,EAAS,GAAG8a,MAAMvgB,MAAc,CAE3DyF,EAASgD,KAAKsc,GACd,IAAMvf,EAAUC,EAASC,KAAI,SAACsf,EAAM9L,GAElC,OACE,uBAAGnP,IAAKmP,EAAM,IAAM8L,EAAK/e,OAAOjG,OAC9B,kBAAC,IAAD,CAAMrC,GAAI,oBAAsBqnB,EAAK/e,OAAOjG,OAAQglB,EAAK9e,YAAYlG,OADvE,IAEGglB,EAAKzE,MAAMvgB,UAIlBwkB,EAAqBhf,SAGtB,CAACxI,EAAMuT,aAEZ,IAAMwU,EAAuB,SAACG,EAAGxY,GAE5B,IAAMyY,EAAQD,EAAEhf,YAAYlG,MAAM4L,cAC5BwZ,EAAQ1Y,EAAExG,YAAYlG,MAAM4L,cAInC,OAAIuZ,EAAQC,GACF,EAEND,EAAQC,EACH,EAGF,GAELP,EAAkB,SAACD,GACvB,IAAMS,EAAkBT,EAAW7hB,MAAM,YAAY,GACrDzC,IAAMC,IAAI,wEAA0E8kB,EAAkB,gBAAgBpmB,MAAK,SAACqmB,GACxH,IAAMC,EAAYD,EAAGpmB,KAAKsmB,SAASH,GAAiBI,OAAOC,KAAOJ,EAAGpmB,KAAKsmB,SAASH,GAAiBI,OAAOC,IAAI,GAAGC,SAASC,UAAU5lB,MAC/H6lB,EAAcP,EAAGpmB,KAAKsmB,SAASH,GAAiBS,aAAlC,IAAwDR,EAAGpmB,KAAKsmB,SAASH,GAAiBS,aAAlC,GAAqD9lB,MAC3HikB,EAAYqB,EAAGpmB,KAAKsmB,SAASH,GAAiBI,OAAOM,MAAQT,EAAGpmB,KAAKsmB,SAASH,GAAiBI,OAAOM,KAAK,GAAGJ,SAASC,UAAU5lB,MAAMgmB,KACvI7B,EAAYmB,EAAGpmB,KAAKsmB,SAASH,GAAiBI,OAAOQ,MAAQX,EAAGpmB,KAAKsmB,SAASH,GAAiBI,OAAOQ,KAAK,GAAGN,SAASC,UAAU5lB,MAAMgmB,KAC7I1lB,IAAMC,IAAI,6HAA+HglB,GAAWtmB,MAAK,SAACinB,GACxJ,IAAMC,EAAQD,EAAGhnB,KAAKmB,MAAM8lB,MACtBnE,EAAOwB,OAAOC,KAAK0C,GAAO,GAC1BtT,EAAWqT,EAAGhnB,KAAKmB,MAAM8lB,MAAMnE,GAAMoE,WAAaF,EAAGhnB,KAAKmB,MAAM8lB,MAAMnE,GAAMoE,UAAU,GAAGroB,IAEjG+lB,EAAkBjR,GAClBmR,EAAqB6B,GAGrB3B,EAAmBlP,SAASiP,IAC5BG,EAAmBpP,SAASmP,WAOlC,OACE,yBAAK9mB,UAAWL,EAAMuQ,OAAS,SAAW,WACxC,kBAACjQ,EAAA,EAAD,KACF,8CAAoB4I,EAApB,IAAkC+d,GAAa,IAAMA,EAAY,IAAME,EAAY,KACnF,yBAAKvmB,MAAO,CAACod,QAAS,OAAQC,eAAgB,SAC5C4I,GAAkB,yBAAK7V,IAAI,SAASD,IAAK8V,EAAgB/U,MAAM,UACjE,uBAAGlR,MAAO,CAAC4jB,WAAY,SAAUuC,EAAjC,IAAqDA,GAAqB,eAE1E,6BACE,gEACGM,GAEL,6BACE,4DACGE,MErGQ8B,OAlCjB,SAAiCrpB,GAC/B,IAM+BspB,EAN/B,EAAkCtf,mBAAS,IAA3C,mBAAOuf,EAAP,KAAkBC,EAAlB,KAEMC,EAAmB,SAACxpB,GACxBupB,EAAa,IACbxpB,EAAMypB,iBAAiBxpB,IAsBzB,OACE,6BACM,kBAACie,GAAA,EAAD,CAAa9R,KAAK,KAAKzE,KAAK,OAAO3E,MAAOumB,EAAW7c,YAAa1M,EAAM0pB,gBAAiBrpB,UAAU,UAAUsM,SAAU,SAACpL,GAAOioB,EAAajoB,EAAEqL,OAAO5J,QAASmb,WAAa,SAAC5c,IARzJ,SAACA,GACP,KAAfA,EAAE6c,WACJpe,EAAMypB,iBAAiBloB,EAAEqL,OAAO5J,OAChCwmB,EAAa,KAK0KlL,CAAmB/c,MACrMgoB,GAAa,yBAAKlpB,UAAU,sBAvBNipB,EAuBiDtpB,EAAM2pB,SAtB/DnD,OAAOC,KAAK6C,GAAM5gB,KAAI,SAACzI,GAC1C,MAAkB,MAAdspB,GAGKtpB,EAAE0O,cAAc1K,SAASslB,EAAU5a,eAFlC,0BAAM1B,QAAU,kBAAMwc,EAAiBxpB,IAAK8M,IAAK,YAAc9M,GAAIA,GAMpE,YCmFA2pB,OA9Ff,SAAwB5pB,GACtB,IAAOC,EAAKC,cAALD,EACP,EAA8B+J,mBAAShK,EAAM6pB,SAA7C,mBAAOA,EAAP,KAAgBC,EAAhB,KACA,EAAoC9f,mBAAShK,EAAM+pB,YAAc,cAAjE,mBAAOA,EAAP,KAAmBC,EAAnB,KACMC,EAAoBjqB,EAAM2d,gBAAkB3d,EAAM2d,eAAejY,KAAO1F,EAAM2d,eAAejY,KAAO,GAC1G,EAAoCsE,mBAAUhK,EAAM2d,gBAAkB3d,EAAM2d,eAAeuM,WAAclqB,EAAM2d,eAAeuM,WAAaD,GAA3I,mBAAOE,EAAP,KAAmBC,EAAnB,KACA,EAAgCpgB,mBAAShK,EAAMqqB,WAAY,GAA3D,mBAAOA,EAAP,KAAiBC,EAAjB,KACA,EAAsBtgB,mBAAShK,EAAMuqB,aAA9BA,EAAP,oBACA,EAAkCvgB,mBAAShK,EAAM2pB,UAAY,IAA7D,mBAAOa,EAAP,KAAkBC,EAAlB,KA0BA/e,qBAAU,WACR,IAAMue,EAAoBjqB,EAAM2d,gBAAkB3d,EAAM2d,eAAejY,KAAO1F,EAAM2d,eAAejY,KAAO,GAC1G0kB,EAAepqB,EAAM2d,gBAAkB3d,EAAM2d,eAAeuM,WAAclqB,EAAM2d,eAAeuM,WAAaD,KAC3G,CAACjqB,EAAM2d,iBACVjS,qBAAU,WACW,eAAfqe,GACFK,EAAcpqB,EAAM2d,eAAiB3d,EAAM2d,eAAejY,KAAO,MAGlE,CAACqkB,IAEJ,IAAMjjB,EAAa9G,EAAM2d,gBAAkB3d,EAAM2d,eAAe7W,UAAa9G,EAAM2d,eAAe7W,UAAUmH,MAAQ,IAAMjO,EAAM2d,eAAe7W,UAAUoH,IAAM,GAE/J,OACI,6BACgB,YAAf6b,GACD,6BACE,mDACE,2BAAI/pB,EAAM2d,eAAejY,KAAzB,KACA,0BAAMrF,UAAU,gBAAgBsT,MAAM,+BAA+B1G,QAAS,WAAK+c,EAAc,gBAAjG,IAAkH,kBAAC,KAAD,MAAlH,KACA,mCAASljB,EAAT,OAEF,kBAACoX,GAAA,EAAD,CAAazR,GAAG,WAAW9E,KAAK,OAAOpH,GAAG,aAAamqB,KAAK,IAC5D1nB,MAAOmnB,EAAYzd,YAAazM,EAAE,WAAYI,UAAU,UAAUsM,SAAU,SAACpL,GAAO6oB,EAAc7oB,EAAEqL,OAAO5J,WAG3G,6BACEhD,EAAM2d,gBAAkB3d,EAAM2d,eAAejY,MAC/C,6BACgB,YAAfqkB,EACD,uDAEA,4CAEE,2BAAI/pB,EAAM2d,eAAejY,KAAzB,KACA,0BAAMrF,UAAU,gBAAgBsT,MAAM,YAAY1G,QAAS,WAAK+c,EAAc,aAA9E,IAA4F,kBAAC,KAAD,MAA5F,KACA,mCAASljB,EAAT,QAMF,6CAAkB,2BAAOa,KAAK,WAAW+e,OAAO,OAAOrO,MAAM,aAAasS,SAAUN,EAAU1d,SAAU,SAACpL,GAAO+oB,GAAaD,IAAYzpB,MAAO,CAACod,QAAS,aAC1J,kBAACE,GAAA,EAAD,CAAazR,GAAG,WAAW9E,KAAK,OAAOpH,GAAG,UAAUmqB,KAAK,IAAI1nB,MAAO6mB,EAASnd,YAAazM,EAAE,WAAYI,UAAU,UAAUsM,SAAU,SAACpL,GAAOuoB,EAAWvoB,EAAEqL,OAAO5J,UACjKwnB,GAAa,gDAEZA,EAAU9hB,KAAI,SAACzI,GACb,OAAQ,0BAAM8M,IAAK,OAAQ9M,GAAG,0BAAMgN,QAAS,YAjEjC,SAAChN,GACrB,IAAM2qB,EAAeJ,EAAUvjB,QAAO,SAAC4jB,GACrC,OAAIA,EAAG9kB,MAAM,KAAK,KAAO9F,EAAE8F,MAAM,KAAK,GAC7B8kB,EAGA,QAGXJ,EAAaG,GAwD+CE,CAAc7qB,KAApC,KAAiD,8BAAOA,QAK1F,kBAAC,GAAD,CAAyB0pB,SAAU3pB,EAAM+qB,kBAAmBtB,iBA3EzC,SAACxpB,GACnBuqB,EAAUvmB,SAAShE,IACtBwqB,EAAa,GAAD,mBAAKD,GAAL,CAAgBvqB,MAyEsEypB,gBAAgB,wEAGlH,kBAAChpB,EAAA,EAAD,CAAQ0L,KAAK,KAAMzE,KAAK,SAASsF,QA7DT,SAAC1L,GAC3BA,EAAEyO,iBACF,IAAMgb,EAAcjB,EACpB/pB,EAAMirB,cAAcpB,EAASmB,EAAab,EAAYnqB,EAAM2d,eAAgB4M,EAAaF,EAAUG,GACnGV,EAAW,KAyDsDoB,OAAK,EAACtqB,MAAO,CAACqY,OAAQ,QAAShZ,EAAE,aCgCvFkrB,OA1Hf,SAAsBnrB,GACpB,IAAOC,EAAKC,cAALD,EACP,EAAgC+J,oBAAS,GAAzC,mBAAOohB,EAAP,KAAiBC,EAAjB,KA6BIze,EAA2C,kBAA1B5M,EAAM6pB,QAAQjd,OAAuB5M,EAAM6pB,QAAQjd,OAAS5M,EAAM6pB,QAAQjd,OAAO0e,OAGlGC,OAAmBxM,EACnByM,OAAwBzM,EACxB/e,EAAM6pB,QAAQjd,OAAO6e,WACvBF,EAAmBvrB,EAAM6pB,QAAQjd,OAAO6e,SAASxkB,QAAO,SAACzB,GAAD,MAAmB,sBAAXA,EAAEmC,QAA+B,GAAG+jB,MAGpG9e,GAFA4e,EAAwBxrB,EAAM6pB,QAAQjd,OAAO6e,SAASxkB,QAAO,SAACzB,GAAD,MAAmB,yBAAXA,EAAEmC,QAAkC,IAE1EsG,MAAQrB,EAAS,IAAM4e,EAAsBvd,MAAQ,IAAMud,EAAsBtd,IAAMtB,GAIxH,IA0BqB0c,EA1Bf3L,EAAiB,CACrBjY,KAAM6lB,EACNrB,WAAYlqB,EAAM6pB,QAAQ/mB,KAAK6oB,YAC/B7kB,UAAW0kB,GAcPI,EAAoB,SAACC,EAAQ5rB,GACjC,IAAM6rB,EAAcD,EAAO1mB,QAAQ,wCAAyC,UAC5E,OAAInF,EAAM2pB,SAAS1pB,IAAMD,EAAM2pB,SAAS1pB,GAAG6rB,IAAgB9rB,EAAM2pB,SAAS1pB,GAAG6rB,GAAaC,MACjF/rB,EAAM2pB,SAAS1pB,GAAG6rB,GAAaC,MAG/B,MAgBX,OACI,6BAIE,2BAAI9rB,EAAE,OAAN,KAAe,kBAAC,IAAD,CAAMU,GAAI,oBAAsBiM,GAASA,IAEtDwe,EACA,kBAAC,GAAD,CAAgBH,cAvFH,SAACe,EAAQjC,EAAYI,EAAYxM,EAAgB4M,EAAaF,EAAUG,GAC3FxqB,EAAMisB,cAAcjsB,EAAM6pB,QAAQtpB,GAAIyrB,EAAQ7B,EAAYJ,EAAYpM,EAAgB4M,EAAaF,EAAUG,GAC7Ga,GAAY,IAsFNxB,QAAS7pB,EAAM6pB,QAAQ/mB,KAAKE,MAC5B2a,eAAgBA,EAChBoM,WAAY/pB,EAAM6pB,QAAQE,WAC1BM,UAAUrqB,EAAM6pB,QAAQjd,OACxB2d,YAAavqB,EAAMuqB,YACnBZ,SA/CwB,SAACkC,EAAQvC,GACvC,IAAM4C,EAAgB,GAQtB,OAPI1F,OAAOC,KAAKzmB,EAAM2pB,UAAUxlB,OAAS,GACvCmlB,GAAQ9C,OAAOC,KAAK6C,GAAM7Z,SAAQ,SAACxP,GACnC,IAAMsqB,EAAcqB,EAAkBC,EAAQ5rB,GACxCksB,EAAU5B,EAActqB,EAAI,IAAMsqB,EAActqB,EACtDisB,EAAc3e,KAAK4e,MAGdD,EAsCSE,CAAwBpsB,EAAM6pB,QAAQtpB,GAAIP,EAAM6pB,QAAQP,MAClEyB,kBAAmB/qB,EAAM2pB,WAEzB,2BAIC4B,GAAoB,6CAAkB,2BAAIA,IAC3C,6BAC8B,YAA7BvrB,EAAM6pB,QAAQE,YAA4B,uDAA6B/pB,EAAM6pB,QAAQ/mB,KAAK6oB,YAAY,8BAEvG,8BApGoB,SAAC3oB,GAE3B,IAAMqpB,EAAOrpB,EAAMspB,MAAM,6EACzB,GAAID,EAAK,CACP,IACIE,EAAU,CADMvpB,EAAM+C,MAAMsmB,EAAK,IAAI,IAWzC,OATAA,EAAK5c,SAAQ,SAAC+c,EAAGhnB,GACf,IAAMinB,EAAgB,kBAAC,IAAD,CAAM1f,IAAKyf,EAAG7rB,GAAI,mBAAqB6rB,GAAIA,GAC3DE,EAAW,0BAAM3f,IAAK,KAAOyf,EAAGnsB,UAAU,gBAAgBsT,MAAM,8BAA8B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgB8pB,KAAK,kBAAC,KAAD,OAC9JD,EAAQhf,KAAKkf,GACbF,EAAQhf,KAAKmf,GACb,IACMC,EADc3pB,EAAM+C,MAAMymB,GAAG,GACFzmB,MAAMsmB,EAAK7mB,EAAE,IAAI,GAClD+mB,EAAQhf,KAAKof,MAERJ,EAGP,OAAOvpB,EAkFI4pB,CAAoB5sB,EAAM6pB,QAAQ/mB,KAAKE,QAC9C,6BACA,wCAxCasmB,EAwCYtpB,EAAM6pB,QAAQP,KAvCzC9C,OAAOC,KAAKzmB,EAAM2pB,UAAUxlB,OAAS,EACrBmlB,GAAQ9C,OAAOC,KAAK6C,GAAM5gB,KAAI,SAACzI,GACjD,IAAMsqB,EAAcqB,EAAkB5rB,EAAM6pB,QAAQtpB,GAAIN,GACxD,OAAQ,0BAAM8M,IAAK,OAAS9M,EAAGI,UAAU,gBAAgB4M,QAAS,kBAAMjN,EAAMwpB,aAAavpB,KAAKA,EAAxF,IAA4FsqB,GAAe,kCAAQA,EAAR,KAA3G,QAKD,OAgCH,6BACA,6CAZA,IAY0BvqB,EAAM6pB,QAAQgD,SAAW7sB,EAAM6pB,QAAQgD,QAAQ9mB,MAAM,KAAK,GAZpF,KAaA,0BAAM1F,UAAU,gBAAgB4M,QAAS,WAAOjN,EAAM8sB,cAAc9sB,EAAM6pB,QAAQtpB,MAAM,kBAAC,KAAD,MAAxF,KAbA,KAcA,0BAAMF,UAAU,gBAAgB4M,QAAS,kBAAMoe,GAAY,KAA3D,IAAmE,kBAAC,KAAD,QAGrE,+BCTO0B,GA/GM,SAAC/sB,GAEpB,MAAoCgK,mBAAS,IAA7C,mBAAOgjB,EAAP,KAAmBC,EAAnB,KACA,EAAoCjjB,oBAAS,GAA7C,mBAAOkjB,EAAP,KAAmBC,EAAnB,KACA,EAAkCnjB,mBAAS,MAA3C,mBAAOojB,EAAP,KAAkBC,EAAlB,KAEMC,EAAqB,WAIzBhqB,IAAMiqB,KAAKC,iDAA+BxtB,EAAMytB,aAAaxrB,MAAK,SAACC,GACjE,GAAIA,EAAKA,KAAKnB,IAAI,CAChBZ,QAAQC,IAAI,yBAA0B8B,EAAKA,KAAKnB,KAChD,IAAM0Q,EAAoBvP,EAAKA,KAAKnB,IAEpCssB,EAAa,CAAC9b,IAAKic,+CAA8B/b,SAGjD4b,EAAa,CAAC/b,OAAQpP,EAAKA,KAAKyP,OAAS,qCAAsCJ,IAAK,SAqE1F,OACE,6BACE,0BAAMlR,UAAU,gBAAgB4M,QAAS,kBAAMkgB,GAAeD,KAA9D,UAAkF,kBAAC,KAAD,OACjFA,GACC,6BACE,0BAAM7sB,UAAU,iBAAgB,kBAAC,KAAD,MAAhC,yBACA,6BACA,2BAAOsH,KAAK,OAAOpH,GAAG,QAAQ8b,KAAK,UAAU1P,SApE5B,SAACpL,GACxB,IAAImsB,EAAS,IAAIC,WAEjBD,EAAOE,WAAWrsB,EAAEqL,OAAOihB,MAAM,IACjC,IAAMC,EAAWvsB,EAAEqL,OAAOihB,MAAM,GAAGxR,KAEnCqR,EAAOlsB,OAAS,SAASD,GACvB,IAAIwsB,EAAOL,EAAO/kB,OAElB3I,EAAMguB,iBAAiBC,KAAKC,MAAMH,GAAOD,OA4DrC,6BACA,0BAAMztB,UAAU,iBAAgB,kBAAC,KAAD,MAAhC,oBACA,0BAAMmQ,SAzDU,SAACjP,GACvBA,EAAEyO,iBACF1M,IAAMC,IAAIypB,GAAY/qB,MAAK,SAACmE,GAC1BjG,QAAQC,IAAI,OAAQgG,GACpBpG,EAAMguB,iBAAiB5nB,EAAElE,KAAM8qB,QAqDM,2BAAOrlB,KAAK,OAAO3E,MAAOgqB,EAAYrgB,SAAU,SAACpL,GAAO0rB,EAAc1rB,EAAEqL,OAAO5J,UAAiB,2BAAO2E,KAAK,aAMjJ,6BACA,uBAAGqK,KAjDa,WAElB,IAAM9P,EAAO+rB,KAAKE,UAAUnuB,EAAMytB,YAAa,KAAM,GAErD,MADiB,uCAAyCW,UAAUlsB,GA8CzDmsB,GAAeC,SAzCZtuB,EAAMuuB,gBAAgBxoB,MAAM,SAAS,GAAK,KAAM,IAAIyoB,MAAOC,cAActnB,MAAM,EAAG,KAyC3C,0BAAM9G,UAAU,iBAAhB,UAAuC,kBAAC,KAAD,QApCvF+sB,EAKIA,EAAU7b,IAEjB,2BAAG,uBAAGS,KAAMob,EAAU7b,IAAKsD,IAAI,uBAA5B,aAKH,6BACE,2BAAG,8BAAOuY,EAAU9b,SACpB,2BAAG,0BAAMjR,UAAU,gBAAgB4M,QAASqgB,GAAzC,+BAAH,MAZA,2BAAG,0BAAMjtB,UAAU,gBAAgB4M,QAASqgB,GAAzC,+BAAH,O,SC7DRoB,iBAVe,CACbC,OAAQ,0CACRC,WAAY,6BACZC,YAAa,iDACbC,UAAW,aACXC,cAAe,yBACfC,kBAAmB,eACnBC,MAAO,4CACPC,cAAe,iBAGjB,IAAMC,GAAKT,cACLU,GAAqB,IAAIV,QAAcW,mBCwiB9BC,OA9hBf,SAAmBtvB,GACjB,IAAOC,EAAKC,cAALD,EAEP,EAA0B+J,mBAAS,CAAC,MAAS,KAA7C,mBAAOulB,EAAP,KAAcC,EAAd,KACA,EAAoCxlB,mBAAS,IAA7C,mBAAOylB,EAAP,KAAmBC,EAAnB,KACA,EAAsC1lB,mBAAS,IAA/C,mBAAOuQ,EAAP,KAAoBoV,EAApB,KACA,EAAwB3lB,mBAAS,IAAjC,mBAAOsf,EAAP,KAAasG,EAAb,KACA,EAAkD5lB,oBAAS,GAA3D,mBAAO6lB,EAAP,KAA0BC,EAA1B,KACA,EAA0C9lB,mBAAS,IAAnD,mBAAO+lB,EAAP,KAAsBC,EAAtB,KACA,EAAsChmB,mBAAS,IAA/C,mBAAOimB,EAAP,KAAoBC,EAApB,KAEA,EAA4BlmB,mBAAS,IAArC,mBAAOmmB,EAAP,KAAeC,EAAf,KACA,EAAwCpmB,mBAAS,IAAjD,mBAAOqmB,EAAP,KAAqBC,EAArB,KACA,EAA4CtmB,oBAAS,GAArD,mBAAOumB,EAAP,KAAuBC,EAAvB,KAKF9kB,qBAAU,WACR0kB,EAAUpwB,EAAMmwB,QACVnwB,EAAMmwB,QAA2B,SAAjBnwB,EAAMmwB,QAC1BhB,GAAGvN,IAAI5hB,EAAMmwB,QACVM,KAAK,SACLxuB,MAAK,SAACyuB,GACL,IAAMC,EAAWD,EAASE,MACtBD,GACFhB,EAAegB,EAASpW,aAAe,IACvCqV,EAAQe,EAASrH,MAAQ,MAGzBqG,EAAe,IACfC,EAAQ,UAIX,CAAC5vB,EAAMmwB,SAKZ,IAAMU,EAAkB,SAACrG,EAAWsG,GAClC,IAAMC,EAAiBvG,EAAU9hB,KAAI,SAACzI,GACpC,OAAOA,EAAE8F,MAAM,KAAK,MAGhBirB,EAAe,GACrBxG,EAAU/a,SAAQ,SAACxP,GACjB,IAAM8rB,EAAQ9rB,EAAE8F,MAAM,KAAK,GACrBkrB,EAAQhxB,EAAE8F,MAAM,KAAK,GAC3BirB,EAAaC,KAASlF,GAAQ/T,SAAS+T,MAIxC,IAAMmF,EAAW,gBAAO5H,GAwBxB,OAtBAyH,EAAethB,SAAQ,SAACxP,GAGlBixB,EAAYjxB,IAEV+wB,EAAa/wB,IAEfumB,OAAOC,KAAKyK,EAAYjxB,IAAIwP,SAAQ,SAAC0hB,GAC/BD,EAAYjxB,GAAGkxB,GAAIpF,OAASmF,EAAYjxB,GAAGkxB,GAAIpF,OAASiF,EAAa/wB,KACvEixB,EAAYjxB,GAAGkxB,GAAIpF,MAAQmF,EAAYjxB,GAAGkxB,GAAIpF,MAAQ,MAK5DmF,EAAYjxB,GAAG6wB,IAAQE,EAAa/wB,IAAK,CAAC8rB,MAAOiF,EAAa/wB,MAI9DixB,EAAYjxB,GAAK,GACjBixB,EAAYjxB,GAAG6wB,IAASE,EAAa/wB,IAAK,CAAC8rB,MAAOiF,EAAa/wB,QAG5DixB,GAKJE,EAAuB,SAAC5G,GAC5B,IAAMuG,EAAiBvG,EAAU9hB,KAAI,SAACzI,GACpC,OAAOA,EAAE8F,MAAM,KAAK,MAEhBsrB,EAAY,GAIlB,OAHAN,EAAethB,SAAQ,SAACxP,GACtBoxB,EAAUpxB,IAAK,KAEVoxB,GAuEHC,EAAa,SAAC/wB,GAClB,IAAM+wB,EAAa,SAAW/wB,EAAGwF,MAAM,mBAAmB,GAC1D,OAAOurB,GAiDHC,GAA2B,SAACtxB,GAChCyvB,EAAc,CAACzvB,KAeX6sB,GAAgB,SAACvsB,GAGrB,IAAIixB,EAAiB,gBAAQjX,GAGvBkX,EAAejL,OAAOC,KAAK+K,EAAkBF,EAAW/wB,IAAK+oB,aAE5DkI,EAAkBF,EAAW/wB,IACpC,IAAImxB,EAAU,gBAAQpI,GACtBmI,EAAahiB,SAAQ,SAACkiB,UACbD,EAAWC,GAAIL,EAAW/wB,OAInCovB,EAAe6B,GACf5B,EAAQ8B,IAEJzF,GAAgB,SAAC1rB,EAAIyrB,EAAQ7B,EAAYJ,EAAYpM,EAAgB4M,EAAaF,EAAUG,GAChG,IAAIgH,EAAiB,gBAAQjX,GACvBqX,EAAgBJ,EAAkBF,EAAW/wB,IACnDqxB,EAAc9uB,KAAKE,MAAQgpB,EAC3B4F,EAAc9uB,KAAK6oB,YAAcxB,EACjCyH,EAAc7H,WAAaA,EAE3B6H,EAAchlB,QAASyd,GAAmBuH,EAAchlB,OACxDglB,EAActI,KAAO8H,EAAqB5G,GAE1C,IAAMsG,EAAOQ,EAAW/wB,GAClB2wB,EAAcL,EAAgBrG,EAAWsG,GAgB/CnB,EAAe6B,GACf5B,EAAQsB,IAEVxlB,qBAAU,WACRwkB,EAAe2B,QAEd,CAAC7xB,EAAMuT,aAEV,IAAMse,GAAiB,WACrB,GAAIrL,OAAOC,KAAKlM,GAAapW,OAAS,EAAE,CACtC,IAAI8rB,EAAczJ,OAAOC,KAAKlM,GAAa7R,KAAI,SAACopB,GAC9C,OAAIvX,EAAYuX,GAAGhvB,KAAKE,OAASuX,EAAYuX,GAAGhvB,KAAKE,MAAMiB,SAASjE,EAAMuT,WAAWxN,MAAM,cAAc,GAAGA,MAAM,KAAK,IACnE,kBAA3BwU,EAAYuX,GAAGllB,OAAuB2N,EAAYuX,GAAGllB,OAAS2N,EAAYuX,GAAGllB,OAAO0e,YAI3G,KAIJ,OADA2E,EAAcA,EAAYhpB,QAAO,SAACzB,GAAO,YAAauZ,IAANvZ,KAIhD,MAAO,IAuBXkG,qBAAU,WAOR,GAAIyjB,IAAM3I,OAAOC,KAAKlM,GAAapW,OAAS,EAC1C,IACEgrB,GAAGvN,IAAIuO,GAAQ4B,IAAI,CAACxX,YAAaA,EAAa+O,KAAMA,IAEtD,MAAO/nB,GACLpB,QAAQC,IAAI,qBAAsBmB,MAIrC,CAACgZ,EAAagV,EAAOjG,IAgBxB,IAAM0I,GAAmB,WACvB,IAAIC,EAAW,GACf,GAAKxC,EAKA,GAA0B,IAAtBA,EAAWtrB,OAAa,CAC/B,IAAM0I,EAAK4iB,EAAW,GAChByC,EAAc,gBAAO3X,GACzBiM,OAAOC,KAAKyL,GAAgBziB,SAAQ,SAACyY,GACrC,OAAIoB,GAAQA,EAAKzc,IAAO2Z,OAAOC,KAAK6C,EAAKzc,IAAK5I,SAASikB,IACjDoB,EAAKzc,GAAIqb,GAAG6D,QACdmG,EAAehK,GAAf,MAA6BoB,EAAKzc,GAAIqb,GAAG6D,OAEpCkG,EAAS1kB,KAAK2kB,EAAehK,KAG7B,YAIT,CACF,IAAMgK,EAAc,gBAAO3X,GACzBiM,OAAOC,KAAKyL,GAAgBziB,SAAQ,SAACyY,GACnC,OAAIgK,EAAehK,GAAGoB,MAChBmG,EAAW0C,OAAM,SAAAvuB,GAAO,OAAI4iB,OAAOC,KAAKyL,EAAehK,GAAGoB,MAAMrlB,SAASL,MACpEquB,EAAS1kB,KAAK2kB,EAAehK,IAO/B,aA/BZ1B,OAAOC,KAAKlM,GAAa9K,SAAQ,SAAC2iB,GAChCH,EAAS1kB,KAAKgN,EAAY6X,OA8C/B,OAZCH,EAASxmB,MAAK,SAACyc,EAAExY,GACf,OAAIwY,EAAE6D,MAAQrc,EAAEqc,MACP,EAEA7D,EAAE6D,MAAQrc,EAAEqc,OACX,EAGD,KAILkG,GAqDT,OACE,kBAAC3xB,EAAA,EAAD,CAAWD,UAAWL,EAAMuQ,OAAS,SAAW,WAC5CvQ,EAAMmwB,QAA2B,SAAjBnwB,EAAMmwB,OACxB,oCACA,kBAAC,GAAD,CACElF,cAxWgB,SAACpB,EAASE,EAAYI,EAAYxM,EAAgB4M,EAAaF,EAAUG,GAC7F,IACM6H,EAAS,wCADE5c,OAEXqb,EAAOQ,EAAWe,GAClBC,EAAa,IAAI9D,KAGjB0C,EAAcL,EAAgBrG,EAAWsG,GAE3C7iB,EAAQ,GACRC,EAAM,GAENyP,GAAkBA,EAAe7W,YACnCmH,EAAQ0P,EAAe7W,UAAUmH,MACjCC,EAAMyP,EAAe7W,UAAUoH,KAE/B,IAAMud,EAAW,CACjB,CACE,KAAQ,oBACR,MAAS9N,EAAiBA,EAAejY,KAAO,IAElD,CACE,KAAQ,uBACR,MAASuI,EACT,IAAOC,IAGLqkB,EAAa,CACjB,WAAY,mCACZ,GAAMF,EACN,KAAQ,aACR,QAAWC,EAAW7D,cACtB,QA3Ba,yCA4Bb,WAAc1E,EACd,KAAQqH,EAAqB5G,GAC7B,KAAQ,CACN,KAAQ,cACR,MAASX,GAEX,QAAWQ,GAAY,CACrBiB,OAAQtrB,EAAMuT,WACdif,QAAS,6BAA+BxyB,EAAMuT,WAAWxN,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC3F0lB,SAAUA,IAKK,YAAf1B,EACFwI,EAAWzvB,KAAK6oB,YAAcxB,SAGvBoI,EAAWzvB,KAAX,YAETktB,EAAiB,IAEjB,IAAMyC,EAAkB,gBAAOlY,GAC/BkY,EAAmB3B,GAAQyB,EAE3B5C,EAAe8C,GACf7C,EAAQsB,IA8SJvT,eAAgB3d,EAAM2d,eACtB+U,SAAU1yB,EAAM0yB,SAChBnI,YAAa/D,OAAOC,KAAKlM,GAAapW,OACtC4mB,kBAAmBzB,IAErB,6BACA,yBAAK/oB,GAAG,wBAEHsvB,EAAoB,kBAACnvB,EAAA,EAAD,CAAQ0L,KAAK,KAAKumB,UAAQ,GAAE1yB,EAAE,sCAAiD,kBAACS,EAAA,EAAD,CAAQH,GAAG,uBAAuB6L,KAAK,KAAKa,QAAS,kBAAM6iB,GAAqB,KAAQ7vB,EAAE,sCAC5L4vB,EAA6F,kBAACnvB,EAAA,EAAD,CAAQH,GAAG,uBAAuB6L,KAAK,KAAKa,QAAS,kBAAM6iB,GAAqB,KAAhF,sCAAzE,kBAACpvB,EAAA,EAAD,CAAQ0L,KAAK,KAAKumB,UAAQ,GAA1B,uCAG1B,yBAAKpyB,GAAG,uBACN,6BACA,kBAAC2d,GAAA,EAAD,CAAa9R,KAAK,KAAKzE,KAAK,OAAO3E,MAAO+sB,EAAerjB,YAAazM,EAAE,2BAA4BI,UAAU,UAAUsM,SAAU,SAACpL,GAAOyuB,EAAiBzuB,EAAEqL,OAAO5J,WAEpK,kBAAC,GAAD,CAAyB2mB,SAAUL,EAAMG,iBA7QpB,SAACxpB,GACrBwvB,EAAWxrB,SAAShE,IACvByvB,EAAc,GAAD,mBAAKD,GAAL,CAAiBxvB,MA2QmDypB,gBAAgB,6CAEhG+F,GAAc,8CAEXA,EAAW/mB,KAAI,SAACzI,GACd,OAAQ,0BAAM8M,IAAK,OAAQ9M,GAAG,0BAAMgN,QAAS,YA1Q3B,SAAChN,GAC3B,IAAM2yB,EAAgBnD,EAAWxoB,QAAO,SAAC4jB,GACvC,OAAIA,EAAG9kB,MAAM,KAAK,KAAO9F,EAAE8F,MAAM,KAAK,GAC7B8kB,EAGA,QAGX6E,EAAckD,GAiQ8CC,CAAoB5yB,KAA1C,KAAuD,8BAAOA,QAKlG,6BACCgwB,EAAY9rB,OAAS,GACtB,6BACE,+CACC8rB,EAAYvnB,KAAI,SAAC0a,GACd,OACE,6BACA,kBAAC,IAAD,CAAMrW,IAAKqW,EAAGziB,GAAI,mBAAqByiB,GAAIA,GAC3C,0BAAM/iB,UAAU,gBAAgBsT,MAAM,8BAA8B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgB0gB,KAAK,kBAAC,KAAD,WAKpI,8BAGF,6BAjGoB,WACtB,IAAM6O,EAAWD,KAEXc,EAAkBb,EAAS9tB,OAAS,GAAK8tB,EAAS9qB,MAAM,GAAGuB,KAAI,SAACopB,EAAEtsB,GACtE,IAAMoH,EAA8B,kBAAdklB,EAAEllB,OAAuBklB,EAAEllB,OAASklB,EAAEllB,OAAO0e,OACnE,OAAIuE,EACEjjB,GAAUA,EAAO3I,SAASjE,EAAM6iB,eAAkBiP,EAAEhvB,KAAKE,OAAS8uB,EAAEhvB,KAAKE,MAAMiB,SAAS8rB,GAExF,yBAAKhjB,IAAKvH,GACR,kBAAC,GAAD,CAAcqkB,QAASiI,EAAGiB,SAAS,EAAMjG,cAAeA,GAAeb,cAAeA,GACtF+G,qBAAsBhzB,EAAMgzB,qBAAsBxJ,aAAc+H,GAA0B5H,SAAUL,KAQjG,KAIL1c,GAAUA,EAAO3I,SAASjE,EAAM6iB,eAAkBiP,EAAEhvB,KAAKE,OAAS8uB,EAAEhvB,KAAKE,MAAMiB,SAAS8rB,GAExF,yBAAKhjB,IAAKvH,EAAG5E,MAAO,CAAC2gB,WAAY,oBAC/B,kBAAC,GAAD,CAAcsI,QAASiI,EAAGhF,cAAeA,GAAeb,cAAeA,GAAezC,aAAc+H,GAA0B5H,SAAUL,KAOrIwI,EAAEhvB,KAAKE,OAAS8uB,EAAEhvB,KAAKE,MAAMiB,SAAS8rB,GAE3C,yBAAKhjB,IAAKvH,GACR,kBAAC,GAAD,CAAcqkB,QAASiI,EAAGhF,cAAeA,GAAeb,cAAeA,GAAezC,aAAc+H,GAA0B5H,SAAUL,KAQrI,QAIb,OAAOwJ,EAmDFA,IAGH,6BACE,0BAAMzyB,UAAU,gBAAgB4M,QAAS,WAAOujB,GAAmBD,KAAnE,eACEA,GACF,6BACCF,GAAgB,gDAEfA,EAAa3nB,KAAI,SAACzI,GAChB,OAAQ,0BAAM8M,IAAK,OAAQ9M,GAAG,0BAAMgN,QAAS,YApUzB,SAAChN,GAC7B,IAAMgzB,EAAkB5C,EAAappB,QAAO,SAAC4jB,GAC3C,OAAIA,EAAG9kB,MAAM,KAAK,KAAO9F,EAAE8F,MAAM,KAAK,GAC7B8kB,EAGA,QAGXyF,EAAgB2C,GA2T4CC,CAAsBjzB,KAA5C,KAAyD,8BAAOA,QAKlG,6BAAK,kBAAC,GAAD,CAAyB0pB,SAAUL,EAAMG,iBA7TnB,SAACxpB,GAC3BowB,EAAapsB,SAAShE,IAC3BqwB,EAAgB,GAAD,mBAAKD,GAAL,CAAmBpwB,MA2T4DypB,gBAAgB,6CAC1G,uBAAGzc,QAAS,YAlWO,SAACkmB,GACxB,IAAI3B,EAAiB,gBAAQjX,GACzBmX,EAAU,gBAAQpI,GAEhB8J,EAAgB,GAEtBD,EAAa1jB,SAAQ,SAACxP,GACpB,IAAMozB,EAAgB7M,OAAOC,KAAKiL,EAAWzxB,IAC7CmzB,EAAc7lB,KAAK8lB,GACnBA,EAAc5jB,SAAQ,SAACyY,UACdsJ,EAAkBtJ,GAAGoB,KAAKrpB,aAG5ByxB,EAAWzxB,MAEpBqzB,MAAM,gEAAkEF,EAAcjvB,OAAS,eAC/FyrB,EAAQ8B,GACR/B,EAAe6B,GAiVQ+B,CAAiBlD,KAApC,iBAKF,kBAACmD,GAAD,CAAuB/F,YAAauE,KAAoBzD,gBAAiBkB,EAAWzpB,KAAK,MAAQ,MAAOgoB,iBAhOnF,SAACD,EAAM0F,GAK9B,IACE,IAAMC,EAAa3F,EACb1R,EAAiBoX,EvC6DRtuB,QAAQ,48DAAsB,IAEpCA,QAAQ,uBAAuB,SAASQ,EAAMwe,GAExD,OAAiB,IAAVA,EAAcxe,EAAKgJ,cAAgBhJ,EAAKiJ,iBAChDzJ,QAAQ,OAAQ,KuClEsBsQ,OACpC8Z,EAAMlT,GAAQqX,EACdlE,EAAS,gBACJD,IAIP,MAAOhuB,GACLpB,QAAQC,IAAI,QAASmB,QAoNvB,kE,mBC9ZWoyB,G,kDA1Hb,WAAY3zB,GAAO,IAAD,8BAChB,cAAMA,IACDkT,QAAU,GACf,EAAKzL,MAAQ,CACXmsB,KAAM,GACNC,OAAQ,GACRC,KAAM,GACNC,OAAQ,GACRC,KAAM,GAENC,UAAU,GAVI,E,oDAclB,SAAiBtY,GAAa,IzB0qBiBuY,EyB1qBlB,OACvBvY,IACFla,KAAKiQ,SAAS,CAACuiB,UAAU,IACS7wB,EzBwqBrB,CACZ,mLACA,IACA,KAJ0C8wB,EyBvqB6BvY,GzB2qB/C,mEACxB,IAAMuY,EAAkB,sDACxB,+EACA,IACC,oGACD,IACA,QACA,IACC,yDACA,oDACD,IACA,aACE,sEACA,iEACF,IACA,6EACA,IACA,2FACA,IACA,QACA,IACC,sDACA,8CACD,IACA,aACC,gEACF,IACC,aACE,4EACA,iEACF,IAEA,WACE,IAEC,IACE,6DACA,mDACA,4EACF,IACA,QAEA,IACE,wEACA,yEACF,IACA,QAEA,IACE,sEACA,wEACF,IACA,gFACA,2EACA,wEACA,+DACD,IACF,IACA,2BAA2BluB,KAAK,KyBpuBP/D,MAAK,SAACC,GAC9B,IAAMiyB,EAAcjyB,EAAKA,KAAKsG,QAAQC,SACtC,GAAI0rB,EAAYhwB,OAAS,EAAE,CACzB,IAAMsE,EAAW0rB,EAAY,GACvBtR,EAAepa,EAASG,WAAaH,EAASG,WAAW5F,MAAQ,GACjEoxB,EAAkB3rB,EAASkY,cAAgBlY,EAASkY,cAAc3d,MAAQ,GAC1EqxB,EAAa5rB,EAAS4rB,WAAa5rB,EAAS4rB,WAAWrxB,MAAQ,GAC/DkG,EAAcT,EAASS,YAAcT,EAASS,YAAYlG,MAAQ,GAClEiG,EAASR,EAASQ,OAASR,EAASQ,OAAOjG,MAAQ,GACnDsxB,EAAc7rB,EAAS6rB,YAAc7rB,EAAS6rB,YAAYtxB,MAAQ,GAClEuxB,EAAS9rB,EAAS8rB,OAAS9rB,EAAS8rB,OAAOvxB,MAAQ,GACnDwxB,EAAa/rB,EAAS+rB,WAAa/rB,EAAS+rB,WAAWxxB,MAAQ,GAC/D2Q,EAAQlL,EAASgsB,WAAahsB,EAASgsB,WAAWzxB,MAAQ,GAC1DiL,EAAQxF,EAAS2R,aAAe3R,EAAS2R,aAAapX,MAAQ,GAC9DkL,EAAMimB,EAAYA,EAAYhwB,OAAS,GAAGiW,aAAe+Z,EAAYA,EAAYhwB,OAAS,GAAGiW,aAAapX,MAAQ,GACpH,EAAKkQ,SACP,EAAKxB,SACH,CACEzI,OAAQA,EACRC,YAAaA,EACbqrB,OAAQA,EACRD,YAAaA,EACbV,KAAM/Q,EACNgR,OAAQQ,EACRP,KAAMM,EACNL,OAAQ9lB,IAAUC,EAAMyF,EAAQ,KAAO1F,EAAQ,IAAMC,EAAMyF,EAAQ,KAAO1F,EAC1E+lB,KAAMrY,EACN6Y,WAAYA,EACZP,UAAU,W,+BASxB,WACExyB,KAAKyR,SAAU,EACfzR,KAAKizB,iBAAiBjzB,KAAKzB,MAAM2b,e,gCAInC,SAAmB/J,GACbnQ,KAAKzB,MAAM2b,cAAgB/J,EAAU+J,aACvCla,KAAKizB,iBAAiBjzB,KAAKzB,MAAM2b,e,kCAGrC,WACEla,KAAKyR,SAAU,I,oBAEjB,WAAS,IAAD,OAEAyhB,EAAqBlzB,KAAKgG,MAAMyB,YAAc,KAAOzH,KAAKgG,MAAMosB,OAAS,IAAMpyB,KAAKgG,MAAMssB,OAAS,kBAAoBtyB,KAAKgG,MAAM+sB,WAAa,IAC/I1tB,EAAYrF,KAAKzB,MAAM2d,gBAAkBlc,KAAKzB,MAAM2d,eAAe7W,WACvErF,KAAKzB,MAAM2d,eAAe7W,UAAUmH,MAAQ,IAAMxM,KAAKzB,MAAM2d,eAAe7W,UAAUoH,IACxF,OACE,kBAAC5N,EAAA,EAAD,KACA,wCACCmB,KAAKgG,MAAMwsB,SACV,kBAAC,EAAD,MACF,6BACE,uBAAG5zB,UAAU,UAAUoB,KAAKgG,MAAMyB,YAAlC,KAAiDzH,KAAKgG,MAAMosB,OAA5D,IAAqE/sB,GAAaA,GAAa,KAAOA,EAAtG,KAAkH,uBAAGkL,KAAMvQ,KAAKgG,MAAMmsB,KAAMhnB,OAAO,SAASiI,IAAI,uBAAuBpT,KAAKgG,MAAMmsB,KAAM9sB,GAAa,IAAMA,GAA3N,IAA0O,0BAAMzG,UAAU,gBAAgBsT,MAAM,6BAA6B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgBoE,EAAY,EAAKW,MAAMmsB,KAAO,IAAM9sB,EAAY,EAAKW,MAAMmsB,QAAQ,kBAAC,KAAD,OAAra,KAEA,uBAAGvzB,UAAU,UACVoB,KAAKgG,MAAM8sB,QAAU,qCAAW9yB,KAAKgG,MAAM6sB,YAAtB,MAErB7yB,KAAKgG,MAAMssB,QAAUtyB,KAAKgG,MAAMssB,OAAS,IAH5C,IAKG,uBAAG/hB,KAAMvQ,KAAKgG,MAAMqsB,KAAMlnB,OAAO,SAASiI,IAAI,uBAAuBpT,KAAKgG,MAAMqsB,KAAMhtB,GAAa,IAAMA,GAE1G,0BAAMzG,UAAU,gBAAgBsT,MAAM,6BAA6B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgBoE,EAAY,EAAKW,MAAMqsB,KAAO,IAAMhtB,EAAY,EAAKW,MAAMqsB,QAAQ,kBAAC,KAAD,OAP7L,KAUA,uBAAGzzB,UAAU,UACX,0DACA,uBAAG2R,KAAMvQ,KAAKgG,MAAMusB,KAAMpnB,OAAO,SAASiI,IAAI,uBAAuBpT,KAAKgG,MAAMusB,KAAMltB,GAAa,IAAMA,GACzG,0BAAMzG,UAAU,gBAAgBsT,MAAM,6BAA6B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgBoE,EAAY,EAAKW,MAAMusB,KAAO,IAAMltB,EAAY,EAAKW,MAAMusB,QAAQ,kBAAC,KAAD,OAC3L,6BACA,+CACA,uBAAGhiB,KAAMvQ,KAAKgG,MAAM+sB,WAAY5nB,OAAO,SAASiI,IAAI,uBAApD,IAA4EpT,KAAKgG,MAAM+sB,YACvF,0BAAMn0B,UAAU,gBAAgBsT,MAAM,6BAA6B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgB,EAAK+E,MAAM+sB,cAAc,kBAAC,KAAD,QAEnJ,uBAAGn0B,UAAU,gBAAgBsT,MAAM,6BAA6B1G,QAAS,SAAC1L,GAAOA,EAAEyO,iBAAkBtN,EAAgBiyB,KAAsB,kBAAC,KAAD,MAA3I,0C,GAtGe1iB,IAAMC,WCgCd0iB,G,kDA1Cb,WAAY50B,GAAO,IAAD,8BAChB,cAAMA,IACD60B,0BAA4B,EAAKA,0BAA0BxjB,KAA/B,gBACjC,EAAK5J,MAAQ,CACXqtB,yBAAyB,GAJX,E,6DAOlB,WACErzB,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAACwhB,yBAA0BxhB,EAAUwhB,8B,oBAGhD,WACE,OACE,kBAACx0B,EAAA,EAAD,CAAWD,UAAU,uBACrB,uBAAG4M,QAASxL,KAAKozB,2BAA4BpzB,KAAKgG,MAAMqtB,wBAA0B,8BAAM,kBAAC,KAAD,MAAN,0CAAsE,8BAAM,kBAAC,KAAD,MAAN,0CAAxJ,KACCrzB,KAAKgG,MAAMqtB,yBACV,6BACE,mlBAUA,kHAEA,uBAAGz0B,UAAU,UAAb,0HAEA,uBAAGA,UAAU,UAAb,qGAEA,uBAAGA,UAAU,UAAb,mI,GAnCwB4R,IAAMC,WCqEzB6iB,G,kDAlEb,WAAY/0B,GAAO,IAAD,8BAChB,cAAMA,IACDg1B,gCAAkC,EAAKA,gCAAgC3jB,KAArC,gBACvC,EAAK5J,MAAQ,CACXwtB,+BAA+B,GAJjB,E,mEAOlB,WACExzB,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAAC2hB,+BAAgC3hB,EAAU2hB,oC,oBAGtD,WAAS,IAAD,OACAnuB,EAAYrF,KAAKzB,MAAM2d,gBAAkBlc,KAAKzB,MAAM2d,eAAe7W,WACvErF,KAAKzB,MAAM2d,eAAe7W,UAAUmH,MAAQ,IAAMxM,KAAKzB,MAAM2d,eAAe7W,UAAUoH,IAqBxF,OACE,kBAAC5N,EAAA,EAAD,CAAWD,UAAU,qBACpBoB,KAAKzB,MAAMk1B,gBACV,wBAAIjoB,QAASxL,KAAKuzB,iCAAkCvzB,KAAKgG,MAAMwtB,8BAAgC,8BAAM,kBAAC,KAAD,MAAN,mCAA+D,8BAAM,kBAAC,KAAD,MAAN,mCAA9J,KAGA,wDAOCxzB,KAAKgG,MAAMwtB,+BAhCgB,WAC9B,GAAI,EAAKj1B,MAAM6gB,eAeb,OAduB,EAAK7gB,MAAM6gB,eAAenY,KAAI,SAAClD,GACpD,OAAI,EAAKxF,MAAM2b,YAAY1X,SAASuB,EAAEmb,eAC5B,uBAAG5T,IAAKvH,EAAEmb,eACfnb,EAAEob,mBAAoB9Z,GAAa,IAAMA,EADpC,qBAKA,uBAAGiG,IAAKvH,EAAEmb,eAChB,kBAAC,IAAD,CAAMhgB,GAAImG,EAAY,oBAAsBtB,EAAEmb,cAAgB,IAAM7Z,EAAY,oBAAsBtB,EAAEmb,eACvGnb,EAAEob,mBAAoB9Z,GAAa,IAAMA,OAqBHquB,Q,GAjDrBljB,IAAMC,WCetCyhB,GAASyB,UAAY,CAKnBzZ,YAAa0Z,KAAU1yB,OAAO2yB,WAU9BzU,eAAgBwU,KAAUE,MAI1BhlB,OAAQ8kB,KAAUG,KAKlBnX,kBAAmBgX,KAAUI,MAEhBC,OAxCf,SAAyB11B,GACvB,OACE,kBAACM,EAAA,EAAD,CAAWD,UAAWL,EAAMuQ,OAAS,yBAA2B,2BAC9D,kBAAC,GAAD,CAAUoL,YAAa3b,EAAM2b,YAAagC,eAAgB3d,EAAM2d,iBAChE,kBAAC,GAAD,MACA,6BACA,kBAAC,GAAD,CACAhC,YAAa3b,EAAM2b,YACnBkF,eAAgB7gB,EAAM6gB,eACtBlD,eAAgB3d,EAAM2d,mBC0EbgY,OArFf,SAAkB31B,GAChB,MAA0BgK,mBAAS,IAAnC,mBAAO4rB,EAAP,KAAcC,EAAd,KA6EA,OAtBAnqB,qBAAU,WAtDgB,IAACnL,EAAIoH,EAAJpH,EAuDPP,EAAMuT,WAnDVnQ,EADD,aAHgBuE,EAuDO3H,EAAM81B,mBAnDnBjjB,GAAwBtS,GAE7B,WAAToH,EACcmL,GAAuBvS,GAE5B,aAAToH,EACcgL,GAAyBpS,GAGzBkS,GAAalS,IAE1B0B,MAAK,SAACmE,GACdjG,QAAQC,IAAI,KAAMG,EAAI,OAAQoH,EAAM,OAAQvB,GAC5C,IAAMlE,EAAOkE,EAAElE,KAAKsG,QAAQC,SAC5B,GAAIvG,EAAKiC,OAAS,GAAKjC,EAAK,GAAG6zB,QAAQ,CACrC,IAGIC,EAHoB9zB,EAAKwG,KAAI,SAACtC,GAChC,OAAOA,EAAEwC,WAAaxC,EAAEwC,WAAW5F,MAAQ,MAEhBiE,QAAO,SAACgvB,EAAGzwB,EAAG0iB,GAAP,OAAaA,EAAEgO,QAAQD,KAAOzwB,KAC9D2wB,EAAiB,GACrBH,EAAOvmB,SAAQ,SAAClO,GACb40B,EAAe50B,GAAK,MAEvBW,EAAKuN,SAAQ,SAACrJ,GACV,IAAMyX,EAAO,CACXjV,WAAYxC,EAAEwC,WAAW5F,MACzB8F,gBAAiB1C,EAAEgwB,sBAAsBpzB,MACzC2d,cAAeva,EAAEua,cAAc3d,MAC/B+yB,QAAS3vB,EAAE2vB,QAAQ/yB,MACnBoX,aAAchU,EAAEiwB,cAAcrzB,MAC9B8Q,cAAe1N,EAAEkwB,+BAAiClwB,EAAEkwB,+BAA+BtzB,MAAQ,IAE/FmzB,EAAe/vB,EAAEwC,WAAW5F,OAAOuK,KAAKsQ,MAYzCgY,EAASM,SASb,CAACn2B,EAAMuT,aAoBR,yBAAKlT,UAAWL,EAAMuQ,OAAS,SAAW,WAlBvB,WACjB,IAAMgmB,EAAe/P,OAAOC,KAAKmP,GAAOltB,KAAI,SAACqE,GAC3C,OACE,uBAAGA,IAAK6oB,EAAM7oB,GAAK,GAAGnE,YACtB,8BACA,kBAAC,IAAD,CAAMjI,GAAI,oBAAsBi1B,EAAM7oB,GAAK,GAAGgpB,SAAUH,EAAM7oB,GAAK,GAAGqN,cADtE,IAGA,kBAAC,IAAD,CAAMzZ,GAAI,oBAAsBi1B,EAAM7oB,GAAK6oB,EAAM7oB,GAAK5I,OAAS,GAAG4xB,SAAUH,EAAM7oB,GAAK6oB,EAAM7oB,GAAK5I,OAAS,GAAGiW,eACtG,KACR,kBAAC,IAAD,CAAMzZ,GAAI,oBAAsBi1B,EAAM7oB,GAAK,GAAG4T,eAAgBiV,EAAM7oB,GAAK,GAAGjE,iBAAwB,KACnG8sB,EAAM7oB,GAAK,GAAG+G,eAAiB8hB,EAAM7oB,GAAK,GAAG+G,kBAKlD,OAAOyiB,EAINA,K,cCHQC,G,kDAxEb,WAAYx2B,GAAO,IAAD,8BAChB,cAAMA,IACDy2B,8BAAgC,EAAKA,8BAA8BplB,KAAnC,gBACrC,EAAK6B,SAAU,EACf,EAAKzL,MAAQ,CACXkU,YAAa,GACbxN,UAAW,KACXuoB,mBAAmB,GAPL,E,iEAUlB,WACEj1B,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAACojB,mBAAoBpjB,EAAUojB,wB,gCAG1C,SAAmBC,GAAuB,ICzBDpjB,EDyBA,OAC1BnQ,ECzBA,CACX,8CACA,WACE,IACE,KALiCmQ,ED0BSojB,GCrBvB,2EACnB,yFACF,IACA,QACA,IACE,SAAWpjB,EAAa,4BACxB,gEACF,IACA,QACA,IACE,IAAMA,EAAa,4EACrB,IACA,qEACA,wDACA,wDACF,KACEvN,KAAK,MDOJ/D,MAAK,SAACmE,GACL,EAAK8M,SACP,EAAKxB,SACH,CACEiK,YAAavV,EAAElE,KAAKsG,QAAQC,SAAS,GAAGia,eAAe1f,MACvDmL,UAAW/H,EAAElE,KAAKsG,QAAQC,SAAS,GAAG0F,UAAUnL,WAIvD+V,OAAM,SAACxX,GACN,EAAKmQ,SAAS,CAACiK,YAAa,U,+BAQhC,WACEla,KAAKyR,SAAU,EACfzR,KAAKm1B,mBAAmBn1B,KAAKzB,MAAM22B,yB,gCAErC,SAAmB/kB,GACbA,EAAU+kB,wBAA0Bl1B,KAAKzB,MAAM22B,uBACjDl1B,KAAKm1B,mBAAmBn1B,KAAKzB,MAAM22B,yB,kCAGvC,WAEEl1B,KAAKyR,SAAU,I,oBAEjB,WAAS,IAAD,OACAmZ,EAAQ5qB,KAAKzB,MAAM62B,kBAAoBp1B,KAAKzB,MAAM82B,eACtDr1B,KAAKgG,MAAMkU,YAAc,IAAMla,KAAKzB,MAAM62B,iBAAmB,IAAMp1B,KAAKzB,MAAM82B,eAC9Er1B,KAAKgG,MAAMkU,YACPob,EAAkBt1B,KAAKzB,MAAMg3B,yBAA2Bv1B,KAAKzB,MAAMg3B,wBAAwBlwB,WAAcrF,KAAKzB,MAAMg3B,wBAAwBlwB,UAAUmH,MAAQ,IAAMxM,KAAKzB,MAAMg3B,wBAAwBlwB,UAAUoH,IAGvN,OACE,kBAAC5N,EAAA,EAAD,CAAWD,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WAErD,qCAAU,kBAAC,IAAD,CAAMtD,QAAS,WAAO,EAAKjN,MAAMi3B,6BAA6B,CAAC,CAAC12B,GAAI,EAAKP,MAAMgjB,kBAAmBhV,MAAO+oB,MAAoBp2B,GAAI,oBAAsB0rB,GAAO5qB,KAAKgG,MAAM0G,YAElL1M,KAAKgG,MAAMkU,aACX,6BACE,kBAAC,YAAD,CAAUA,YAAala,KAAKgG,MAAMkU,YAAa1N,MAAO+J,SAASvW,KAAKzB,MAAM62B,kBAAmBzyB,KAAM4T,SAASvW,KAAKzB,MAAM82B,gBAAiBI,SAAS,U,GAhEzHjlB,IAAMC,W,IEiPxBilB,G,kDAnOb,WAAYn3B,GAAO,IAAD,8BAChB,cAAMA,IACDo3B,8BAAgC,EAAKA,8BAA8B/lB,KAAnC,gBACrC,EAAKgmB,6BAA+B,EAAKA,6BAA6BhmB,KAAlC,gBACpC,EAAKimB,sBAAwB,EAAKA,sBAAsBjmB,KAA3B,gBAC7B,EAAKkmB,uBAAyB,EAAKA,uBAAuBlmB,KAA5B,gBAC9B,EAAK5J,MAAQ,CACXG,YAAa,GACb4vB,WAAY,GACZC,gBAAgB,EAChBC,WAAW,EACXr0B,MAAO,IAXO,E,yDAclB,WACE5B,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACLokB,WAAYpkB,EAAUokB,gB,0CAI5B,SAA6B7W,EAAgB8W,GAC3C,IAAIjX,EAAoB,GAGpBG,aAA0BjR,MAC5B8Q,EAAoBG,EAAenY,KAAI,SAAC0a,GACtC,MAAO,CACLzC,cAAeyC,EAAE,OAAOje,QAAQ,SAAU,8BAC1Cyb,mBAAoBwC,EAAE,OAAOje,QAAQ,SAAU,8BAA8BY,MAAM,cAAc,GACjGsZ,cAAe,OAKZwB,IACPH,EAAoB,CAAC,CACnBC,cAAeE,EAAe,OAAO1b,QAAQ,SAAU,8BACvDyb,mBAAoBC,EAAe,OAAO1b,QAAQ,SAAU,8BAA8BY,MAAM,cAAc,GAC9GsZ,cAAe,MAGnBlf,QAAQC,IAAI,oBAAqBsgB,GACjC,IACMkX,EADSn2B,KAAKzB,MAAMwS,UAAUzM,MAAM,cAAc,GAC/BA,MAAM,KAAK,GAC9B8xB,EAA+BnX,EAAoBA,EAAkBzZ,QAAO,SAACmc,GAAD,OAAOA,EAAEzC,cAAc1c,SAAS2zB,MAAY,GAAGjX,cAAgB,GAEjJ,MAAO,CACLmX,uBAAwBpX,EACxBmX,6BAA8BA,K,2CAIlC,SAA8BF,GAC5Bl2B,KAAKiQ,UAAS,SAAC4B,GACb,IAAM1G,EAAS0G,EAAU1L,YAAY0c,MAAK,SAAC/iB,GAAD,OAAOA,EAAEshB,eAAiB8U,KAGpE,OAFA/qB,EAAOmrB,cAAgBnrB,EAAOmrB,aAEvB,CACLnwB,YAFkB,YAAO0L,EAAU1L,mB,yCAOzC,SAA4B+vB,GAC1Bl2B,KAAKiQ,UAAS,SAAC4B,GACb,IAAM1G,EAAS0G,EAAU1L,YAAY0c,MAAK,SAAC/iB,GAAD,OAAOA,EAAEshB,eAAiB8U,KAGpE,OAFA/qB,EAAOorB,qBAAuBprB,EAAOorB,oBAE9B,CACLpwB,YAFkB,YAAO0L,EAAU1L,mB,oCAOzC,SAAuB+vB,GACrBl2B,KAAKiQ,UAAS,SAAC4B,GACb,IAAM1G,EAAS0G,EAAU1L,YAAY0c,MAAK,SAAC/iB,GAAD,OAAOA,EAAEshB,eAAiB8U,KAGpE,OAFA/qB,EAAO4T,YAAc5T,EAAO4T,WAErB,CACL5Y,YAFkB,YAAO0L,EAAU1L,mB,iCASzC,SAAoB4K,GAAW,IAAD,OACtBnP,EC5GF,SAAwBmP,GAmB7B,MAlBc,CACZ,6CACA,YACA,IACA,uDACA,gDACA,IACA,QACA,IACA,2DAA6DA,EAAY,MACzE,wGACA,6EACA,oEACA,6EACA,sEACA,4DACA,KACAxM,KAAK,ID0FQuM,CAAeC,GACTpP,EAASC,GACjBpB,MAAK,SAACmE,GAChB,GAAIA,EAAElE,KAAK,UAAU,CACnB,IAAMA,EAAOkE,EAAElE,KAAK,UACpB/B,QAAQC,IAAI,OAAQ8B,GACpB,IAAM0F,EAAc,GACpB1F,EAAKuN,SAAQ,SAAClO,GACZ,IAAIA,EAAE,0BAYJ,OAAO,KAXP,IAAMu2B,EAAyB,EAAKT,6BAA6B91B,EAAE,0BAA2BA,EAAE,OAAO4D,QAAQ,SAAU,+BACzHyC,EAAY2F,KAAK,CACfsV,aAActhB,EAAE,OAAO4D,QAAQ,SAAU,8BACzC0b,eAAgBtf,EAAE,0BAClBu2B,uBAAwBA,EACxBC,cAAc,EACdC,qBAAqB,EACrBxX,YAAY,OAOlB,IAAIgX,EAAa,GACjBt1B,EAAKuN,SAAQ,SAAClO,GACRA,EAAE,uBACJi2B,EAAWj2B,EAAE,OAAO4D,QAAQ,SAAU,+BAAiC5D,EAAE,qBAAqB,OAAO4D,QAAQ,SAAU,kCAG3H,EAAKuM,SAAS,CACZ9J,YAAaA,EACb4vB,WAAYA,EACZn0B,MAAOA,U,+BAMf,WACE5B,KAAKwZ,oBAAoBxZ,KAAKzB,MAAMwS,a,gCAEtC,SAAmBZ,GACbnQ,KAAKzB,MAAMwS,YAAcZ,EAAUY,WACrC/Q,KAAKwZ,oBAAoBxZ,KAAKzB,MAAMwS,a,oBAGxC,WAAS,IAAD,OAkEN,OACE,yBAAKnS,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WAC/C,yCACE,yBAAK3P,MAAO,CAAC,SAAY,SACzB,yDAA8B,kBAACF,EAAA,EAAD,CAAQ0L,KAAK,KAAK/L,UAAU,gBAAgB4M,QAASxL,KAAK61B,uBAAwB71B,KAAKgG,MAAMiwB,UAAY,aAAe,cACrJj2B,KAAKgG,MAAMiwB,WAAa,2BAAIj2B,KAAKgG,MAAMpE,OArEtC,EAAKoE,MAAMG,YAAYzD,OAAS,EACd,EAAKsD,MAAMG,YAAYc,KAAI,SAACnH,GAC9C,IAAIsf,EAAiB,GAErB,GAAIjR,MAAMC,QAAQtO,EAAEsf,gBAClBA,EAAiBtf,EAAEsf,eAAenY,KAAI,SAACuvB,GACrC,IAAM7U,EAAI6U,EAAO,OAAO9yB,QAAQ,SAAU,8BAC1C,OACI,yBAAK4H,IAAKqW,GACV,8BAAOA,EAAP,IAAU,kBAAC,IAAD,CAAMziB,GAAI,oBAAsByiB,GAAG,kBAAC,KAAD,QAC7C,6BACA,0BAAMxiB,MAAO,CAAC,WAAc,SAA5B,2BAA8D,EAAK6G,MAAM+vB,WAAWpU,GAApF,IAAwF,kBAAC,IAAD,CAAMziB,GAAI,oBAAsB,EAAK8G,MAAM+vB,WAAWpU,IAAI,kBAAC,KAAD,QAClJ,6BACA,sCAMD,GAAI7hB,EAAEsf,eAAe,CACxB,IAAMuC,EAAI7hB,EAAEsf,eAAe,OAAO1b,QAAQ,SAAU,8BACpD0b,EACI,yBAAK9T,IAAKqW,GACV,8BAAOA,EAAP,IAAU,kBAAC,IAAD,CAAMziB,GAAI,oBAAsByiB,GAAG,kBAAC,KAAD,QAC7C,6BACA,0BAAMxiB,MAAO,CAAC,WAAc,SAA5B,2BAA8D,EAAK6G,MAAM+vB,WAAWpU,GAApF,IAAwF,kBAAC,IAAD,CAAMziB,GAAI,oBAAsB,EAAK8G,MAAM+vB,WAAWpU,IAAI,kBAAC,KAAD,QAClJ,6BACA,mCAKFvC,EAAiB,GAEvB,OACE,yBAAK9T,IAAKxL,EAAEshB,cACZ,6BACA,2BAAIthB,EAAEshB,aAAN,IAAoB,kBAAC,IAAD,CAAMliB,GAAI,oBAAsBY,EAAEshB,cAAc,kBAAC,KAAD,QACpE,kBAACniB,EAAA,EAAD,CAAQ6G,QAAQ,kBAAkB6E,KAAK,KAAK8e,OAAK,EAACje,QAAS,kBAAM,EAAKsqB,uBAAuBh2B,EAAEshB,gBAAgBthB,EAAEif,WAAa,cAAgB,eAC5I,6BACEjf,EAAEif,YAAejf,EAAEu2B,wBAA0Bv2B,EAAEu2B,uBAAuBA,uBAAuB3zB,OAAS,GACxG,kBAAC,mBAAD,CAAiB4I,IAAKxL,EAAEshB,aAAchC,eAAgBtf,EAAEu2B,uBAAuBA,uBAAwBhX,qBAAsBvf,EAAEu2B,uBAAuBD,6BAA8B9d,mBAAmB,YAAYjI,MAAM,MAAMvB,QAAQ,IAExOhP,EAAEy2B,oBACD,6BACE,kBAACt3B,EAAA,EAAD,CAAQ6G,QAAQ,kBAAkB6E,KAAK,KAAK8e,OAAK,EAACje,QAAS,WAAO,EAAKirB,4BAA4B32B,EAAEshB,gBAArG,wBACF,6BACChC,GAED,6BACE,kBAACngB,EAAA,EAAD,CAAQ6G,QAAQ,kBAAkB6E,KAAK,KAAK8e,OAAK,EAACje,QAAS,WAAO,EAAKirB,4BAA4B32B,EAAEshB,gBAArG,wBACA,kCASD,W,GAtMW5Q,IAAMC,WEXjBimB,OATf,SAAuBn4B,GACrB,OACE,yBAAKK,UAAWL,EAAMuQ,OAAS,SAAW,WACxC,+CC0BS6nB,OA3Bf,SAAoBp4B,GAElB,MAAqBgK,mBAAS,WAAvBquB,EAAP,oBAEA,OACE,yBAAKh4B,UAAWL,EAAMuQ,OAAS,wBAA0B,0BAOrDvQ,EAAM0F,MAAyC,IAAjC1F,EAAM0F,KAAKK,MAAM,KAAK5B,QACtC,yBAAK9D,UAAU,mBAEE,YAAfg4B,EAA2B,4BAAQh4B,UAAU,cAAcsT,MAAM,UAAU5C,IAAK,gCAAkC/Q,EAAM0F,OAExH,4BAAQrF,UAAU,cAAcsT,MAAM,iBAAiB5C,IAAK,mDAAqD/Q,EAAM0F,UCrBxH,SAAS4yB,GAAuBC,GACnC,IAAIC,EAAiB,GACnB,OAAQD,GACR,IAAK,aACHC,EAAejrB,KAAK,gBACpBirB,EAAejrB,KAAK,eACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,UACpB,MACF,IAAK,YACHirB,EAAejrB,KAAK,iBACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,UACpB,MACF,IAAK,SACHirB,EAAejrB,KAAK,cACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,UACpB,MACF,IAAK,QACHirB,EAAejrB,KAAK,SACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,UACpB,MACF,IAAK,iBACDirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,UACpB,MACJ,IAAK,OACHirB,EAAejrB,KAAK,gBACpBirB,EAAejrB,KAAK,eACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,UACpBirB,EAAejrB,KAAK,OACpBirB,EAAejrB,KAAK,YACpBirB,EAAejrB,KAAK,sBAKtB,OAAOirB,E,IC2ZEC,G,kDAzab,WAAYz4B,GAAO,IAAD,8BAChB,cAAMA,IACD04B,0BAA4B,EAAKA,0BAA0BrnB,KAA/B,gBACjC,EAAKsnB,0BAA4B,EAAKA,0BAA0BtnB,KAA/B,gBAEjC,EAAK5J,MAAQ,CACX+U,WAAY,GACZoc,YAAa,CACXC,aAAa,EACbC,UAAU,EACVC,UAAU,EACVC,KAAK,EACLC,QAAS,EACTC,aAAa,EACbC,UAAU,GAEZC,yBAAyB,GAhBX,E,6DAsBlB,SAA0BC,GACxB53B,KAAKzB,MAAM04B,0BAA0Bj3B,KAAKzB,MAAM2c,SAAU0c,K,uCAG5D,SAA0B1Y,GAIxB,IAAM2Y,EAAoB3Y,EAAc5a,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC1EtE,KAAKzB,MAAM24B,0BAA0Bl3B,KAAKzB,MAAM2c,SAAU2c,K,+BAE5D,WACE73B,KAAKiQ,SACH,CAAC8K,WAAY/a,KAAKzB,MAAMwc,e,gCAG5B,SAAmB5K,GAGjB,IAAI2nB,EAAiB,GACrB,GAAI93B,KAAKzB,MAAMuT,aAAe3B,EAAU2B,YACtCgmB,EAAiB,CACfV,aAAa,EACbC,UAAU,EACVC,UAAU,EACVC,KAAK,EACLC,QAAS,EACTC,aAAa,EACbC,UAAU,IAGG13B,KAAKzB,MAAMwc,aAAc,EACxC/a,KAAKiQ,SACH,CACE8K,WAAY/a,KAAKzB,MAAMwc,WACvBoc,YAAaW,SAId,GAAI93B,KAAKzB,MAAMwc,aAAe5K,EAAU4K,WAAW,CACtD,IAAMgd,EAAe/3B,KAAKgG,MAAMmxB,YAChCY,EAAa/3B,KAAKzB,MAAMwc,aAAc,EACtC+c,EAAiBC,EACjB/3B,KAAKiQ,SACH,CAAC8K,WAAY/a,KAAKzB,MAAMwc,WACxBoc,YAAaW,SAIfA,EAAiB93B,KAAKgG,MAAMmxB,c,oBAIhC,WAAS,IAAD,OAwRR,OACE,yBAAKv4B,UAAWoB,KAAKzB,MAAMod,WAAa,IAAM3b,KAAKzB,MAAMod,WAAa3b,KAAKzB,MAAM6c,iBAC/E,kBAAC,GAAD,CAAcH,gBAAiBjb,KAAKzB,MAAM0c,gBAC1CO,YAAaxb,KAAKzB,MAAMid,YACxBH,eAAgBrb,KAAKzB,MAAM8c,eAC3BE,eAAgBvb,KAAKzB,MAAMgd,eAC3BD,eAAgBtb,KAAKzB,MAAM+c,eAC3BK,WAAY3b,KAAKzB,MAAMod,WACvBP,gBAAiBpb,KAAKzB,MAAM6c,gBAC5BF,SAAUlb,KAAKzB,MAAM2c,SACrBH,WAAY/a,KAAKzB,MAAMwc,WACvBid,MAAOh4B,KAAKzB,MAAMuT,WAClBmmB,mBAAoBj4B,KAAKzB,MAAM05B,mBAC/Bvc,sBAAuB1b,KAAKzB,MAAMmd,sBAClCD,eAAgBzb,KAAKzB,MAAMkd,eAC3Byc,WAAYl4B,KAAKzB,MAAM6d,KACvB5B,cApEuB,WACvB,IAAM2d,EAAoBtB,GAAuB,EAAKt4B,MAAMu4B,cAC5D,MAAO,CACP,CACElc,KAAM,WACNI,KAAM,gBACNN,KAAMyd,EAAkB31B,SAAS,iBAC9B21B,EAAkB31B,SAAS,iBAC3B21B,EAAkB31B,SAAS,eAC3B21B,EAAkB31B,SAAS,aAC3B21B,EAAkB31B,SAAS,iBAC9B2Y,KAAM,kBAAC,KAAD,OAER,CACEP,KAAM,WACNI,KAAM,SACNN,KAAMyd,EAAkB31B,SAAS,YACjC2Y,KAAM,kBAAC,KAAD,OAER,CACEP,KAAM,MACNI,KAAM,kBACNN,KAAMyd,EAAkB31B,SAAS,OACjC2Y,KAAM,kBAAC,KAAD,OAER,CACEP,KAAM,cACNI,KAAM,mBACNN,KAAMyd,EAAkB31B,SAAS,gBAC9B21B,EAAkB31B,SAAS,SAC9B2Y,KAAM,kBAAC,KAAD,OAER,CACEP,KAAM,WACNI,KAAM,WACNN,KAAMyd,EAAkB31B,SAAS,YACjC2Y,KAAM,kBAAC,KAAD,OAER,CACEP,KAAM,qBACNI,KAAM,eACNN,KAAMyd,EAAkB31B,SAAS,sBACjC2Y,KAAM,kBAAC,KAAD,OAER,CACEP,KAAM,SACNI,KAAM,cACNN,KAAMyd,EAAkB31B,SAAS,UACjC2Y,KAAM,kBAAC,KAAD,QAoBOid,KAEa,aAA1Bp4B,KAAKgG,MAAM+U,YAAuD,eAA1B/a,KAAKgG,MAAM+U,YAClD,kBAAC,GAAD,CACHqB,KAAMpc,KAAKzB,MAAM6d,KACjBD,uBAAwBnc,KAAKzB,MAAM4d,uBACnCS,kBAAmB5c,KAAKzB,MAAMqe,kBAC9BV,eAAgBlc,KAAKzB,MAAM2d,iBA3RR,WAanB,IAAMic,EAAoBtB,GAAuB,EAAKt4B,MAAMu4B,cAC5D,OACE,6BAUIqB,EAAkB31B,SAAS,iBAEA,gBAA1B,EAAKwD,MAAM+U,YAAgC,EAAK/U,MAAMmxB,YAAYC,cAEnE,kBAAC,GAAD,CACEhb,KAAM,EAAK7d,MAAM6d,KACjBkD,aAAwC,iBAA1B,EAAK/gB,MAAMod,WAAgC,OAAS,MAClE7M,OAAkC,gBAA1B,EAAK9I,MAAM+U,WACnBmB,eAAgB,EAAK3d,MAAM2d,eAC3BsF,2BAA4B,EAAKjjB,MAAMijB,2BACvCE,8BAA+B,EAAKnjB,MAAMmjB,gCAI5CyW,EAAkB31B,SAAS,kBAEA,aAA1B,EAAKwD,MAAM+U,YAA6B,EAAK/U,MAAMmxB,YAAYO,WAEhE,kBAAC,GAAD,CACAxd,YAAa,EAAK3b,MAAM6d,KAAKtK,WAAa,EAAKvT,MAAMwU,QACrDjB,WAAY,EAAKvT,MAAM6d,KAAKtK,WAC5BsN,eAAgB,EAAK7gB,MAAM6d,KAAKgD,eAChCxC,kBAAmB,EAAKre,MAAMqe,kBAC9B9N,OAAkC,aAA1B,EAAK9I,MAAM+U,WACnBmB,eAAgB,EAAK3d,MAAM2d,iBAI3Bic,EAAkB31B,SAAS,gBAEA,aAA1B,EAAKwD,MAAM+U,YAA6B,EAAK/U,MAAMmxB,YAAYO,WAEhE,kBAAC,GAAD,CACE5lB,WAAY,EAAKvT,MAAMuT,WACvBhD,OAAkC,aAA1B,EAAK9I,MAAM+U,aAIrBod,EAAkB31B,SAAS,mBAEA,aAA1B,EAAKwD,MAAM+U,YAA6B,EAAK/U,MAAMmxB,YAAYO,WAEhE,kBAAC,GAAD,CACE5lB,WAAY,EAAKvT,MAAMuT,WACvBhD,OAAkC,aAA1B,EAAK9I,MAAM+U,aAIrBod,EAAkB31B,SAAS,WAEA,gBAA1B,EAAKwD,MAAM+U,YAAgC,EAAK/U,MAAMmxB,YAAYC,cAEnE,kBAAC,GAAD,CACErmB,UAAW,EAAKxS,MAAMwS,UACtBe,WAAY,EAAKvT,MAAMuT,WACvBuiB,kBAAmB,EAAK91B,MAAM81B,kBAC9BvlB,OAAkC,gBAA1B,EAAK9I,MAAM+U,aAIrBod,EAAkB31B,SAAS,cAEA,aAA1B,EAAKwD,MAAM+U,YAA6B,EAAK/U,MAAMmxB,YAAYE,WAEhE,kBAAC,mBAAD,CACAz4B,UAAU,iBACVwgB,eAAgB,EAAK7gB,MAAM6d,KAAKgD,eAEhCC,qBAAsB,EAAK9gB,MAAM85B,yBAA2B,EAAK95B,MAAMuT,WAAa,IAAM,EAAKvT,MAAM85B,yBAA2B,EAAK95B,MAAMuT,WAAa,IAAM,EAAKvT,MAAMwU,QAAQzO,MAAM,KAAK,GAC5LgU,mBAAoB,EAAK/Z,MAAM+Z,mBAC/B2e,0BAA2B,EAAKA,0BAChCC,0BAA2B,EAAKA,0BAChC7mB,MAAiC,iBAA1B,EAAK9R,MAAMod,WAAgC,IAAO,IACzD1C,YAAa,EAAK1a,MAAM0a,YACxBnK,OAAkC,aAA1B,EAAK9I,MAAM+U,WACnB0E,UAAW,EAAKlhB,MAAM2d,eAAe7W,WAAa,EAAK9G,MAAM2d,eAAe7W,UAAUmH,MACtFkT,QAAS,EAAKnhB,MAAM2d,eAAe7W,WAAa,EAAK9G,MAAM2d,eAAe7W,UAAUoH,MAIlF0rB,EAAkB31B,SAAS,cAEA,aAA1B,EAAKwD,MAAM+U,YAA6B,EAAK/U,MAAMmxB,YAAYG,WAEhE,kBAAC,GAAD,CACExlB,WAAY,EAAKvT,MAAMuT,WAAa,EAAKvT,MAAMwU,QAC/CqO,aAAc,EAAK7iB,MAAMuT,WACzBhD,OAAkC,aAA1B,EAAK9I,MAAM+U,WACnBmB,eAAgB,EAAK3d,MAAM2d,eAC3BwS,OAAQ,EAAKnwB,MAAMmwB,SAGtByJ,EAAkB31B,SAAS,SACE,QAA1B,EAAKwD,MAAM+U,YAAwB,EAAK/U,MAAMmxB,YAAYI,MAE9D,kBAAC,GAAD,CACArd,YAAa,EAAK3b,MAAM6d,KAAO,EAAK7d,MAAM6d,KAAKtK,WAAa,EAAKvT,MAAMwU,QAAU,EAAKxU,MAAM+5B,UAAUnxB,WAAa,EAAK5I,MAAMwU,QAC9HjE,OAAkC,QAA1B,EAAK9I,MAAM+U,aAMrBod,EAAkB31B,SAAS,uBAE3B,kBAAC,GAAD,CACEqQ,gBAAiB,EAAKtU,MAAM6d,KAAO,EAAK7d,MAAM6d,KAAKtK,WAAa,EAAKvT,MAAM+5B,UAAUnxB,WACrF2K,WAAY,EAAKvT,MAAM6d,KAAKE,SAC5BpK,MAAO,EAAK3T,MAAM6d,KAAKE,SACvBxN,OAAkC,uBAA1B,EAAK9I,MAAM+U,WACnBhI,QAAS,EAAKxU,MAAMwU,QACpBE,gBAAgB,IAGlBklB,EAAkB31B,SAAS,aAE3B,kBAAC,GAAD,CACEsP,WAAY,EAAKvT,MAAMuT,WACvBuiB,kBAAmB,EAAK91B,MAAM81B,kBAC9BvlB,OAAkC,aAA1B,EAAK9I,MAAM+U,aAMnBod,EAAkB31B,SAAS,WAE7B,kBAAC,EAAD,CACEsM,OAAkC,WAA1B,EAAK9I,MAAM+U,WACnBlS,UAAW,EAAKtK,MAAM6d,KAAO,EAAK7d,MAAM6d,KAAKE,SAAuC,eAA5B,EAAK/d,MAAMu4B,cAAiC,EAAKv4B,MAAMuT,WAC/GlL,aAAc,EAAKrI,MAAM6d,KAAO,EAAK7d,MAAM6d,KAAK5U,OAAqC,WAA5B,EAAKjJ,MAAMu4B,cAA6B,EAAKv4B,MAAMuT,WAC5G/I,YAAyC,mBAA5B,EAAKxK,MAAMu4B,cAAqC,EAAKv4B,MAAMuT,WACxEtL,gBAA6C,cAA5B,EAAKjI,MAAMu4B,cAAgC,EAAKv4B,MAAMuT,WACvEtJ,WAAW,OACX0G,YAAY,EACZ3D,wBAAwB,EACxB0D,YAAY,EACZvG,WAAa,EAAKnK,MAAM2d,gBAAkB,EAAK3d,MAAM2d,eAAejY,KAAQ,IAAM,EAAK1F,MAAM2d,eAAejY,KAAO,IAAM,KAM/F,gBAA1B,EAAK+B,MAAM+U,YAxLH,EAAKxc,MAAMg6B,mBAAmBtxB,KAAI,SAAClD,EAAG2e,GAClD,OACE,kBAAC,GAAD,CAAoBpX,IAAKoX,EAC3BwS,sBAAuBnxB,EAAEjF,GACzBs2B,iBAAkBrxB,EAAEwI,MAAQxI,EAAEwI,MAAMjI,MAAM,KAAK,GAAK,KACpD+wB,eAAgBtxB,EAAEwI,MAAQxI,EAAEwI,MAAMjI,MAAM,KAAK,GAAK,KAClDsY,kBAAmB,EAAKre,MAAMqe,kBAC9B9N,OAAkC,gBAA1B,EAAK9I,MAAM+U,WACnBya,6BAA8B,EAAKj3B,MAAMi3B,6BACzCjU,kBAAmB,EAAKhjB,MAAM6d,KAAK6E,eACnCsU,wBAAyB,EAAKh3B,MAAM2d,oBAiLL,eAA1B,EAAKlW,MAAM+U,YAA+B,EAAKxc,MAAM2d,eAAejY,MACrE,kBAAC,GAAD,CAAYA,KAAM,EAAK1F,MAAM2d,eAAejY,KAAM6K,OAAkC,eAA1B,EAAK9I,MAAM+U,aAG3C,mBAA1B,EAAK/U,MAAM+U,YACX,6BACG,EAAK/U,MAAM2xB,wBACZ,kBAAC,kBAAD,CAAgBa,cAAe,EAAKj6B,MAAM2d,eAAe7W,UAA1B,CAC5B,EAAK9G,MAAMuT,WAAa,IAAM,EAAKvT,MAAM2d,eAAe7W,UAAUmH,MAAQ,IAAM,EAAKjO,MAAM2d,eAAe7W,UAAUoH,KADxF,mBACgG,EAAKlO,MAAMk6B,uBAD3G,CAE5B,EAAKl6B,MAAMuT,YAFiB,mBAEF,EAAKvT,MAAMk6B,uBACxCC,uBAAwB,EAAKn6B,MAAMqe,oBAEnC,kBAAC,kBAAD,CAAgB4b,cAAa,CAAG,EAAKj6B,MAAMuT,YAAd,mBAA6B,EAAKvT,MAAMk6B,uBACnEC,uBAAwB,EAAKn6B,MAAMqe,oBAErC,uBAAGpR,QAAS,WAAO,EAAKyE,SAAS,CAAC0nB,yBAA0B,EAAK3xB,MAAM2xB,4BAA6B,EAAK3xB,MAAM2xB,wBAA0B,gCAAkC,+BAInJ,aAA1B,EAAK3xB,MAAM+U,YAEX,kBAAC,GAAD,CACEhK,UAAW,EAAKxS,MAAMwS,UACtBkI,YAAa,EAAK1a,MAAM0a,YACxBqD,SAAU,EAAK/d,MAAM6d,KAAKE,SAC1B9D,yBAA0B,EAAKja,MAAMia,yBACrCa,sBAAuB,EAAK9a,MAAM8a,sBAClCvK,OAAkC,aAA1B,EAAK9I,MAAM+U,cAwF1B4d,Q,GA9XenoB,IAAMC,W,mBCoCbmoB,GA3DM,SAACr6B,GACpB,MAAkCgK,qBAAlC,mBAAOswB,EAAP,KAAkBC,EAAlB,KACA,EAA4CvwB,qBAA5C,mBAAOwwB,EAAP,KAAuBC,EAAvB,KACA/uB,qBAAU,WACRgvB,MACC,IAIH,IAAMA,EAAQ,WACZp3B,IAAM,qCAAqCrB,MAAK,SAACmE,GACjDm0B,EAAan0B,EAAElE,KAAKy4B,IACpBF,EAAkBr0B,EAAElE,KAAKy4B,GAAG50B,MAAM,KAAK,GAAK,IAAMK,EAAElE,KAAKy4B,GAAG50B,MAAM,KAAK,GAAK,IAAMK,EAAElE,KAAKy4B,GAAG50B,MAAM,KAAK,QAInG60B,EAAiB,CACrB,YAAa,CACX,KAAQ,4BACR,QAAW,oEACX,QAAW,wBAEb,cAAe,CACb,KAAQ,4BACR,QAAW,oEACX,QAAW,wBAEb,YAAa,CACX,KAAQ,2BACR,QAAW,sEACX,QAAW,4BAcTC,EAVgB,WACpB,GAAID,EAAeJ,GACjB,OAAOI,EAAeJ,GAGtB,IAAMM,EAAaC,KAAKC,MAAMD,KAAKE,SAASzU,OAAOC,KAAKmU,GAAgBz2B,QAClE+2B,EAAW1U,OAAOC,KAAKmU,GAAgBE,GAC7C,OAAOF,EAAeM,GAGPC,GACnB,OACEb,EACA,yBAAKj6B,UAAU,YACb,8BAAM,uBAAGO,MAAO,CAAC,MAAS,sBAAuBoR,KAAK,sCAAsCpF,OAAO,SAASiI,IAAI,sBAAsBlB,MAAM,kCAAtI,oBAAN,SACA,uBAAG3B,KAAM6oB,EAAWO,QAASxuB,OAAO,SAASiI,IAAI,sBAAsBlB,MAAO,mDAAqDknB,EAAWxe,MAC5I,yBAAKrL,IAAI,cAAce,OAAO,OAAOhB,IAAK8pB,EAAWjiB,YAKzD,MC9BWyiB,mBApBI,SAACr7B,GAEhB,IAAQC,EAAMD,EAANC,EACR,OACE,kBAACq7B,GAAA,EAAD,CAAQC,GAAG,QAAQh0B,QAAQ,QAAQi0B,OAAO,KAAKC,MAAM,UACnD,kBAACH,GAAA,EAAOI,OAAR,CAAeC,gBAAc,qBAC7B,kBAACL,GAAA,EAAOM,SAAR,CAAiBr7B,GAAG,oBACpB,kBAACyb,GAAA,EAAD,KACGhc,EAAM6N,UAAY,kBAAC,IAAD,CAASxN,UAAU,WAAWM,GAAI,oBAAsBX,EAAM6N,SAAW7N,EAAMwU,SAAUvU,EAAE,aAC7GD,EAAM+N,MAAQ,kBAAC,IAAD,CAAS1N,UAAU,WAAWM,GAAI,oBAAsBX,EAAM+N,KAAO/N,EAAMwU,SAAUvU,EAAE,SACrGD,EAAM+d,UAAY,kBAAC,IAAD,CAAS1d,UAAU,WAAWM,GAAI,oBAAsBX,EAAM+d,UAAW9d,EAAE,cAC7FD,EAAM67B,QAAU,0BAAMx7B,UAAU,WAAW4M,QAAS,kBAAIjN,EAAM87B,wBAAwB77B,EAAE,aAAsB,0BAAMI,UAAU,WAAW4M,QAAS,kBAAIjN,EAAM87B,wBAAwB77B,EAAE,eACvL,kBAAC,GAAD,Y,SC+aKqM,G,kDAzbb,WAAYtM,GAAO,IAAD,8BAChB,cAAMA,IACD+7B,aAAe,EAAKA,aAAa1qB,KAAlB,gBACpB,EAAK2qB,kBAAoB,EAAKA,kBAAkB3qB,KAAvB,gBACzB,EAAK4qB,kBAAoB,EAAKA,kBAAkB5qB,KAAvB,gBACzB,EAAK6qB,0BAA4B,EAAKA,0BAA0B7qB,KAA/B,gBACjC,EAAK8qB,0BAA4B,EAAKA,0BAA0B9qB,KAA/B,gBACjC,EAAK+qB,qBAAuB,EAAKA,qBAAqB/qB,KAA1B,gBAC5B,EAAK6B,QAAU,GACf,EAAKzL,MAAQ,CACXwsB,UAAU,EAGVtW,eAAgB,GAChB0e,gBAAiB,GACjBhE,WAAY,IAfE,E,gDAkBlB,SAAaiE,EAAKve,EAAUwe,EAAU5e,GAAgB,IvDeb5c,EuDfY,OAC7C8kB,EAAQpkB,KAEd,GAAI66B,EAAI,CAEN,IAAMA,EAAM76B,KAAKzB,MAAMs8B,IACjBve,EAAWtc,KAAKzB,MAAM+d,SACtBye,EAAcF,EAAIv2B,MAAM,YAAY,GACpC02B,EAAmB1e,EAAShY,MAAM,cAAc,GAElDlE,EAAS,GAEXA,EADEy6B,EAAIr4B,SAAS,QACNq4B,EAGA,oDAAsDG,EAAmB,IAAMD,EAK1F/6B,KAAKiQ,SAAS,CAACuiB,UAAU,KvDLYlzB,EuDOac,EvDN/CyB,IAAMC,IAAI,yEAA2ExC,IuDOzEkB,MAAK,SAACC,GAGnB,EAAKwP,SAAS,CAACuiB,UAAU,IAIzB1xB,SAASm6B,eAAe,QAAQC,UAAY,GAC5Cp6B,SAASm6B,eAAe,QAAQC,UAAYz6B,EAAKA,KAEjD,EAAK06B,UAAU/W,EAAO0W,EAAU5e,MAEjC5E,OAAM,SAACxX,GAEiBK,EAAcC,EApBxB,uBAqBEI,MAAK,SAACC,GACnB,EAAKwP,SAAS,CAACuiB,UAAU,IACzB1xB,SAASm6B,eAAe,QAAQC,UAAY,GAC5Cp6B,SAASm6B,eAAe,QAAQ35B,YAAYb,GAE5C,EAAK06B,UAAU/W,EAAO0W,EAAU5e,MAC7B5E,OAAM,SAACxX,GAERpB,QAAQC,IAAI,uBAAwBmB,GACpCgB,SAASm6B,eAAe,QAAQC,UAAY,GAC5Cp6B,SAASm6B,eAAe,QAAQC,UAAY,gF,uBAMtD,SAAU9W,EAAO0W,EAAU5e,GAgJvB,SAASkf,EAAKt7B,GAEZskB,EAAMoW,oBAEN,IAAIa,EAAMv6B,SAASw6B,eAEnB,GAAIn2B,OAAOm2B,eAAeC,YAAc,EAAE,CACxC,IAAIC,EAAMH,GAAOA,EAAII,WAAW,GAC1BC,EvDoFT,SAAwBz4B,GAC7B,KAAOA,GAAM,CACX,GAAsB,IAAlBA,EAAK04B,UAAiD,MAA/B14B,EAAK24B,QAAQ1uB,cACpC,OAAOjK,EAEXA,EAAOA,EAAKE,euDzFY04B,CAAeL,EAAIM,yBAGrC,GAAIJ,GAAaA,EAAU98B,UAAU4D,SAAS,mBAAmB,CAC/D,IAAMiC,EAA0Bi3B,EAAU58B,GACtCi9B,EAAMP,EAAIQ,gBAGd,GAFA55B,IAAE25B,GAAKlZ,KAAK,2FAA2FoZ,SAEnGF,EAAIG,YAAYx5B,OAAS,EAAE,CAEdN,IAAEs5B,GAAWS,QACrBtZ,KAAK,2FAA2FoZ,SAGvG,IAOIG,EACAC,EAREC,EAAgB94B,EAAUu4B,EAAIG,aASZ,IAApBV,EAAIY,aACNA,EAAcZ,EAAIY,YAClBC,EAAiBb,EAAIa,iBAGrBD,EAAcZ,EAAIY,YAAc,EAChCC,EAAiBb,EAAIa,gBAGvB,IACME,EvDsCb,SAA2Bf,GAChC,IAAIO,EAAMP,EAAIQ,gBAId,OAHA55B,IAAE25B,GAAKlZ,KAAK,2FAA2FoZ,SACjFz4B,EAAUu4B,EAAIG,aACP53B,MAAM,KAAKkB,QAAO,SAAAg3B,GAAC,OAAEA,KAAG95B,OuD1Cb+5B,CvD4BnC,SAAqBC,EAAML,EAAgBD,EAAaO,EAAcC,GAC3E,IAAMrwB,EAAQmwB,EAAKG,cAAcC,cAGjC,OAFAvwB,EAAMwwB,SAASV,EAAgBD,GAC/B7vB,EAAMywB,OAAOL,EAAcC,GACpBrwB,EuDjC4BuwB,CAAYpB,EAAWA,EAAW,EAAGW,EAAgBD,IAItE/2B,EAAY,CAACmH,MAFA+vB,EAAsB,EAEH9vB,IADrB8vB,EAAuBD,EAAch4B,MAAM,KAAKkB,QAAO,SAAAg3B,GAAC,OAAEA,KAAG95B,QAGxEu6B,EAAQzB,EAAI0B,wBACZhhB,EAAiB,CACrBjY,KAAMq4B,EACNj3B,YACAZ,2BAGF2f,EAAMmW,kBAAkBre,EAAgB+gB,MAnMlD76B,IAAE,oBAAoB+6B,OAAM,SAASr9B,GACnCA,EAAEyO,iBACF,IAAMzP,EAAKsD,IAAEpC,MAAMqc,OAAO,KAAK+gB,KAAK,MACpChZ,EAAM7lB,MAAM8+B,SAASv+B,GACrBslB,EAAM7lB,MAAM++B,WAAW,cAErBxC,GACH94B,EAAkB84B,GAAU,GAE3B5e,GACFkI,EAAMmZ,gBAAgBrhB,GAGxB9Z,IAAE,yBAAyB+6B,OAAM,SAASr9B,GACxCA,EAAEyO,iBACF,IAAMivB,EAAWp7B,IAAEpC,MAAMo9B,KAAK,MAC9BhZ,EAAM7lB,MAAM8+B,SAASG,GACjB1C,GACF94B,EAAkB84B,GAAU,MAK/B14B,IAAE,wBAAwB+6B,OAAM,SAASr9B,GACvCA,EAAEyO,iBACF,IAAMwC,EAAY3O,IAAEpC,MAAMo9B,KAAK,kBACzBK,EAAcr7B,IAAEpC,MAAM09B,QAAQ,oBAAoBN,KAAK,MAE7DhZ,EAAM7lB,MAAM8+B,SAASI,GACrBrZ,EAAM7lB,MAAMia,yBAAyB,6BAA+BzH,GACpEqT,EAAM7lB,MAAM++B,WAAW,UAAW,eAGpCl7B,IAAE,oBAAoB+6B,OAAM,SAASr9B,GACnCA,EAAEyO,iBACF,IAAMwC,EAAY3O,IAAEpC,MAAMo9B,KAAK,kBACzBO,EAAKv7B,IAAEpC,MAAMo9B,KAAK,WAClBK,EAAcr7B,IAAEpC,MAAM09B,QAAQ,oBAAoBN,KAAK,MAE7DhZ,EAAM7lB,MAAM8+B,SAASI,GACrBrZ,EAAM7lB,MAAMia,yBAAyB,6BAA+BzH,GACpEqT,EAAM7lB,MAAM8a,sBAAsB,6BAA+BtI,EAAY,IAAM4sB,GACnFvZ,EAAM7lB,MAAM++B,WAAW,UAAW,eAGpCl7B,IAAE,uBAAuB+6B,OAAM,SAASr9B,GACnCA,EAAEyO,iBACFnM,IAAEpC,MAAMo9B,KAAK,WAAY,eACzB,IAAMxS,EAAOxoB,IAAEpC,MAAMqc,SAAS9Z,SAAS,uBACjC4I,EAAS/I,IAAEwoB,GAAMwS,KAAK,QACtBn5B,EAAO7B,IAAE+I,GAAQyyB,OACjBC,EAAiB79B,KAAKk9B,wBAC5B9Y,EAAMnU,SAAS,CAAC6tB,aAAc75B,EAAM45B,eAAgBA,IACpDzZ,EAAMsW,4BACN,IAAMqD,EAAa37B,IAAEpC,MAAMqc,SAAS9Z,SAAS,iBAAiB66B,KAAK,kBACnEh7B,IAAE,cAAcE,YAAY,aAC5BF,IAAE,IAAM27B,GAAY17B,SAAS,aAC7BD,IAAE,qBAAuB27B,EAAa,KAAK17B,SAAS,gBAKtDD,IAAEtB,UAAU6Y,GAAG,QAAS,iBAAiB,SAAS7Z,GAGhD,GAAIA,EAAEqL,SAAWnL,KAAK,CACpBF,EAAEyO,iBACF,IAAMzP,EAAKsD,IAAEpC,MAAMo9B,KAAK,YACxBhZ,EAAM7lB,MAAM8+B,SAASv+B,GACrBslB,EAAM7lB,MAAM++B,WAAW,eAItBxC,GACH94B,EAAkB84B,GAAU,GAG9B14B,IAAEtB,UAAU6Y,GAAG,QAAS,sBAAsB,SAAS7Z,GAErDA,EAAEyO,iBACF,IAAMwC,EAAY3O,IAAEpC,MAAMo9B,KAAK,kBACzBO,EAAKv7B,IAAEpC,MAAMo9B,KAAK,WAMxBhZ,EAAM7lB,MAAMia,yBAAyB,6BAA+BzH,GACpEqT,EAAM7lB,MAAM8a,sBAAsB,6BAA+BtI,EAAY,IAAM4sB,GACnFvZ,EAAM7lB,MAAM++B,WAAW,UAAW,eAGpCl7B,IAAEtB,UAAU6Y,GAAG,QAAS,gCAAgC,SAAS7Z,GAS/D,GARAA,EAAEyO,iBAQwB,SADAnM,IAAEpC,MAAMo9B,KAAK,0BACHt9B,EAAEqL,SAAWnL,KAAK,CAGpD,IAAMg+B,EAAkB57B,IAAEpC,MAAMo9B,KAAK,wBAI/Ba,EAFY77B,IAAEpC,MAAMo9B,KAAK,YAEC94B,MAAM,KAEhCyZ,EAAc3b,IAAEpC,MAAMo9B,KAAK,qBAE3Bc,EAAmBngB,EAAcA,EAAYzZ,MAAM,KAAO,KAE1D65B,EAAgBF,EAAch3B,KAAI,SAAClD,EAAG2e,GAC1C,MAAO,CACL5jB,GAAIiF,EACJwI,MAAO2xB,EAAmBA,EAAiBxb,GAAS,SAMxD0B,EAAM7lB,MAAMi3B,6BAA6B2I,GAEzC/Z,EAAM7lB,MAAM++B,WAAW,UAAW,eAUlClZ,EAAM7lB,MAAM8+B,SAASW,OAiEzBl9B,SAASs9B,iBAAiB,QAAShD,GACnCt6B,SAASs9B,iBAAiB,UAAWhD,K,6BAMzC,SAAgBlf,GAEdlc,KAAKq+B,oBAEL,IAAMC,EAAYx9B,SAASm6B,eAAe/e,EAAezX,yBAGzD,GAAI65B,GAAapiB,EAAe7W,UAAU,CACxC,IAAMkH,EvDrJL,SAAiBmwB,EAAMlwB,EAAOC,GAwBnC,IApBA,IAOI4vB,EACAD,EACAmC,EACA5B,EACAC,EACA4B,EAKAv7B,EAjBEw7B,EAAW/B,EAAKG,cAAc6B,mBAClChC,EACAt5B,WAAWu7B,UACX37B,GACA,GASE47B,EAAS,EAGTC,EAAa,GAIT57B,EAAOw7B,EAASK,eAAiBzC,IAAmBM,IAAe,CAIrE15B,EAAK87B,iBACH97B,EAAK87B,gBAAgBC,cACnB/7B,EAAK87B,iBAAuE,OAApD97B,EAAK87B,gBAAgBC,aAAa,gBAC5DJ,GAAU,GAIhB,IAEMK,EAAgBz7B,EAFLP,EAAKK,WAEoBgB,MAAM,KAAKkB,QAAO,SAAAg3B,GAAC,OAAEA,KAEzD0C,EAAgBD,EAAcv8B,OAKpC,IACG25B,GACD7vB,EAAQoyB,GAAUC,GAClBryB,EAAQoyB,GAAUC,EAAaK,EAC/B,CACA7C,EAAiBp5B,EAIjB,IAAMkB,EAAiBR,EAAkBs7B,GAHzCV,EAAmB/xB,EAAQoyB,EAAUC,GAGqC,GAE1EzC,EAAcp4B,EAAoBf,EAAKK,UAAW27B,EAAcV,EAAkB,GAAIp6B,GAAgB,GAGxG,IACGw4B,GACDlwB,EAAMmyB,GAAUC,GAChBpyB,EAAMmyB,GAAUC,EAAaK,EAC7B,CACAvC,EAAe15B,EAGf,IAAMkB,EAAiBR,EAAkBs7B,GAFzCT,EAAiB/xB,EAAMmyB,EAAUC,GAEuC,GAExEjC,EAAY54B,EAAoBf,EAAKK,UAAW27B,EAAcT,EAAgB,GAAIr6B,GAAgB,GAIpG06B,GAAcK,EAKhB,IAAM3yB,EAAQmwB,EAAKG,cAAcC,cAOjC,OAHAT,EAAiB9vB,EAAMwwB,SAASV,EAAgBD,GAAe19B,QAAQC,IAAI,sCAC3Eg+B,EAAepwB,EAAMywB,OAAOL,EAAcC,GAAal+B,QAAQC,IAAI,mCAE5D4N,EuDiEW4yB,CAAQb,EAAWpiB,EAAe7W,UAAUmH,MAAO0P,EAAe7W,UAAUoH,KACpFsvB,EAAMxvB,EAAM6yB,kBACZn8B,EAAOnC,SAASM,cAAc,QACpC6B,EAAK9D,MAAMkgC,gBAAkB,UAC7Bp8B,EAAK3B,YAAYy6B,GACjBxvB,EAAM+yB,WAAWr8B,GAEjB,IAAMk5B,EAAQ/5B,IAAEa,GAAMk5B,QACtB/5B,IAAE+5B,GAAOtZ,KAAK,2FAA2FoZ,SACzG/f,EAAejY,KAAOT,EAAUpB,IAAE+5B,GAAOl4B,QACzCjE,KAAKzB,MAAMghC,2BAA2BrjB,M,+BAM1C,WACE9Z,IAAE,QAAQo9B,WAAWC,W,kCAEvB,SAAqB1kB,GAAgC,IAApB5V,EAAmB,uDAAV,UAClC+W,EAAiBlc,KAAKgG,MAAMkW,eAClCxd,QAAQC,IAAI,uBAAwBud,GAEpClc,KAAKu9B,gBAAgBrhB,GACrB,IAAMwjB,EAAIxjB,EACVlc,KAAKzB,MAAM8+B,SAASqC,EAAEj7B,wBAA0B,IAAMi7B,EAAEr6B,UAAUmH,MAAQ,IAAMkzB,EAAEr6B,UAAUoH,KAE5FzM,KAAKzB,MAAM++B,WAAWn4B,EAAQ4V,K,+BAEhC,WACE4kB,KAAaC,KAAK5/B,KAAK6/B,U,uCAEzB,WACEF,KAAaC,KAAK5/B,KAAK8/B,c,+BAWzB,SAAkB5jB,EAAgB0e,GAC5B56B,KAAKyR,UAEPzR,KAAKiQ,SAAS,CAACiM,eAAgBA,EAAgB0e,gBAAiBA,IAChE+E,KAAajlB,KAAK1a,KAAK6/B,W,uCAG3B,WACEF,KAAajlB,KAAK1a,KAAK8/B,c,+BAEzB,WACE9/B,KAAKyR,SAAU,EAIf,IAAMsuB,EAAc//B,KAAKzB,MAAMu8B,UAAY96B,KAAKzB,MAAMu8B,SAASt4B,SAAS,cAAgBxC,KAAKzB,MAAMu8B,SAASx2B,MAAM,cAAc,GAAKtE,KAAKzB,MAAMu8B,SAChJ96B,KAAKs6B,aAAat6B,KAAKzB,MAAMs8B,IAAK76B,KAAKzB,MAAM+d,SAAUyjB,EAAa//B,KAAKzB,MAAM2d,kB,gCAGjF,SAAmB/L,EAAW0B,GAG5B,GAAI1B,EAAU0qB,MAAQ76B,KAAKzB,MAAMs8B,IAAI,CAInC,IAAMkF,EAAc//B,KAAKzB,MAAMu8B,UAAY96B,KAAKzB,MAAMu8B,SAASt4B,SAAS,cAAgBxC,KAAKzB,MAAMu8B,SAASx2B,MAAM,cAAc,GAAKtE,KAAKzB,MAAMu8B,SAChJ96B,KAAKs6B,aAAat6B,KAAKzB,MAAMs8B,IAAK76B,KAAKzB,MAAM+d,SAAUyjB,EAAa//B,KAAKzB,MAAM2d,oBAG7E,CACF,GAAIlc,KAAKzB,MAAMu8B,WAAa3qB,EAAU2qB,SAKpC94B,EADoBhC,KAAKzB,MAAMu8B,UAAY96B,KAAKzB,MAAMu8B,SAASt4B,SAAS,cAAgBxC,KAAKzB,MAAMu8B,SAASx2B,MAAM,cAAc,GAAKtE,KAAKzB,MAAMu8B,UACjH,GAG3B96B,KAAKzB,MAAM2d,eAAezX,yBAA2BzE,KAAKzB,MAAM2d,eAAe7W,UACjFrF,KAAKu9B,gBAAgBv9B,KAAKzB,MAAM2d,gBAGhClc,KAAKq+B,yBASAr+B,KAAKzB,MAAM2d,eAAe7W,YAAc8K,EAAU+L,eAAe7W,WAAarF,KAAKzB,MAAM2d,eAAezX,wBAC/GzE,KAAKu9B,gBAAgBv9B,KAAKzB,MAAM2d,gBAGxBlc,KAAKzB,MAAM2d,eAAezX,yBAA4BzE,KAAKzB,MAAM2d,eAAe7W,WACxFrF,KAAKq+B,uB,kCAKX,WACEr+B,KAAKyR,SAAU,I,oBAGjB,WAAS,IAAD,OACAuuB,EAAchgC,KAAKgG,MAAMwsB,SAAW,OAAS,QAEnD,OACE,6BAEIxyB,KAAKgG,MAAMwsB,UAEX,yBAAKrzB,MAAO,CAAC8gC,SAAU,QAASl9B,IAAK,MAAOm9B,KAAM,QAClD,kBAAC,EAAD,OAIDlgC,KAAKgG,MAAMkW,gBAAkB,uBAAGiE,IAAK,SAAAA,GAAG,OAAI,EAAK0f,OAAS1f,GAAKggB,WAAS,UAAUC,WAAS,YAAYjhC,MAAO,CAAC8gC,SAAU,QAASl9B,IAAK/C,KAAKgG,MAAM40B,gBAAgB73B,IAAM,GAAIm9B,KAAMlgC,KAAKgG,MAAM40B,gBAAgBsF,QAC7MlgC,KAAKgG,MAAM83B,cAAgB,uBAAG3d,IAAK,SAAAA,GAAG,OAAI,EAAK2f,WAAa3f,GAAKggB,WAAS,UAAUC,WAAS,WAAWjhC,MAAO,CAAC8gC,SAAU,QAASl9B,IAAK/C,KAAKgG,MAAM63B,eAAe96B,IAAM,GAAIm9B,KAAMlgC,KAAKgG,MAAM63B,eAAeqC,QAC7M,kBAAC,KAAD,CAAcG,WAAW,EAAMC,MAAM,MAAMxhC,GAAG,aACzCkB,KAAKgG,MAAMkW,gBACZ,kBAAC3B,GAAA,EAAD,KACE,kBAACA,GAAA,EAAIM,KAAL,CAAU3I,MAAOlS,KAAKgG,MAAMkW,eAAe7W,UAAUmH,MAAQ,IAAKxM,KAAKgG,MAAMkW,eAAe7W,UAAUoH,IAAKjB,QAAS,WAAO,EAAKmvB,qBAAqB,cAAc,kBAAC,KAAD,OACnK,kBAACpgB,GAAA,EAAIM,KAAL,CAAUrP,QAAS,WAAO,EAAKmvB,qBAAqB,cAAc,kBAAC,KAAD,OAChE36B,KAAKgG,MAAMkW,eAAejY,MAA6D,IAArDjE,KAAKgG,MAAMkW,eAAejY,KAAKK,MAAM,KAAK5B,QAC9E,kBAAC6X,GAAA,EAAIM,KAAL,CAAUrP,QAAS,WAAOhH,EAAe,EAAKjG,MAAMs8B,IAAK,EAAK70B,MAAMkW,eAAejY,KAAM,EAAK+B,MAAMkW,eAAezX,2BAA2B,kBAAC,KAAD,OAE9I,kBAAC8V,GAAA,EAAIM,KAAL,CAAUrP,QAAS,WAAO,EAAKmvB,qBAAqB,YAAY,kBAAC,KAAD,OAC9D36B,KAAKgG,MAAMkW,eAAejY,MAA6D,IAArDjE,KAAKgG,MAAMkW,eAAejY,KAAKK,MAAM,KAAK5B,QAC9E,kBAAC6X,GAAA,EAAIM,KAAL,CAAU3I,MAAM,eAAe1G,QAAS,kBAAI,EAAKmvB,qBAAqB,aAAc,aAAY,kBAAC,KAAD,SAMtG,kBAAC,KAAD,CAAc77B,GAAG,WAAWuhC,WAAW,EAAMC,MAAM,OAEjD,uBAAG1zB,wBAAyB,CAAEC,OAAQ7M,KAAKgG,MAAM83B,iBAEnD,yBAAKh/B,GAAG,OAAOK,MAAO,CAACod,QAASyjB,U,GAnbrBxvB,IAAMC,W,UCcVkK,OArBf,SAAcpc,GAgBZ,OAbMA,EAAMgoB,KAEN,4BACGhoB,EAAMgoB,KAAK/e,QAAU,4BAAI,kBAAC,IAAD,CAAMtI,GAAI,oBAAsBX,EAAMgoB,KAAK/e,QAASjJ,EAAMgoB,KAAK9e,cACzF,4BAAI,kBAAC,IAAD,CAAMvI,GAAI,oBAAsBX,EAAMgoB,KAAKznB,IAAKP,EAAMgoB,KAAKrU,QAC9D3T,EAAMgoB,KAAKlU,eAAiB,4BAAI,kBAAC,IAAD,CAAMnT,GAAI,oBAAsBX,EAAMgoB,KAAKznB,IAAKP,EAAMgoB,KAAKlU,iBAKzF,MC6JEkuB,G,kDAjKb,WAAYhiC,GAAO,IAAD,8BAChB,cAAMA,IAEDiiC,6BAA+B,EAAKA,6BAA6B5wB,KAAlC,gBACpC,EAAK6wB,iBAAmB,EAAKA,iBAAiB7wB,KAAtB,gBACxB,EAAK8wB,WAAalwB,IAAMmwB,YAExB,EAAKjpB,OAAQ,EACb,EAAK1R,MAAQ,CACXyB,YAAa,GACbm5B,eAAgB,GAChBC,aAAc,GACd16B,YAAa,GACbu6B,WAAY,IAbE,E,oDAiBlB,SAAiB5gC,GACf,IAAMymB,EAAOzmB,EAAEqL,OAAO5J,MACtBvB,KAAKiQ,SAAS,CAACywB,WAAYna,M,0BAG7B,SAAaua,EAAchvB,GAAY,IAAD,OACpCgvB,EAAatgC,MAAK,SAACmE,GAEjB,IAAI6C,EAAS7C,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAW+N,EAAWpO,QAAQ,6BAA8B,aAAW,GAChH8D,IACHA,EAAS7C,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAW+N,KAAY,IAEnE,IAAMrK,EAAcD,EAAO,YAEvBo5B,EAAiB,KAClBzyB,MAAMC,QAAQ5G,EAAO,wBACtBo5B,EAAkBp5B,EAAO,uBAAuBP,KAAI,SAACwf,GACnD,MAAO,CACL3nB,GAAI2nB,EAAE,OAAO/iB,QAAQ,SAAU,8BAG/BwO,MAAOvN,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAW0iB,EAAE,UAAQ,GAAG,gBAI7Djf,EAAO,yBACdo5B,EAAiB,CAAC,CAAC9hC,GAAI0I,EAAO,uBAAuB,OAAO9D,QAAQ,SAAU,8BAA+BwO,MAAOvN,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAWyD,EAAO,uBAAuB,UAAQ,GAAG,eAE3M,IAAIq5B,EAAe,KAChB1yB,MAAMC,QAAQ5G,EAAO,sBACpBq5B,EAAgBr5B,EAAOu5B,YAAY95B,KAAI,SAACwf,GACxC,MAAO,CACL3nB,GAAI2nB,EAAE,OAAO/iB,QAAQ,SAAU,8BAC/BwO,MAAOvN,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAW0iB,EAAE,UAAQ,GAAG,gBAI7Djf,EAAO,uBACdq5B,EAAe,CAAC,CAAC/hC,GAAI0I,EAAO,qBAAqB,OAAO9D,QAAQ,SAAU,8BAA+BwO,MAAOvN,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAWyD,EAAO,qBAAqB,UAAQ,GAAG,eAGrM,IAAIrB,EAAc,KACfgI,MAAMC,QAAQ5G,EAAO,gCACtBrB,EAAeqB,EAAO,+BAA+BP,KAAI,SAACwf,GACxD,MAAO,CACL3nB,GAAI2nB,EAAE,OAAO/iB,QAAQ,SAAU,8BAC/BwO,MAAOvN,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAW0iB,EAAE,UAAQ,GAAG,gBAI7Djf,EAAO,iCACdrB,EAAc,CAAC,CAACrH,GAAI0I,EAAO,+BAA+B,OAAO9D,QAAQ,SAAU,8BAA+BwO,MAAOvN,EAAElE,KAAK,UAAU+E,QAAO,SAACzB,GAAD,OAAOA,EAAE,SAAWyD,EAAO,+BAA+B,UAAQ,GAAG,eAExN9I,QAAQC,IAAI,cAAewH,GACvB,EAAKuR,OACP,EAAKzH,SAAS,CAAC2wB,eAAgBA,EAAgBC,aAAcA,EAAc16B,YAAaA,EAAasB,YAAaA,OAIrH6P,OAAM,SAAC0pB,GACNtiC,QAAQC,IAAIqiC,Q,0CAIhB,SAA6BlvB,GAC3B,IAAMmvB,EAAuBt/B,E1Ckdf,CACZ,gDACA,6CACA,YACA,IACA,kCACA,4CACA,sCACA,mCACD,iDACC,6CACD,kDACC,IACA,SACA,IACA,S0CjeyDmQ,E1CienC,mBACtB,iEACA,WACA,IACA,oEACA,yDACA,sDACA,iFACA,IACA,WACA,IACA,qEACA,sEACA,2EACA,IACA,WACA,IACA,mEACA,6EACA,IACA,KAAKvN,KAAK,K0CnfZvE,KAAKkhC,aAAaD,EAAsBnvB,K,gCAE1C,SAAmB3B,GACbnQ,KAAKzB,MAAMuT,aAAe3B,EAAU2B,aACtC9R,KAAKmhC,KAAKT,WAAa1gC,KAAKmhC,KAAKT,WAAWn/B,MAAQ,GACpDvB,KAAKwgC,6BAA6BxgC,KAAKzB,MAAMuT,e,+BAGjD,WACE9R,KAAK0X,OAAQ,EACb1X,KAAKwgC,6BAA6BxgC,KAAKzB,MAAMuT,c,kCAG/C,WACE9R,KAAK0X,OAAQ,I,oBAEf,WAGE,IAAMod,EAAe,SAACxI,GAQpB,OAPcA,EAAKrlB,KAAI,SAAClD,GACtB,OAEE,kBAAC,GAAD,CAAMuH,IAAKvH,EAAEjF,GAAIynB,KAAMxiB,QAY7B,OACE,kBAAClF,EAAA,EAAD,CAAWD,UAAU,kBACrB,4BAAKoB,KAAKgG,MAAMyB,aAEbzH,KAAKgG,MAAMG,aACZ,kBAACtH,EAAA,EAAD,KACA,2CACA,6BACA,kBAACuiC,GAAA,EAAD,CAAOC,SAAO,EAACC,UAAQ,EAACC,OAAK,EAAC52B,KAAK,MACnC,+BACCmqB,EAAa90B,KAAKgG,MAAMG,gBAK1BnG,KAAKgG,MAAM46B,gBACV,kBAAC/hC,EAAA,EAAD,KACA,uDACA,6BACA,kBAACuiC,GAAA,EAAD,CAAOC,SAAO,EAACC,UAAQ,EAACC,OAAK,EAAC52B,KAAK,MACnC,+BACCmqB,EAAa90B,KAAKgG,MAAM46B,mBAK1B5gC,KAAKgG,MAAM66B,cACV,kBAAChiC,EAAA,EAAD,KACA,qDACA,6BACA,kBAACuiC,GAAA,EAAD,CAAOC,SAAO,EAACC,UAAQ,EAACC,OAAK,EAAC52B,KAAK,MACnC,+BACCmqB,EAAa90B,KAAKgG,MAAM66B,sB,GAxJFrwB,IAAMC,W,UCD/B+wB,G,kDACJ,WAAYjjC,GAAO,IAAD,8BAChB,cAAMA,IACDkjC,kBAAoB,EAAKA,kBAAkB7xB,KAAvB,gBACzB,EAAK8xB,yBAA2B,EAAKA,yBAAyB9xB,KAA9B,gBAChC,EAAK5J,MAAQ,CACX27B,SAAU,GACVC,eAAgB,GAChBC,cAAc,GAPA,E,4DAUlB,WACE7hC,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAACgwB,cAAehwB,EAAUgwB,mB,+BAGrC,SAAkBpP,GAAiB,I3C6jBAqP,E2C7jBD,OACLngC,E3C6jBT,CACb,6EACC,IACE,IACG,UALsBmgC,E2C5jBsBrP,G3CikBd,oBAC9B,kEACA,2DACA,0EACJ,qEACA,aACC,2DACA,IACF,IACG,QACD,IACG,IAAMqP,EAAmB,uDAC7B,kEACI,2DACA,0EACJ,qEACA,aACC,2DACA,IACF,IACG,QACA,IACE,IAAMA,EAAmB,yDAC7B,kEACI,2DACA,0EACJ,qEACA,aACC,2DACA,IACF,IACC,IACA,gCAAgCv9B,KAAK,K2ChmBzB/D,MAAK,SAACmE,GACXA,EAAElE,KAAKsG,QAAQC,SACvBgH,SAAQ,SAACC,EAAGlK,GACZ,IAAIg+B,EAAY,6DAA+D9zB,EAAE4sB,IAAIt5B,MAAQ,eAC7FM,IAAMkgC,GAAWvhC,MAAK,SAACkY,GACrB,IAAMjY,EAAOiY,EAAGjY,KACZuhC,EAAe,GACfvhC,EAAKiC,OAAS,IAChBs/B,EAAe,CACbC,QAASxhC,EAAK,GAAG,aACjByhC,SAAUzhC,EAAK,GAAL,GACV0hC,SAAU1hC,EAAK,GAAG,aAClB2hC,UAAW,iDAAmD3hC,EAAK,GAAL,GAAgB,QAC9E4hC,YAAa5hC,EAAK,GAAG,gBACrB6hC,QAAS7hC,EAAK,GAAG,oBAGrB,EAAKwP,UAAS,SAAC4B,GACb,IAAM0wB,EAAa,CACjBC,qBAAsBv0B,EAAEw0B,QAAUx0B,EAAEw0B,QAAQlhC,MAAQ,GACpDmhC,aAAcz0B,EAAE00B,cAAgB10B,EAAE00B,cAAcphC,MAAQ,GACxDqhC,mBAAoB30B,EAAE40B,aAAe50B,EAAE40B,aAAathC,MAAQ,GAC5DuhC,cAAe70B,EAAE80B,OAAS90B,EAAE80B,OAAOxhC,MAAQ,GAC3CyhC,WAAY/0B,EAAE4sB,IAAM5sB,EAAE4sB,IAAIt5B,MAAQ,GAClC0hC,kBAAmBjB,GAErB,MAAO,CACLL,SAAS,GAAD,mBAAM9vB,EAAU8vB,UAAhB,CAA0BY,IAClCX,eAAgBnP,iB,+BAO9B,WAEMzyB,KAAKzB,MAAMk0B,iBACbzyB,KAAKyhC,kBAAkBzhC,KAAKzB,MAAMk0B,mB,gCAGtC,SAAmBtiB,EAAW0B,GAAW,IAAD,OAClC7R,KAAKzB,MAAMk0B,kBAAoBtiB,EAAUsiB,kBAC3C/zB,QAAQC,IAAI,iBACZqB,KAAKiQ,SAAS,CAAC0xB,SAAU,KAAK,WAC5B,EAAKF,kBAAkB,EAAKljC,MAAMk0B,uB,oBAIxC,WAAS,IAAD,OACEj0B,EAAMwB,KAAKzB,MAAXC,EAmDR,OAlCqB,WACnB,GAAI,EAAKwH,MAAM27B,SAAS,CACtB,GAAI,EAAK37B,MAAM27B,SAASj/B,OAAS,EAC/B,OACE,kBAACwgC,GAAA,EAAD,CAAOp9B,QAAQ,QACb,uBAAG0F,QAAS,EAAKk2B,yBAA0B9iC,UAAU,SAASJ,EAAE,4CAC/D,EAAKwH,MAAM67B,cArBH,EAAK77B,MAAM27B,SAAS16B,KAAI,SAACutB,GACxC,IAAM2O,EAAmB3O,EAAEgO,uBAAyB,EAAKx8B,MAAM47B,eAAiB,mBAAqB,GAC/FwB,EAAa5O,EAAEwO,WAAWxgC,SAAS,eAAiBgyB,EAAEwO,WAAWt/B,QAAQ,QAAS,UAGlF2/B,EAAe,kCADG7O,EAAEwO,WAAWxgC,SAAS,eAAiBgyB,EAAEwO,WAAW1+B,MAAM,gBAAgB,GAAGA,MAAM,KAAK,IACtC,SAC1E,OAAQ,uBAAGgH,IAAKkpB,EAAEgO,qBAAsB5jC,UAAWukC,EAAmB,UACnEA,EAAmB,8BAAO3O,EAAEkO,aAAT,IAAwBlkC,EAAE,wBAAiC,0BAAMI,UAAU,gBAAgB4M,QAAS,WAAK,EAAKjN,MAAMqe,kBAAkB4X,EAAEgO,wBAAyBhO,EAAEkO,cACtLlO,EAAEyO,kBAAkBb,WAAa,kCAAQ5jC,EAAE,iBAAV,KAA6B,uBAAG+R,KAAMikB,EAAEyO,kBAAkBb,WAAW,yBAAK7yB,IAAI,SAASD,IAAKklB,EAAEyO,kBAAkBhB,WAAhH,KAClC,0BAAMrjC,UAAU,SAAhB,IAA0BJ,EAAE,eAA5B,KAA6C,uBAAG+R,KAAMikB,EAAEwO,YAAaxO,EAAEwO,YAAvE,KACCI,GAAc,0BAAMxkC,UAAU,SAAhB,MAA2B,uBAAG2R,KAAM6yB,EAAYj4B,OAAO,SAASiI,IAAI,uBAAzC,YAAwE,yBAAK9D,IAAI,0BAA0BC,IAAI,SAASe,OAAO,SAA/H,WAA3B,OAAiL,uBAAGC,KAAM8yB,EAAcl4B,OAAO,SAASiI,IAAI,uBAA3C,+BAe7L,GAAmC,IAA/B,EAAKpN,MAAM27B,SAASj/B,OAAa,CACxC,IAAM+/B,EAAU,EAAKz8B,MAAM27B,SAAS,GAC9ByB,EAAaX,EAAQO,WAAWxgC,SAAS,eAAiBigC,EAAQO,WAAWt/B,QAAQ,QAAS,UAG9F2/B,EAAe,kCADGZ,EAAQO,WAAWxgC,SAAS,eAAiBigC,EAAQO,WAAW1+B,MAAM,gBAAgB,GAAGA,MAAM,KAAK,IAClD,UAE1E,OAAQ,kBAAC4+B,GAAA,EAAD,CAAOtkC,UAAU,iBAAiBkH,QAAQ,QAChD,0BAAMlH,UAAU,SAASJ,EAAE,WAA3B,KAAyCikC,EAAQC,aAAjD,IAEClkC,EAAE,eAFH,KAEoB,uBAAG+R,KAAMkyB,EAAQO,YAAaP,EAAQO,aAEzDI,GAAc,0BAAMxkC,UAAU,SAAhB,MAA2B,uBAAG2R,KAAM6yB,EAAYj4B,OAAO,SAASiI,IAAI,uBAAzC,YAAwE,yBAAK9D,IAAI,0BAA0BC,IAAI,SAASe,OAAO,SAA/H,WAA3B,OAAiL,uBAAGC,KAAM8yB,EAAcl4B,OAAO,SAASiI,IAAI,uBAA3C,2BAKlM,OAAO,KAIT,OAAO,KAITkwB,O,GAxHqB9yB,IAAMC,WAyIlBmpB,kBAAkB4H,I,oBCsDlB+B,G,kDA5Lb,WAAYhlC,GAAO,IAAD,8BAChB,cAAMA,IACDilC,uBAAyB,EAAKA,uBAAuB5zB,KAA5B,gBAC9B,EAAK6zB,aAAe,EAAKA,aAAa7zB,KAAlB,gBACpB,EAAK8zB,aAAe,EAAKA,aAAa9zB,KAAlB,gBACpB,EAAKpK,OAASgL,IAAMmwB,YACpB,EAAKjpB,OAAQ,EACb,EAAK1R,MAAQ,CACXkM,MAAO,GACPkV,YAAa,GACb+M,MAAO,GACPziB,MAAO,GACPlM,OAAQ,IAZM,E,gDAgBlB,SAAa1F,GACX,IAAMymB,EAAOzmB,EAAEqL,OAAO5J,MACtBvB,KAAKiQ,SAAS,CAACzK,OAAQ+gB,M,0BAGzB,SAAaod,GAAc,IAAD,OAClBvf,EAAQpkB,KACd2jC,EAAanjC,MAAK,SAACmE,GACf,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAC1BkL,EAAQlL,EAAS,GAAGkL,MAAM3Q,MAC1B6lB,EAAcpgB,EAAS,GAAGogB,YAAY7lB,MACxCqiC,EAAc,GAClB58B,EAASgH,SAAQ,SAACC,GAChB,IAAM41B,EAAM51B,EAAEgE,KAAK1Q,MACnBqiC,EAAYC,GAAO,CACjB/kC,GAAImP,EAAEgE,KAAK1Q,MACX2Q,MAAOjE,EAAE61B,UAAUviC,MACnB2E,KAAM+H,EAAE81B,SAASxiC,MACjB8Q,cAAepE,EAAE+1B,kBAAoB/1B,EAAE+1B,kBAAkBziC,MAAQ,KACjE4Q,MAAOlE,EAAEg2B,UAAYh2B,EAAEg2B,UAAU1iC,MAAQ,cAG3C,EAAKmW,OACP0M,EAAMnU,SACJ,CACEiC,QACAkV,cACA1V,MAAOkyB,S,0BAMjB,SAAa9C,GAAc,IAAD,OAClB1c,EAAQpkB,KACd8gC,EAAatgC,MAAK,SAACmE,GACjB,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAC5Bk9B,EAAc,GAClBl9B,EAASgH,SAAQ,SAACC,GAChB,IAAMk2B,EAASl2B,EAAEsY,KAAKhlB,MACtB2iC,EAAYC,GAAU,CACpBjyB,MAAOjE,EAAEm2B,UAAU7iC,MACnBzC,GAAImP,EAAEsY,KAAKhlB,MACX2E,KAAM+H,EAAEo2B,SAAS9iC,MACjB8Q,cAAepE,EAAEq2B,kBAAoBr2B,EAAEq2B,kBAAkB/iC,MAAQ,KACjEiG,OAAQyG,EAAEs2B,WAAat2B,EAAEs2B,WAAWhjC,MAAQ,KAC5CkG,YAAawG,EAAEu2B,gBAAkBv2B,EAAEu2B,gBAAgBjjC,MAAQ,KAC3D+K,KAAM2B,EAAE3B,KAAO2B,EAAE3B,KAAK/K,MAAQ,KAC9B6K,SAAU6B,EAAE7B,SAAW6B,EAAE7B,SAAS7K,MAAQ,KAC1CkjC,GAAIx2B,EAAEw2B,GAAKx2B,EAAEw2B,GAAGljC,MAAQ,KACxBmjC,QAASz2B,EAAEy2B,QAAUz2B,EAAEy2B,QAAQnjC,MAAQ,KACvCojC,GAAI12B,EAAE02B,GAAK12B,EAAE02B,GAAGpjC,MAAQ,KACxB+a,SAAUrO,EAAEqO,SAAWrO,EAAEqO,SAAS/a,MAAQ,KAC1Cs5B,IAAK5sB,EAAE4sB,IAAM5sB,EAAE4sB,IAAIt5B,MAAQ,SAG3B,EAAKmW,OACP0M,EAAMnU,SACJ,CACEkkB,MAAO+P,OAKd5sB,OAAM,SAAC0pB,GACNtiC,QAAQC,IAAIqiC,Q,mCAIhB,SAAsBlvB,GACpB,IAAM8yB,EAAkBjjC,E5CsSR,CACZ,2EACA,WACA,I4CzSsDmQ,E5CySlC,sDACpB,uEACA,6DACA,kEACA,yEACA,IACA,6BAA6BvN,KAAK,K4C9ShCsgC,EAAYljC,EAASiP,GAAekB,IAC1C9R,KAAK8kC,aAAaD,GAClB7kC,KAAKkhC,aAAa0D,K,oCAEpB,SAAuB9yB,EAAYM,EAAekK,GAChD,IAAMyoB,EAAiBpjC,E5C4OT,CACZ,iHACA,WACA,I4C/O8D2a,E5C+OhC,yDAC9B,2EACA,6DACA,uEACA,aACA,uEACA,IACA,WACA,IACA,iDACA,IACA,WACA,IACA,yDACA,IACA,oEACA,yEACA,yDACA,kEACA,qDACA,IACA,8BAA8B/X,KAAK,K4CnQ/BsgC,EAAYljC,EAASiP,GAAekB,IAG1C9R,KAAK8kC,aAAaD,GAElB7kC,KAAKkhC,aAAa6D,K,0BAEpB,SAAaC,EAAe5yB,EAAekK,EAAUpW,GAIpC,wCAATA,EACAlG,KAAKilC,sBAAsBD,EAAe5yB,EAAekK,GAIlC,kDAAlBlK,GACLpS,KAAKwjC,uBAAuBwB,EAAe5yB,EAAekK,K,+BAMlE,WACEtc,KAAK0X,OAAQ,EACb1X,KAAKiQ,SAAS,CAAC6B,WAAY9R,KAAKzB,MAAMuT,aACtC9R,KAAKyjC,aAAazjC,KAAKzB,MAAMuT,WAAY9R,KAAKzB,MAAM6T,cAAepS,KAAKzB,MAAM+d,SAAUtc,KAAKzB,MAAM2H,Q,gCAgBrG,SAAmBiK,GAGbnQ,KAAKzB,MAAMuT,aAAe3B,EAAU2B,aACtC9R,KAAKiQ,SAAS,CAAC6B,WAAY9R,KAAKzB,MAAMuT,WAAYtM,OAAQ,KAK1DxF,KAAKyjC,aAAazjC,KAAKzB,MAAMuT,WAAY9R,KAAKzB,MAAM6T,cAAepS,KAAKzB,MAAM+d,SAAUtc,KAAKzB,MAAM2H,S,kCAGvG,WACElG,KAAK0X,OAAQ,I,oBAEf,WACE,OACE,kBAAC7Y,EAAA,EAAD,CAAWD,UAAU,kBACpBoB,KAAKgG,MAAMkM,OAAS,4BAAKlS,KAAKgG,MAAMkM,OACpClS,KAAKgG,MAAMkM,OAAS,uBAAG/S,MAAO,CAAC,UAAa,WAAYa,KAAKgG,MAAMohB,aAKpE,kBAAC8d,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAKC,GAAI,GACP,kBAACvmC,EAAA,EAAD,KACI,kBAAC,GAAD,CACEgU,gBAAiB7S,KAAKgG,MAAM8L,WAC5BA,WAAY9R,KAAKgG,MAAM8L,WACvBI,MAAOlS,KAAKgG,MAAMkM,MAClBpD,QAAQ,EACRiE,QAAS,GACTE,gBAAgB,EAChBD,YAAY,EACZE,gBAAgB,EAChBvB,cAAc,EACdmB,wBAAwB,OAKP,mCAA1B9S,KAAKgG,MAAM8L,YACZ,6BACE,mDACA,2BAAG,kBAAC,IAAD,CAAM5S,GAAI,uDAAV,aAAH,8C,GArLiBsR,IAAMC,WCAzB40B,G,kDACJ,WAAY9mC,GAAO,IAAD,8BAChB,cAAMA,IACDkT,QAAU,GACf,EAAKkG,WAAa,EAAKA,WAAW/H,KAAhB,gBAClB,EAAKgI,eAAiB,EAAKA,eAAehI,KAApB,gBACtB,EAAK5J,MAAQ,CACXqS,OAAQ,OACRitB,SAAU,IAPI,E,8CAYlB,WAEEtlC,KAAKzB,MAAMia,yBAAyBxY,KAAKgG,MAAMsG,Q,4BAEjD,WAEEtM,KAAKzB,MAAMia,yBAAyBxY,KAAKgG,MAAMoG,Y,iCAGjD,SAAoBumB,GAAiB,IAAD,OAGZhxB,E7C6lBP,CACZ,sCACA,IACE,I6ChmBwCgxB,E7CgmBX,kDAC7B,sDACA,wDACA,sDACA,gEACA,2DACF,KAAKpuB,KAAK,K6CrmBC/D,MAAK,SAAC+kC,GAClBA,EAAG9kC,KAAKsG,QAAQC,SAASgH,SAAQ,SAACw3B,GAChC,IAAMz0B,EAAYy0B,EAAElR,QAAQ/yB,MACtBkkC,EAAYD,EAAEphC,MAAM7C,MACpBmkC,EAAWF,EAAEG,KAAKpkC,MAClB+oB,EAAQkb,EAAElb,MAAM/oB,MAEFI,EAASmP,GAAeC,IAChCvQ,MAAK,SAACmE,GAChB,IAAMsJ,EAAItJ,EAAElE,KAAKsG,QAAQC,SAAS,GAElC,GAAIiH,EAAE,CAEJ,IAAMwK,EAAQ,4GAA8G1H,EAAUzM,MAAM,cAAc,GAAK,gBAC/JzC,IAAMC,IAAI2W,GAAOjY,MAAK,SAACkY,GAEjB,EAAKjH,SACP,EAAKxB,UAAS,SAAC4B,GACb,IAAM+zB,EAAa,CACjBztB,iBAAkBpH,EAClB4H,aAAc1K,EAAE0K,aAAe1K,EAAE0K,aAAapX,MAAQ,GAEtDyV,OAAQ/I,EAAE+I,OAAOzV,MACjB6S,SAAUnG,EAAEmG,SAAS7S,MACrB+K,KAAM2B,EAAE2K,aAAe3K,EAAE2K,aAAarX,MAAQ,GAC9C6K,SAAU6B,EAAE4K,iBAAmB5K,EAAE4K,iBAAiBtX,MAAQ,GAC1DuX,YAAaJ,EAAGjY,KAAOiY,EAAGjY,KAAKsY,UAAY,GAC3ChI,UAAWA,EACX00B,UAAWA,EACXC,SAAUA,EACVpb,MAAOA,GAGX,MAAO,CACLgb,SAAS,GAAD,mBACHzzB,EAAUyzB,UADP,CAENM,WAKLtuB,OAAM,SAACC,GACJ,EAAK9F,SACP,EAAKxB,UAAS,SAAC4B,GACb,IAAM+zB,EAAa,CACjBztB,iBAAkBpH,EAClB4H,aAAc1K,EAAE0K,aAAapX,MAE7ByV,OAAQ/I,EAAE+I,OAAOzV,MACjB6S,SAAUnG,EAAEmG,SAAS7S,MACrB+K,KAAM2B,EAAE2K,aAAe3K,EAAE2K,aAAarX,MAAQ,GAC9C6K,SAAU6B,EAAE4K,iBAAmB5K,EAAE4K,iBAAiBtX,MAAQ,GAC1DuX,YAAa,GACb/H,UAAWA,EACX00B,UAAWA,EACXC,SAAUA,EACVpb,MAAOA,GAGX,MAAO,CACLgb,SAAS,GAAD,mBACHzzB,EAAUyzB,UADP,CAENM,uB,+BAWpB,WACE5lC,KAAKyR,SAAU,EACTzR,KAAKzB,MAAMo0B,iBACb3yB,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACLyzB,SAAU,MAGdtlC,KAAKwZ,oBAAoBxZ,KAAKzB,MAAMo0B,oB,gCAIxC,SAAmBxiB,GACbnQ,KAAKzB,MAAMo0B,kBAAoBxiB,EAAUwiB,iBAC3C3yB,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACLyzB,SAAU,MAIhBtlC,KAAKwZ,oBAAoBxZ,KAAKzB,MAAMo0B,oB,kCAGtC,WACE3yB,KAAKyR,SAAU,I,oBAEjB,WAAU,IAAD,OAYDqI,EAAgB,SAACwa,GAErB,GAAIA,EAAQxb,aAAiD,UAAlC,EAAKva,MAAM+Z,mBA8BpC,OA7B0Bgc,EAAQxb,YAAY7R,KAAI,SAAC4M,EAAG9P,GAEpD,GAAIA,EAAI,GAAKuwB,EAAQmR,WAAa1hC,EAAIuwB,EAAQoR,SAAS,CACrD,IAAMzhC,EAAO4P,EAAE7G,SAAS0M,MAClB1C,EAASnD,EAAE8F,GAAGrV,MAAM,UAAU,GAC9B2S,EAAcD,EAAO1S,MAAM,KAAK0S,EAAO1S,MAAM,KAAK5B,OAAS,GAC3DwR,EAASL,EAAE8F,GAAGrV,MAAM,UAAU,GAC9BoS,EAAW7C,EAAE6C,SACbE,EAAQ/C,EAAE+C,MAChB,OACE,kBAAC,GAAD,CAAkBtL,IAAKvH,EACrB2S,SAAUA,EACVM,OAAQA,EACR9C,OAAQA,EACR+C,YAAaA,EACbhT,KAAMA,EACN2S,MAAOA,EACP9S,OAAQC,EAAI,EACZgT,YAAa,EAAKxY,MAAMwY,YACxB6C,eAAe,EACfpD,aAAc,EAAKjY,MAAM8R,QAK3B,OAAO,QAOV,GAAIikB,EAAQxb,aAAiD,cAAlC,EAAKva,MAAM+Z,mBAAmC,CAE5E,IAAMzE,EAAIygB,EAAQxb,YAAYpW,OAAS4xB,EAAQxb,YAAYwb,EAAQmR,UAAY,GAAKnR,EAAQxb,YACtF+sB,EAAKvR,EAAQxb,YAAYpW,OAAS4xB,EAAQxb,YAAYwb,EAAQmR,UAAY,GAAKnR,EAAQxb,YACvFgtB,EAAWD,EAAKA,EAAGlsB,GAAGrV,MAAM,UAAU,GAAK,GAC3CyhC,EAAgBD,EAASxhC,MAAM,KAAKwhC,EAASxhC,MAAM,KAAK5B,OAAS,GACjEsjC,EAAWH,EAAKA,EAAGlsB,GAAGrV,MAAM,UAAU,GAAK,GAC3CuQ,EAAImxB,EAAS1hC,MAAM,KAAK,GACxB2hC,EAAK3R,EAAQxb,YAAYpW,OAAS4xB,EAAQxb,YAAYwb,EAAQoR,SAAW,GAAKpR,EAAQxb,YAGtFotB,EAAWD,EAAKA,EAAGtsB,GAAGrV,MAAM,UAAU,GAAK,GAC3C6hC,EAAMD,EAAS5hC,MAAM,KAAK,GAC1B8hC,EAAMF,EAAS5hC,MAAM,KAAK,GAC1B+hC,EAAY9vB,SAAS4vB,GAAO5vB,SAAS6vB,GAAQ7vB,SAAS1B,GAGtDX,GADIqC,SAASyvB,EAAS1hC,MAAM,KAAK,IAAM,GAAKiS,SAASyvB,EAAS1hC,MAAM,KAAK,IAAM,GAAKiS,SAASyvB,EAAS1hC,MAAM,KAAK,KACpG,IAAOiS,SAAS1B,GAAM,KAAO0B,SAASyvB,EAAS1hC,MAAM,KAAK,IAAM,IAAM,KAAOiS,SAAS8vB,GAAY,IAE/G3vB,EAAW7C,EAAIA,EAAE6C,SAAW,GAK9B1B,EAAkB,GACtB,GAAI,EAAKzW,MAAM0a,YACb,GAAKqb,EAAQxb,YAAYpW,OAQvB4xB,EAAQxb,YAAY9K,SAAQ,SAAC6F,EAAG9P,GAC5BwS,SAAS,EAAKhY,MAAM0a,YAAY3U,MAAM,KAAK,EAAK/F,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,MAASqB,EAAI,IACrGiR,EAAkBnB,EAAE8F,GAAGrV,MAAM,UAAU,WAVX,CAC9B,IAAMuP,EAAIygB,EAAQxb,YAEiF/U,IAA/FwS,SAAS,EAAKhY,MAAM0a,YAAY3U,MAAM,KAAK,EAAK/F,MAAM0a,YAAY3U,MAAM,KAAK5B,OAAS,MACxFsS,EAAkBnB,EAAE8F,GAAGrV,MAAM,UAAU,IAW7C,OAAIoS,EAEA,kBAAC,GAAD,CACEpL,IAAKgpB,EAAQnc,iBAAmB,IAAMmc,EAAQhK,MAC9C5T,SAAUA,EACVM,OAAQ8uB,EACR5xB,OAAQA,EACR+C,YAAa8uB,EACb9hC,KA/BO,GAgCP2S,MAAO,GACPG,YAAa,GACb6C,eAAe,EACfpD,aAAc,EAAKjY,MAAM8R,MACzB2E,gBAAiBA,IAKX,uBAAG1J,IAAKgpB,EAAQnc,iBAAmB,IAAMmc,EAAQhK,OAAjD,sCAIZ,OAAO,yBAAKhf,IAAKgpB,EAAQnc,iBAAmB,IAAMmc,EAAQhK,MAAO/a,IAAI,aAAaD,IAAKglB,EAAQlgB,SAAW,SAAW,EAAK7V,MAAM8R,MAAQ,qBAG5I,OACE,kBAACxR,EAAA,EAAD,CAAWD,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,WAhH9B,EAAK9I,MAAMs/B,SAASt7B,MAAK,SAACyc,EAAGxY,GAClD,OAAIwY,EAAE6D,MAAQrc,EAAEqc,MAAc,EAC1Brc,EAAEqc,MAAQ7D,EAAE6D,OAAe,EACxB,KAE8BrjB,KAAI,SAACqtB,GAC1C,OAAOxa,EAAcwa,MA4GvB,kBAAC,GAAD,CAAWlgB,SAAUpU,KAAKgG,MAAMs/B,SAAS,GAAKtlC,KAAKgG,MAAMs/B,SAAS,GAAGlxB,SAAW,U,GAjP/D5D,IAAMC,WAwP7B40B,GAAS51B,aAAe,CACtBY,MAAO,OAoBMg1B,UC1QTiB,G,kDACJ,WAAY/nC,GAAO,IAAD,8BAChB,cAAMA,IACD24B,0BAA4B,EAAKA,0BAA0BtnB,KAA/B,gBACjC,EAAKqnB,0BAA4B,EAAKA,0BAA0BrnB,KAA/B,gBACjC,EAAKsT,4BAA8B,EAAKA,4BAA4BtT,KAAjC,gBACnC,EAAK22B,8BAAgC,EAAKA,8BAA8B32B,KAAnC,gBACrC,EAAK42B,gCAAkC,EAAKA,gCAAgC52B,KAArC,gBACvC,EAAK5J,MAAQ,CACXqZ,qBAAsB,GACtB/G,mBAAoB,QACpBmuB,sBAAuB,GACvBC,wBAAyB,GACzBC,2BAA4B,IAZd,E,mEAelB,SAAgCplC,GAC9BvB,KAAKiQ,SAAS,CAAC02B,2BAA4BplC,M,yCAE7C,SAA4BA,GAC1BvB,KAAKiQ,SAAS,CAACw2B,sBAAuBllC,M,2CAExC,SAA8BzB,GAAG,IAAD,OAC9BA,EAAEyO,iBACc5M,EAAS+O,GAAe1Q,KAAKgG,MAAMygC,wBAC3CjmC,MAAK,SAACmE,GACZ,IAAMya,EAAiBza,EAAElE,KAAKsG,QAAQC,SAASC,KAAI,SAACgH,GAClD,MAAO,CACLiR,cAAejR,EAAEiR,cAAc3d,MAC/B4d,mBAAoBlR,EAAEkR,mBAAmB5d,MACzCqc,cAAe3P,EAAEwS,4BAA8BxS,EAAEwS,4BAA4Blf,MAAQ,OAGzF,EAAK0O,SAAS,CAACy2B,wBAAyBtnB,EAAgBunB,2BAA4BhiC,EAAElE,KAAKsG,QAAQC,SAAS,GAAGga,eAAezf,a,uCAMlI,SAA0Bq2B,GAEpB53B,KAAKzB,MAAM04B,0BACbj3B,KAAKzB,MAAM04B,0BAA0BW,GAGrC53B,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CAACyG,mBAAoBsf,Q,uCAIlC,SAA0B93B,GACxBA,EAAEyO,iBAEEvO,KAAKzB,MAAM24B,0BACbl3B,KAAKzB,MAAM24B,0BAA0Bp3B,EAAEqL,OAAO5J,OAG9CvB,KAAKiQ,SAAS,CAACoP,qBAAsBvf,EAAEqL,OAAO5J,U,+BAGlD,WAAoB,IAAD,OACbvB,KAAKzB,MAAM6gB,gBACbpf,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACLwN,qBAAsB,EAAK9gB,MAAM8gB,qBACjC/G,mBAAoB,EAAK/Z,MAAM+Z,yB,gCA2BvC,SAAmBnI,GAAW,IAAD,OACvBnQ,KAAKzB,MAAM8gB,uBAAyBlP,EAAUkP,sBAChDrf,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACLwN,qBAAsB,EAAK9gB,MAAM8gB,yBAInCrf,KAAKzB,MAAM+Z,qBAAuBnI,EAAUmI,oBAC9CtY,KAAKiQ,UAAS,SAAC4B,GACb,MAAO,CACLyG,mBAAoB,EAAK/Z,MAAM+Z,yB,oBAKvC,WAAU,IAAD,OAwBP,OACE,yBAAK1Z,UAAWoB,KAAKzB,MAAMuQ,OAAS,SAAW,YAC3C9O,KAAKzB,MAAMghB,mBACb,yBAAK3gB,UAAU,sBACb,kBAACkM,EAAA,EAAKC,QAAN,CAAcJ,KAAK,KAAKK,GAAG,SAASE,SAAUlL,KAAKk3B,0BAA2B31B,MAAOvB,KAAKgG,MAAMqZ,sBA1BvF,EAAK9gB,MAAM6gB,eAAenY,KAAI,SAAC0a,GAC1C,OAAO,4BAAQrW,IAAK,SAAWqW,EAAEzC,cAAe3d,MAAOogB,EAAEzC,eAAgByC,EAAExC,yBA8B3E,yBAAKvgB,UAAU,mBACXoB,KAAKzB,MAAMqoC,mBAAqB5mC,KAAKgG,MAAMqZ,sBAC3C,yBAAKzgB,UAAU,wBACb,2BAAG,0BAAMsT,MAAM,iBAAiB1G,QAAS,WAAO,EAAKyrB,0BAA0B,WAAW,kBAAC,KAAD,QAC1F,2BAAG,0BAAM/kB,MAAM,iBAAiB1G,QAAS,WAAO,EAAKyrB,0BAA0B,eAAe,kBAAC,KAAD,QAC9F,2BAAG,0BAAM/kB,MAAM,oBAAoB1G,QAAS,WAAO,EAAKyrB,0BAA0B,aAAa,kBAAC,KAAD,SAGnG,yBAAKr4B,UAAU,iBAjCG,EAAKL,MAAM6gB,eAAenY,KAAI,SAAC0a,GACnD,OAAIA,EAAEzC,gBAAkB,EAAKlZ,MAAMqZ,qBAC1B,kBAAC,GAAD,CAAU/T,IAAK,WAAaqW,EAAEzC,cACrCyT,gBAAiBhR,EAAEzC,cACnB5G,mBAAoB,EAAKtS,MAAMsS,mBAC/BjI,MAAO,EAAK9R,MAAM8R,MAClB4I,YAAa,EAAK1a,MAAM0a,cAGjB,UA8BPjZ,KAAKgG,MAAM0gC,wBAAwBhkC,OAAS,GAC5C,kBAAC4jC,EAAD,CACElnB,eAAgBpf,KAAKgG,MAAM0gC,wBAC3BrnB,qBAAsBrf,KAAKgG,MAAM2gC,2BACjCruB,mBAAoBtY,KAAKgG,MAAMsS,mBAC/B2e,0BAA2Bj3B,KAAKzB,MAAM04B,0BACtCC,0BAA2Bl3B,KAAKwmC,gCAChCn2B,MAAOrQ,KAAKzB,MAAM8R,MAClB4I,YAAa,GACbnK,QAAQ,EACR0Q,qBAAqB,KAEvBxf,KAAKzB,MAAMihB,qBACb,yBAAKrgB,MAAO,CAAC,aAAgB,+BAAgC,UAAa,+BAAgC0nC,UAAW,MAAOvlB,QAAS,QACnI,uBAAGniB,MAAO,CAAC+gB,SAAU,SAArB,8BACA,kBAACpV,EAAA,EAAD,CAAMiE,SAAU/O,KAAKumC,8BAA+BthB,QAAM,GACxD,kBAACxI,GAAA,EAAD,CAAawI,OAAO,OAAOta,KAAK,KAAK7L,GAAG,OAAOoH,KAAK,OAAO3E,MAAOvB,KAAKgG,MAAMygC,sBAAuBx7B,YAAY,gBAAgBrM,UAAU,UAAUsM,SAAU,SAACpL,GAAO,EAAKojB,4BAA4BpjB,EAAEqL,OAAO5J,UAChN,kBAACtC,EAAA,EAAD,CAAQgmB,OAAO,OAAOta,KAAK,KAAMzE,KAAK,SAAS/G,MAAO,CAACqY,OAAQ,QAA/D,iB,GA5KkBhH,IAAMC,WAsLpC61B,GAAgB72B,aAAe,CAC7B2P,eAAgB,GAChBtQ,QAAQ,EACRuQ,qBAAsB,GACtB/G,mBAAoB,YACpBjI,MAAO,OAgCMi2B,UCjHAQ,G,kDA/Gb,WAAYvoC,GAAO,IAAD,8BAChB,cAAMA,IACDwoC,kBAAoB,EAAKA,kBAAkBn3B,KAAvB,gBACzB,EAAK4I,yBAA2B,EAAKA,yBAAyB5I,KAA9B,gBAChC,EAAKo3B,yBAA2B,EAAKA,yBAAyBp3B,KAA9B,gBAEhC,EAAK5J,MAAQ,CACXmuB,MAAO,GACPjiB,MAAO,GACP+0B,eAAgB,GAChBC,eAAgB,GAChBC,cAAc,EACd9Q,uBAAwB,GACxBD,6BAA8B,IAbhB,E,4DAgBlB,WACEp2B,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJs1B,cAAet1B,EAAUs1B,mB,sCAK/B,SAAyBp2B,GAEvB/Q,KAAKzB,MAAM6oC,eAAer2B,K,+BAE5B,SAAkBjS,EAAIoH,GAAM,IAAD,OAGXvE,EADD,YAATuE,EACmBkL,GAAwBtS,GAE7B,WAAToH,EACcmL,GAAuBvS,GAE5B,aAAToH,EACcgL,GAAyBpS,GAGzBkS,GAAalS,IAE1B0B,MAAK,SAACmE,GACd,IAAMlE,EAAOkE,EAAElE,KAAKsG,QAAQC,SAC5B,GAAIvG,EAAKiC,OAAS,GAAKjC,EAAK,GAAG6zB,QAAQ,CACrC,IAGIC,EAHoB9zB,EAAKwG,KAAI,SAACtC,GAChC,OAAOA,EAAEwC,WAAaxC,EAAEwC,WAAW5F,MAAQ,MAEhBiE,QAAO,SAACgvB,EAAGzwB,EAAG0iB,GAAP,OAAaA,EAAEgO,QAAQD,KAAOzwB,KAC9D2wB,EAAiB,GACrBH,EAAOvmB,SAAQ,SAAClO,GACb40B,EAAe50B,GAAK,MAEvBW,EAAKuN,SAAQ,SAACrJ,GACV,IAAMyX,EAAO,CACXjV,WAAYxC,EAAEwC,WAAW5F,MACzB8F,gBAAiB1C,EAAEgwB,sBAAsBpzB,MACzC2d,cAAeva,EAAEua,cAAc3d,MAC/B+yB,QAAS3vB,EAAE2vB,QAAQ/yB,MACnBoX,aAAchU,EAAEiwB,cAAcrzB,MAC9B8Q,cAAe1N,EAAEkwB,+BAAiClwB,EAAEkwB,+BAA+BtzB,MAAQ,IAE/FmzB,EAAe/vB,EAAEwC,WAAW5F,OAAOuK,KAAKsQ,MAE1C,IAAI6qB,EAAiB,GAElBA,EADU,YAAT/gC,EACgBpH,EAED,WAAToH,EACUzF,EAAK,GAAG4mC,aAAa9lC,MAGrBd,EAAK,GAAG6zB,QAAQ/yB,MAEpC,EAAK0O,SAAS,CAACkkB,MAAOO,EAAgBuS,eAAgBA,IACtD,EAAK1oC,MAAMia,yBAAyByuB,S,+BAK1C,WACEjnC,KAAK+mC,kBAAkB/mC,KAAKzB,MAAMuT,WAAY9R,KAAKzB,MAAM81B,qB,gCAE3D,SAAmBlkB,GACbnQ,KAAKzB,MAAMuT,YAAc9R,KAAKzB,MAAMuT,aAAe3B,EAAU2B,YAC/D9R,KAAK+mC,kBAAkB/mC,KAAKzB,MAAMuT,WAAY9R,KAAKzB,MAAM81B,qB,oBAI7D,WAAS,IAAD,OAaN,OACE,yBAAKz1B,UAAU,cACX,2CAbA,EAAKoH,MAAMqwB,uBAAuB3zB,OAAS,EACtC,kBAAC,GAAD,CAAiB0c,eAAgB,EAAKpZ,MAAMqwB,uBAAwBhX,qBAAsB,EAAKrZ,MAAMowB,6BAA8B9d,mBAAmB,YAAYjI,MAAM,MAAMvB,QAAQ,IAEtL,EAAK9I,MAAMihC,eACX,kBAAC,GAAD,CAAUl2B,UAAW,EAAK/K,MAAMihC,eAAgBhuB,YAAY,GAAGqD,SAAU,EAAK/d,MAAM+d,SAAU9D,yBAA0B,EAAKA,yBAA0BnI,MAAO,MAAOiI,oBAAoB,EAAOxJ,QAAQ,IAGxM,U,GAnGK0B,IAAMC,WCF1B,IAiCe62B,GAjCQ,SAAC/oC,GACtB,MAAsCgK,mBAAS,IAA/C,mBAAOpC,EAAP,KAAoBohC,EAApB,KAQA,OAPAt9B,qBAAU,WACR,ICTkCnL,EDSlB6C,ECRH,CACZ,gGACA,IACE,IACE,4DAL6B7C,EDSaP,EAAMipC,kBCJkB,MACpE,IACA,QACA,IACE,2EACA,2DAA6D1oC,EAAK,MACpE,IACA,kEACA,aACA,qEACA,iEACA,IACD,IAGD,yBAAyByF,KAAK,MDVvB/D,MAAK,SAACmE,GACZ,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAChCugC,EAAevgC,QAEhB,CAACzI,EAAMipC,mBAER,kBAAC3oC,EAAA,EAAD,CAAWD,UAAU,kBACnB,4BAAKL,EAAMipC,kBACVrhC,EAAYc,KAAI,SAACnH,GAChB,OACE,kBAACjB,EAAA,EAAD,KACA,kBAAC,GAAD,CACAgU,gBAAiB/S,EAAEqH,WAAW5F,MAC9BuQ,WAAYhS,EAAEqH,WAAW5F,MACzB2Q,MAAOpS,EAAE2H,YAAc3H,EAAE2H,YAAYlG,MAAQ,KAAOzB,EAAE8yB,WAAWrxB,MAAQzB,EAAE8yB,WAAWrxB,MACtFuN,QAAQ,EACRiE,QAAS,GACTE,gBAAgB,EAChBC,gBAAgB,UEioBXu0B,G,kDAvoBb,WAAYlpC,GAAO,IAAD,8BAChB,cAAMA,IACDmZ,OAAQ,EACb,EAAK4lB,WAAa,EAAKA,WAAW1tB,KAAhB,gBAClB,EAAKytB,SAAW,EAAKA,SAASztB,KAAd,gBAChB,EAAK83B,UAAY,EAAKA,UAAU93B,KAAf,gBACjB,EAAKqL,gBAAkB,EAAKA,gBAAgBrL,KAArB,gBACvB,EAAK4L,YAAc,EAAKA,YAAY5L,KAAjB,gBACnB,EAAKyL,eAAiB,EAAKA,eAAezL,KAApB,gBACtB,EAAK2L,eAAiB,EAAKA,eAAe3L,KAApB,gBACtB,EAAK0L,eAAiB,EAAKA,eAAe1L,KAApB,gBACtB,EAAKqoB,mBAAqB,EAAKA,mBAAmBroB,KAAxB,gBAC1B,EAAK8L,sBAAwB,EAAKA,sBAAsB9L,KAA3B,gBAC7B,EAAK4I,yBAA2B,EAAKA,yBAAyB5I,KAA9B,gBAChC,EAAKyJ,sBAAwB,EAAKA,sBAAsBzJ,KAA3B,gBAC7B,EAAKqnB,0BAA4B,EAAKA,0BAA0BrnB,KAA/B,gBACjC,EAAKsnB,0BAA4B,EAAKA,0BAA0BtnB,KAA/B,gBACjC,EAAK4lB,6BAA+B,EAAKA,6BAA6B5lB,KAAlC,gBACpC,EAAK4R,2BAA6B,EAAKA,2BAA2B5R,KAAhC,gBAClC,EAAK8R,8BAAgC,EAAKA,8BAA8B9R,KAAnC,gBACrC,EAAKyqB,oBAAsB,EAAKA,oBAAoBzqB,KAAzB,gBAC3B,EAAK2vB,2BAA6B,EAAKA,2BAA2B3vB,KAAhC,gBAClC,EAAK5J,MAAQ,CACXyyB,qBAAsB,GACtBoC,IAAK,GACL7C,MAAO,GAEPjlB,QAAS,GACTulB,UAAW,GAEXvnB,UAAW,GACXkI,YAAa,GACbsf,mBAAoB,GACpB6B,SAAS,EACTle,oBAAgBoB,EAChBqqB,QAAS,CACPC,QAAS,CACP1sB,SAAU,UACVvb,MAAM,EACNob,WAAY,WACZklB,SAAU,aACV7kB,gBAAiB,SACjB9C,mBAAoB,YACpB+f,yBAA0B,IAE5BwP,QAAS,CACP3sB,SAAU,UACVvb,MAAM,EACNob,WAAY,WACZklB,SAAU,eACV7kB,gBAAiB,SACjB9C,mBAAoB,YACpB+f,yBAA0B,MApDhB,E,uDA0DlB,WACEr4B,KAAKiQ,UAAS,SAAC4B,GACX,MAAO,CACLuoB,SAAUvoB,EAAUuoB,c,uCAI5B,SAA0Blf,EAAU3Z,GAClCvB,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAU5C,mBAAqB/W,EAChC,CAAComC,QAASA,Q,uCAGrB,SAA0BzsB,EAAU2c,GAClC73B,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAUmd,yBAA2BR,EACtC,CAAC8P,QAASA,Q,wBAIrB,SAAW7oC,EAAIic,GACR/a,KAAKgG,MAAM2hC,QAAQ7oC,GAAIa,MAAQK,KAAKgG,MAAM2hC,QAAQ7oC,GAAIic,aAAeA,GACxE/a,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAK1B,OAJAA,EAAQ7oC,GAAIa,MAAO,EACfob,IACF4sB,EAAQ7oC,GAAIic,WAAaA,GAEpB,CACL4sB,QAASA,Q,yBAKjB,SAAYzsB,GACVlb,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAUvb,MAAO,EAClB,CAACgoC,QAASA,MAKnB3lC,EAAkBhC,KAAKgG,MAAM8hC,YAAY,K,4BAI3C,SAAe5sB,GACblb,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAUE,gBAAkB,UAC7B,CAACusB,QAASA,Q,4BAIrB,SAAezsB,GACblb,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAUE,gBAAkB,UAC7B,CAACusB,QAASA,Q,4BAIrB,SAAezsB,GACblb,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAUE,gBAAkB,SAC7B,CAACusB,QAASA,Q,wCASrB,SAA2BzrB,GACzB,IAAMwjB,EAAIxjB,EACVlc,KAAKiQ,SAAS,CAACiM,eAAgBwjB,M,gCAEjC,SAAmBxkB,EAAUS,GAC3B3b,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAyB1B,MAxBmC,eAA/BA,EAAQzsB,GAAU+kB,SACpB0H,EAAQzsB,GAAU+kB,SAAW,eAWS,iBAA/B0H,EAAQzsB,GAAU+kB,WACzB0H,EAAQzsB,GAAU+kB,SAAW,cAWxB,CAAC0H,QAASA,Q,mCAIrB,SAAsBzsB,EAAUS,GAC9B3b,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QACpBI,EAA2B,YAAb7sB,EAAyB,UAAY,UASzD,MARmC,eAA/BysB,EAAQzsB,GAAU+kB,UACpB0H,EAAQI,GAAa9H,SAAW,eAChC0H,EAAQI,GAAapoC,MAAO,GAEU,iBAA/BgoC,EAAQzsB,GAAU+kB,WACzB0H,EAAQI,GAAa9H,SAAW,aAChC0H,EAAQI,GAAapoC,MAAO,GAEvB,CAACgoC,QAASA,Q,6BAGrB,SAAgB5sB,EAAYG,GAE1Blb,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAE1B,OADAA,EAAQzsB,GAAUH,WAAaA,EACxB,CAAC4sB,QAASA,Q,sCAMrB,SAAyB52B,GACvB/Q,KAAKiQ,SAAS,CAACc,UAAWA,M,mCAE5B,SAAsBkI,GACpBjZ,KAAKiQ,SAAS,CAACgJ,YAAaA,M,0CAS9B,SAA6BklB,GAG3Bn+B,KAAKiQ,SAAS,CAACsoB,mBAAoB4F,M,wCAGrC,WACEz/B,QAAQC,IAAI,UACZqB,KAAKs9B,WAAW,UAAW,oB,2CAG7B,SAA8B0K,GAC5BhoC,KAAKwhB,4BAA2B,GAChCxhB,KAAKiQ,UAAS,SAAC4B,GACb,MAAM,CACJ4mB,qBAAqB,GAAD,mBAAM5mB,EAAU4mB,sBAAhB,CAAsCuP,U,sBAQhE,SAASlpC,GACP,IAAMyN,EAAQzN,EAAGwF,MAAM,KAAK,GAAK,IAAMxF,EAAGwF,MAAM,KAAK,GAAK,GAEpD2jC,GADNnpC,EAAKA,EAAGwF,MAAM,KAAK,IACD9B,SAAS,QAAU1D,EAAKkB,KAAKgG,MAAM+M,QAAUxG,EAAQ,6BAA+BzN,EAAKkB,KAAKgG,MAAM+M,QAAUxG,EAChIvM,KAAKzB,MAAM2pC,wBAAwBD,K,uBAErC,SAAUE,GACRnoC,KAAKzB,MAAM2pC,wBAAwBC,K,+BAKrC,SAAkBrpC,GAChB,IAAMmpC,EAASnpC,EAAG0D,SAAS,QAAU1D,EAAK,6BAA+BA,EAEnEsd,EAAOza,EAAS+O,GAAeu3B,IAGrCjoC,KAAKooC,iBAAiBhsB,EAAM6rB,K,8BAY9B,SAAiB7rB,EAAMtK,GAAY,IAAD,OAC9BsK,EAAK5b,MAAK,SAACmE,GACT,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAAS,GACnCoY,EAAiBza,EAAElE,KAAKsG,QAAQC,SAASC,KAAI,SAACgH,GAAO,IAAD,EACxD,MAAO,CACLiR,cAAejR,EAAEiR,cAAc3d,MAC/B4d,mBAAoBlR,EAAEkR,mBAAmB5d,MACzCqc,cAAe3P,EAAEwS,4BAA8BxS,EAAEwS,4BAA4Blf,MAAQ,GACrFmf,iBAAgB,UAAEzS,EAAE0S,sCAAJ,aAAE,EAAkCpf,UAIlD,EAAKmW,OAAS1Q,GAChB,EAAKiJ,SAAS,CACZ+nB,MAAO,CACLlmB,WAAYA,EACZI,MAAOlL,EAASkL,MAAM3Q,MACtBmL,UAAW1F,EAAS0F,UAAY1F,EAAS0F,UAAUnL,MAAQ,GAC3DiG,OAAQR,EAASQ,OAASR,EAASQ,OAAOjG,MAAQ,GAClDkG,YAAaT,EAASS,YAAcT,EAASS,YAAYlG,MAAQ,GACjE6Q,cAAepL,EAASoL,cAAc7Q,MACtCqf,MAAO5Z,EAAS4Z,MAAMrf,MACtB+K,KAAMtF,EAASsF,KAAOtF,EAASsF,KAAK/K,MAAQ,GAC5C6K,SAAUpF,EAASoF,SAAWpF,EAASoF,SAAS7K,MAAQ,GACxD8a,OAAQrV,EAASqV,OAASrV,EAASqV,OAAO9a,MAAQ,GAClDsf,KAAM7Z,EAAS6Z,KAAO7Z,EAAS6Z,KAAKtf,MAAQ,GAC5Cuf,KAAM9Z,EAAS8Z,KAAO9Z,EAAS8Z,KAAKvf,MAAQ,GAC5C+a,SAAUtV,EAAS+Z,mBAAqB/Z,EAAS+Z,mBAAmBxf,MAAQ,GAC5Eyf,eAAgBha,EAASga,eAAezf,MACxC0f,eAAgBja,EAASia,eAAiBja,EAASia,eAAe1f,MAAQ,GAC1E6d,eAAgBA,U,0BAW5B,SAAatgB,GACX,IAAMmpC,EAASnpC,EAAG0D,SAAS,QAAU1D,EAAK,6BAA+BA,EAEnEsd,EAAOza,ElDhBD,CACZ,2IACA,WACA,SkDaiDsmC,ElDbf,cAClC,sDACA,oEACA,qDACA,gDACA,6EACA,yEACA,uEACA,iEACA,2FACA,aACA,uDACA,IACA,aACA,+DACA,IACA,yDACA,IACA,6BAA6B1jC,KAAK,KkDJlCvE,KAAKqoC,qBAAqBjsB,K,kCAE5B,SAAqBksB,GAAe,IAAD,OAC/BA,EAAc9nC,MAAK,SAACmE,GAClB,IAAMqC,EAAWrC,EAAElE,KAAKsG,QAAQC,SAAS,GACrC,EAAK0Q,OACP,EAAKzH,SAAS,CACZqoB,UAAW,CACTpmB,MAAOlL,EAASkL,MAAM3Q,MACtB2d,cAAelY,EAASkY,cAAc3d,MACtC4F,WAAYH,EAASG,WAAW5F,MAChCs5B,IAAK7zB,EAAS6zB,IAAIt5B,MAClBg2B,IAAKvwB,EAASuwB,IAAIh2B,MAClB+K,KAAMtF,EAASsF,KAAOtF,EAASsF,KAAK/K,MAAQ,GAC5C6K,SAAUpF,EAASoF,SAAWpF,EAASoF,SAAS7K,MAAQ,GACxDqf,MAAO5Z,EAAS4Z,MAAMrf,MACtB+a,SAAUtV,EAAS+Z,mBAAmBxf,MACtCkxB,gBAAiBzrB,EAASxI,EAAE+C,c,+BAO1C,WAEE,GADAvB,KAAK0X,OAAQ,EACmB,WAA5B1X,KAAKzB,MAAMu4B,cACgB,cAA5B92B,KAAKzB,MAAMu4B,cACiB,UAA5B92B,KAAKzB,MAAMu4B,cACiB,mBAA5B92B,KAAKzB,MAAMu4B,mBAIT,GAAgC,eAA5B92B,KAAKzB,MAAMu4B,aAA8B,CAEhD92B,KAAKuoC,kBAAkBvoC,KAAKzB,MAAM6iB,cAGhC,IAAMonB,EAASxoC,KAAKzB,MAAMk0B,gBAAkBzyB,KAAKzB,MAAMk0B,gBAAgBnuB,MAAM,cAAc,GAAGA,MAAM,KAAK,GAAK,GACxGmkC,EAASzoC,KAAKzB,MAAMk0B,gBAAkBzyB,KAAKzB,MAAMk0B,gBAAgBnuB,MAAM,cAAc,GAAGA,MAAM,KAAK,GAAK,GAC9GtE,KAAKiQ,SACH,CACE8C,QAAS,IAAMy1B,EAAS,IAAMC,EAC9BnQ,UAAW,UAKjB,GAAIt4B,KAAKzB,MAAMmqC,oBAAoB,CACjC1oC,KAAK2oC,aAAa3oC,KAAKzB,MAAMmqC,qBAG7B,IAAMF,EAASxoC,KAAKzB,MAAMmqC,oBAAoBpkC,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC1EmkC,EAASzoC,KAAKzB,MAAMmqC,oBAAoBpkC,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC1E4X,EAAiBlc,KAAKzB,MAAMqqC,WAAa,CAC7CvjC,UAAWrF,KAAKzB,MAAMqqC,WACtBnkC,wBAAyBzE,KAAKzB,MAAM6iB,cAAgBphB,KAAKzB,MAAM6iB,aAAa9c,MAAM,cAAc,IAC9F,GACJtE,KAAKiQ,SACH,CAAC8C,QAAS,IAAMy1B,EAAS,IAAMC,EAC/BvsB,eAAgBA,IAGdlc,KAAKzB,MAAM6iB,cACbphB,KAAKuoC,kBAAkBvoC,KAAKzB,MAAM6iB,iB,gCAMxC,SAAmBjR,GAAW,IAAD,OAI3B,GAAgC,WAA5BnQ,KAAKzB,MAAMu4B,cACgB,cAA5B92B,KAAKzB,MAAMu4B,cACiB,UAA5B92B,KAAKzB,MAAMu4B,cACiB,mBAA5B92B,KAAKzB,MAAMu4B,aAER92B,KAAKzB,MAAMuT,aAAe3B,EAAU2B,YACtC9R,KAAKiQ,SAAS,CACZ+nB,MAAO,GACPjlB,QAAS,UAIV,GAAgC,eAA5B/S,KAAKzB,MAAMu4B,cAElB,GAAI92B,KAAKzB,MAAMuT,aAAe3B,EAAU2B,WAAW,CACjD9R,KAAKuoC,kBAAkBvoC,KAAKzB,MAAM6iB,cAGlC,IAAMonB,EAASxoC,KAAKzB,MAAMk0B,gBAAkBzyB,KAAKzB,MAAMk0B,gBAAgBnuB,MAAM,cAAc,GAAGA,MAAM,KAAK,GAAK,GACxGmkC,EAASzoC,KAAKzB,MAAMk0B,gBAAkBzyB,KAAKzB,MAAMk0B,gBAAgBnuB,MAAM,cAAc,GAAGA,MAAM,KAAK,GAAK,GAC9GtE,KAAKiQ,SACL,CACE8C,QAAS,IAAMy1B,EAAS,IAAMC,EAC9BnQ,UAAW,UAKb,CAEF,GAAIt4B,KAAKzB,MAAMmqC,sBAAwBv4B,EAAUu4B,oBAAoB,CACnE1oC,KAAK2oC,aAAa3oC,KAAKzB,MAAMmqC,qBAC7B,IAAMF,EAASxoC,KAAKzB,MAAMmqC,oBAAoBpkC,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC1EmkC,EAASzoC,KAAKzB,MAAMmqC,oBAAoBpkC,MAAM,cAAc,GAAGA,MAAM,KAAK,GAEhFtE,KAAKiQ,UAAS,SAAC4B,GACb,IAAM81B,EAAU91B,EAAU81B,QAC1BA,EAAO,QAAYtP,yBAA2B,GAC9CsP,EAAO,QAAYtP,yBAA2B,GAC9C,IAAMnc,EAAiB,EAAK3d,MAAMqqC,WAAX,6BAClB/2B,EAAUqK,gBADQ,IAErB7W,UAAW,EAAK9G,MAAMqqC,WACtBnkC,wBAAyB,EAAKlG,MAAM6iB,cAAgB,EAAK7iB,MAAM6iB,aAAa9c,MAAM,cAAc,KAC9F,GACJ,MAAO,CACLyO,QAAS,IAAMy1B,EAAS,IAAMC,EAC9BvsB,eAAgBA,EAChByrB,QAASA,EACTlP,qBAAsB,OAMxBz4B,KAAKzB,MAAM6iB,eAAiBjR,EAAUiR,eACnCphB,KAAKzB,MAAM6iB,cASdphB,KAAKiQ,UAAS,SAAC4B,GAMb,MAAO,CACPqK,eANuB,EAAK3d,MAAMqqC,WAAX,6BAClB/2B,EAAUqK,gBADQ,IAErB7W,UAAW,EAAK9G,MAAMqqC,WACtBnkC,wBAAyB,EAAKlG,MAAM6iB,cAAgB,EAAK7iB,MAAM6iB,aAAa9c,MAAM,cAAc,KAC9F,GAGJm0B,qBAAsB,OAGxBz4B,KAAKuoC,kBAAkBvoC,KAAKzB,MAAM6iB,eAnBlCphB,KAAKiQ,SACH,CACE+nB,MAAO,GACP9b,eAAgB,GAChBuc,qBAAsB,MAkB1Bz4B,KAAKzB,MAAMqqC,aAAez4B,EAAUy4B,YACtC5oC,KAAKiQ,UAAS,SAAC4B,GAMb,MAAO,CACPqK,eANuB,EAAK3d,MAAMqqC,WAAX,6BAClB/2B,EAAUqK,gBADQ,IAErB7W,UAAW,EAAK9G,MAAMqqC,WACtBnkC,wBAAyB,EAAKlG,MAAM6iB,cAAgB,EAAK7iB,MAAM6iB,aAAa9c,MAAM,cAAc,KAC9F,GAGJm0B,qBAAsB,U,kCAMhC,WACEz4B,KAAK0X,OAAQ,I,oBAEf,WAAS,IAAD,OAmDAmxB,EAAiB,CAAC,YACxB7oC,KAAKgG,MAAM2hC,QAAQC,QAAQjoC,MAAuD,WAA/CK,KAAKgG,MAAM2hC,QAAQC,QAAQxsB,gBAA+BytB,EAAe/8B,KAAK,cAAgB+8B,EAAe/8B,KAAK,YACrJ9L,KAAKgG,MAAM2hC,QAAQE,QAAQloC,MAAQkpC,EAAe/8B,KAAK,YACvD9L,KAAKgG,MAAMo0B,QAAUyO,EAAe/8B,KAAK,UAAW+8B,EAAe/8B,KAAK,WAsExE,OACE,6BAEI9L,KAAKgG,MAAMo0B,SAAW,kBAAC,GAAD,CAAO96B,IAAKU,KAAKgG,MAAMsyB,UAAUuC,MAEzD,kBAACh8B,EAAA,EAAD,CAAWD,UAAWiqC,EAAetkC,KAAK,MAxEZ,UAA5B,EAAKhG,MAAMu4B,aAEX,kBAAC,GAAD,CACAhlB,WAAY,EAAKvT,MAAMuT,WACvBuiB,kBAAmB,EAAK91B,MAAM81B,kBAC9B+S,eAAgB,EAAK/J,SACrB7kB,yBAA0B,EAAKA,2BAIE,WAA5B,EAAKja,MAAMu4B,aACV,kBAAC,GAAD,CAAkBhlB,WAAY,EAAKvT,MAAMuT,aAEd,cAA5B,EAAKvT,MAAMu4B,aACT,kBAAC,GAAD,CAAYhlB,WAAY,EAAKvT,MAAMuT,WACzC5L,KAAK,wCAG2B,mBAA5B,EAAK3H,MAAMu4B,aAElB,kBAAC,GAAD,CAAgB0Q,iBAAkB,EAAKjpC,MAAMuT,aAGV,eAA5B,EAAKvT,MAAMu4B,aACV,6BACN,4BAAK,EAAK9wB,MAAM8iC,eACd,uBAAG3pC,MAAO,CAAC,UAAa,WAAxB,MAAsC,kBAAC,IAAD,CAAMD,GAAI,oBAAsB,EAAK8G,MAAMgyB,MAAMxwB,QAAS,EAAKxB,MAAMgyB,MAAMvwB,cACjH,kBAAC,GAAD,CAGEoL,gBAAiB,EAAKtU,MAAMuT,WAC5BA,WAAY,EAAKvT,MAAMuT,WACvBI,MAAO,EAAKlM,MAAMgyB,MAAM9lB,MACxBpD,QAAQ,EAERiE,QAAS,GACTE,gBAAgB,EAChBC,gBAAgB,KAMpB,EAAKlN,MAAMsyB,WACX,oCACA,kBAAC,GAAD,CAAc7F,gBAAiB,EAAKzsB,MAAMsyB,UAAU7F,gBAAiB7V,kBAAmB,EAAK8qB,YAC7F,kBAAC,GAAD,CACE7M,IAAK,EAAK70B,MAAMsyB,UAAUuC,IAC1Bve,SAAU,EAAKtW,MAAMsyB,UAAUhc,SAC/B+gB,SAAU,EAAKA,SACf7kB,yBAA0B,EAAKA,yBAC/Ba,sBAAuB,EAAKA,sBAC5BikB,WAAY,EAAKA,WAIjBxC,SAAU,EAAKv8B,MAAM6iB,cAAgB,EAAK7iB,MAAM6iB,aAAa9c,MAAM,cAAc,GACjFkxB,6BAA8B,EAAKA,6BACnC+J,2BAA4B,EAAKA,2BACjCrjB,eAAgB,EAAKlW,MAAMkW,mBAiB9Blc,KAAKgG,MAAMsyB,WAAa,kBAAC,GAAD,CACvBhsB,KAAMtM,KAAKgG,MAAMsyB,WAAat4B,KAAKgG,MAAMsyB,UAAUhsB,KACnDF,SAAUpM,KAAKgG,MAAMsyB,WAAat4B,KAAKgG,MAAMsyB,UAAUlsB,SACvDkQ,SAAUtc,KAAKgG,MAAMsyB,WAAat4B,KAAKgG,MAAMsyB,UAAUhc,SACvDd,YAAaxb,KAAKwb,YAClB4e,QAASp6B,KAAKgG,MAAMo0B,QACpBC,oBAAqBr6B,KAAKq6B,oBAC1BtnB,QAAS/S,KAAKgG,MAAM+M,UAEtB,8BAEE/S,KAAKgG,MAAMo0B,SA9ICrV,OAAOC,KAAK,EAAKhf,MAAM2hC,SAAS1gC,KAAI,SAACqE,GACnD,OAAI,EAAKtF,MAAM2hC,QAAQr8B,GAAK3L,KAClB,kBAAC,GAAD,CACJ2L,IAAKA,EACLkQ,YAAa,EAAKA,YAClBH,eAAgB,EAAKA,eACrBE,eAAgB,EAAKA,eACrBD,eAAgB,EAAKA,eACrBL,gBAAiB,EAAKA,gBACtBkB,uBAAwB,EAAKkhB,SAC7BzgB,kBAAmB,EAAK8qB,UACxBlvB,yBAA0B,EAAKA,yBAC/Byf,mBAAoB,EAAKA,mBACzBvc,sBAAuB,EAAKA,sBAC5B5J,WAAY,EAAK9L,MAAMgyB,MAAQ,EAAKhyB,MAAMgyB,MAAMlmB,WAAa,EAAKvT,MAAMuT,WACxEglB,aAAc,EAAKv4B,MAAMu4B,aAAe,EAAKv4B,MAAMu4B,aAAe,OAClEnb,WAAY,EAAK3V,MAAM2hC,QAAQr8B,GAAK20B,SACpC/kB,SAAU,EAAKlV,MAAM2hC,QAAQr8B,GAAK4P,SAClCH,WAAY,EAAK/U,MAAM2hC,QAAQr8B,GAAKyP,WACpCK,gBAAiB,EAAKpV,MAAM2hC,QAAQr8B,GAAK8P,gBACzCrK,UAAW,EAAK/K,MAAM+K,UACtBkI,YAAa,EAAKjT,MAAMiT,YACxBmD,KAAM,EAAKpW,MAAMgyB,MACjBM,UAAW,EAAKtyB,MAAMsyB,UACtB7c,eAAqD,YAArC,EAAKzV,MAAM2hC,QAAQr8B,GAAK4P,SAAyB,EAAKlV,MAAM2hC,QAAX,QAA8BhoC,KAAO,EAAKqG,MAAM2hC,QAAX,QAA8BhoC,KACpIoT,QAAS,EAAK/M,MAAM+M,QACpBkkB,0BAA2B,EAAKA,0BAChC3e,mBAAoB,EAAKtS,MAAM2hC,QAAQr8B,GAAKgN,mBAC5C4e,0BAA2B,EAAKA,0BAChCmB,yBAA0B,EAAKryB,MAAM2hC,QAAQr8B,GAAK+sB,yBAClDE,mBAAoB,EAAKvyB,MAAMuyB,mBAC/B/C,6BAA8B,EAAKA,6BACnCnc,sBAAuB,EAAKA,sBAC5B6C,eAAgB,EAAKlW,MAAMkW,eAC3BmY,kBAAmB,EAAK91B,MAAM81B,kBAC9B3F,OAAQ,EAAKnwB,MAAMmwB,OACnBlN,2BAA4B,EAAKA,2BACjCE,8BAA+B,EAAKA,8BACpC+W,qBAAsB,EAAKzyB,MAAMyyB,uBAK5B,c,GA5gBOjoB,IAAMC,WC+IjBs4B,I,yDArJb,WAAYxqC,GAAO,IAAD,8BAChB,cAAMA,IACD+7B,aAAe,EAAKA,aAAa1qB,KAAlB,gBAFJ,E,gDAMlB,SAAairB,EAAKC,EAAUkO,GAC1B,IAAM5kB,EAAQpkB,KACd,GAAI66B,EAAI,CAEN,IAAMA,EAAM76B,KAAKzB,MAAMs8B,IAInBz6B,EAAS,GACb,GAAIy6B,EAAIr4B,SAAS,SAAYq4B,EAAIr4B,SAAS,UACvCpC,EAASy6B,OAITz6B,EAAS,kEADUy6B,EAAIv2B,MAAM,YAAY,GAAGA,MAAM,KAAK,GAkBnCnE,EAAcC,EAdjB,uCAAhB4oC,EACQ,8BAEa,2CAAhBA,EACE,kCAEc,wCAAhBA,EACE,+BAGA,+BAKIxoC,MAAK,SAACC,GAInBK,SAASm6B,eAAe,QAAQC,UAAY,GAC5Cp6B,SAASm6B,eAAe,QAAQ35B,YAAYb,GAkC5C2B,IAAE,uBAAuB+6B,OAAM,SAASr9B,GACtCA,EAAEyO,oBAGJnM,IAAE,uBAAuBia,SAAS8gB,OAAM,SAASr9B,GAC5CA,EAAEyO,iBACF,IAAMqc,EAAOxoB,IAAEpC,MAAMuC,SAAS,uBACxB4I,EAAS/I,IAAEwoB,GAAMwS,KAAK,QACtBn5B,EAAO7B,IAAE+I,GAAQyyB,OACjBG,EAAa37B,IAAEpC,MAAMuC,SAAS,iBAAiB66B,KAAK,kBAEtDW,IACF37B,IAAE,IAAM27B,GAAYkL,YAAY,aAChC7mC,IAAE,qBAAuB27B,EAAa,KAAKkL,YAAY,cAIzD,IAAMC,EAAc9mC,IAAEpC,MAAMuC,SAAS,iBACrC2mC,EAAYD,YAAY,UACxBC,EAAYtL,KAAK35B,MAEnB7B,IAAEtB,UAAU6Y,GAAG,QAAS,gCAAgC,SAAS7Z,GAChEA,EAAEyO,iBACF,IAAMpD,EAAS/I,IAAEpC,MAAMo9B,KAAK,YACtBY,EAAkB57B,IAAEpC,MAAMo9B,KAAK,yBAErChZ,EAAM7lB,MAAM8+B,SAASW,GAErB5Z,EAAM7lB,MAAMi3B,6BAA6BrqB,GAEzCiZ,EAAM7lB,MAAM++B,WAAW,UAAW,qBAGrChmB,OAAM,SAACxX,GACNpB,QAAQC,IAAI,uBAAwBmB,GACpCgB,SAASm6B,eAAe,QAAQC,UAAY,GAC5Cp6B,SAASm6B,eAAe,QAAQC,UAAY,6E,gCAKpD,SAAmB/qB,EAAW0B,GAGxB1B,EAAU0qB,MAAQ76B,KAAKzB,MAAMs8B,IAC/B76B,KAAKs6B,aAAat6B,KAAKzB,MAAMs8B,IAAK76B,KAAKzB,MAAMu8B,SAAU96B,KAAKzB,MAAMyqC,aAI9DhpC,KAAKzB,MAAMu8B,WAAa3qB,EAAU2qB,UACpC94B,EAAkBhC,KAAKzB,MAAMu8B,UAAU,K,+BAQ7C,WACE96B,KAAKs6B,aAAat6B,KAAKzB,MAAMs8B,IAAK76B,KAAKzB,MAAMu8B,SAAU96B,KAAKzB,MAAMyqC,e,oBAGpE,WAEE,OACE,kBAACnqC,EAAA,EAAD,KACE,yBAAKC,GAAG,c,GAhJU0R,IAAMC,YCLhC,IAoCe04B,GApCU,SAAC5qC,GACxB,MAAkCgK,mBAAS,IAA3C,mBAAOwQ,EAAP,KAAkBqwB,EAAlB,KACA,EAA4B7gC,mBAAS,IAArC,mBAAO/C,EAAP,KAAe6jC,EAAf,KASA,OAPAp/B,qBAAU,WACR,IAAMlD,EAAUpF,ECbH,CACZ,kCACA,IACE,gBDUmCpD,EAAM+qC,eCVR,MACjC,mEACD,IACD,2BAA2B/kC,KAAK,KDQjC6kC,EAAa,YACbriC,EAAQvG,MAAK,SAACmE,GACZykC,EAAazkC,EAAElE,KAAKsG,QAAQC,eAE7B,CAACzI,EAAM+qC,iBAER,kBAACzqC,EAAA,EAAD,CAAWD,UAAU,kBACnB,4BAAKL,EAAM+qC,gBACX,kBAACx+B,EAAA,EAAKC,QAAN,CAAcC,GAAG,QAAQ9E,KAAK,OAAO+E,YAAY,SAASC,SAAU,SAACpL,GAAD,OAAOupC,EAAUvpC,EAAEqL,OAAO5J,QAAQA,MAAOiE,IAC9F,aAAduT,EAA2B,kBAAC,EAAD,MAC5BA,EAAU9R,KAAI,SAACiF,GAEb,MAAyB,+BAArBA,EAAEc,SAASzL,OACT2K,EAAE48B,cAAcvnC,MAAM2L,cAAc1K,SAASgD,EAAO0H,eAC/C,uBAAG5B,IAAKY,EAAEc,SAASzL,OAAO,kBAAC,IAAD,CAAMrC,GAAI,oBAAsBgN,EAAEc,SAASzL,OAAQ2K,EAAE48B,cAAcvnC,QAO/F,UE0UFgoC,G,kDAnWb,WAAYhrC,GAAO,IAAD,8BAChB,cAAMA,IACD2pC,wBAA0B,EAAKA,wBAAwBt4B,KAA7B,gBAC/B,EAAK5J,MAAQ,CACXwjC,YAAa,GACb13B,WAAY,GACZ42B,oBAAqB,GACrBe,cAAe,GACfX,cAAe,GACfthC,OAAQ,GACRC,YAAa,GACbmhC,WAAY,IAXE,E,2DAelB,SAAwBX,GACtBjoC,KAAKzB,MAAMmrC,QAAQ59B,KAAK,CAAC0rB,OAAQ,eAAiByQ,M,qBAEpD,SAAQn2B,EAAY63B,GAAe,IAC7Bf,EtDkb2B/3B,EsDnbC,OAE5BiB,EAAWxN,MAAM,KAAK,KACxBskC,EAAa,CAACp8B,MAAO+J,SAASzE,EAAWxN,MAAM,KAAK,GAAGA,MAAM,KAAK,IAAKmI,IAAK8J,SAASzE,EAAWxN,MAAM,KAAK,GAAGA,MAAM,KAAK,MAE3HwN,EAAaA,EAAWxN,MAAM,KAAK,GAEN3C,EtD6af,CACZ,yHACA,WACA,KAJ6BkP,EsD5awBiB,GtDgbjC,+DACpB,aACE,IAAMjB,EAAc,0DACpB,iEACF,IACA,aACE,IAAMA,EAAc,6DACtB,IACA,aACA,IAAMA,EAAc,gEACpB,IACA,aACA,IAAMA,EAAc,gDACpB,IACA,aACA,IAAMA,EAAc,wEACpB,IACA,aACA,IAAMA,EAAc,2EACpB,IACA,aACA,IAAMA,EAAc,0EACpB,IACA,aACE,IACE,IAAMA,EAAc,qEACtB,IACA,QACA,IACE,IAAMA,EAAc,uEACpB,gFACF,IACF,IACA,aACE,IACE,IAAMA,EAAc,6EACpB,2FACF,IACA,QACA,IACE,IAAMA,EAAc,6EACtB,IACA,QACA,IACE,IAAMA,EAAc,mDACpB,SAAWA,EAAc,0BAC3B,IACF,IACF,KAAKtM,KAAK,KsD9dW/D,MAAK,SAAChC,GAEzB,IAAMwI,EAAWxI,EAAEiC,KAAKsG,QAAQC,SAAStE,OAAS,EAAIlE,EAAEiC,KAAKsG,QAAQC,SAAS,GAAK,GAE7Ed,EAAOc,EAASd,KAAOc,EAASd,KAAK3E,MAAQ,KAC7C6Q,EAAgBpL,EAASoL,cAAgBpL,EAASoL,cAAc7Q,MAAQ,KAExE+a,EAAWtV,EAASsV,SAAWtV,EAASsV,SAAS/a,MAAQuQ,EACzD83B,EAAa5iC,EAAS4iC,WAAa5iC,EAAS4iC,WAAWroC,MAAQ,KAC/DunC,EAAgB9hC,EAAS8hC,cAAgB9hC,EAAS8hC,cAAcvnC,MAAQ,GACxEiG,EAASR,EAASQ,OAASR,EAASQ,OAAOjG,MAAQ,GACnDkG,EAAcT,EAASS,YAAcT,EAASS,YAAYlG,MAAQ,GAClE0f,EAAiBja,EAASia,eAAiBja,EAASia,eAAe1f,MAAQ,GAGjF,GAAmB,qCAAfuQ,EACF,EAAK7B,SAAS,CAACu5B,YAAa,aAAc13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAM,GAAI4iC,cAAe,UAEzH,GAAmB,oCAAfh3B,EACP,EAAK7B,SAAS,CAACu5B,YAAa,YAAa13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAM,GAAI4iC,cAAe,UAExH,GAAmB,6CAAfh3B,EACP,EAAK7B,SAAS,CAACu5B,YAAa,qBAAsB13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAM,GAAI4iC,cAAe,UAEjI,GAAa,6CAAT5iC,EACP,EAAK+J,SAAS,CAACu5B,YAAa,iBAAkB13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAM,GAAI4iC,cAAe,UAE7H,GAAa,qCAAT5iC,EACP,EAAK+J,SAAS,CAACu5B,YAAa,SAAU13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAMA,EAAM4iC,cAAeA,SAEvH,GAAa,sCAAT5iC,EAA6C,CACvBvE,EtD+U5B,SAAoCkP,GAQvC,MAPY,CACZ,qCACA,WACE,IAAMA,EAAc,6EACpB,IAAMA,EAAc,2DACpB,6DACF,KAAKtM,KAAK,IsDtV8BslC,CAA2B/3B,IAC5CtR,MAAK,SAAChC,GACzB,EAAKyR,SACH,CAACu5B,YAAa,UACdM,WAAYtrC,EAAEiC,KAAKsG,QAAQC,SAAS,GAAKxI,EAAEiC,KAAKsG,QAAQC,SAAS,GAAG6zB,IAAIt5B,MAAQ,GAChFynC,YAAaxqC,EAAEiC,KAAKsG,QAAQC,SAAS,GAAKxI,EAAEiC,KAAKsG,QAAQC,SAAS,GAAGgiC,YAAYznC,MAAQ,GACzFuQ,WAAYA,EACZM,cAAe,GAAIkK,SAAU,GAC7BpW,KAAMA,EACN4iC,cAAeA,YAKhB,GAAa,oCAAT5iC,EACL,EAAK+J,SAAS,CAACu5B,YAAa,QAAS13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAMA,EAAM4iC,cAAeA,SAExH,GAAa,sCAAT5iC,EACL,EAAK+J,SAAS,CAACu5B,YAAa,UAAW13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAMA,EAAM4iC,cAAeA,SAE1H,GAAa,+CAAT5iC,EACL,EAAK+J,SAAS,CAACu5B,YAAa,WAAY13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAMA,EAAM4iC,cAAeA,SAE3H,GAAa,6CAAT5iC,EACL,EAAK+J,SAAS,CAACu5B,YAAa,SAAU13B,WAAYA,EAAYM,cAAe,GAAIkK,SAAU,GAAIpW,KAAMA,EAAM4iC,cAAeA,SAEzH,GAAa,wCAAT5iC,EACL,EAAK+J,SAAS,CAACu5B,YAAa,YAAa13B,WAAYA,EAAYM,cAAeA,EAAekK,SAAUA,EAAUpW,KAAMA,EAAM4iC,cAAeA,SAE7I,GAAsB,kDAAlB12B,EACL,EAAKnC,SAAS,CACZu5B,YAAa,aACb/W,gBAAiBxR,EACjBnP,WAAYA,EAEZsP,aAAc,6BAA+BtP,EAAWxN,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC1F8N,cAAeA,EACfkK,SAAUA,EACVpW,KAAMA,EACN4iC,cAAeA,EACfthC,OAAQA,EACRC,YAAaA,SAId,GAAsB,4CAAlB2K,EAEL,EAAKnC,SAAS,CACZy4B,oBAAqBznB,EACrBuoB,YAAa,OACb13B,WAAYA,EAEZsP,aAAc,6BAA+BtP,EAAWxN,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC1FmuB,gBAAiBxR,EACjB6nB,cAAeA,EACfF,WAAYA,SAGb,GAAsB,+CAAlBx2B,GAAoF,6CAAlBA,GAAkF,gDAAlBA,EAAiE,CAC7KzQ,EtD8R5B,SAA0CkP,GAyC7C,MAxCY,CACZ,uDACA,WACE,WACA,IAGE,IACE,IAAMA,EAAc,qEACtB,IACA,QACA,IACE,IAAMA,EAAc,uEACpB,gFACF,IAEF,qGACA,IACE,IACE,uFACA,2FACF,IACA,QACA,IACE,uFACF,IACF,IACA,IACA,WACA,IACE,IACE,IAAMA,EAAc,yEACtB,IACA,QACA,IACE,IAAMA,EAAc,4EACpB,8FACF,IACF,IACF,KAAKtM,KAAK,IsDtU8BwlC,CAAiCj4B,IAClDtR,MAAK,SAAChC,GAEZ,4CAAT0H,EACF,EAAK+J,SAAS,CACZy4B,oBAAqBkB,EACrB93B,WAAYA,EACZsP,aAAc5iB,EAAEiC,KAAKsG,QAAQC,SAAS,GAAGgjC,mBAAmBzoC,MAC5DkxB,gBAAiB3gB,EACjB03B,YAAa,OACbV,cAAeA,EACfF,WAAYA,IAIE,yCAAT1iC,EACH1H,EAAEiC,KAAKsG,QAAQC,SAAS,GAAGia,eAC7B,EAAKhR,SAAS,CACZy4B,oBAAqBlqC,EAAEiC,KAAKsG,QAAQC,SAAS,GAAGia,eAAe1f,MAC/DuQ,WAAYA,EACZsP,aAActP,EACd2gB,gBAAiB,2CACjB+W,YAAa,OACbV,cAAeA,EACfF,WAAYA,IAGd,EAAK34B,SAAS,CAACu5B,YAAa,aAK9B,EAAKv5B,SACH,CAACy4B,oBAAqBlqC,EAAEiC,KAAKsG,QAAQC,SAAS,GAAGia,eAAe1f,MAChEuQ,WAAYA,EACZsP,aAAc5iB,EAAEiC,KAAKsG,QAAQC,SAAS,GAAGgjC,mBAAmBzoC,MAC5DkxB,gBAAiB,2CACjB+W,YAAa,OACbV,cAAeA,EACfF,WAAYA,WAIhB,CAIF,IAAMqB,EAAsBn4B,EAAWxN,MAAM,cAAc,GAAK,aAAewN,EAAWxN,MAAM,cAAc,GAAGA,MAAM,KAAK,GAExHwN,IAAem4B,GACjBvrC,QAAQC,IAAI,iBAAmBmT,EAAa,gCAAkCm4B,GAE9E,EAAK/B,wBAAwB+B,KAG7BvrC,QAAQC,IAAI,4BACZ,EAAKsR,SAAS,CAACu5B,YAAa,oB,+BAMpC,WAEE,GAAIxpC,KAAKzB,MAAM0X,SAAS,CACtB,IAAM+uB,EAAgBkF,KAAGzd,MAAMzsB,KAAKzB,MAAM0X,SAASuhB,OAAQ,CAAE2S,mBAAmB,IAAQr4B,WACpFkzB,EAAcxiC,SAAS,sBACzBxC,KAAKkoC,wBAAwBlD,EAActhC,QAAQ,qBAAsB,sBAGzE1D,KAAKoqC,QAAQpF,M,gCAKnB,SAAmB70B,GACjB,IAAM60B,EAAgBkF,KAAGzd,MAAMzsB,KAAKzB,MAAM0X,SAASuhB,OAAQ,CAAE2S,mBAAmB,IAAQr4B,WAEpFkzB,IADkBkF,KAAGzd,MAAMtc,EAAU8F,SAASuhB,OAAQ,CAAE2S,mBAAmB,IAAQr4B,aAEjFkzB,EAAcxiC,SAAS,sBACzBxC,KAAKkoC,wBAAwBlD,EAActhC,QAAQ,qBAAsB,sBAGzE1D,KAAKoqC,QAAQpF,M,oBAOnB,WAAS,IAAD,OA2HR,OACE,6BACE,kBAACqF,GAAA,EAAD,KACE,+BAAQrqC,KAAKgG,MAAM8iC,eACnB,0BAAM11B,IAAI,YAAY7C,KAAK,qCAC3B,0BAAM6C,IAAI,iBAAiB7C,KAAK,8BAChC,0BAAM6C,IAAI,aAAa7C,KAAK,gCAbD,UAA3B,EAAKvK,MAAMwjC,YACN,0BAAM5uB,KAAK,WAAWvP,QAAQ,eAG9B,0BAAMuP,KAAK,UAAUvP,QAAQ,aAWlC,0BAAMuP,KAAK,gBAAgBvP,QAASrL,KAAKgG,MAAM8L,aAG/C,0BAAM8I,KAAK,WAAWvP,QAASrL,KAAKgG,MAAM8iC,gBAC1C,0BAAMluB,KAAK,aAAavP,QAASrL,KAAKgG,MAAMyB,cAC5C,0BAAMmT,KAAK,cAAcvP,QAAQ,OACjC,0BAAMuP,KAAK,eAAevP,QAAQ,UAvIL,eAA3B,EAAKrF,MAAMwjC,YACL,kBAAC,GAAD,CAAkBF,eAAe,qCAEP,cAA3B,EAAKtjC,MAAMwjC,YACV,kBAAC,GAAD,CAAkBF,eAAe,oCAEP,uBAA3B,EAAKtjC,MAAMwjC,YACV,kBAAC,GAAD,CAAkBF,eAAe,6CAEP,WAA3B,EAAKtjC,MAAMwjC,YAGlB,kBAAC,GAAD,CACE13B,WAAY,EAAK9L,MAAM8L,WACvBglB,aAAa,SACboR,wBAAyB,EAAKA,wBAC9BxZ,OAAQ,EAAKnwB,MAAMmwB,SAKa,YAA3B,EAAK1oB,MAAMwjC,YACV,kBAAC,GAAD,CAAa3O,IAAK,EAAK70B,MAAM8jC,WAAYd,YAAa,EAAKhjC,MAAMgjC,cAGvC,cAA3B,EAAKhjC,MAAMwjC,YAIlB,kBAAC,GAAD,CACA13B,WAAY,EAAK9L,MAAM8L,WACvBglB,aAAa,YACboR,wBAAyB,EAAKA,wBAC9BxZ,OAAQ,EAAKnwB,MAAMmwB,SAIe,eAA3B,EAAK1oB,MAAMwjC,YAEhB,kBAAC,GAAD,CACA13B,WAAY,EAAK9L,MAAM8L,WACvBsP,aAAc,EAAKpb,MAAMob,aACzBqR,gBAAiB,EAAKzsB,MAAMysB,gBAC5BqE,aAAa,aACboR,wBAAyB,EAAKA,wBAC9BxZ,OAAQ,EAAKnwB,MAAMmwB,SAIa,SAA3B,EAAK1oB,MAAMwjC,YAEd,EAAKxjC,MAAM0iC,oBAEX,kBAAC,GAAD,CACA52B,WAAY,EAAK9L,MAAM8L,WACvBsP,aAAc,EAAKpb,MAAMob,aACzBqR,gBAAiB,EAAKzsB,MAAMysB,gBAC5BmW,WAAY,EAAK5iC,MAAM4iC,WACvBF,oBAAqB,EAAK1iC,MAAM0iC,oBAChCR,wBAAyB,EAAKA,wBAC9BxZ,OAAQ,EAAKnwB,MAAMmwB,SAMb,iGAKwB,UAA3B,EAAK1oB,MAAMwjC,aACU,YAA3B,EAAKxjC,MAAMwjC,aACgB,WAA3B,EAAKxjC,MAAMwjC,aACgB,aAA3B,EAAKxjC,MAAMwjC,YAGZ,kBAAC,GAAD,CACA13B,WAAY,EAAK9L,MAAM8L,WACvBglB,aAAa,QACbzC,kBAAmB,EAAKruB,MAAMwjC,YAC9BtB,wBAAyB,EAAKA,wBAC9BxZ,OAAQ,EAAKnwB,MAAMmwB,SAce,mBAA3B,EAAK1oB,MAAMwjC,YAEd,kBAAC,GAAD,CACA13B,WAAY,EAAK9L,MAAM8L,WACvBglB,aAAa,iBACboR,wBAAyB,EAAKA,wBAC9BxZ,OAAQ,EAAKnwB,MAAMmwB,SAIW,aAA3B,EAAK1oB,MAAMwjC,YACV,0EAGD,U,GAhUUh5B,IAAMC,WCChB65B,OATf,WACE,OACE,yBAAK1rC,UAAU,SACf,uCC0BW2rC,OA3Bf,SAAmBhsC,GACjB,MAA8CgK,mBAAShK,EAAMisC,MAAQjsC,EAAMisC,KAAKC,aAAhF,mBAAOC,EAAP,KAAwBC,EAAxB,KAEA,EAAkCpiC,mBAAShK,EAAMisC,MAAQjsC,EAAMisC,KAAKI,UAApE,mBAAOC,EAAP,KAAoBC,EAApB,KAiBA,OALA7gC,qBAAU,WACR0gC,EAAmBpsC,EAAMisC,MAAQjsC,EAAMisC,KAAKC,aAE5CK,EAAWvsC,EAAMisC,MAAQjsC,EAAMisC,KAAKI,YACnC,CAACrsC,EAAMisC,OAER,6BACCE,EAAkB,8BAAM,8BAAOA,GAAb,IAAqC,yBAAKp7B,IAAKu7B,EAAat7B,IAAI,WAAWe,OAAO,SAAlF,IAAgG,kBAACrR,EAAA,EAAD,CAAS0L,KAAK,KAAKa,QAZpH,WAGlB,OAFAm/B,IACEG,IACK7d,GAAS8d,OAAOC,YAS4F,UAAhG,KAAmK,kBAAC/rC,EAAA,EAAD,CAAQ0L,KAAK,KAAKa,QAlBvL,WACjB,OAAOyhB,GAAS8d,OAAOE,gBAAgBtd,IAAoBntB,MAAK,SAACmE,GAC/DgmC,EAAmBhmC,EAAEumC,mBAAmBC,QAAQvwB,MAChDkwB,EAAWnmC,EAAEumC,mBAAmBC,QAAQC,cAe4I,WCmC3KC,OApDf,SAAgB9sC,GACd,IAAOC,EAAKC,cAALD,EAGP,OACE,kBAACq7B,GAAA,EAAD,CAAQC,GAAG,OAAOh0B,QAAQ,QAAQi0B,OAAO,KAAKC,MAAM,MAAM76B,MAAO,CAACmsC,aAAc,sBAC9E,kBAAC/wB,GAAA,EAAD,KACE,kBAAC,IAAD,CAAS3b,UAAU,WAAWM,GAAG,KAAKV,EAAE,WAE1C,kBAACq7B,GAAA,EAAOI,OAAR,CAAeC,gBAAc,qBAC7B,kBAACL,GAAA,EAAOM,SAAR,CAAiBr7B,GAAG,oBACpB,kBAACyb,GAAA,EAAD,KAIE,kBAAC,IAAD,CAAS3b,UAAU,WAAWM,GAAI,kDAAwCV,EAAE,UAC5E,kBAAC,IAAD,CAASI,UAAU,WAAWM,GAAI,oDAAqDV,EAAE,WACzF,kBAAC,IAAD,CAASI,UAAU,WAAWM,GAAI,mDAAoDV,EAAE,aAa1F,kBAAC+b,GAAA,EAAD,KAIE,uBAAG3b,UAAU,WAAW2R,KAAK,wCAAwC/R,EAAE,aAIzE,kBAACq7B,GAAA,EAAOM,SAAR,CAAiBr7B,GAAG,yBAAyBF,UAAU,cAAcO,MAAO,CAACosC,SAAU,MACvF,kBAAChxB,GAAA,EAAD,KACI,kBAAC,GAAD,CAAWiwB,KAAMjsC,EAAMisC,WCflBgB,OAvBf,WACE,IAAOhtC,EAAKC,cAALD,EACP,OAEE,kBAACq7B,GAAA,EAAD,CAAQC,GAAG,QAAQh0B,QAAQ,QAAQi0B,OAAO,KAAKC,MAAM,SAAS76B,MAAO,CAAC,OAAU,MAChF,kBAAC06B,GAAA,EAAOI,OAAR,CAAeC,gBAAc,qBAC7B,kBAACL,GAAA,EAAOM,SAAR,CAAiBr7B,GAAG,oBAEpB,kBAACyb,GAAA,EAAD,CAAKpb,MAAO,CAAC,QAAW,OAAQ,eAAkB,eAAgB,MAAS,SACzE,kBAACob,GAAA,EAAIM,KAAL,CAAUtK,KAAK,qDAAf,cACA,kBAACgK,GAAA,EAAIM,KAAL,CAAUtK,KAAK,2BAA2B/R,EAAE,+BAC5C,kBAAC+b,GAAA,EAAIM,KAAL,CAAUtK,KAAK,oBAAoB/R,EAAE,wBAArC,KACA,kBAAC+b,GAAA,EAAIM,KAAL,CAAUtK,KAAK,2BAA2B/R,EAAE,+BAC5C,kBAAC,GAAD,UCmBSitC,I,cA5BG,SAACltC,GAEjB,IAAMmtC,EAAMntC,EAAMisC,KAAOjsC,EAAMisC,KAAKkB,IAAM,GAC1C,OACA,kBAAC,WAAD,CAAUC,SAAU,kBAAC,EAAD,OAClB,kBAAC,IAAD,CAAeC,cAAc,GAC3B,6BACE,kBAAC,GAAD,CAASpB,KAAMjsC,EAAMisC,OACrB,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOqB,KAAK,IAAI5hB,OAAO,EAAM6hB,OAAQ,SAACvtC,GAAD,OAAW,kBAAC,EAAD,iBAAUA,EAAV,CAAiBmwB,OAAQgd,QACzE,kBAAC,IAAD,CAAOG,KAAK,OAAO5hB,OAAO,EAAM6hB,OAAQ,SAACvtC,GAAD,OAAW,kBAAC,GAAD,iBAAgBA,EAAhB,CAAuBmwB,OAAQgd,QAClF,kBAAC,IAAD,CAAOG,KAAK,QAAS5hB,OAAO,EAAM6hB,OAAQ,SAACvtC,GAAD,OAAW,kBAAC,GAAD,iBAAgBA,EAAhB,CAAuBmwB,OAAQgd,QACpF,kBAAC,IAAD,CAAOG,KAAK,SAAS5hB,OAAO,EAAM6hB,OAAQ,SAACvtC,GAAD,OAAW,kBAAC,GAAD,iBAAWA,EAAX,CAAkBmwB,OAAQgd,QAC/E,kBAAC,IAAD,CAAOG,KAAK,UAAU5hB,OAAO,EAAM6hB,OAAQ,SAACvtC,GAAD,OAAW,kBAAC,EAAD,iBAAaA,EAAb,CAAoBmwB,OAAQgd,QAClF,kBAAC,IAAD,CAAOG,KAAK,OAAO5hB,OAAO,EAAM6hB,OAAQ,SAACvtC,GAAD,OAAW,kBAAC,GAAD,iBAAgBA,EAAhB,CAAuBmwB,OAAQgd,SAOpF,kBAAC,GAAD,WCxBYjmC,QACW,cAA7BN,OAAO8Q,SAAS81B,UAEe,UAA7B5mC,OAAO8Q,SAAS81B,UAEhB5mC,OAAO8Q,SAAS81B,SAASlhB,MACvB,2D,2CCTNmhB,KAGGC,IAAIC,MAGJD,IAAIE,MAEJF,IAAIG,MAGJC,KAAK,CACJC,YAAa,KACbC,OAAO,EAEPC,cAAe,CACbC,aAAa,KAKJT,GAAf,EAAeA,ICjBTU,GAAY,SAAClC,GAEfmC,IAASb,OAEL,kBAAC,GAAD,CAAWtB,KAAMA,IAEnB1pC,SAASm6B,eAAe,UAM9BhO,GAAS8d,OAAO6B,oBAAmB,SAACpC,GAClC,GAAIA,EACF9rC,QAAQC,IAAI,UACZ+tC,GAAUlC,OAEP,CACH9rC,QAAQC,IAAI,WAEZ+tC,GADa,CAAChB,IAAK,aFiGjB,kBAAmBmB,WACrBA,UAAUC,cAAcC,MAAMvsC,MAAK,SAAAwsC,GACjCA,EAAaC,kB","file":"static/js/main.5ecea55a.chunk.js","sourcesContent":["//export const sparqlEndpoint = \"http://localhost:3030/ds/query\"\n//export const sparqlEndpoint = \"https://sparql-docker.scta.info/ds/query\"\n//export const sparqlEndpoint = \"https://sparql-staging.scta.info/ds/query\"\nexport const sparqlEndpoint = \"https://sparql.scta.info/ds/query\"\n\n\nexport const resourceEndpoint = \"http://scta.info/resource/scta\"\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport Jumbotron from 'react-bootstrap/Jumbotron';\nimport Button from 'react-bootstrap/Button';\nimport {Link} from 'react-router-dom';\nimport {resourceEndpoint} from './config';\nimport {useTranslation} from 'react-i18next'\n\n\n\nfunction Home(props) {\n  const {t} = useTranslation();\n  //const resourceid = props.location ? Qs.parse(props.location.search, { ignoreQueryPrefix: true }).resourceid : null;\n  const displayBody = () => {\n    // if (resourceid){\n    //   return <Text resourceid={props.location.search.resourceid}/>\n    // }\n    // else\n    console.log(\"home props\", props)\n    return (\n      <div className=\"Home\">\n        <Container id=\"lbp-home\" fluid>\n            <Container>\n              <Jumbotron id=\"lbp-jumbo\">\n              \t<h1>{t(\"Title\")}</h1>\n                <p>{t(\"Subtitle\")}</p>\n                <Button><Link className=\"nav-link\" to={\"/text?resourceid=\" + resourceEndpoint} style={{color: \"black\"}}>{t(\"Enter\")}</Link></Button>\n              </Jumbotron>\n            </Container>\n          </Container>\n          </div>\n    )\n  }\n  return (\n    displayBody()\n  )\n}\n\nexport default Home;\n","import Axios from 'axios'\nimport {sparqlEndpoint} from './config';\nimport $ from 'jquery';\n\n\nexport function loadXMLDoc(url){\n  //See https://github.com/martin-honnen/martin-honnen.github.io/blob/master/xslt/arcor-archive/2016/test2016081501.html\n  return new Promise(function(resolve) {\n    var req = new XMLHttpRequest();\n    req.open(\"GET\", url);\n    if (typeof XSLTProcessor === 'undefined') {\n     try {\n       req.responseType = 'msxml-document';\n     }\n     catch (e) {\n       console.log('error', e)\n     }\n    }\n    req.onload = function() {\n     resolve(this.responseXML)\n    }\n    req.send();\n  });\n}\n\nexport function convertXMLDoc(xmlurl, xslurl){\n  //See https://github.com/martin-honnen/martin-honnen.github.io/blob/master/xslt/arcor-archive/2016/test2016081501.html\n  return new Promise(function(resolve, reject){\n    Promise.all([loadXMLDoc(xmlurl), loadXMLDoc(xslurl)]).then(function(data) {\n      const xsltProcessor = new XSLTProcessor();\n      xsltProcessor.importStylesheet(data[1]);\n      if (data[0]){\n        const resultDocument = xsltProcessor.transformToFragment(data[0], document);\n        resolve(resultDocument)\n      }\n      else{\n        const reason = new Error('xml document could not be retrieved');\n        reject(reason); // reject\n      }\n    })\n  })\n}\n\nexport function loadHtmlResultDocFromExist(url){\n  return Axios.get(\"https://exist.scta.info/exist/apps/scta-app/xslt-conversion.xq?xmlurl=\" + url)\n}\n\nexport function nsResolver(prefix) {\n    if(prefix === \"tei\") {\n      return 'http://www.tei-c.org/ns/1.0'\n    }\n}\n\nexport function copyToClipboard(string){\n  var dummy = document.createElement(\"textarea\");\n  document.body.appendChild(dummy);\n  dummy.value = string;\n  dummy.select();\n  document.execCommand(\"copy\");\n  document.body.removeChild(dummy);\n}\n\nexport function runQuery(query){\n  //const sparqlEndpoint = \"https://sparql-docker.scta.info/ds/query\"\n  //const sparqlEndpoint = sparqlEndpoint\n  const queryPromise = Axios.get(sparqlEndpoint, { params: { \"query\": query, \"output\": \"json\" } })\n  return queryPromise\n}\n\n//handles scroll to paragraph procedure\nexport function scrollToParagraph(hash, highlight){\n    const element = $(\"#\" + hash);\n\n    // TODO: refactor. this could be a lot simpler\n    if (highlight){\n      element.addClass(\"highlightNone\");\n      $(\".paragraphnumber\").removeClass(\"highlight2\")\n      $(\".plaoulparagraph\").removeClass(\"highlightNone\")\n      $(\".lbp-quote\").removeClass(\"highlightNone\")\n      $(\".lbp-quote\").removeClass(\"highlight\")\n      $(\".lbp-ref\").removeClass(\"highlightNone\")\n      $(\".lbp-ref\").removeClass(\"highlight\")\n      $(\".plaoulparagraph\").removeClass(\"highlight\")\n      element.children(\".paragraphnumber\").addClass(\"highlight2\")\n      element.addClass( \"highlight\");\n      \n      // TODO: Refactor\n      // conditional to ensure fire of next conditional ONLY IF element[0] is found\n      // prevents error with include method below when element does not exist\n      if (element[0]){\n        // condition set to prevent fade if element is quote or ref \n        if (!element[0].className.includes('lbp-quote') && !element[0].className.includes('lbp-ref')){\n          setTimeout(function(){\n            $(\".lbp-ref\").removeClass(\"highlight\")\n            $(\".lbp-quote\").removeClass(\"highlight\")\n            $(\".plaoulparagraph\").removeClass(\"highlight\")\n            element.addClass(\"highlightNone\");\n          }, 2000);\n        }\n      }\n\n    }\n  \tif (element.length > 0) {\n  \t    $('html, body')\n              .stop()\n              .animate({\n                  scrollTop: element.offset().top - 100\n              }, 1000);\n     }\n\n  }\n\n  // adopted from https://github.com/hypothesis/client/blob/master/src/annotator/anchoring/text-position.js\n  /**\n * Convert `start` and `end` character offset positions within the `textContent`\n * of a `root` element into a `Range`.\n *\n * Throws if the `start` or `end` offsets are outside of the range `[0,\n * root.textContent.length]`.\n *\n * @param {HTMLElement} root\n * @param {number} start - Character offset within `root.textContent`\n * @param {number} end - Character offset within `root.textContent`\n * @return {Range} Range spanning text from `start` to `end`\n */\n\nfunction nodeFilterCheck(node){\n  \n  const check = node.parentElement.className\n  // skip text nodes if their parent has the following classes\n  if (check.includes(\"paragraphnumber\") \n  || check.includes(\"lbp-line-number\")\n  || check.includes(\"appnote\") \n  || check.includes(\"paragraphnumber\")\n  || check.includes(\"footnote\")\n  || check.includes(\"lbp-reg\")\n  || check.includes(\"lbp-folionumber\")\n  || check.includes(\"js-show-folio-image\") // removes folio number\n  ){\n    return NodeFilter.FILTER_REJECT\n  }\n  else if (!node.nodeValue){\n    return NodeFilter.FILTER_REJECT\n  }\n  else{\n    return NodeFilter.FILTER_ACCEPT;\n  }\n  \n}\n\nexport function toRange(root, start, end) {\n  // The `filter` and `expandEntityReferences` arguments are mandatory in IE\n  // although optional according to the spec.\n  //console.log(\"root\", root)\n  const nodeIter = root.ownerDocument.createNodeIterator(\n    root,\n    NodeFilter.SHOW_TEXT,\n    nodeFilterCheck, // filter\n    true // expandEntityReferences\n  );\n\n  let startContainer;\n  let startOffset;\n  let startWordOffset\n  let endContainer;\n  let endOffset;\n  let endWordOffset;\n  let breaks = 0;\n\n // let textLength = 0;\n  let wordLength = 0;\n  let node;\n\n  \n  while ((node = nodeIter.nextNode()) && (!startContainer || !endContainer)) {\n    // keep running total of break words and then use this to adjust word count \n    // in comparison to word count with broken words; then adjust;\n    // NOTE: requires xslt to add data-break='no' to line break span\n    if (node.previousSibling){\n      if (node.previousSibling.getAttribute){\n        if (node.previousSibling && node.previousSibling.getAttribute(\"data-break\") === \"no\"){\n          breaks += 1\n        }\n      }\n    }\n    const nodeText = node.nodeValue;\n    // get array of words in node\n    const nodeTextArray = cleanText(nodeText).split(\" \").filter(n=>n)\n    // use clean text to remove punctuation and unwanted white space, then filter to get rid of blank array items, then count\n    const newWordLength = nodeTextArray.length\n    \n    // if start word is greater than length of word count in preceding nodes, but less than or equal \n    // to word count of of preceding plus this node, then selection starts somewhere within this node\n    // select node, then find precise word and character position start\n    if (\n      !startContainer &&\n      start + breaks >= wordLength &&\n      start + breaks <= wordLength + newWordLength\n    ) {\n      startContainer = node;\n      startWordOffset = (start + breaks) - wordLength;\n      \n      // get the occurrence instance within the node (needed in case there are two more instances of the same word in the node)\n      const instanceNumber = getInstanceNumber(nodeTextArray, startWordOffset - 1)\n      // calculate character offset of word within containing node\n      startOffset = getStringBeforeWord(node.nodeValue, nodeTextArray[startWordOffset - 1], instanceNumber, true)\n    }\n    // similar to above only for final position\n    if (\n      !endContainer &&\n      end + breaks >= wordLength &&\n      end + breaks <= wordLength + newWordLength\n    ) {\n      endContainer = node;\n      endWordOffset = (end + breaks) - wordLength;\n      // get the occurrence instance within the node (needed in case there are two more instances of the same word in the node)\n      const instanceNumber = getInstanceNumber(nodeTextArray, endWordOffset - 1)\n      // calculate character offset of word within containing node\n      endOffset = getStringBeforeWord(node.nodeValue, nodeTextArray[endWordOffset - 1], instanceNumber, false)\n    }\n\n    //textLength += nodeText.length;\n    wordLength += newWordLength\n    \n    \n  }\n\n  const range = root.ownerDocument.createRange();\n  //conditional here to if container exists before calling it.\n  //usual reason a end container doesn't exist is the end number in the request does not exist in the paragraph \n  // for example, asking for end word 40 when there are only 39 words in the paragraph\n  startContainer ? range.setStart(startContainer, startOffset) : console.log(\"no container or invalid end offset\")\n  endContainer ? range.setEnd(endContainer, endOffset) : console.log(\"no container invalid end offset\")\n\n  return range;\n}\n\n// function to remove spaces from selected html text\nexport function cleanText(selectedText){\n  selectedText = selectedText.replace(/^[ ]+|[ ]+$/g,''); // remove leading and trailing white space\n    // remove all punctuation with escape slashes; escape slashes don't seem needed as the line below with slashes seems to work.\n    // this line with extra slashes produces lint errors\n    // selectedText = selectedText.replace(/[.,\\/#!$%\\^&\\*;:{}=\\-_`~()\"]/g,\"\") //remove all punctuation\n  selectedText = selectedText.replace(/[.,/#!$%^&*;:{}=\\-_`~()\"/\\u00B6/|/\\u204B/]/g,\"\") //remove all punctuation including pilcrows\n  \n  selectedText = selectedText.replace(/\\s+/gi, ' ' ) // condences 1 or more space to single space\n  return selectedText\n}\n\n/**\n * @description returns identical instance number of a certain item in array,\n * e.g. if we have array [1, 2, 3, 4, 5, 1, 2, 3] \n * and we ask for the instanceNumber of index position 5, \n * the function will return 2, as this is the second instance of the number 1 in this array\n * @param {array} wordArray \n * @param {number} wordPosition \n */\nfunction getInstanceNumber(wordArray, wordPosition){\n  let number = 0\n  // using <= to include self in count\n  for (let i=0; i <= wordPosition; i++){\n    if (wordArray[i] === wordArray[wordPosition]){\n      number++\n    }\n  }\n  return number\n}\n/**\n * @description get strings before nth instance of a word\n * @param {string} text - string to be search\n * @param {string} word - word to be matched\n * @param {number} instanceNumber - number instance of word to be matched\n * modified from https://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string\n */\nfunction getStringBeforeWord(text, word, instanceNumber, first) {\n  const splitText = text.split(word, instanceNumber).join(word);  \n  if (first){\n    const characterOffset = splitText.length\n    return characterOffset\n  }\n  else{\n    const characterOffset = splitText.length + word.length\n    return characterOffset\n\n  }\n}\n/**\n * @description creates a range\n * @param {*} root \n * @param {*} startContainer \n * @param {number} startOffset start character relative to containing node\n * @param {*} endContainer \n * @param {number} endOffset - end character length relative to containing node\n */\n\nexport function createRange(root, startContainer, startOffset, endContainer, endOffset){\n  const range = root.ownerDocument.createRange();\n  range.setStart(startContainer, startOffset);\n  range.setEnd(endContainer, endOffset);\n  return range;\n}\n/**\n * @description takes a range object and computes the Word Count after filtering elements nodes not to be counted\n * @param {Range} rng - must take a Range object\n */\nexport function getRangeWordCount(rng){\n  var cnt = rng.cloneContents();\n  $(cnt).find(\".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg\").remove();\n  const selectionText = cleanText(cnt.textContent)\n  const length = selectionText.split(\" \").filter(n=>n).length\n  return length;\n}\n\n \n/**\n * @description gets the containing paragraph node for a node somewhere within the paragraph node\n * @param {node} node \n */\nexport function getContainingP(node) {\n  while (node) {\n    if (node.nodeType === 1 && node.tagName.toLowerCase() === \"p\") {\n        return node;\n    }\n    node = node.parentElement;\n  }\n}\n\n/**\n * @description retrieves plain text and counts line breaks based on input\n */\nexport function getLineNumber(url, selectedText, selectedElementTargetId){\n  //https://github.com/scta-texts/plaoulcommentary/edit/master/lectio1/lectio1.xml#L117\n  //https://raw.githubusercontent.com/scta-texts/plaoulcommentary/master/lectio1/lectio1.xml\n  //https://raw.githubusercontent.com/scta-texts/plaoulcommentarymaster/lectio1/lectio1.xml\n  const newRawUrl = url.replace(\"https://github.com\", \"https://raw.githubusercontent.com\").replace(\"/raw/\", '/')\n  const file = Axios.get(newRawUrl)\n  const data = file.then((d) => {\n    const findElement = \"xml:id=\\\"\" + selectedElementTargetId + \"\\\"\"\n    const splitText = d.data.split(findElement);\n    const beforeText = splitText[0]\n    const splitBeforeText = beforeText.split('\\n');\n    const newLineCount = splitBeforeText.length\n    \n    const afterText = splitText[1]\n    const regexp = new RegExp(`\\\\W${selectedText}\\\\W`, 'gi')\n    const elementBeforeText = afterText.split(regexp)[0] // this is flawed, first instance of the same text will be used\n    const splitElementBeforeText = elementBeforeText.split('\\n');\n    const newElementLineCount = splitElementBeforeText.length\n    return newLineCount + newElementLineCount - 1\n  })\n  return data\n}\n\nexport function goToGitHubEdit(url, selectedText, selectedElementTargetId){\n  console.log(url, selectedText, selectedElementTargetId)\n  const data = getLineNumber(url, selectedText, selectedElementTargetId)\n  //https://github.com/scta-texts/plaoulcommentary/raw/master/lectio1/lectio1.xml\n  data.then((d) => {\n    const editUrl = url.replace(\"raw\", \"edit\") + \"#L\" + d\n    window.open(editUrl,\"gitHubEditWindow\",'height=750,width=750');\n    //window.open(editUrl, \"_blank\"); \n\n  })\n  \n  //window.location = \n  \n}\n\nexport function textReduce(text, wordRange){\n  const wordTokenStart = wordRange.split(\"-\")[0]\n  const wordTokenEnd = wordRange.split(\"-\")[1]\n  const wordTokens = text.split(\" \")\n  // NOTE: I'm not sure what this .filter(Boolean) is doing??\n  const wordTokensClean = wordTokens.filter(Boolean)\n  //const wordTokensBefore = wordTokensClean.slice(0, wordTokenStart - 1);\n  //const wordTokensAfter = wordTokensClean.slice(wordTokenEnd)\n  const wordTokensFocus = wordTokensClean.slice(wordTokenStart - 1, wordTokenEnd)\n  const reducedText = wordTokensFocus.join(\" \")\n  return reducedText\n  // let textElement = \"\"\n  //     if (context){\n  //       textElement = \"<p class='text'><span>\" + wordTokensBefore.join(\" \") + \"</span> <span style='font-weight: bold'>\" + wordTokensFocus.join(\" \") + \"</span> <span>\" + wordTokensAfter.join(\" \") +\"</span></p>\"\n  //     }\n  //     else{\n  //       textElement = \"<p class='text'>\" + wordTokensFocus.join(\" \") + \"</p>\"\n  //     }\n  //   return textElement\n}\n\n// a function to remove spaces and punctuation from a string;\n// currently I'm using this in the comments component to create valid key for a annotaiton list\nexport function camelCase(str) {\n  // remove punctuation\n  const newStr = str.replace(/[\\p{P}$+<=>^`|~]/gu, '')\n  //return string camelCased at spaces\n return newStr.replace(/(?:^\\w|[A-Z]|\\b\\w)/g, function(word, index)\n {\n     return index === 0 ? word.toLowerCase() : word.toUpperCase();\n }).replace(/\\s+/g, '');\n}\n\n//copied from TextCompareItem\n//TODO: TextCompareItem instances should be removed and this function should be used\nexport function textClean(text){\n  // remove most punctuation\n  let punctuationless = text.replace(/[.,/#!$%^&*;:{}=\\-_`~()/\\u00B6/|/\\u204B/]/g,\"\");\n  //convert v->u, ae->e, oe-e>\n  punctuationless = punctuationless.replace(/v/g, \"u\");\n  punctuationless = punctuationless.replace(/ae/g, \"e\");\n  punctuationless = punctuationless.replace(/oe/g, \"e\");\n  punctuationless = punctuationless.replace(/oe/g, \"e\");\n  punctuationless = punctuationless.replace(/y/g, \"i\");\n  //remove space\n  punctuationless = punctuationless.replace(/\\s{2,}/g,\" \");\n  //lowercase\n  const finalFinalString = punctuationless.toLowerCase()\n  return finalFinalString\n\n}","import React from 'react';\nimport BSpinner from 'react-bootstrap/Spinner';\n\nfunction Spinner() {\n  return (\n    <div className=\"spinner\" style={{\"padding\": \"20px 5px\"}}>\n      <BSpinner animation=\"grow\" role=\"status\">\n        <span className=\"sr-only\">Loading...</span>\n      </BSpinner>\n      <BSpinner animation=\"grow\" variant=\"primary\" />\n      <BSpinner animation=\"grow\" variant=\"secondary\" />\n      <BSpinner animation=\"grow\" variant=\"success\" />\n      <BSpinner animation=\"grow\" variant=\"danger\" />\n      <BSpinner animation=\"grow\" variant=\"warning\" />\n      <BSpinner animation=\"grow\" variant=\"info\" />\n    </div>\n  );\n}\n\nexport default Spinner;\n","const searchExpressionsListReducer = (state, action) => {\n  if (action){\n    switch (action.type){\n      case 'START_EXPRESSIONS_FETCH':\n          return {\n\n          }\n      case 'COMPLETE_EXPRESSIONS_FETCH':\n        return [...action.expressions]\n      default:\n        return state\n    }\n  }\n}\n\nexport {searchExpressionsListReducer as default}\n","import Axios from 'axios'\nimport {sparqlEndpoint} from '../components/config';\n\nexport var startExpressionsFetch = () => {\n  return{\n    type: \"START_EXPRESSIONS_FETCH\"\n  };\n};\nexport var completeExpressionsFetch = (expressions) => {\n  return{\n    type: \"COMPLETE_EXPRESSIONS_FETCH\",\n    expressions\n  };\n};\nexport var fetchExpressionsList = (searchParameters, dispatch) =>{\n    let workGroupSparql = \"\"\n    if (searchParameters.searchWorkGroup){\n      workGroupSparql = [\n      \"<\" + searchParameters.searchWorkGroup + \"> <http://scta.info/property/hasExpression> ?expression .\"\n      ].join(' ');\n    }\n    let expressionAuthorTypeSparql = \"\"\n    if (searchParameters.expressionAuthorType){\n      expressionAuthorTypeSparql = [\n      \"?expression <http://www.loc.gov/loc.terms/relators/AUT> ?expressionAuthor . \",\n      \"?expressionAuthor <http://scta.info/property/personType> <http://scta.info/resource/\" + searchParameters.expressionAuthorType + \"> .\"\n      ].join('');\n    }\n\n    let authorSparql = \"\"\n    if (searchParameters.searchAuthor){\n      authorSparql = [\n      \"?expression <http://www.loc.gov/loc.terms/relators/AUT> <\" + searchParameters.searchAuthor + \"> .\"\n      ].join('');\n    }\n    var query = [\n        \"SELECT ?type ?expression ?expressionShortId ?expressionTitle ?author ?authorTitle ?workGroup ?workGroupTitle\",\n        \"WHERE { \",\n          \"?expression a <http://scta.info/resource/expression> .\",\n          \"?expression a ?type .\",\n          \"?expression <http://scta.info/property/level> '1' . \",\n          expressionAuthorTypeSparql,\n          workGroupSparql,\n          authorSparql,\n          \"?expression <http://scta.info/property/shortId> ?expressionShortId .\",\n          \"?expression <http://scta.info/property/shortId> ?expressionShortId .\",\n          \"?expression <http://purl.org/dc/elements/1.1/title> ?expressionTitle .\",\n          \"?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author . \",\n          \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n          \"?expression <http://purl.org/dc/terms/isPartOf> ?workGroup .\",\n          \"?workGroup <http://purl.org/dc/elements/1.1/title> ?workGroupTitle .\",\n          \"}\",\n        \"ORDER BY ?expressionTitle\"].join('');\n\n  dispatch(startExpressionsFetch());\n  Axios.get(sparqlEndpoint, {params: {\"query\" : query, \"output\": \"json\"}}).then(function(res){\n    var results = res.data.results.bindings;\n    var searchWorks = results.map((result) => {\n      var workInfo = {\n          expression: result.expression.value,\n          expressionShortId: result.expressionShortId ? result.expressionShortId.value : \"\",\n          expressionTitle: result.expressionTitle.value,\n          workGroup: result.workGroup ? result.workGroup.value : \"\",\n          workGroupTitle: result.workGroupTitle ? result.workGroupTitle.value : \"\",\n          author: result.author ? result.author.value : \"\",\n          authorTitle: result.author ? result.authorTitle.value : \"\",\n          type: result.type.value\n\n        }\n        return workInfo\n\n      });\n      dispatch(completeExpressionsFetch(searchWorks));\n    });\n\n};\n","const searchAuthorsListReducer = (state, action) => {\n  if (action){\n    switch (action.type){\n      case 'START_AUTHORS_FETCH':\n          return {\n\n          }\n      case 'COMPLETE_AUTHORS_FETCH':\n        return [...action.authors]\n      default:\n        return state\n    }\n  }\n}\n\nexport {searchAuthorsListReducer as default}\n","import Axios from 'axios'\nimport {sparqlEndpoint} from '../components/config';\n\nexport var startAuthorsFetch = () => {\n  return{\n    type: \"START_AUTHORS_FETCH\"\n  };\n};\nexport var completeAuthorsFetch = (authors) => {\n  return{\n    type: \"COMPLETE_AUTHORS_FETCH\",\n    authors\n  };\n};\nexport var fetchAuthorsList = (searchParameters, dispatch) =>{\n    let workGroupSparql = \"\";\n      if (searchParameters.searchWorkGroup){\n        workGroupSparql = \"<\" + searchParameters.searchWorkGroup + \"> <http://scta.info/property/hasExpression> ?resource .\"\n      }\n    const query = [\n        \"SELECT DISTINCT ?author ?authorTitle ?authorShortId \",\n        \"WHERE { \",\n        \"?author a <http://scta.info/resource/person> .\",\n        \"?resource a <http://scta.info/resource/expression> .\",\n        \"?resource <http://scta.info/property/level> '1' .\",\n        workGroupSparql,\n        \"?resource <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n        \"?author <http://scta.info/property/shortId> ?authorShortId .\",\n        \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n        \"}\",\n        \"ORDER BY ?authorTitle\"].join('');\n  dispatch(startAuthorsFetch());\n  Axios.get(sparqlEndpoint, {params: {\"query\" : query, \"output\": \"json\"}}).then(function(res){\n    var results = res.data.results.bindings;\n    var authors = results.map((result) => {\n        var authorInfo = {\n          author: result.author.value,\n          authorShortId: result.authorShortId.value,\n          authorTitle: result.authorTitle.value,\n        }\n        return authorInfo\n\n      });\n      dispatch(completeAuthorsFetch(authors));\n    });\n  };\n","const searchWorkGroupsListReducer = (state, action) => {\n  if (action){\n    switch (action.type){\n      case 'START_WORK_GROUPS_LIST_FETCH':\n          return {\n\n          }\n      case 'COMPLETE_WORK_GROUPS_LIST_FETCH':\n        return [...action.workGroups]\n      default:\n        return state\n    }\n  }\n}\n\nexport {searchWorkGroupsListReducer as default}\n","import Axios from 'axios'\nimport {sparqlEndpoint} from '../components/config';\n\nexport var startWorkGroupsListFetch = () => {\n  return{\n    type: \"START_WORK_GROUPS_LIST_FETCH\"\n  };\n};\nexport var completeWorkGroupsListFetch = (workGroups) => {\n  return{\n    type: \"COMPLETE_WORK_GROUPS_LIST_FETCH\",\n    workGroups\n  };\n};\nexport var fetchWorkGroupsList = (searchParameters, dispatch) =>{\n  let authorQuery = \"\";\n    if (searchParameters.searchAuthor){\n      authorQuery = [\n      \"?workGroup <http://scta.info/property/hasExpression> ?expression .\",\n      \"?expression <http://www.loc.gov/loc.terms/relators/AUT> <\" + searchParameters.searchAuthor + \"> .\"\n      ].join('');\n    }\n  //   // Begin Author date sparql filters\n  //   let quotationAuthorDateSparql = \"\";\n  //   if (searchParameters.quotationAuthorDateAfter || searchParameters.quotationAuthorDateBefore){\n  //     quotationAuthorDateSparql = \"?author <http://scta.info/property/dateOfBirth> ?dateOfBirth .\"\n  //   }\n  //   let quotationAuthorDateAfterSparqlFilter = \"\";\n  //   if (searchParameters.quotationAuthorDateAfter){\n  //     quotationAuthorDateAfterSparqlFilter = \"FILTER (?dateOfBirth >= '\" + searchParameters.quotationAuthorDateAfter + \"').\"\n  //   }\n  //   let quotationAuthorDateBeforeSparqlFilter = \"\";\n  //   if (searchParameters.quotationAuthorDateBefore){\n  //     quotationAuthorDateBeforeSparqlFilter = \"FILTER (?dateOfBirth <= '\" + searchParameters.quotationAuthorDateBefore + \"').\"\n  //   }\n    // END author date sparql filter\n    var query = [\n        \"SELECT DISTINCT ?workGroup ?workGroupTitle \",\n        \"WHERE { \",\n        \"?workGroup a <http://scta.info/resource/workGroup> .\",\n        \"?workGroup <http://purl.org/dc/elements/1.1/title> ?workGroupTitle .\",\n        authorQuery,\n        \"}\",\n        \"ORDER BY ?workGroupTitle\"].join(' ');\n  dispatch(startWorkGroupsListFetch());\n  Axios.get(sparqlEndpoint, {params: {\"query\" : query, \"output\": \"json\"}}).then(function(res){\n    var results = res.data.results.bindings;\n    var workGroups = results.map((result) => {\n        var workGroupInfo = {\n          workGroup: result.workGroup.value,\n          workGroupTitle: result.workGroupTitle.value,\n        }\n        return workGroupInfo\n\n      });\n      dispatch(completeWorkGroupsListFetch(workGroups));\n    });\n  };\n","const searchExpressionTypesListReducer = (state, action) => {\n  if (action){\n    switch (action.type){\n      case 'START_EXPRESSION_TYPES_LIST_FETCH':\n          return {\n\n          }\n      case 'COMPLETE_EXPRESSION_TYPES_LIST_FETCH':\n        return [...action.expressionTypes]\n      default:\n        return state\n    }\n  }\n}\n\nexport {searchExpressionTypesListReducer as default}\n","import React, {useState, useEffect, useReducer} from 'react';\nimport searchExpressionsListReducer from '../reducers/searchExpressionsListReducer'\nimport * as searchExpressionsListActions from '../actions/searchExpressionsListActions'\nimport searchAuthorsListReducer from '../reducers/searchAuthorsListReducer'\nimport * as searchAuthorsListActions from '../actions/searchAuthorsListActions'\nimport searchWorkGroupsListReducer from '../reducers/searchWorkGroupsListReducer'\nimport * as searchWorkGroupsListActions from '../actions/searchWorkGroupsListActions'\nimport searchExpressionTypesListReducer from '../reducers/searchExpressionTypesListReducer'\nimport * as searchExpressionTypesListActions from '../actions/searchExpressionTypesListActions'\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport InputGroup from 'react-bootstrap/InputGroup';\n\nconst Search3Parameters = (props) => {\n  const [searchType, setSearchType] = useState(props.searchType ? props.searchType : \"text\")\n  const [searchTerm, setSearchTerm] = useState(props.searchTerm)\n  const [searchAuthor, setSearchAuthor] = useState(props.searchAuthor)\n  const [searchEid, setSearchEid] = useState(props.searchEid)\n  const [searchEType, setSearchEType] = useState(props.searchEType)\n  const [searchWorkGroup, setSearchWorkGroup] = useState(props.searchWorkGroup)\n\n  const [resultsFilter, setResultsFilter] = useState(\"\")\n\n  const [searchExpressionTypesList, searchExpressionTypesListDispatch] = useReducer(searchExpressionTypesListReducer, [])\n  const [searchExpressionsList, searchExpressionsListDispatch] = useReducer(searchExpressionsListReducer, [])\n  const [searchAuthorsList, searchAuthorsListDispatch] = useReducer(searchAuthorsListReducer, [])\n  const [searchWorkGroupsList, searchWorkGroupsListDispatch] = useReducer(searchWorkGroupsListReducer, [])\n  const searchParameters = {searchTerm, searchAuthor, searchEid, searchWorkGroup, searchType, searchEType, resultsFilter}\n\n  const [displayAllParameters, setDisplayAllParameters] = useState(false)\n\n  // this is temporary to allow list of figure tags to be viewed; it is not a final solution; if keeping tags is important, available tags should be received from a service -->\n  const availableFigureTagsList = [\"light/shadow\", \"physical objects\", \"concrete elements\", \"letters\", \"text\", \"woodcut\", \"integrated in the layout\", \"3d and perspective\", \"plasticity\", \"tree\", \"related to an experiment\", \"specimen\", \"material\", \"polarity\", \"magnetic force\", \"scientific\", \"analogy, allegory and symbols\", \"practice\", \"geometrical forms\", \"abstract elements\", \"inclination\", \"arrows\", \"knife\", \"hand\", \"persons or human body\"]\n  availableFigureTagsList.sort()\n\n  const handleSetSearchParameters = () => {\n    props.handleSetSearchParameters(searchParameters)\n  }\n  const handleSetResultsFilter = (content) => {\n    setResultsFilter(content)\n  }\n\n  //begin effects to update hooks when props change\n  // perhaps this could be combined into a single custom hook\n  useEffect(() => {\n    setSearchType(props.searchType ? props.searchType : \"text\")\n  }, [props.searchType])\n  useEffect(() => {\n    setSearchAuthor(props.searchAuthor)\n  }, [props.searchAuthor])\n  useEffect(() => {\n    setSearchEid(props.searchEid)\n  }, [props.searchEid])\n  useEffect(() => {\n    setSearchEType(props.searchEType)\n  }, [props.searchEType])\n  useEffect(() => {\n    setSearchWorkGroup(props.searchWorkGroup)\n  }, [props.searchWorkGroup])\n  useEffect(() => {\n    setSearchTerm(props.searchTerm)\n  }, [props.searchTerm])\n  //end effects to update hooks when props change\n  //begin other effects\n  useEffect(handleSetSearchParameters, [searchTerm, searchAuthor, searchEid, searchWorkGroup, searchType, searchEType, resultsFilter])\n  useEffect(() => {\n    searchExpressionsListDispatch(searchExpressionsListActions.fetchExpressionsList(searchParameters, searchExpressionsListDispatch))\n    searchAuthorsListDispatch(searchAuthorsListActions.fetchAuthorsList(searchParameters, searchAuthorsListDispatch))\n    searchWorkGroupsListDispatch(searchWorkGroupsListActions.fetchWorkGroupsList(searchParameters, searchWorkGroupsListDispatch))\n    searchExpressionTypesListDispatch(searchExpressionTypesListActions.fetchExpressionTypesList(searchParameters, searchExpressionTypesListDispatch))\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n  useEffect(() => {\n    searchExpressionsListDispatch(searchExpressionsListActions.fetchExpressionsList(searchParameters, searchExpressionsListDispatch))\n    searchWorkGroupsListDispatch(searchWorkGroupsListActions.fetchWorkGroupsList(searchParameters, searchWorkGroupsListDispatch))\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchAuthor])\n  useEffect(() => {\n    searchExpressionsListDispatch(searchExpressionsListActions.fetchExpressionsList(searchParameters, searchExpressionsListDispatch))\n    searchAuthorsListDispatch(searchAuthorsListActions.fetchAuthorsList(searchParameters, searchAuthorsListDispatch))\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchWorkGroup])\n\n  return(\n    <div>\n      <InputGroup size=\"sm\" className=\"mb-2\">\n        <InputGroup.Prepend>\n            <InputGroup.Text>Search Term</InputGroup.Text>\n        </InputGroup.Prepend>\n        <Form.Control as=\"input\" type=\"text\" placeholder=\"search term\" onChange={(e) => setSearchTerm(e.target.value)} value={searchParameters.searchTerm}/>\n      </InputGroup>\n      {/* {NOTE filter results parameter is useful only when results are of manageable size;\n        when results are big, javascript locks up while filtering\n        if paging is used, then this could prevent performance slow down \n        but paging makes the tool less than useful, because it will only filter what is on the page\n        TODO: reconsider if you want to keep this; or this is not worth the trouble\n        NOTE: if this parameters is removed, then filterResults() and filterQuestionResults() functions \n        in Search3 should be removed\n        } */}\n\n      {searchType === 'figure' && \n      <InputGroup size=\"sm\" className=\"mb-2\">\n        <InputGroup.Prepend>\n          <InputGroup.Text>Search by Figure Tag</InputGroup.Text>\n        </InputGroup.Prepend>\n        <Form.Control as=\"select\" onChange={(e) => {setSearchTerm(e.target.value)}} value={searchParameters.searchTerm}>\n            <option value=\"\"></option>\n            {availableFigureTagsList.map((ft) => {\n              return <option value={\"'\" + ft + \"'\"}>{ft}</option>\n            })}\n          </Form.Control>\n      </InputGroup>\n      }\n      <InputGroup size=\"sm\" className=\"mb-2\">\n          <InputGroup.Prepend>\n            <InputGroup.Text>Filter Results</InputGroup.Text>\n          </InputGroup.Prepend>\n        <Form.Control as=\"input\" type=\"secondary results filter\" placeholder=\"secondary results filter\" onChange={(e) => handleSetResultsFilter(e.target.value)} value={resultsFilter}/>\n      </InputGroup>\n      {displayAllParameters &&\n        <div>\n          <InputGroup size=\"sm\" className=\"mb-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text>Search Type</InputGroup.Text>\n            </InputGroup.Prepend>\n            <Form.Control as=\"select\" onChange={(e) => {setSearchType(e.target.value)}} value={searchParameters.searchType}>\n              <option value=\"questionTitles\">Questions Titles</option>\n              <option value=\"text\">Text</option>\n              <option value=\"figure\">Figure</option>\n            </Form.Control>\n          </InputGroup>\n          <InputGroup size=\"sm\" className=\"mb-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text>Work Group</InputGroup.Text>\n            </InputGroup.Prepend>\n            <Form.Control as=\"select\" onChange={(e) => {setSearchWorkGroup(e.target.value)}} value={searchParameters.searchWorkGroup}>\n                <option value=\"\">All</option>\n                {searchWorkGroupsList && searchWorkGroupsList.map((e, i) => {\n                    return (<option key={e.workGroup + \"-\" + i} value={e.workGroup}>{e.workGroupTitle}</option>)\n                  })\n                }\n              </Form.Control>\n          </InputGroup>\n          <InputGroup size=\"sm\" className=\"mb-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text>Expression Type</InputGroup.Text>\n            </InputGroup.Prepend>\n            <Form.Control as=\"select\" onChange={(e) => {setSearchEType(e.target.value)}} value={searchParameters.searchEType}>\n                <option value=\"\">All</option>\n                {searchExpressionTypesList && searchExpressionTypesList.map((e, i) => {\n                    return (<option key={e.expressionType + \"-\" + i} value={e.expressionType}>{e.expressionTypeTitle}</option>)\n                  })\n                }\n            </Form.Control>\n          </InputGroup>\n          <InputGroup size=\"sm\" className=\"mb-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text>Author</InputGroup.Text>\n            </InputGroup.Prepend>\n            <Form.Control as=\"select\" onChange={(e) => {setSearchAuthor(e.target.value)}} value={searchParameters.searchAuthor}>\n              <option value=\"\">All</option>\n              {searchAuthorsList && searchAuthorsList.map((e, i) => {\n                  return (<option key={e.author + \"-\" + i} value={e.author}>{e.authorTitle}</option>)\n                })\n              }\n            </Form.Control>\n          </InputGroup>\n          <InputGroup size=\"sm\" className=\"mb-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text>Text</InputGroup.Text>\n            </InputGroup.Prepend>\n            <Form.Control as=\"select\" onChange={(e) => {setSearchEid(e.target.value)}} value={searchParameters.searchEid}>\n              <option value=\"\">All</option>\n              {searchExpressionsList && searchExpressionsList.map((e, i) => {\n                  return (<option key={e.expression + \"-\" + i} value={e.expression}>{e.authorTitle}: {e.expressionTitle}</option>)\n                })\n              }\n            </Form.Control>\n          </InputGroup>\n        </div>\n      }\n      <InputGroup.Prepend size=\"sm\" className=\"mb-2\">\n        {props.children}\n        {props.showAdvancedParameters && <Button className=\"btn-sm\" onClick={() => {setDisplayAllParameters(!displayAllParameters)}}>{displayAllParameters ? \"Hide\" : \"Show\"} More Filter Options</Button>}        \n      </InputGroup.Prepend>\n      \n      \n    </div>\n  )\n}\n\nexport {Search3Parameters as default}\n","import Axios from 'axios'\nimport {sparqlEndpoint} from '../components/config';\n\nexport var startExpressionTypesListFetch = () => {\n  return{\n    type: \"START_EXPRESSION_TYPES_LIST_FETCH\"\n  };\n};\nexport var completeExpressionTypesListFetch = (expressionTypes) => {\n  return{\n    type: \"COMPLETE_EXPRESSION_TYPES_LIST_FETCH\",\n    expressionTypes\n  };\n};\nexport var fetchExpressionTypesList = (searchParameters, dispatch) =>{\n  //TODO: delete this or uncomment if authorQuery should be included in expressionTypeList Fetch\n  // let authorQuery = \"\";\n  //   if (searchParameters.searchAuthor){\n  //     authorQuery = [\n  //     \"?workGroup <http://scta.info/property/hasExpression> ?expression .\",\n  //     \"?expression <http://www.loc.gov/loc.terms/relators/AUT> <\" + searchParameters.searchAuthor + \"> .\"\n  //     ].join('');\n  //   }\n\n    var query = [\n        \"SELECT DISTINCT ?expressionType ?expressionTypeTitle \",\n        \"WHERE { \",\n        \"?expressionType a <http://scta.info/resource/expressionType> .\",\n        \"?expressionType <http://purl.org/dc/elements/1.1/title> ?expressionTypeTitle .\",\n        \"}\",\n        \"ORDER BY ?expressionTypeTitle\"].join(' ');\n  dispatch(startExpressionTypesListFetch());\n  Axios.get(sparqlEndpoint, {params: {\"query\" : query, \"output\": \"json\"}}).then(function(res){\n    const results = res.data.results.bindings;\n    const expressionTypes = results.map((result) => {\n        return {\n          expressionType: result.expressionType.value,\n          expressionTypeTitle: result.expressionTypeTitle.value,\n        }\n      });\n      dispatch(completeExpressionTypesListFetch(expressionTypes));\n    });\n  };\n","import React from 'react';\nimport {Link} from 'react-router-dom';\nimport Axios from 'axios'\n\n\n//TODO: these retrieves need to be refactored into; \n// if exist db api is improved then a single request should be easier\n\n// // TODO; the following should be deleted; now that new search script has been made\n// export function retrieveExpressionResults(searchTerm, searchEid){\n//   const expressionShortId = searchEid === \"all\" ? searchEid : searchEid.split(\"/resource/\")[1]\n//   const url = \"https://exist.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-expressionid.xq?query=\" + searchTerm + \"&expressionid=\" + expressionShortId\n//   const queryPromise = Axios.get(url)\n//   return queryPromise\n// }\n// // TODO; the following should be deleted; now that new search script has been made\n// export function retrieveAuthorResults(searchTerm, searchAuthor){\n//   const authorShortId = searchAuthor.split(\"/resource/\")[1]\n//   const url = \"https://exist.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-authorid.xq?query=\" + searchTerm + \"&authorid=\" + authorShortId\n//   const queryPromise = Axios.get(url)\n//   return queryPromise\n\n// }\n// // TODO; the following should be deleted; now that new search script has been made\n// export function retrieveWorkGroupResults(searchTerm, searchWorkGroup){\n//   const workGroupShortId = searchWorkGroup.split(\"/resource/\")[1]\n//   const url = \"https://exist.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-workGroupId.xq?query=\" + searchTerm + \"&workGroupId=\" + workGroupShortId\n//   const queryPromise = Axios.get(url)\n//   return queryPromise\n\n// }\nexport function retrieveFigureResults(searchTerm, searchEid){\n  const expressionShortId = searchEid === \"all\" ? searchEid : searchEid.split(\"/resource/\")[1]\n  const url = \"https://exist2.scta.info/exist/apps/scta-app/jsonsearch/json-search-text-by-figure.xq?query=\" + searchTerm + \"&expressionid=\" + expressionShortId\n  const queryPromise = Axios.get(url)\n  return queryPromise\n}\n\nexport function retrieveSearchResults(searchTerm, searchEid, searchWorkGroup, searchAuthor, searchETypeId, searchType, offset){\n  const workGroupShortId = searchWorkGroup && searchWorkGroup.split(\"/resource/\")[1]\n  const expressionShortId = searchEid && searchEid.split(\"/resource/\")[1]\n  const expressionTypeShortId = searchETypeId && searchETypeId.split(\"/resource/\")[1]\n  const authorShortId = searchAuthor && searchAuthor.split(\"/resource/\")[1]\n  const queryParameters = []\n  if (expressionShortId){\n    queryParameters.push(\"eid=\" + expressionShortId)\n  }\n  if (expressionTypeShortId){\n    queryParameters.push(\"etid=\" + expressionTypeShortId)\n  }\n  if (authorShortId){\n    queryParameters.push(\"aid=\" + authorShortId)\n  }\n  if (workGroupShortId){\n    queryParameters.push(\"wgid=\" + workGroupShortId)\n  }\n  if (searchType){\n    queryParameters.push(\"searchType=\" + searchType)\n  }\n  if (offset){\n    queryParameters.push(\"offset=\" + offset)\n  }\n  const queryString = \"?query=\" + searchTerm + \"&\" + queryParameters.join(\"&\");\n  const url = \"https://exist2.scta.info/exist/apps/scta-app/jsonsearch/json-search-text.xq\" + queryString\n  const queryPromise = Axios.get(url)\n  return queryPromise\n}\n\nexport function displayFigureResults(results, idTitleMap){\n    if (!results || results.length === 0){\n      return (<div>\n        <p>No results found</p>\n      </div>)\n    }\n    else if (results.length > 0){\n      console.log(\"results\", results)\n      const figureResults = results.map((r, i) => {\n        const imgurl = r.imgurl\n        const longTitle = idTitleMap[\"http://scta.info/resource/\" + r.pid] ?  idTitleMap[\"http://scta.info/resource/\" + r.pid].longTitle : \"\"\n          //const author = idTitleMap[\"http://scta.info/resource/\" + r.pid] ?  idTitleMap[\"http://scta.info/resource/\" + r.pid].author : \"\"\n          const authorTitle = idTitleMap[\"http://scta.info/resource/\" + r.pid] ?  idTitleMap[\"http://scta.info/resource/\" + r.pid].authorTitle : \"\"\n        return (\n          <div key={i} className=\"figure-tile\">\n          {/* <Link to={\"/text?resourceid=http://scta.info/resource/\" + r.pid}><img src={imgurl} alt=\"figure\"></img></Link> */}\n          <Link to={\"/text?resourceid=http://scta.info/resource/\" + r.pid}>\n            <span className=\"image-description\">{authorTitle + \", \" + longTitle + \" (\" + r.pid + \")\"}</span>\n            <img src={imgurl} alt=\"figure\"></img>\n          </Link>\n          \n          </div>\n        )\n      })\n      return (\n        <div className=\"figure-grid\">\n            {/* <p>{results.length + \" results\"}</p> */}\n            {figureResults}\n        </div>\n      )\n    }\n    // TODO: i think this can be deleted\n    // else if (results){\n    //   const r = results\n    //   const imgurl = r.imgurl\n    //   return (\n    //     <div>\n    //       <p>{1 + \" results\"}</p>\n    //       <div key={results.pid}>\n    //         <p><Link to={\"/text?resourceid=http://scta.info/resource/\" + r.pid}>{r.pid}</Link></p>\n    //         <img src={imgurl} alt=\"figure\" style={{\"width\": \"300px\"}}></img>\n    //       </div>\n    //     </div>\n    //     )\n    //   }\n    else {\n      return (\n        <div><p>No results</p></div>\n      )\n    }\n  }  \n\n\nexport function displayTextResults(results, idTitleMap){\n  if (!results || results.length === 0){\n    return (<div>\n      <p>No results found</p>\n    </div>)\n  }\n  else {\n      if (results.length > 0){\n        const textResults = results.map((r, i) => {\n          const textString = r.previous + \" <span class='highlight'>\" + r.hit + \"</span> \" + r.next\n          const range = r.start + \"-\" + r.end\n          const longTitle = idTitleMap[\"http://scta.info/resource/\" + r.pid] ?  idTitleMap[\"http://scta.info/resource/\" + r.pid].longTitle : \"\"\n          //const author = idTitleMap[\"http://scta.info/resource/\" + r.pid] ?  idTitleMap[\"http://scta.info/resource/\" + r.pid].author : \"\"\n          const authorTitle = idTitleMap[\"http://scta.info/resource/\" + r.pid] ?  idTitleMap[\"http://scta.info/resource/\" + r.pid].authorTitle : \"\"\n          return (\n            <div key={i}>\n            {/* <p><Link to={\"/text?resourceid=http://scta.info/resource/\" + r.pid + \"@\" + range}>{r.pid + \"@\" + range}</Link></p> */}\n            <p><Link to={\"/text?resourceid=http://scta.info/resource/\" + r.pid + \"@\" + range}>{authorTitle + \", \" + longTitle + \" (\" + r.pid + \"@\" + range + \")\"}</Link></p>\n            <p dangerouslySetInnerHTML={{ __html: textString}}/>\n            </div>\n          )\n          \n        })\n        return (\n          <div>\n              {textResults}\n          </div>\n        )\n      }\n      // don't think this is necessary now that I've forced all results to be an array \n      // else if (results){\n      //   const r = results\n      //   const textString = r.previous + \" <span class='highlight'>\" + r.hit + \"</span> \" + r.next\n      //   const range = r.start + \"-\" + r.end\n      //   return (\n      //     <div>\n      //       <p>{1 + \" results\"}</p>\n      //     <div key={results.pid}>\n      //     <p><Link to={\"/text?resourceid=http://scta.info/resource/\" + r.pid + \"@\" + range}>{r.pid + \"@\" + range}</Link></p>\n      //     <p dangerouslySetInnerHTML={{ __html: textString}}/>\n      //     </div>\n      //     </div>\n      //   )\n      // }\n      else{\n        return (\n          <div><p>No results</p></div>\n        )\n      }\n  }\n}\n\nexport function displayQuestionResults(results, searchParameters){\n  if (results.length > 0){\n    const displayResults = results.map((r, i) => {\n      return (\n      <div key={r.resource.value + \"-\" + i}>\n        <p><Link to={\"/text?resourceid=\" + r.author.value}>{r.authorTitle.value}</Link>: <Link to={\"/text?resourceid=\" + r.resource.value}>{r.longTitle.value}</Link></p>\n        <p>{r.qtitle.value.toLowerCase().replace(searchParameters.searchTerm.toLowerCase(), searchParameters.searchTerm.toUpperCase())}</p>\n      </div>\n      )\n    })\n    return (\n      <div>\n        <p>{displayResults.length + \" results\"}</p>\n        {displayResults}\n      </div>\n    )\n  }\n  else{\n    return (\n      <div>\n        <p>No results</p>\n      </div>\n    )\n\n  }\n}\n\nexport const getValueLongTitlesAndAuthors = (results) => {\n  let values = []\n  if (results){\n    //if (results.length > 0){\n      values = results.map((r) => {\n        return \"<http://scta.info/resource/\" + r.pid + \">\"\n      })\n    //}\n    // else {\n    //   values = [\"<http://scta.info/resource/\" + results.pid + \">\"]\n    // }\n    const valuesString = values.join(\" \")\n\n    const query = [\n      \"SELECT DISTINCT ?id ?longTitle ?author ?authorTitle \",\n        \"{\",\n        \"VALUES ?id {\" + valuesString + \"}\",\n        \"?id <http://scta.info/property/longTitle> ?longTitle .\",\n        \"OPTIONAL {\",\n          \"?id <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\",\n          \"?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n          \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n        \"}\",\n      \"}\"].join('')\n    return query\n  }\n}\n\nexport const createIdTitleMap = (bindings) => {\n  const idTitleMap = {}\n  bindings.forEach((b) => {\n    idTitleMap[b.id.value] = {\n      longTitle: b.longTitle.value, \n      author: b.author && b.author.value, \n      authorTitle: b.authorTitle && b.authorTitle.value}\n  })\n  return idTitleMap\n}\n","import React, {useEffect, useState} from 'react';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport {runQuery} from './utils'\nimport {questionTitleQuery} from '../queries/questionTitleQuery'\nimport Spinner from './Spinner';\nimport Container from 'react-bootstrap/Container';\nimport Search3Parameters from './Search3Parameters';\nimport {retrieveSearchResults, displayTextResults, displayFigureResults, displayQuestionResults, createIdTitleMap, getValueLongTitlesAndAuthors} from './searchUtils'\n\nconst Search3 = (props) => {\n  const [searchParameters, setSearchParameters] = useState({})\n  const [results, setResults] = useState([])\n  const [questionResults, setQuestionResults] = useState([])\n  const [idTitleMap, setIdTitleMap] = useState()\n  const [offset, setOffset] = useState(1)\n  const [showMore, setShowMore] = useState(true)\n  \n  // TODO: check this; i don't think it is doing anything\n  useEffect(() => {\n    if (searchParameters.searchType === \"questionTitles\"){\n      displayQuestionResults(filterQuestionResults(questionResults, searchParameters.resultsFilter), searchParameters)\n    }\n    if (searchParameters.searchType === \"figure\"){\n      displayQuestionResults(filterQuestionResults(results, searchParameters.resultsFilter), searchParameters.resultsFilter, )\n    }\n    else if (searchParameters.searchType === \"text\"){\n        displayTextResults(filterResults(results, searchParameters.resultsFilter), idTitleMap)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParameters.resultsFilter])\n  // TODO check above; might be deletable \n\n  useEffect(() => {\n    if (results !== \"fetching\"){\n      const idTitleArray = runQuery(getValueLongTitlesAndAuthors(results))\n      idTitleArray.then((d) => {\n        setIdTitleMap(createIdTitleMap(d.data.results.bindings))\n      })\n    }\n  }, [results])\n  \n  useEffect(() => {\n    setResults([])\n  }, [searchParameters.searchType])\n\n  useEffect(() => {\n    if (searchParameters.searchEid || searchParameters.searchAuthor || searchParameters.searchWorkGroup || searchParameters.searchEType){\n      const textResults = retrieveSearchResults(searchParameters.searchTerm, \n        searchParameters.searchEid, \n        searchParameters.searchWorkGroup, \n        searchParameters.searchAuthor, \n        searchParameters.searchEType,\n        searchParameters.searchType,\n        offset)\n        setResults(\"fetching\")\n        textResults.then((d) => {\n          if (d.data.results){\n            if (Array.isArray(d.data.results)){\n              setResults(d.data.results)     \n              const showMore = d.data.results[0].moreResults === \"true\" ? true : false\n              setShowMore(showMore)\n            }\n            else{\n              console.log(\"results when null\", results)\n              setResults([d.data.results])     \n              const showMore = d.data.results[0].moreResults === \"true\" ? true : false\n              setShowMore(showMore)\n            } \n          }\n          else{\n            setResults([])\n          }\n      })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [offset])\n  \n  const handleSetSearchParameters = (parameters) => {\n    setSearchParameters(parameters)\n  }\n\n  const handleRunSearch = (e) => {\n    e.preventDefault()\n    setShowMore(true)\n    setOffset(1)\n    if (!searchParameters.searchTerm){\n      setResults([])\n    }\n    else{\n      if (searchParameters.searchType === \"text\" || searchParameters.searchType === \"figure\"){\n        setResults(\"fetching\")\n        setQuestionResults([])\n        if (searchParameters.searchEid || searchParameters.searchAuthor || searchParameters.searchWorkGroup || searchParameters.searchEType){\n            const textResults = retrieveSearchResults(searchParameters.searchTerm, \n              searchParameters.searchEid, \n              searchParameters.searchWorkGroup, \n              searchParameters.searchAuthor, \n              searchParameters.searchEType,\n              searchParameters.searchType,\n              offset)\n            textResults.then((d) => {\n              if (d.data.results){\n                if (Array.isArray(d.data.results)){\n                  setResults(d.data.results)     \n                  const showMore = d.data.results[0].moreResults === \"true\" ? true : false\n                  setShowMore(showMore)\n                }\n                else{\n                  setResults([d.data.results])     \n                  const showMore = d.data.results.moreResults === \"true\" ? true : false\n                  setShowMore(showMore)\n                }         \n              }\n              else{\n                setResults([])\n              }\n          })\n        }\n      }\n      else if (searchParameters.searchType === \"questionTitles\"){\n        const questionResults = runQuery(questionTitleQuery(searchParameters))\n        setQuestionResults(\"fetching\")\n        setResults([])\n        questionResults.then((d) => {\n          setQuestionResults(d.data.results.bindings)\n        })\n      }\n    }\n  }\n  const displayResults = (results) => {\n    if (results === \"fetching\" || questionResults === \"fetching\"){ \n      return <Spinner/>\n    }\n    else if (searchParameters.searchType === \"questionTitles\"){\n      return displayQuestionResults(filterQuestionResults(questionResults, searchParameters.resultsFilter), searchParameters)\n    }\n    else if (searchParameters.searchType === \"figure\"){\n      return displayFigureResults(results, idTitleMap);\n    }\n    else if (searchParameters.searchType === \"text\"){\n        return displayTextResults(filterResults(results, searchParameters.resultsFilter), idTitleMap)\n    }\n  }\n  const filterResults = (results, resultsFilter) => {\n    let newResults = [] \n    if (!results || results.length === 0){\n      newResults = [] \n    }\n    else if (results.length > 0){\n      results.forEach((r) => {\n        if (r.previous && r.hit && r.next){\n          const combinedString = [ r.previous.toLowerCase(), r.hit.toLowerCase(), r.next.toLowerCase()].join(\" \")\n          if (combinedString.includes(resultsFilter.toLowerCase())){\n            newResults.push(r)\n          }\n        }\n      })\n    }\n    else if (results){\n      const r = results;\n      if (r.previous && r.hit && r.next){\n        const combinedString = [r.previous.toLowerCase(), r.hit.toLowerCase(), r.next.toLowerCase()].join(\" \")\n        newResults = combinedString.includes(resultsFilter.toLowerCase()) ? results : \"\";\n      }\n    }\n    return newResults\n  }\n  // similar filter to above; but modified to handle question title data structure\n  const filterQuestionResults = (results, resultsFilter) => {\n    let newResults = [] \n    if (!results || results.length === 0){\n      newResults = [] \n    }\n    else if (results.length > 0){\n      results.forEach((r) => {\n        if (r.qtitle && r.qtitle.value.toLowerCase().includes(resultsFilter.toLowerCase())){\n          newResults.push(r)\n        }\n      })\n    }\n    return newResults\n  }\n  return(\n    <Container className={props.hidden ? \"hidden\" : \"showing\"}>\n      <Form onSubmit={handleRunSearch}>\n        <Search3Parameters\n          handleSetSearchParameters={handleSetSearchParameters}\n          searchAuthor={props.searchAuthor}\n          searchEid={props.searchEid}\n          searchEType={props.searchEType}\n          searchWorkGroup={props.searchWorkGroup}\n          showAdvancedParameters={props.showAdvancedParameters}\n          showLabels={props.showLabels}\n          searchType={props.searchType}\n          searchTerm={props.searchTerm}\n          >\n            {props.showSubmit && <Button onClick={handleRunSearch} className=\"btn-sm\" style={{marginRight: \"5px\"}}>Submit</Button>}\n            </Search3Parameters>\n          \n      \n    </Form>\n    {results && results.length > 0 && <p>{(offset !==1) && <span onClick={(() => {setOffset(offset - 20)})}>Show Previous</span>} \n    <span> | </span>\n    {/* <span>{\"page \" + offset + \" (results\" + results.length + \")\"}</span> */}\n    {(showMore === true) && <span onClick={(() => {setOffset(offset + 20)})}>Show More</span>}</p>}\n    {displayResults(results)}\n    \n    </Container>\n\n  )\n}\n\nSearch3.defaultProps = {\n  showLabels: true,\n  showAdvancedParameters: true,\n  searchAuthor: \"\",\n  searchEid: \"\",\n  showSubmit: true\n};\n\nexport {Search3 as default}\n","export function questionTitleQuery(searchParameters){\n  const searchTerm = searchParameters.searchTerm\n  let workGroupQuery = \"\";\n    if (searchParameters.searchWorkGroup){\n      workGroupQuery = [\n        \"BIND(<\" + searchParameters.searchWorkGroup + \"> AS ?workGroup) .\",\n        \"?workGroup <http://scta.info/property/hasExpression> ?topLevel .\"\n      ].join(' ')\n    }\n  let expressionTypeQuery = \"\";\n    if (searchParameters.searchEType){\n      expressionTypeQuery = [\n        \"BIND(<\" + searchParameters.searchEType + \"> AS ?expressionType) .\",\n        \"{\",\n          \"?resource <http://scta.info/property/expressionType> ?expressionType .\",\n        \"}\",\n        \"UNION\",\n        \"{\",\n          \"?resource <http://scta.info/property/isMemberOf> ?ancestor .\",\n          \"?ancestor <http://scta.info/property/expressionType> ?expressionType .\",\n        \"}\"].join(' ')\n    }\n  let authorQuery = \"\";\n    if (searchParameters.searchAuthor){\n      authorQuery = \"BIND(<\" + searchParameters.searchAuthor + \"> AS ?author).\"\n    }\n  let eidQuery = \"\";\n    if (searchParameters.searchEid){\n      eidQuery = \"BIND(<\" + searchParameters.searchEid + \"> AS ?topLevel).\"\n    }\n   const query = [\n     \"SELECT ?resource ?qtitle ?resourceTitle ?structureType ?longTitle ?author ?authorTitle\",\n     \"WHERE\",\n     \"{\",\n\n       \"?resource <http://scta.info/property/questionTitle> ?qtitle  .\",\n       \"?resource <http://purl.org/dc/elements/1.1/title> ?resourceTitle .\",\n       \"?resource <http://scta.info/property/structureType> ?structureType .\",\n       \"?resource <http://scta.info/property/longTitle> ?longTitle .\",\n       expressionTypeQuery,\n       eidQuery,\n       \"?resource <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\",\n       authorQuery,\n       \"?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n       \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n       workGroupQuery,\n       \"FILTER (REGEX(STR(?qtitle), '\" + searchTerm + \"', 'i')) .\",\n     \"}\"\n   ].join(' ');\n   return query\n }\n","//Vendor Imports\nimport React from 'react';\nimport Axios from 'axios'\nimport PropTypes from 'prop-types';\n\nclass Print extends React.Component {\n  constructor(props){\n    super(props)\n    this.getPdf = this.getPdf.bind(this)\n    this.state = {\n      status: \"\",\n      pdf: \"\",\n    }\n  }\n  getPdf(url){\n    const printApiUrlBase = \"https://print.lombardpress.org\"\n    //const printApiUrlBase = \"localhost:5000\"\n    Axios.get(printApiUrlBase + \"/api/v1/resource?url=\" + url)\n      .then((data) => {\n        console.log(data)\n        if (data.data.url){\n          console.log(\"first condition passed\", data.data.url)\n          const hashWithExtension = data.data.url\n          //window.location = \"http://print.lombardpress.org/api/v1/cache/\" + hashWithExtension\n          this.setState({pdf: printApiUrlBase + \"/api/v1/cache/\" + hashWithExtension})\n        }\n        else{\n          this.setState({status: data.data.Status + \"Please check back in a few minutes\", pdf: \"\"})\n        }\n      })\n\n  }\n  componentDidMount(){\n    const url = this.props.url\n    this.getPdf(url)\n  }\n  \n  componentDidUpdate(prevProps){\n    const newUrl = this.props.url\n    const oldUrl = prevProps.url\n    if (newUrl !== oldUrl){\n      this.getPdf(newUrl)\n    }\n  }\n  render(){\n\n    return (\n      <div style={{\"width\": \"100%\", \"height\": \"77vh\", \"margin\": \"auto\"}}>\n      {this.state.pdf ?\n        <object data={this.state.pdf} type=\"application/pdf\" width=\"100%\" height=\"100%\">\n            alt : <a href={this.state.pdf}>{this.state.pdf}</a>\n        </object>\n        :\n        <p>{this.state.status}</p>\n        }\n    </div>\n    );\n  }\n}\n\nPrint.propTypes = {\n  /**\n  * url to raw xml source file\n  */\n url: PropTypes.string.isRequired,\n}\n\nexport default Print;\n","//note; each query here represents an attempt an efficient single request for related information\n//each query therefore could be tranformed into a restful api\n\n//NOTE: this query does not work as expected when using Fuseking version 3 it only works as expected using version 2.0\n// with version 3, it seems to get all quotes from the entire corpus, suggested something may not be working with the \"bind\" method\n export function getRelatedExpressions(itemExpressionUri, offset, pagesize, rangeStart, rangeEnd){\n\n   let rangeFilter;\n   if (rangeStart && rangeEnd){\n    rangeFilter = [\"FILTER (?isRelatedToRangeEnd <=\" + rangeEnd + \")\",\n                  \"FILTER (?isRelatedToRangeStart >=\" + rangeStart + \")\"].join(\" \")\n   }\n   let activeSource; \n   if (!rangeStart && !rangeEnd){\n    activeSource = [ \n      \"{\",\n        \"?element <http://scta.info/property/source> ?isRelatedTo .\",\n        \"FILTER (!isBlank(?isRelatedTo)) .\",\n      \"}\",\n      \"UNION\",\n      \"{\",\n      \"?element <http://scta.info/property/source> ?bn .\",\n      \"?bn <http://scta.info/property/source> ?isRelatedTo .\",\n      \"?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .\",\n      \"?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .\",\n      \"}\"].join(\" \")\n    }\n    else{\n      activeSource = [\"?element <http://scta.info/property/source> ?bn .\",\n      \"?bn <http://scta.info/property/source> ?isRelatedTo .\",\n      \"?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .\",\n      \"?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .\",\n      rangeFilter].join(\" \")\n    }\n   \n    let inverseSource;\n   if (!rangeStart && !rangeEnd){\n    inverseSource = [\"{\",\n            \"?isRelatedTo <http://scta.info/property/source> ?element .\",\n          \"}\",\n            \"UNION\",\n          \"{\",\n            \"?isRelatedTo <http://scta.info/property/source> ?bn .\",\n            \"?bn <http://scta.info/property/source> ?element .\",\n            \"?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .\",\n            \"?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .\",\n          \"}\"].join(\" \")\n   }\n   else{\n    inverseSource = [\"?isRelatedTo <http://scta.info/property/source> ?bn .\",\n    \"?bn <http://scta.info/property/source> ?element .\",\n    \"?bn <http://scta.info/property/canonicalRangeStart> ?isRelatedToRangeStart .\",\n    \"?bn <http://scta.info/property/canonicalRangeEnd> ?isRelatedToRangeEnd .\",\n    rangeFilter].join(\" \")\n   }\n  //OLD QUERY THAT STOPPED WORKING As part of update to fuseki 4.3\n  //  const query = [\n  //   \"SELECT DISTINCT ?isRelatedTo ?label ?element ?longTitle ?author ?authorTitle ?isRelatedToRangeStart ?isRelatedToRangeEnd \",\n  //   \"WHERE\",\n  //   \"{ \",\n  //   \"BIND (<\" + itemExpressionUri + \"> as ?resource)\",\n  //     \"{\",\n  //       \"?resource ?o ?isRelatedTo .\",\n  //       \"?o a <http://scta.info/resource/textRelation> .\",\n  //       \"FILTER (?o != <http://scta.info/property/quotes>)\",\n  //       \"FILTER (?o != <http://scta.info/property/quotedBy>)\", \n  //       \"FILTER (?o != <http://scta.info/property/references>)\", \n  //       \"FILTER (?o != <http://scta.info/property/referencedBy>)\", \n  //       \"?o <http://www.w3.org/1999/02/22-rdf-syntax-ns#label> ?label . \",\n  //       \"?isRelatedTo a <http://scta.info/resource/expression> .\",\n  //     \"}\",\n  //     \"UNION\",\n  //     \"{\",\n  //       \"{\",\n  //         \"?resource <http://scta.info/property/structureType> <http://scta.info/resource/structureElement> .\",\n  //         \"BIND (?resource as ?element)\",\n  //       \"}\",\n  //       \"UNION\",\n  //       \"{\",\n  //         \"?element <http://scta.info/property/isMemberOf> ?resource .\",\n  //       \"}\",\n  //       \"{\",\n  //           activeSource,\n  //           \"?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> .\",\n  //           \"BIND ('quotes' as ?label) .\",\n  //         \"}\",\n  //       \"UNION\",\n  //       \"{\",\n  //         activeSource,\n  //         \"?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> .\",\n  //         \"BIND ('refs' as ?label) .\",\n  //       \"}\",\n  //     \"}\",\n  //     \"UNION\", \n  //     \"{\",\n  //       \"{\",\n  //         \"BIND (?resource as ?element)\",\n  //       \"}\",\n  //       \"UNION\",\n  //       \"{\",\n  //         \"?element <http://scta.info/property/isMemberOf> ?resource .\",\n  //       \"}\",\n  //       \"{\",\n  //         inverseSource,\n  //         \"?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> .\",\n  //         \"BIND ('isQuotedBy' as ?label) .\",\n  //       \"}\",\n  //       \"UNION\",\n  //       \"{\",\n  //         inverseSource,\n  //         //\"?isRelatedTo <http://scta.info/property/source> ?element.\",\n  //         \"?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> .\",\n  //         \"BIND ('isReferencedBy' as ?label) .\",\n  //       \"}\",\n  //     \"}\",\n  //     \"?isRelatedTo <http://scta.info/property/longTitle> ?longTitle .\",\n  //     \"?isRelatedTo <http://scta.info/property/isMemberOf> ?mem .\",\n  //     \"?mem <http://scta.info/property/level> '1' .\",\n  //     \"OPTIONAL\",\n  //     \"{\",\n  //       \"?mem <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n  //       \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle\",\n  //     \"}\",\n  //   \"}\",\n  //   \"ORDER BY ?authorTitle\",\n  //   \"LIMIT \" + pagesize,\n  //   \"OFFSET \" + offset\n  //  ].join(' ');\n\n  const query = [\n  \"SELECT DISTINCT ?isRelatedTo ?label ?element ?longTitle ?author ?authorTitle ?isRelatedToRangeStart ?isRelatedToRangeEnd ?parentBlock \",\n  \"WHERE\",\n  \"{ \",\n    \"BIND (<\" + itemExpressionUri  + \"> AS ?resource) .\",\n    \"{\",\n      \"<\" + itemExpressionUri  + \"> ?o ?isRelatedTo . \",\n      \"?o a <http://scta.info/resource/textRelation> . \", \n      \"FILTER (?o != <http://scta.info/property/quotes>) . \",\n      \"FILTER (?o != <http://scta.info/property/quotedBy>) . \",\n      \"FILTER (?o != <http://scta.info/property/references>).\",\n      \"FILTER (?o != <http://scta.info/property/referencedBy>).\", \n      \"?o <http://www.w3.org/1999/02/22-rdf-syntax-ns#label> ?label . \",\n      \"?isRelatedTo a <http://scta.info/resource/expression> . \",\n      \"}\", \n      \"UNION\", \n    \"{\",\n      \"{\",\n      \"<\" + itemExpressionUri  + \"> <http://scta.info/property/structureType> <http://scta.info/resource/structureElement> . \",\n        \"BIND (<\" + itemExpressionUri  + \"> as ?element) .\",\n      \"} \",\n      \"UNION\", \n      \"{\",\n        \"?element <http://scta.info/property/isMemberOf> <\" + itemExpressionUri  + \">  . \",\n      \"}\",\n      \"{ \",\n          activeSource,\n          \"{\",\n            \"?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> . \",\n            \"BIND ('quotes' as ?label) . \",\n          \"}\",\n          \"UNION\",\n          \"{\",\n            \"?element <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> . \",\n            \"BIND ('refs' as ?label) . \",\n          \"}\",\n        \"} \",\n    \"} \",\n    \"UNION\",\n    \"{ \",\n    \"{ \",\n      \"BIND (<\" + itemExpressionUri  + \">  as ?element) .\",\n      \"} \",\n      \"UNION \",\n      \"{ \",\n      \"?element <http://scta.info/property/isMemberOf> <\" + itemExpressionUri  + \">  . \",\n      \"}\",\n      inverseSource,\n      \"{\",\n      \" ?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementQuote> . \",\n      \" BIND ('isQuotedBy' as ?label) . \",\n      \"} \",\n      \"UNION\", \n      \"{ \",\n        \"?isRelatedTo <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementRef> . \",\n        \"BIND ('isReferencedBy' as ?label) . \",\n      \"}\",\n      \"OPTIONAL\",\n      \"{\",\n        \"?isRelatedTo <http://scta.info/property/isPartOfStructureBlock> ?parentBlock .\",\n        //\"?isRelatedTo <http://scta.info/property/isMemberOf> ?parentBlock .\",\n        //\"?parentBlock <http://scta.info/property/structureType> <http://scta.info/resource/stuctureBlock> .\",\n      \"}\",\n    \"}\",\n    \"?isRelatedTo <http://scta.info/property/longTitle> ?longTitle . \",\n    \"?isRelatedTo <http://scta.info/property/isMemberOf> ?mem . \",\n    \"?mem <http://scta.info/property/level> '1' . \",\n    \"OPTIONAL \",\n    \"{ \",\n      \"?mem <http://www.loc.gov/loc.terms/relators/AUT> ?author . \",\n      \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n    \"} \",\n  \"} \",\n  \"ORDER BY ?authorTitle\",\n  \"LIMIT \" + pagesize,\n  \"OFFSET \" + offset\n].join(' ');\n     return query\n }\n//get Related Expressions\n// export function getRelatedExpressions(itemExpressionUri){\n//   const query = [\n//     \"SELECT DISTINCT ?isRelatedTo \",\n//     \"WHERE { \",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/isRelatedTo> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/quotes> ?quote .\",\n//     \"?quote a <http://scta.info/resource/quotation> .\",\n//     \"?quote <http://scta.info/property/source> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/quotes> ?quote .\",\n//     \"?quote a <http://scta.info/resource/expression> .\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/quotes> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/quotedBy> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/abbreviates> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/abbreviatedBy> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/references> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/referencedBy> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/copies> ?isRelatedTo .\",\n//     \"}\",\n//     \"UNION\",\n//     \"{\",\n//     \"<\" + itemExpressionUri + \"> <http://scta.info/property/isCopiedBy> ?isRelatedTo .\",\n//     \"}\",\n//     \"}\"\n//   ].join('');\n//\n//     return query\n// }\n\n// query info block, division, or item (possible also collection)\nexport function basicInfoQuery(itemExpressionUri){\n  const query = [\n    \"SELECT DISTINCT ?title ?structureType ?cmanifestation ?cmanifestationTitle ?manifestation ?manifestationTitle ?ctranscription ?manifestationCTranscription ?manifestationCTranscriptionDoc ?cdoc ?cxml ?expressionShortId ?longTitle ?topLevelExpression ?next ?previous ?inbox ?author ?authorTitle ?parent \",\n    \"WHERE { \",\n    \"<\" + itemExpressionUri + \"> <http://purl.org/dc/elements/1.1/title> ?title .\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/structureType> ?structureType .\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation .\",\n    \"?cmanifestation <http://purl.org/dc/elements/1.1/title> ?cmanifestationTitle .\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/hasManifestation> ?manifestation .\",\n    \"?manifestation <http://purl.org/dc/elements/1.1/title> ?manifestationTitle .\",\n    \"OPTIONAL {\",\n    \"?manifestation <http://scta.info/property/hasCanonicalTranscription> ?manifestationCTranscription .\",\n    \"?manifestationCTranscription <http://scta.info/property/hasDocument> ?manifestationCTranscriptionDoc .\",\n    \"?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .\",\n    \"?ctranscription <http://scta.info/property/hasDocument> ?cdoc . \",\n    \"?ctranscription <http://scta.info/property/hasXML> ?cxml . \",\n    \"}\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/shortId> ?expressionShortId .\",\n    \"{\",\n      \"<\" + itemExpressionUri + \"> <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .\",\n    \"}\",\n    \"UNION\",\n    \"{\",\n      \"<\" + itemExpressionUri + \"> <http://scta.info/property/level> '1' .\",\n      \"BIND(<\" + itemExpressionUri + \"> AS ?topLevelExpression) .\", \n    \"}\",\n    \"OPTIONAL {\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/longTitle> ?longTitle .\",\n    \"}\",\n    \"OPTIONAL {\",\n    \"?topLevelExpression <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n    \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n    \"}\",\n    \"OPTIONAL {\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/next> ?next .\",\n    \"}\",\n    \"OPTIONAL {\",\n    \"<\" + itemExpressionUri + \"> <http://scta.info/property/previous> ?previous .\",\n    \"}\",\n    \"OPTIONAL {\",\n    \"<\" + itemExpressionUri + \"> <http://purl.org/dc/terms/isPartOf> ?parent .\",\n    \"}\",\n    \"<\" + itemExpressionUri + \"> <http://www.w3.org/ns/ldp#inbox> ?inbox . \",\n    \"}\",\n    \"ORDER BY ?title\"].join('');\n\n    return query\n  }\n\n  export function itemTranscriptionInfoQuery(itemTranscriptionUri){\n    const query = [\n      \"SELECT DISTINCT ?title ?manifestation ?doc ?xml ?expression ?expressionShortId ?longTitle ?topLevelExpression ?next ?previous ?inbox ?t \",\n      \"WHERE { \",\n      \"BIND(<\" + itemTranscriptionUri + \"> as ?t) . \",\n      \"?t <http://purl.org/dc/elements/1.1/title> ?title .\",\n      \"?t <http://scta.info/property/isTranscriptionOf> ?manifestation .\",\n      \"?t <http://scta.info/property/hasDocument> ?doc . \",\n      \"?t <http://scta.info/property/hasXML> ?xml . \",\n      \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n      \"?expression <http://purl.org/dc/elements/1.1/title> ?expressionTitle .\",\n      \"?expression <http://scta.info/property/shortId> ?expressionShortId .\",\n      \"?expression <http://scta.info/property/longTitle> ?longTitle .\",\n      \"?expression <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .\",\n      \"OPTIONAL {\",\n      \"?expression <http://scta.info/property/next> ?next .\",\n      \"}\",\n      \"OPTIONAL {\",\n      \"?expression <http://scta.info/property/previous> ?previous .\",\n      \"}\",\n      \"?expression <http://www.w3.org/ns/ldp#inbox> ?inbox . \",\n      \"}\",\n      \"ORDER BY ?expressionTitle\"].join('');\n\n      return query\n    }\n  // gets all structure items with basic item information\n  export function basicStructureAllItemsInfoQuery(topLevelExpressionUrl){\n    const query = [\n      \"SELECT DISTINCT ?item ?itemTitle ?topLevel ?itemQuestionTitle ?cm ?cmTitle ?ct ?next ?previous ?itemType ?doc \",\n      \"WHERE { \",\n      \"<\" + topLevelExpressionUrl + \"> <http://scta.info/property/hasStructureItem> ?item .\",\n      \"?item <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\",\n      \"?item <http://purl.org/dc/elements/1.1/title> ?itemTitle .\",\n      \"?item <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?itemType . \",\n      \"OPTIONAL {\",\n      \"?item <http://scta.info/property/questionTitle> ?itemQuestionTitle .\",\n      \"}\",\n      \"OPTIONAL\",\n      \"{\",\n      \"?item <http://scta.info/property/next> ?next .\",\n      \"}\",\n      \"OPTIONAL\",\n      \"{\",\n      \"?item <http://scta.info/property/previous> ?previous .\",\n      \"}\",\n      \"?item <http://scta.info/property/hasCanonicalManifestation> ?cm .\",\n      \"?item <http://scta.info/property/totalOrderNumber> ?totalOrderNumber .\",\n      \"?cm <http://purl.org/dc/elements/1.1/title> ?cmTitle .\",\n      \"?cm <http://scta.info/property/hasCanonicalTranscription> ?ct .\",\n      \"?ct <http://scta.info/property/hasDocument> ?doc .\",\n      \"}\",\n      \"ORDER BY ?totalOrderNumber\"].join('');\n      return query\n    }\n    // gets all parts\n    export function partsInfoQuery(resourceurl){\n      const query = [\n        \"SELECT DISTINCT ?title ?description ?part ?partTitle ?partQuestionTitle ?partType ?partLevel \",\n        \"WHERE { \",\n        \"<\" + resourceurl + \"> <http://purl.org/dc/elements/1.1/title> ?title .\",\n        \"<\" + resourceurl + \"> <http://purl.org/dc/elements/1.1/description> ?description .\",\n        \"<\" + resourceurl + \"> <http://purl.org/dc/terms/hasPart> ?part .\",\n        \"?part <http://purl.org/dc/elements/1.1/title> ?partTitle .\",\n        \"?part <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?partType . \",\n        \"OPTIONAL {\",\n        \"?part <http://scta.info/property/questionTitle> ?partQuestionTitle .\",\n        \"}\",\n        \"OPTIONAL {\",\n        \"?part <http://scta.info/property/level> ?partLevel .\",\n        \"}\",\n        \"OPTIONAL {\",\n        \"?part <http://scta.info/property/totalOrderNumber> ?totalOrderNumber .\",\n        \"}\",\n        \"}\",\n        \"ORDER BY ?totalOrderNumber\"].join('');\n        return query\n      }\n    // gets all expressions for work Group\n    export function workGroupExpressionQuery(resourceurl){\n      const query = [\n        \"SELECT DISTINCT ?item ?itemTitle ?itemAuthor ?itemAuthorTitle ?itemType \",\n        \"WHERE { \",\n        \"<\" + resourceurl + \"> <http://scta.info/property/hasExpression> ?item .\",\n        \"?item <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?itemType . \",\n        \"?item <http://purl.org/dc/elements/1.1/title> ?itemTitle .\",\n        \"?item <http://www.loc.gov/loc.terms/relators/AUT> ?itemAuthor .\",\n        \"?itemAuthor <http://purl.org/dc/elements/1.1/title> ?itemAuthorTitle .\",\n        \"}\",\n        \"ORDER BY ?itemAuthorTitle\"].join('');\n        return query\n  }\n  export function getArticleTranscriptionDoc(resourceurl){\n    const query = [\n      \"SELECT DISTINCT ?doc ?articleType \",\n      \"WHERE { \",\n        \"<\" + resourceurl + \"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . \",\n        \"<\" + resourceurl + \"> <http://scta.info/property/articleType> ?articleType .\",\n        \"?ctranscription <http://scta.info/property/hasXML> ?doc . \",\n      \"}\"].join('');\n      return query\n  }\n  export function getItemTranscriptionFromBlockDiv(resourceurl){\n    const query = [\n      \"SELECT DISTINCT ?ctranscription ?blockDivExpression \",\n      \"WHERE { \",\n        \"OPTIONAL\",\n        \"{\",\n          //\"<\" + resourceurl + \"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . \",\n          //\"<\" + resourceurl + \"> <http://scta.info/property/isMemberOf> ?itemParent . \",\n          \"{\",\n            \"<\" + resourceurl + \"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . \",\n          \"}\",\n          \"UNION\",\n          \"{\",\n            \"<\" + resourceurl + \">  <http://scta.info/property/isPartOfStructureBlock> ?blockParent .\",\n            \"?blockParent <http://scta.info/property/isPartOfStructureItem> ?itemParent . \",\n          \"}\",\n\n        \"?itemParent <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> . \",\n        \"{\",\n          \"{\",\n            \"?itemParent <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation . \",\n            \"?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . \",\n          \"}\",\n          \"UNION\",\n          \"{\",\n            \"?itemParent <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . \",\n          \"}\",\n        \"}\",\n        \"}\",\n        \"OPTIONAL\",\n        \"{\",\n          \"{\",\n            \"<\" + resourceurl + \"> <http://scta.info/property/isManifestationOf> ?blockDivExpression . \",\n          \"}\",\n          \"UNION\",\n          \"{\",\n            \"<\" + resourceurl + \"> <http://scta.info/property/isTranscriptionOf> ?blockDivManifestation . \",\n            \"?blockDivManifestation <http://scta.info/property/isManifestationOf> ?blockDivExpression . \",\n          \"}\",\n        \"}\",\n      \"}\"].join('');\n      return query\n  }\n  /**\n   * @description constructs query needed for initial textSwitch component; captures resource type information and related \n   * details needed to allow the textSwitch component decide what kind of display is necessary\n   * \n   * @param {string} resourceurl - resource url should be full scta url id\n   * @returns {string} - returns query as string\n   */\n  export function getStructureType(resourceurl){\n    const query = [\n      \"SELECT DISTINCT ?type ?structureType ?level ?topLevel ?itemParent ?resourceTitle ?author ?authorTitle ?ctranscription \",\n      \"WHERE { \",\n      \"<\" + resourceurl + \"> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?type . \",\n      \"OPTIONAL {\",\n        \"<\" + resourceurl + \"> <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n        \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n      \"}\",\n      \"OPTIONAL {\",\n        \"<\" + resourceurl + \"> <http://purl.org/dc/elements/1.1/title> ?resourceTitle .\",\n      \"}\",\n      \"OPTIONAL {\",\n      \"<\" + resourceurl + \"> <http://scta.info/property/structureType> ?structureType . \",\n      \"}\",\n      \"OPTIONAL {\",\n      \"<\" + resourceurl + \"> <http://scta.info/property/level> ?level . \",\n      \"}\",\n      \"OPTIONAL {\",\n      \"<\" + resourceurl + \"> <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel . \",\n      \"}\",\n      \"OPTIONAL {\",\n      \"<\" + resourceurl + \"> <http://scta.info/property/isPartOfTopLevelManifestation> ?topLevel . \",\n      \"}\",\n      \"OPTIONAL {\",\n      \"<\" + resourceurl + \"> <http://scta.info/property/isPartOfTopLevelTransription> ?topLevel . \",\n      \"}\",\n      \"OPTIONAL {\",\n        \"{\",\n          \"<\" + resourceurl + \"> <http://scta.info/property/isPartOfStructureItem> ?itemParent . \",\n        \"}\",\n        \"UNION\",\n        \"{\",\n          \"<\" + resourceurl + \"> <http://scta.info/property/isPartOfStructureBlock> ?blockParent . \",\n          \"?blockParent  <http://scta.info/property/isPartOfStructureItem> ?itemParent .\",\n        \"}\",\n      \"}\",\n      \"OPTIONAL {\",\n        \"{\",\n          \"<\" + resourceurl + \"> <http://scta.info/property/hasCanonicalManifestation> ?cmanifestation . \",\n          \"?cmanifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . \",\n        \"}\",\n        \"UNION\",\n        \"{\",\n          \"<\" + resourceurl + \"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription . \",\n        \"}\",\n        \"UNION\",\n        \"{\",\n          \"<\" + resourceurl + \"> a <http://scta.info/resource/transcription> . \",\n          \"BIND(<\" + resourceurl + \"> AS ?ctranscription) .\",\n        \"}\",\n      \"}\",\n    \"}\"].join('');\n      return query\n    }\n  //surface id query, gets canvas and manifestation\n  export function getSurfaceInfo(surfaceid){\n    const query = [\n      \"SELECT DISTINCT ?surfaceTitle ?isurface ?isurfaceTitle ?icodexTitle ?canvas ?imageurl ?next_surface ?previous_surface \",\n        \"{\",\n  \t\t\t\t\"<\" + surfaceid + \"> <http://purl.org/dc/elements/1.1/title> ?surfaceTitle .\",\n  \t\t\t\t\"<\" + surfaceid + \"> <http://scta.info/property/hasISurface> ?isurface .\",\n  \t\t\t\t\"OPTIONAL {\",\n  \t\t\t\t\t\"<\" + surfaceid + \"> <http://scta.info/property/next> ?next_surface .\",\n  \t\t\t\t\"}\",\n  \t\t\t\t\"OPTIONAL {\",\n  \t\t\t\t\t\"<\" + surfaceid + \"> <http://scta.info/property/previous> ?previous_surface .\",\n          \"}\",\n  \t\t\t\t\"OPTIONAL {\",\n  \t\t\t\t\t\"?isurface <http://purl.org/dc/elements/1.1/title> ?isurfaceTitle .\",\n  \t\t\t\t\t\"?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .\",\n  \t\t\t\t\t\"?icodex <http://purl.org/dc/elements/1.1/title> ?icodexTitle .\",\n  \t\t\t\t\"}\",\n  \t\t\t\t\"?isurface <http://scta.info/property/hasCanvas> ?canvas .\",\n  \t\t\t\t\"OPTIONAL{\",\n  \t\t\t\t\t\"?canvas <http://iiif.io/api/presentation/2#hasImageAnnotations> ?blank .\",\n  \t\t\t\t\"}\",\n  \t\t\t\t\"OPTIONAL{\",\n  \t\t\t\t\"?canvas <http://www.w3.org/2003/12/exif/ns#height> ?c_height .\",\n          \"}\",\n  \t\t     \"?blank <http://www.w3.org/1999/02/22-rdf-syntax-ns#first> ?o .\",\n  \t\t     \"?o <http://www.w3.org/ns/oa#hasBody> ?o2 .\",\n  \t\t    \"OPTIONAL{\",\n  \t\t\t\t\t \"?o2 <http://rdfs.org/sioc/services#has_service> ?imageurl .\",\n  \t\t\t\t \"}\",\n  \t\t\t\t \"OPTIONAL{\",\n  \t\t\t\t\t \"?o2 <http://www.shared-canvas.org/ns/hasRelatedService> ?imageurl .\",\n  \t\t\t\t \"}\",\n        \"}\"].join('');\n\n      return query\n    }\n\n//surface id query, gets canvas and manifestation\nexport function getAuthorInformation(authorid){\n    const query = [\n      \"PREFIX dc: <http://purl.org/dc/elements/1.1/>\",\n      \"PREFIX sctap: <http://scta.info/property/>\",\n      \"CONSTRUCT\",\n      \"{\",\n      \"?author dc:title ?authorTitle ;\",\n      \"sctap:hasTopLevelExpression ?expression ;\",\n      \"sctap:authorArticle ?authorArticle;\",\n      \"sctap:textArticle ?textArticle .\",\n    \t\"?authorArticle dc:title ?authorArticleTitle . \",\n      \"?textArticle dc:title ?textArticleTitle . \",\n    \t\"?expression dc:title ?topLevelExpressionTitle .\",\n      \"}\",\n      \"WHERE \",\n      \"{\",\n      \"BIND(<\" + authorid + \"> as ?author) . \",\n      \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n      \"OPTIONAL\",\n      \"{\",\n      \"?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n      \"?expression a <http://scta.info/resource/expression> .\",\n      \"?expression <http://scta.info/property/level> '1' .\",\n      \"?expression <http://purl.org/dc/elements/1.1/title> ?topLevelExpressionTitle .\",\n      \"}\",\n      \"OPTIONAL\",\n      \"{\",\n      \"?expression2 <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n      \"?textArticle <http://scta.info/property/isArticleOf> ?expression2 .\",\n      \"?textArticle <http://purl.org/dc/elements/1.1/title> ?textArticleTitle .\",\n      \"}\",\n      \"OPTIONAL\",\n      \"{\",\n      \"?authorArticle <http://scta.info/property/isArticleOf> ?author .\",\n      \"?authorArticle <http://purl.org/dc/elements/1.1/title> ?authorArticleTitle\",\n      \"}\",\n      \"}\"].join('');\n      return query\n      }\n\n  export function versionHistoryInfo(transcriptionUri){\n     \t \tconst query = [\n     \t \t\t\"SELECT ?version ?version_shortId ?order_number ?version_label ?review ?doc\",\n     \t    \"{\",\n            \"{\",\n               \"BIND(<\" + transcriptionUri + \"> as ?version) . \",\n     \t         \"?version <http://scta.info/property/shortId> ?version_shortId .\",\n               \"?version <http://scta.info/property/hasDocument> ?doc . \",\n     \t         \"?version <http://scta.info/property/versionOrderNumber> ?order_number .\",\n     \t\t\t\t\t \"?version <http://scta.info/property/versionLabel> ?version_label .\",\n     \t\t\t\t\t \"OPTIONAL {\",\n     \t\t\t\t\t \t\"?version <http://scta.info/property/hasReview> ?review .\",\n     \t\t\t\t   \"}\",\n     \t\t\t\t \"}\",\n     \t       \"UNION\",\n            \"{\",\n     \t         \"<\" + transcriptionUri + \"> <http://scta.info/property/hasAncestor> ?version .\",\n     \t\t\t\t\t \"?version <http://scta.info/property/shortId> ?version_shortId .\",\n               \"?version <http://scta.info/property/hasDocument> ?doc . \",\n     \t         \"?version <http://scta.info/property/versionOrderNumber> ?order_number .\",\n     \t\t\t\t\t \"?version <http://scta.info/property/versionLabel> ?version_label .\",\n     \t\t\t\t\t \"OPTIONAL {\",\n     \t\t\t\t\t \t\"?version <http://scta.info/property/hasReview> ?review .\",\n     \t\t\t\t   \"}\",\n     \t\t\t\t \"}\",\n     \t       \"UNION\",\n     \t       \"{\",\n     \t         \"<\" + transcriptionUri + \"> <http://scta.info/property/hasDescendant> ?version .\",\n     \t\t\t\t\t \"?version <http://scta.info/property/shortId> ?version_shortId .\",\n               \"?version <http://scta.info/property/hasDocument> ?doc . \",\n     \t         \"?version <http://scta.info/property/versionOrderNumber> ?order_number .\",\n     \t\t\t\t\t \"?version <http://scta.info/property/versionLabel> ?version_label .\",\n     \t\t\t\t\t \"OPTIONAL {\",\n     \t\t\t\t\t \t\"?version <http://scta.info/property/hasReview> ?review .\",\n     \t\t\t\t   \"}\",\n     \t\t\t\t \"}\",\n     \t     \"}\",\n     \t     \"ORDER BY DESC(?order_number)\"].join('');\n           return query\n           }\n\n  //gets lines and zone order for\n  export function getBlockLines(manifestationBlockId){\n     const query = [\n       \"SELECT ?first ?last ?order ?surface\",\n       \"{\",\n         \"<\" + manifestationBlockId + \"> <http://scta.info/property/isOnZone> ?zone . \",\n         \"?zone <http://scta.info/property/isOnZone> ?zone2 .\",\n         \"?zone2 <http://scta.info/property/firstLine> ?first .\",\n         \"?zone2 <http://scta.info/property/lastLine> ?last .\",\n         \"?zone2 <http://scta.info/property/isPartOfSurface> ?surface .\",\n         \"?zone <http://scta.info/property/isOnZoneOrder> ?order .\",\n       \"}\"].join('');\n       return query\n     }\n\n   //gets lines and zone order for\n   export function getChildParts(resourceid){\n      const query = [\n        \"SELECT ?part ?title ?level ?order ?structureType ?questionTitle ?author ?authorTitle ?isPartOf ?isPartOfTitle \",\n        \"{\",\n          \"<\" + resourceid + \"> <http://purl.org/dc/terms/hasPart> ?part . \",\n          \"?part <http://purl.org/dc/elements/1.1/title> ?title .\",\n          \"OPTIONAL {\",\n            \"?isPartOf <http://purl.org/dc/terms/hasPart> <\" + resourceid + \"> .\",\n            \"?isPartOf <http://purl.org/dc/elements/1.1/title> ?isPartOfTitle .\",\n          \"}\",\n          \"OPTIONAL {\",\n            \"?part <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n            \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n          \"}\",\n          \"OPTIONAL\",\n          \"{\",\n          \"?part <http://scta.info/property/level> ?level .\",\n          \"}\",\n          \"OPTIONAL\",\n          \"{\",\n          \"?part <http://scta.info/property/structureType> ?structureType .\",\n          \"}\",\n          \"OPTIONAL\",\n          \"{\",\n            \"{\",\n              \"?part <http://scta.info/property/sectionOrderNumber> ?order .\",\n            \"}\",\n            \"UNION\",\n            \"{\",\n              \"?part <http://scta.info/property/isTranscriptionOf> ?mpart . \",\n              \"?mpart <http://scta.info/property/isManifestationOf> ?epart . \",\n              \"?epart <http://scta.info/property/sectionOrderNumber> ?order .\",\n            \"}\",\n            \"UNION\",\n            \"{\",\n              \"?part <http://scta.info/property/isManifestationOf> ?epart . \",\n              \"?epart <http://scta.info/property/sectionOrderNumber> ?order .\",\n            \"}\",\n          \"}\",\n          \"OPTIONAL\",\n          \"{\",\n          \"?part <http://scta.info/property/questionTitle> ?questionTitle .\",\n          \"}\",\n        \"}\",\n        \"ORDER BY ?order ?authorTitle\"].join('');\n        return query\n      }\n      //gets lines and zone order for\n    export function getMembersOf(resourceid){\n       const query = [\n         \"SELECT ?memberOf\",\n         \"{\",\n           \"<\" + resourceid + \"> <http://scta.info/property/isMemberOf> ?memberOf . \",\n         \"}\"].join('');\n         return query\n       }\n\n    export function getManifestationCitationInfo(transcriptionid){\n       var query = [\n       \"SELECT DISTINCT ?manifestation ?manifestationTitle ?manifestationSurface ?surfaceTitle ?codexTitle ?datasource ?eLongTitle ?author ?authorTitle ?expression ?editor ?editorTitle\",\n       \"{\",\n       \"<\" + transcriptionid + \"> <http://scta.info/property/isTranscriptionOf> ?manifestation .\",\n       \"<\" + transcriptionid + \"> <http://scta.info/property/hasXML> ?datasource . \",\n       \"?manifestation <http://purl.org/dc/elements/1.1/title> ?manifestationTitle .\",\n       \"{\",\n        \"?manifestation <http://scta.info/property/isPartOfTopLevelManifestation> ?topLevelManifestation .\",\n       \"}\",\n       \"UNION\",\n       \"{\",\n        \"?manifestation <http://scta.info/property/level> '1' .\",\n        \"BIND (?manifestation AS ?topLevelManifestation) .\",\n       \"}\",\n       \"OPTIONAL {\",\n         \"?topLevelManifestation <http://scta.info/property/editor> ?editor .\",\n         \"?editor <http://purl.org/dc/elements/1.1/title> ?editorTitle .\",\n       \"}\",\n       \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n       \"{\",\n       \"?expression <http://scta.info/property/isPartOfTopLevelExpression> ?topLevelExpression .\",\n       \"}\",\n       \"UNION\",\n       \"{\",\n        \"?expression <http://scta.info/property/level> '1' .\",\n        \"BIND (?expression AS ?topLevelExpression) .\",\n       \"}\",\n       \"OPTIONAL {\",\n        \"?expression <http://scta.info/property/longTitle> ?eLongTitle\",\n      \"}\",\n       \"OPTIONAL {\",\n         \"?topLevelExpression <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n         \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n       \"}\",\n       // # TODO isOnSurface should become more uniform across manifestations in order to simplify this\n       \"OPTIONAL\",\n         \"{\",\n         // #option 1 get surfaces for elements and blocks\n          \"{\",\n            \"?manifestation <http://scta.info/property/isOnZone> ?bn . \",\n            \"?bn <http://scta.info/property/isOnZone> ?zone .\",\n            \"?zone <http://scta.info/property/isPartOfSurface> ?manifestationSurface .\",\n          \"}\",\n          \"UNION\",\n          //#option 2 get surface for divisions and items\n          \"{\",\n            \"?manifestation <http://scta.info/property/hasStructureBlock> ?block .\",\n            \"?block <http://scta.info/property/isOnSurface> ?manifestationSurface .\",\n          \"}\",\n          \"UNION\",\n          //#option 3 get surfaces for collections\"\n          \"{\",\n            \"?manifestation <http://scta.info/property/hasStructureItem> ?item .\",\n            \"?item <http://scta.info/property/isOnSurface> ?manifestationSurface .\",\n          \"}\",\n          \"?manifestationSurface <http://purl.org/dc/elements/1.1/title> ?surfaceTitle .\",\n          \"?manifestationSurface <http://scta.info/property/order> ?surface_order .\",\n          \"?codex <http://scta.info/property/hasSurface> ?manifestationSurface .\",\n          \"?codex <http://purl.org/dc/elements/1.1/title> ?codexTitle .\",\n         \"}\",\n       \"}\",\n       \"ORDER BY ?surface_order\"].join('');\n       return query\n     }\n    \n\n    export function getCodices(){\n     const query = [\n       \"SELECT ?codex ?codex_title\",\n \t     \"{\",\n\t\t\t\t \"?codex a <http://scta.info/resource/codex> .\",\n\t\t\t\t \"?codex <http://purl.org/dc/elements/1.1/title> ?codex_title\",\n\t\t\t\t\"}\",\n\t\t\t \"ORDER BY ?codex_title\"].join('')\n       return query\n     }\n     export function getCodexInfo(codexid){\n      const query = [\n        \"SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status \",\n        \"{\",\n          \"BIND(<\" + codexid + \"> as ?codex) . \",\n          \"?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .\",\n          \"OPTIONAL {\",\n          \"?icodex <http://scta.info/property/isCodexItemOf> ?codex .\",\n          \"?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .\",\n          \"?surface <http://scta.info/property/hasISurface> ?isurface .\",\n          \"?surface <http://scta.info/property/order> ?surface_order .\",\n          \"?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .\",\n          \"?manifestation <http://scta.info/property/isOnSurface> ?surface .\",\n          \"?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .\",\n          \"?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .\",\n          \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n          \"?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .\",\n          \"?expression <http://scta.info/property/status> ?status .\",\n          \"OPTIONAL {\",\n             \"?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .\",\n           \"}\",\n         \"}\",\n        \"}\",\n        \"ORDER BY ?surface_order\"].join('')\n     return query\n   }\n   export function getCodexInfoFromManifest(manifestid){\n    const query = [\n      \"SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status \",\n      \"{\",\n        \"?icodex <http://scta.info/property/hasOfficialManifest> <\" + manifestid + \"> .\",\n        \"?codex <http://scta.info/property/hasCodexItem> ?icodex .\",\n        \"?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .\",\n        \"OPTIONAL {\",\n        \"?icodex <http://scta.info/property/isCodexItemOf> ?codex .\",\n        \"?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .\",\n        \"?surface <http://scta.info/property/hasISurface> ?isurface .\",\n        \"?surface <http://scta.info/property/order> ?surface_order .\",\n        \"?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .\",\n        \"?manifestation <http://scta.info/property/isOnSurface> ?surface .\",\n        \"?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .\",\n        \"?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .\",\n        \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n        \"?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .\",\n        \"?expression <http://scta.info/property/status> ?status .\",\n        \"OPTIONAL {\",\n           \"?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .\",\n         \"}\",\n       \"}\",\n      \"}\",\n      \"ORDER BY ?surface_order\"].join('')\n      return query\n    }\n\n     export function getCodexInfoFromSurface(surfaceid){\n      const query = [\n        \"SELECT DISTINCT ?codex ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status \",\n        \"{\",\n          \"?codex <http://scta.info/property/hasSurface> <\" + surfaceid + \"> .\",\n          \"?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .\",\n          \"OPTIONAL {\",\n          \"?icodex <http://scta.info/property/isCodexItemOf> ?codex .\",\n          \"?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .\",\n          \"?surface <http://scta.info/property/hasISurface> ?isurface .\",\n          \"?surface <http://scta.info/property/order> ?surface_order .\",\n          \"?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .\",\n          \"?manifestation <http://scta.info/property/isOnSurface> ?surface .\",\n          \"?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .\",\n          \"?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .\",\n          \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n          \"?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .\",\n          \"?expression <http://scta.info/property/status> ?status .\",\n          \"OPTIONAL {\",\n             \"?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .\",\n           \"}\",\n         \"}\",\n        \"}\",\n        \"ORDER BY ?surface_order\"].join('')\n     return query\n   }\n\n   export function getCodexInfoFromCanvas(canvasid){\n    const query = [\n      \"SELECT DISTINCT ?codex ?surfaceFocus ?expression ?codex_title ?item_expression_title ?item_expression_question_title ?surface ?surface_title ?surface_order ?manifestation ?manifestation_short_id ?status \",\n      \"{\",\n        \"?isurfaceFocus <http://scta.info/property/hasCanvas> <\" + canvasid + \"> .\",\n        \"?surfaceFocus <http://scta.info/property/hasISurface> ?isurfaceFocus .\",\n        \"?codex <http://scta.info/property/hasSurface> ?surfaceFocus .\",\n        \"?codex <http://purl.org/dc/elements/1.1/title> ?codex_title .\",\n        \"OPTIONAL {\",\n        \"?icodex <http://scta.info/property/isCodexItemOf> ?codex .\",\n        \"?isurface <http://purl.org/dc/elements/1.1/isPartOf> ?icodex .\",\n        \"?surface <http://scta.info/property/hasISurface> ?isurface .\",\n        \"?surface <http://scta.info/property/order> ?surface_order .\",\n        \"?surface <http://purl.org/dc/elements/1.1/title> ?surface_title .\",\n        \"?manifestation <http://scta.info/property/isOnSurface> ?surface .\",\n        \"?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureItem> .\",\n        \"?manifestation <http://scta.info/property/shortId> ?manifestation_short_id .\",\n        \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n        \"?expression <http://purl.org/dc/elements/1.1/title> ?item_expression_title .\",\n        \"?expression <http://scta.info/property/status> ?status .\",\n        \"OPTIONAL {\",\n           \"?expression <http://scta.info/property/questionTitle> ?item_expression_question_title .\",\n         \"}\",\n       \"}\",\n      \"}\",\n      \"ORDER BY ?surface_order\"].join('')\n      return query\n    }\n\n   export function getSearchExpressionList(filters){\n     //filters should be an ojbect\n     let authorFilter = \"\"\n     if (filters.authorId){\n       authorFilter = \"BIND(<\" + filters.authorId + \"> as ?author) . \"\n     }\n     const query = [\n       \"SELECT DISTINCT ?expressionid ?expressionTitle ?author ?authorTitle \",\n       \"{\",\n         authorFilter,\n         \"?author a <http://scta.info/resource/person> .\",\n         \"?expressionid <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n         \"?expressionid a <http://scta.info/resource/expression> .\",\n         \"?expressionid <http://scta.info/property/level> '1' .\",\n         \"?expressionid <http://purl.org/dc/elements/1.1/title> ?expressionTitle .\",\n         \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n       \"}\",\n       \"ORDER BY ?authorTitle\"].join('')\n    return query\n   }\n   export function getSearchAuthorList(filters){\n     //filters should be an ojbect\n     const query = [\n       \"SELECT DISTINCT ?author ?authorTitle \",\n       \"{\",\n          \"?author a <http://scta.info/resource/person> .\",\n          \"?expressionid <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n          \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n\n       \"}\",\n       \"ORDER BY ?authorTitle\"].join('')\n    return query\n   }\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {FaExternalLinkAlt, FaChevronDown, FaChevronUp} from 'react-icons/fa';\nimport {Link} from 'react-router-dom';\n\nimport {runQuery} from './utils'\nimport {getChildParts} from './Queries'\n\n/**\n* creates a text outline section\n*/\nclass TextOutline extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleToggleChildren = this.handleToggleChildren.bind(this)\n    this.mounted = \"\"\n    this.state = {\n      parts: [],\n      showChildren: false,\n      isPartOf: {}\n    }\n\n  }\n  /**\n    @public\n    * toggles state.showChildren indicating whether or not section children should be mounted\n  */\n  handleToggleChildren(e){\n    e.preventDefault();\n    this.setState((prevState) => {\n      return {showChildren: !prevState.showChildren}\n    })\n  }\n  retrieveParts(resourceid){\n\n    const partsInfo = runQuery(getChildParts(resourceid))\n    partsInfo.then((data) => {\n\n      // async seems to be working pretty well and efficiently.\n      // if a section has many parts, it will be fired several times.\n      // if it has a 100 parts, it will fire 100 times.\n      // But 100 doesn't seem to causing serious performance issues.\n      //console.log(\"async test; fired\")\n      const newData = data.data.results.bindings.map((d) => {\n\n        return {\n          part: d.part.value,\n          title: d.title.value,\n          level: d.level ? d.level.value : \"\",\n          author: d.author ? d.author.value : \"\",\n          authorTitle: d.authorTitle ? d.authorTitle.value : \"\",\n          structureType: d.structureType ? d.structureType.value : \"\",\n          questionTitle: d.questionTitle ? d.questionTitle.value : \"\"\n        }\n      })\n\n      let isPartOf = {isPartOfId: \"\", isPartOfTitle: \"\"}\n      if (data.data.results.bindings[0]){\n        if (data.data.results.bindings[0].isPartOf){\n        isPartOf.isPartOfId = data.data.results.bindings[0].isPartOf.value\n        isPartOf.isPartOfTitle = data.data.results.bindings[0].isPartOfTitle.value\n        }\n      }\n\n\n      if (this.mounted){\n        this.setState({parts: newData, isPartOf: isPartOf})\n      }\n    })\n  }\n  componentDidMount(){\n    //this.setState({showChildren: this.props.showChildren})\n    this.mounted = true;\n    this.retrieveParts(this.props.resourceid)\n    \n    if (this.props.membersOf){\n      if (this.props.membersOf.includes(this.props.resourceid)) {\n        this.setState({showChildren: true})\n\n      }\n    }\n\n  }\n  // UNSAFE_componentWillReceiveProps(newProps){\n  //   if (newProps.resourceid !== this.props.resourceid){\n  //     this.retrieveParts(this.props.resourceid)\n  //   }\n  //   if (newProps.resourceid !== this.props.resourceid || newProps.membersOf !== this.props.membersOf){\n  //     if (newProps.membersOf){\n  //       if (newProps.membersOf.includes(newProps.resourceid)) {\n  //         this.setState({showChildren: true})\n  //       }\n  //       // else{\n  //       //   this.setState({showChildren: false})\n  //       // }\n  //     }\n  //   }\n\n  // }\n  componentDidUpdate(prevProps){\n    if (this.props.resourceid !== prevProps.resourceid){\n      this.retrieveParts(this.props.resourceid)\n    }\n    if (this.props.resourceid !== prevProps.resourceid || this.props.membersOf !== prevProps.membersOf){\n      if (this.props.membersOf){\n        if (this.props.membersOf.includes(this.props.resourceid)) {\n          this.setState({showChildren: true})\n        }\n        // else{\n        //   this.setState({showChildren: false})\n        // }\n      }\n    }\n\n  }\n  componentWillUnmount(){\n    this.mounted = false;\n  }\n  render(){\n    const displayChildren = () => {\n      const parts = this.state.parts.map((p) => {\n        let bold = \"\"\n        if (this.props.membersOf){\n          if (this.props.membersOf.includes(p.part) || p.part === this.props.focusResourceid) {\n            bold = \"bold\"\n            //showChildren = true;\n          }\n        }\n        return <TextOutline\n        bold={bold}\n        key={p.part}\n        focusResourceid={this.props.focusResourceid}\n        showChildren={this.state.showChildren}\n        showFirstLevelChildren={false}\n        resourceid={p.part}\n        title={p.title}\n        level={p.level}\n        author={p.author}\n        authorTitle={p.authorTitle}\n        structureType={p.structureType}\n        membersOf={this.props.membersOf}\n        questionTitle={p.questionTitle}\n        mtFocus={this.props.mtFocus}\n        showAuthor={this.props.showAuthor}\n        collectionLink={p.structureType === \"http://scta.info/resource/structureCollection\" ? this.props.collectionLink : false}\n        showParentLink={false}\n        />\n\n\n      })\n      return parts\n    }\n    const indent = this.props.level * 5\n    return (\n      <div id=\"outline\" style={{\"paddingLeft\": indent + \"px\"}}>\n        <p className={this.props.bold}>\n        {(this.state.isPartOf.isPartOfId && this.props.showParentLink) && <Link to={\"/text?resourceid=\" + this.state.isPartOf.isPartOfId}><FaChevronUp/></Link>}\n        {(this.props.author && this.props.showAuthor && this.props.level === \"1\") &&\n          <span>\n            <span>{this.props.authorTitle}: </span>\n            <Link to={\"/text?resourceid=\" + this.props.author}><FaExternalLinkAlt/></Link>\n          </span>\n        }\n        {this.props.title}\n        {this.props.questionTitle && <span>: {this.props.questionTitle}</span>}\n        \n        {!this.props.showFirstLevelChildren &&\n        <>\n        {(this.state.parts.length > 0 && !this.state.showChildren) && <span className=\"outlineArrow\" onClick={this.handleToggleChildren}><FaChevronDown/></span>}\n        {(this.state.parts.length > 0 && this.state.showChildren) && <span className=\"outlineArrow\" onClick={this.handleToggleChildren}><FaChevronUp/></span>}\n        </>\n        }\n        \n        {/** Note this conditional below (\"this.props.resourceid &&\"\") was added mostly to allow current tests to pass; if required documentation of required props is improved; tests could be improved and this conditional likely wouldn't be necessary */}\n        {this.props.resourceid && <Link to={\"/text?resourceid=\" + this.props.resourceid + this.props.mtFocus} ><FaExternalLinkAlt/></Link>}\n        {this.props.collectionLink && <a href={\"https://mirador.scta.info?resourceid=\" + this.props.resourceid} target=\"_blank\" rel=\"noopener noreferrer\"> <img alt=\"view in mirador\" style={{width: \"12px\", height: \"12px\"}} src=\"https://projectmirador.org/img/mirador-logo.svg\"></img></a>}\n        </p>\n        {this.props.showFirstLevelChildren ? displayChildren() : this.state.showChildren && displayChildren()}\n      </div>\n    );\n  }\n}\n\nTextOutline.propTypes = {\n  /**\n  * resource id of focused passage, e.g. paragraph or div structure\n  */\n  focusedResourceid: PropTypes.string,\n  /**\n  * resource id of current section\n  */\n  resourceid: PropTypes.string,\n  /**\n  * title of current section\n  */\n  title: PropTypes.string,\n  /**\n  * hide entire outline\n  */\n  hidden: PropTypes.bool,\n  /**\n  * manifestation and transcription slug\n  * used to create links in outline to specific manifestation\n  * or transcription\n\n  */\n  mtFocus: PropTypes.string,\n  /**\n  * indicates if section heading should be bold with string \"bold\", indicating that focusedResourceId falls within this section\n\n  * TODO: \"bold\" value would be better as boolean, true false\n  */\n  bold: PropTypes.string,\n  /**\n  * indicates whether children should be shown\n  */\n  showChildren: PropTypes.bool,\n  /**\n  * indicates whether level of section with number as string\n\n  * TODO: would be better if level propType was number.\n  */\n  level: PropTypes.string,\n  /**\n  * indicates structureType of current section (e.g. collection, item, division, block)\n  */\n  structureType: PropTypes.string,\n  /**\n  * an array of ids, that focused section is a member of\n  */\n  membersOf: PropTypes.array,\n  /**\n  * question title associated with section\n  */\n  questionTitle: PropTypes.string,\n  /**\n  * indications whether a link at the collection level should be set or not\n  */\n  collectionLink: PropTypes.bool\n}\n\nexport default TextOutline;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport TextOutline from './TextOutline'\n\nimport {runQuery} from './utils'\nimport {getMembersOf} from './Queries'\n\n/**\n* creates a text outline starting from top level expression\n\n*/\nclass TextOutlineWrapper extends React.Component {\n  constructor(props){\n    super(props)\n    this.mounted = \"\"\n    this.state = {\n      membersOf: [],\n    }\n  }\n  retrieveMembersOf(resourceid){\n    const membersOfInfo = runQuery(getMembersOf(resourceid))\n    membersOfInfo.then((data) => {\n      const newData = data.data.results.bindings.map((d) => {\n        return d.memberOf.value\n      })\n      if (this.mounted){\n        this.setState({membersOf: newData})\n      }\n    })\n  }\n  componentDidMount(){\n    this.mounted = true;\n    this.retrieveMembersOf(this.props.focusResourceid)\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.focusResourceid !== prevProps.focusResourceid){\n      this.retrieveMembersOf(this.props.focusResourceid)\n    }\n  }\n  componentWillUnmount(){\n    this.mounted = false;\n}\n  render(){\n    return (\n      <div className={this.props.hidden ? \"hidden\" : \"showing\"}>\n\n        <TextOutline\n          key={this.props.resourceid}\n          showChildren={true}\n          showFirstLevelChildren={this.props.showFirstLevelChildren}\n          focusResourceid={this.props.focusResourceid}\n          resourceid={this.props.resourceid}\n          title={this.props.title}\n          level={\"1\"}\n          structureType={\"http://scta.info/resource/structureCollection\"}\n          membersOf={this.state.membersOf}\n          mtFocus={this.props.mtFocus}\n          collectionLink={this.props.collectionLink}\n          showAuthor={this.props.showAuthor}\n          showParentLink={this.props.showParentLink}\n          />\n      </div>\n    );\n  }\n}\n\nTextOutlineWrapper.propTypes = {\n  /**\n  * resource id of focused passage, e.g. paragraph or div structure\n  */\n  focusedResourceid: PropTypes.string,\n  /**\n  * resource id of current section\n  */\n  resourceid: PropTypes.string,\n  /**\n  * title of current section\n  */\n  title: PropTypes.string,\n  /**\n  * hide entire outline\n  */\n  hidden: PropTypes.bool,\n  /**\n  * manifestation and transcription slug\n  * used to create links in outline to specific manifestation\n  * or transcription\n  */\n  mtFoucs: PropTypes.string,\n  /**\n  * indications whether a link at the collection level should be set or not\n  */\n  collectionLink: PropTypes.bool\n}\nexport default TextOutlineWrapper;\n","import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport OpenSeadragon from 'openseadragon';\nimport Axios from 'axios'\nimport uuidv4 from 'uuid/v4';\n\nconst OSDInstance = (props) => {\n  const [instance, setInstance] = useState()\n  const [viewerWidthHeight, setViewerWidthHeight] = useState({ w: \"\", h: \"\" })\n  const [viewerId] = useState(uuidv4())\n  useEffect(() => {\n    if (props.coords){\n      setViewerWidthHeight(computeViewerWidthHeight(props.coords.split(\",\")[2], props.coords.split(\",\")[3]))\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.coords])\n  useEffect(() => {\n    Axios.get(props.imageurl + \"/info.json\").then((d) => {\n      if (instance) {\n        // Modify tile source as needed to already existing instance\n        instance.addTiledImage({\n          tileSource: d.data\n        });\n        if (props.coords) {\n          // this should be another way to get Scalar coordinates, but it doesn't seem to be working\n          //const newRect = instance.viewport.imageToViewportRectangle(x, y, w, h)\n          const sc = getScalarCoordinates(props.coords, d.data.height, d.data.width)\n          const rect = new OpenSeadragon.Rect(sc.x, sc.y, sc.w, sc.h)\n          setBounds(instance, rect)\n          setOverlay(instance, rect)\n          if (props.lineFocusCoords){\n            const lsc = getScalarCoordinates(props.lineFocusCoords, d.data.height, d.data.width)\n            const linerect = new OpenSeadragon.Rect(lsc.x, lsc.y, lsc.w, lsc.h)\n            setOverlay(instance, linerect)\n          \n          }\n          setGoHome(instance, rect)\n          instance.viewport.fitBounds(rect)\n        }\n      }\n      else {\n        const id = \"osd-\" + viewerId\n        const instance = OpenSeadragon({\n          id: id,\n          prefixUrl: \"/img/openseadragon/\",\n          preserveViewport: true, //this helps to keep the viewer in the same spot when toggling full screen\n          visibilityRatio: 1,\n          minZoomLevel: 1,\n          defaultZoomLevel: 1,\n          tileSources: [d.data],\n          controlsFadeDelay: 0,\n          controlsFadeLength: 25\n        })\n        if (props.coords) {\n          // this should be another way to get Scalar coordinates, but it doesn't seem to be working\n          //const newRect = instance.viewport.imageToViewportRectangle(x, y, w, h)\n          const sc = getScalarCoordinates(props.coords, d.data.height, d.data.width)\n          const rect = new OpenSeadragon.Rect(sc.x, sc.y, sc.w, sc.h)\n          setBounds(instance, rect)\n          setOverlay(instance, rect)\n          if (props.lineFocusCoords){\n            const lsc = getScalarCoordinates(props.lineFocusCoords, d.data.height, d.data.width)\n            const linerect = new OpenSeadragon.Rect(lsc.x, lsc.y, lsc.w, lsc.h)\n            setOverlay(instance, linerect)\n        }\n          setGoHome(instance, rect)\n        }\n        setInstance(instance)\n      }\n    })\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.imageurl, props.coords])\n\n  const setOverlay = (instance, rect) => {\n    instance.addHandler(\"open\", function () {\n      const id = uuidv4()\n      const elt = document.createElement(\"div\");\n      elt.id = \"runtime-overlay-\" + id;\n      elt.className = \"osdhighlight\";\n      instance.addOverlay({\n        element: elt,\n        location: rect\n      });\n    })\n  }\n  const setBounds = (instance, rect) => {\n    instance.addHandler(\"open\", function () {\n      instance.viewport.fitBounds(rect, true);\n    });\n  }\n  const setGoHome = (instance, rect) => {\n    //OpenSeadragon.Viewport.prototype.goHome = function () {\n    instance.viewport.goHome = function () {\n      // Give it whatever rectangle you want\n      this.fitBounds(rect);\n    }\n  }\n  const getScalarCoordinates = (inputCoords, imageH, imageW) => {\n    const coords = inputCoords.split(\",\")\n    const x = parseInt(coords[0])\n    const y = parseInt(coords[1])\n    const w = parseInt(coords[2])\n    const h = parseInt(coords[3])\n\n    const ar = imageH / imageW\n    const xcomp = x / imageW\n    const ycomp = (y / imageH) * ar\n    const wcomp = w / imageW\n    const hcomp = (h / imageH) * ar\n    return { x: xcomp, y: ycomp, w: wcomp, h: hcomp }\n  }\n  const computeViewerWidthHeight = (w, h) => {\n    const displayWidth = props.displayWidth\n    const newHeight = displayWidth * (parseInt(h) / parseInt(w))\n    return { w: displayWidth, h: newHeight }\n  }\n  return (\n    <div>\n      {\n        //<p onClick={handleAddOverlay}>Add overlay</p>\n      }\n      {\n        props.coords ? <div id={\"osd-\" + viewerId} className=\"open-seadragon-container\" style={{ height: viewerWidthHeight.h + \"px\", width: viewerWidthHeight.w + \"px\" }}></div>\n          : <div id={\"osd-\" + viewerId} className=\"open-seadragon-container\" style={{ height: \"100vh\" }}></div>\n      }\n\n    </div>\n  )\n}\n\nOSDInstance.defaultProps = {\n  imageurl: \"https://loris2.scta.info/vat/V145v.jpg\",\n  displayWidth: 1000\n};\nOSDInstance.propTypes = {\n  /**\n  * imageurl (without iiif parameters) for which logo will be requested\n  **/\n  imageurl: PropTypes.string.isRequired,\n\n}\n\nexport default OSDInstance;","import React from 'react';\nimport OSDInstance from './OSDInstance';\nimport PropTypes from 'prop-types';\n\n// TODO: osd component makes this component fairly obsolete or a least exchangeable\nfunction Image(props) {\n  //TODO comment when ready to build a conditional based on prop to allow switch between using static image or OSDInstance\n    // let newCoords = \"\"\n    // if (props.coords){\n    //   const coordsSplitArray = props.coords.split(\",\")\n    //   //const x = parseInt(coordsSplitArray[0]) - 20\n    //   const x = parseInt(coordsSplitArray[0])\n    //   const y = coordsSplitArray[1]\n    //   //const w = parseInt(coordsSplitArray[2]) + 40\n    //   const w = parseInt(coordsSplitArray[2])\n    //   const h = coordsSplitArray[3]\n    //   newCoords = x + \",\" + y + \",\" + w + \",\" + h\n    // }\n    //const imageLink = props.imageUrl + \"/\" + newCoords + \"/\" + props.displayWidth + \",/0/default.jpg\"\n  return (\n      //<img alt=\"manuscript\" src={imageLink}/>\n      <OSDInstance imageurl={props.imageUrl} coords={props.coords} displayWidth={props.displayWidth} lineFocusCoords={props.lineFocusCoords}/>\n  );\n}\n\nImage.propTypes = {\n  /**\n  * the Url for the image resource\n  **/\n  imageUrl: PropTypes.string.isRequired,\n  /**\n  * width of the image to be displayed\n  *\n  * TODO: might be better to make this a number/integer and not required;\n  * when not preset perhaps it should just default to the widths listed in the coords\n  **/\n  displayWidth: PropTypes.string.isRequired,\n  /**\n  * string in the form of \"x,y,w,h\"\n  *\n  **/\n  coords: PropTypes.string.isRequired\n}\nexport default Image;\n","import React from 'react';\n\nfunction LineText(props) {\n  return (\n    <div className=\"text\" style={{\"whiteSpace\": \"nowrap\"}}>\n    {props.number && <span>{props.label.split(\"(\")[0]}/</span>}     \n    {props.number && <span>{props.number}</span>}\n    <span dangerouslySetInnerHTML={{__html: props.text}} />\n    </div>\n  );\n}\n\nexport default LineText;\n","// Note this component is a near duplicate of Image Text Wrapper in Paleographinator\n// TODO: This shoud be the target for a refactored independent React Component\n\nimport React, { Component } from 'react';\nimport Image from './Image';\nimport LineText from './LineText';\n\nclass ImageTextWrapper extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      searchText: \"\"\n    }\n  }\n  render() {\n    // const getClass = () => {\n    //   if (this.props.targetLabel === this.props.label){\n    //     return \"ImageTextWrapper target\"\n    //   }\n    //   else {\n    //     return \"ImageTextWrapper\"\n    //   }\n    // }\n    return (\n      <div className={this.props.targetLabel === this.props.label ? \"ImageTextWrapper target\" : \"ImageTextWrapper\"}>\n        <div className=\"labelImageWrapper\">\n        <Image\n          imageUrl={this.props.imageUrl}\n          canvas={this.props.canvas}\n          coords={this.props.coords}\n          canvasShort={this.props.canvasShort}\n          displayWidth={this.props.displayWidth}\n          lineFocusCoords={this.props.lineFocusCoords}\n          />\n        </div>\n        <LineText text={this.props.text} number={this.props.number} label={this.props.label}/>\n      </div>\n    );\n  }\n}\n\nexport default ImageTextWrapper;\n","import React, {useState, useEffect} from 'react';\nimport PropTypes from 'prop-types';\nimport Axios from 'axios'\n\nconst ImageLogo = (props) => {\n  const [logoUrl, setLogoUrl] = useState(\"\")\n  useEffect(() => {\n    // conditional set in order prevent ajax request if props.imagurl does not exist\n    if (props.imageurl){\n      Axios.get(props.imageurl + \"/info.json\").then((d) => {\n        const logo = d.data.logo[\"@id\"]\n        setLogoUrl(logo)\n      }).catch((error) => {\n        console.log(\"no logo found\", error)\n        setLogoUrl(\"\")\n      })\n    }\n  }, [props.imageurl])\n  return (\n    <>{logoUrl && <img src={logoUrl} style={{margin: props.margin, height: props.height}} alt=\"imagelogo\"/>}</>\n  )\n}\n\nImageLogo.defaultProps = {\n  height: \"20px\",\n  margin: \"5px\"\n};\n\nImageLogo.propTypes = {\n  /**\n  * imageurl (without iiif parameters) for which logo will be requested\n  **/\n  imageurl: PropTypes.string.isRequired,\n  margin: PropTypes.string,\n  height: PropTypes.string\n\n}\nexport default ImageLogo;\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport Axios from 'axios'\nimport Button from 'react-bootstrap/Button';\n\nimport ImageTextWrapper from './ImageTextWrapper';\nimport ImageLogo from './ImageLogo';\nimport OSDInstance from './OSDInstance';\n\nimport {runQuery} from './utils'\nimport {getSurfaceInfo} from './Queries'\n\n\n\nclass Surface2 extends React.Component {\n  constructor(props){\n    super(props)\n    this.mount = false\n    this.handleNext = this.handleNext.bind(this)\n    this.handlePrevious = this.handlePrevious.bind(this)\n    this.handleLineFocusNext = this.handleLineFocusNext.bind(this)\n    this.handleLineFocusPrev = this.handleLineFocusPrev.bind(this)\n    this.isLineNumberLast = this.isLineNumberLast.bind(this)\n    this.isLineNumberFirst = this.isLineNumberFirst.bind(this)\n    this.handleToggleTextLines = this.handleToggleTextLines.bind(this)\n    this.handleToggleAllLines = this.handleToggleAllLines.bind(this)\n    this.state = {\n      currentSurfaceId: \"\",\n      manifest: \"\",\n      canvas: \"\",\n      region: \"full\",\n      width: \"1000\",\n      next: \"\",\n      previous: \"\",\n      imageurl: \"\",\n      annotationsDisplay: true,\n      showAllLines: false\n    }\n\n  }\n  handleNext(){\n    //this.retrieveSurfaceInfo(this.state.next)\n    this.props.handleSurfaceFocusChange(this.state.next)\n  }\n  handlePrevious(){\n    //this.retrieveSurfaceInfo(this.state.previous)\n    this.props.handleSurfaceFocusChange(this.state.previous)\n\n  }\n  handleToggleTextLines(){\n    //this.retrieveSurfaceInfo(this.state.previous)\n    this.setState((prevState) => {\n      return {annotationsDisplay: !prevState.annotationsDisplay}\n    })\n  }\n  handleToggleAllLines(){\n    this.setState((prevState) => {\n      return {showAllLines: !prevState.showAllLines}\n    })\n  }\n  retrieveSurfaceInfo(surfaceid){\n    // manifest id should be retrieved from query\n    // this is a temporary measure until db is corrected and query is posible\n\n    //const manifest = \"http://scta.info/iiif/\" + this.props.topLevel.split(\"/resource/\")[1] + \"/\" + surfaceid.split(\"/resource/\")[1].split(\"/\")[0] + \"/manifest\";\n    const manifest = \"\";\n    const surfaceInfo = runQuery(getSurfaceInfo(surfaceid))\n    surfaceInfo.then((d) => {\n      const b = d.data.results.bindings[0]\n      // only preceed if sparql query returns results\n      if (b){\n        //second nested async call for annotation list\n        const alUrl = \"https://exist.scta.info/exist/apps/scta-app/folio-annotaiton-list-from-simpleXmlCoordinates.xq?surfaceid=\" + surfaceid.split(\"/resource/\")[1] + \"&coords=loose\"\n        Axios.get(alUrl).then((d2) => {\n          if (this.mount){\n              this.setState({\n                currentSurfaceId: surfaceid,\n                surfaceTitle: b.surfaceTitle.value,\n                manifest: manifest,\n                canvas: b.canvas.value,\n                imageurl: b.imageurl.value,\n                next: b.next_surface ? b.next_surface.value : \"\",\n                previous: b.previous_surface ? b.previous_surface.value : \"\",\n                annotations: d2.data ? d2.data.resources : \"\"\n            })\n          }\n        }).catch((error) => {\n          console.log(\"failed retrieving annotationlist: \", error)\n          if (this.mount){\n            this.setState({\n            currentSurfaceId: surfaceid,\n            surfaceTitle: b.surfaceTitle.value,\n            manifest: manifest,\n            canvas: b.canvas.value,\n            imageurl: b.imageurl.value,\n            next: b.next_surface ? b.next_surface.value : \"\",\n            previous: b.previous_surface ? b.previous_surface.value : \"\",\n            annotations: \"\"\n          })\n        }\n      })\n    }\n  })\n}\n// next for functions are used to compute next and previous Lines\n// this is a little bit hacky, since there are no resources for lines yet.\n// thus the line id is computed by breaking the line id apart,\n// using the line number to compute the next and the reassembling the line RDF id.\n// this will become unnecessary if/when each lines become and RDF resource and contains a next previous property\nhandleLineFocusNext() {\n  const currentLineNumber = parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1])\n  const newLineArray = this.props.lineFocusId.split(\"/\")\n  newLineArray.pop()\n  newLineArray.push((currentLineNumber + 1).toString())\n  this.props.handleLineFocusChange(newLineArray.join(\"/\"))\n}\nhandleLineFocusPrev(){\n  const currentLineNumber = parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1])\n  const previousLineArray = this.props.lineFocusId.split(\"/\")\n  previousLineArray.pop()\n  previousLineArray.push((currentLineNumber - 1).toString())\n  this.props.handleLineFocusChange(previousLineArray.join(\"/\"))\n}\nisLineNumberFirst(){\n  const lineNumber = parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1])\n\n  if (lineNumber === 1){\n    return true\n  }\n  else {\n    return false\n  }\n}\nisLineNumberLast(){\n  const total = this.state.annotations ? this.state.annotations.length : \"\"\n  const lineNumber = parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1])\n  if (lineNumber === total){\n    return true\n  }\n  else{\n    return false\n  }\n}\ncomponentDidMount(){\n  this.mount = true\n    if (this.props.surfaceid){\n      this.retrieveSurfaceInfo(this.props.surfaceid)\n    }\n    this.setState({annotationsDisplay: this.props.annotationsDisplay})\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.surfaceid !== prevProps.surfaceid){\n    this.retrieveSurfaceInfo(this.props.surfaceid)\n    }\n  }\n  componentWillUnmount(){\n    this.mount = false\n  }\n\n  render() {\n    const displayImage = (h, i) => {\n      const text = h.resource.chars;\n      const canvas = h.on.split(\"#xywh=\")[0];\n      const canvasShort = canvas.split(\"/\")[canvas.split(\"/\").length - 1];\n      const coords = h.on.split(\"#xywh=\")[1];\n      const imageUrl = h.imageUrl\n      const label = h.label\n      if (this.state.showAllLines || (parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1]) === (i + 1) ) || !this.props.lineFocusId){\n      return (\n        <ImageTextWrapper key={i}\n          imageUrl={imageUrl}\n          canvas={canvas}\n          coords={coords}\n          canvasShort={canvasShort}\n          text={text}\n          label={label}\n          number={i + 1}\n          targetLabel={this.props.targetLabel}\n          surfaceButton={false}\n          displayWidth={this.props.width ? this.props.width : this.state.width}\n          />\n        )\n      }\n      else{\n        return null\n      }\n\n    }\n    const displayImages = () => {\n      if (this.state.annotations && this.state.annotationsDisplay){\n        let imageTextWrappers = []\n        if (!this.state.annotations.length){\n          const imageResult = displayImage(this.state.annotations, 0)\n          imageTextWrappers = imageResult\n        }\n        else{\n          imageTextWrappers = this.state.annotations.map((h, i) => {\n            return displayImage(h, i)\n          });\n        }\n        return imageTextWrappers\n      }\n      else{\n        //TODO uncommnent when ready to make a switch between using OSD or Image\n        //const width = this.props.width ? this.props.width : this.state.width\n        //return <img alt=\"manuscript\" src={this.state.imageurl + \"/\" + this.state.region + \"/\" + width + \",/0/default.jpg\"}/>\n        return <OSDInstance imageurl={this.state.imageurl}/>\n      }\n    }\n    return (\n      <Container className={this.props.hidden ? \"hidden\" : \"showing\"}>\n      {this.state.currentSurfaceId ?\n        <div>\n          <div className=\"surface-navigation\">\n            <p>{this.state.surfaceTitle}</p>\n            {(this.props.handleSurfaceFocusChange) &&\n              <div>\n              {this.state.previous && <Button size=\"sm\" onClick={this.handlePrevious}>Previous Page</Button>}\n              {this.state.next && <Button size=\"sm\" onClick={this.handleNext}>Next Page</Button>}\n              </div>\n            }\n            {(this.props.handleLineFocusChange && !this.state.showAllLines) &&\n              <div>\n              {!this.isLineNumberFirst() && <Button size=\"sm\" onClick={this.handleLineFocusPrev}>Previous Line</Button>}\n              {!this.isLineNumberLast() && <Button size=\"sm\" onClick={this.handleLineFocusNext}>Next Line</Button>}\n              </div>\n            }\n            <div>\n\n            {this.props.lineFocusId && <Button size=\"sm\" onClick={this.handleToggleAllLines}>Toggle All/Focus Lines</Button>}\n            {(this.state.annotations) && <Button size=\"sm\" onClick={this.handleToggleTextLines}>Toggle Show Text Lines</Button>}\n            </div>\n            <ImageLogo imageurl={this.state.imageurl}/>\n          </div>\n          {displayImages()}\n        </div> : <p>No surface selected</p>}\n      </Container>\n\n    );\n  }\n\n}\nSurface2.defaultProps = {\n  annotationsDisplay: true\n};\nexport default Surface2;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Axios from 'axios'\nimport { Light as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { docco } from 'react-syntax-highlighter/dist/cjs/styles/hljs';\n/**\n* XML view show component\n**/\nclass XmlView extends React.Component {\n\n  constructor(props){\n    super(props)\n    this.mount = false\n    this.retrieveXML = this.retrieveXML.bind(this)\n    this.state = {\n      xmlstring: \"\"\n    }\n  }\n  retrieveXML(tresourceid){\n    const xmlurl = \"https://exist.scta.info/exist/apps/scta-app/document/\" + tresourceid.split(\"/resource/\")[1]\n    Axios.get(xmlurl).then((d) => {\n      if (this.mount){\n        this.setState({xmlstring: d.data})\n      }\n    })\n\n  }\n  componentDidMount(){\n    this.mount = true\n    //condition to make sure tresourceid is defined before trying to parse and retrieve\n    // though this should never since tresourceid is a required prop\n    if (this.props.tresourceid){\n      this.retrieveXML(this.props.tresourceid)\n    }\n\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.tresourceid !== prevProps.tresourceid){\n      this.retrieveXML(this.props.tresourceid)\n    }\n  }\n  componentWillUnmount(){\n    this.mount = false\n  }\n\n  render(){\n    return (\n      <div className={this.props.hidden ? \"hidden\" : \"showing\"}>\n      <SyntaxHighlighter language=\"xml\" style={docco} showLineNumbers>\n        {this.state.xmlstring}\n      </SyntaxHighlighter>\n      </div>\n    )\n  }\n}\n\nXmlView.propTypes = {\n  /**\n  * transcription resource id of transcription for desired xml view\n  *\n  * TODO: Component is currently splitting the id and constructing the xml based\n  * on a prior knowledge of where xml is; this really should be retrieved from the resource id\n  * but the xml look up should happen outside of the XmlView Component in order to keep this component simple\n  * and making only request directly to the xml file\n  */\n  tresourceid: PropTypes.string.isRequired,\n  /**\n  * hidden designates whether the component should be hidden after mounting\n  */\n  hidden: PropTypes.bool,\n}\nexport default XmlView;\n","import React from 'react';\nimport Nav from 'react-bootstrap/Nav';\n\nimport {FaRegWindowRestore, FaRegWindowMaximize, FaRegWindowMinimize, FaRegWindowClose, FaClone} from 'react-icons/fa';\n// reimport these if you want to use the change window location functions: FaAngleDoubleDown, FaAngleDoubleLeft,\n\nfunction WindowNavBar(props) {\n  const displayTabs = () => {\n    const tabs = props.availableTabs && props.availableTabs.map((t, idx) => {\n      if (t.show){\n        return (\n          <Nav.Item key={\"tab-\" + t.name}>\n            <Nav.Link active={props.windowLoad === t.name} title={t.desc} onClick={() => {props.handleTabChange(t.name, props.windowId)}}>{t.icon}</Nav.Link>\n          </Nav.Item>\n        )\n      }\n      else{\n        return null\n      }\n    })\n    return tabs\n  }\n  return (\n  <Nav variant=\"tabs\">\n    {displayTabs()}\n  \n\n  {props.openWidthHeight !== \"minimum\" &&\n  <Nav.Item>\n    <Nav.Link title=\"Minimize Window\" onClick={() => {props.handleMinimize(props.windowId)}}><FaRegWindowMinimize/></Nav.Link>\n  </Nav.Item>}\n  {props.openWidthHeight !== \"middle\" &&\n  <Nav.Item>\n    <Nav.Link title=\"Half Size Window\" onClick={() => {props.handleMiddlize(props.windowId)}}><FaRegWindowRestore/></Nav.Link>\n  </Nav.Item>\n  }\n  {props.openWidthHeight !== \"maximum\" &&\n  <Nav.Item>\n    <Nav.Link title=\"Maximize Window\" onClick={() => {props.handleMaximize(props.windowId)}}><FaRegWindowMaximize/></Nav.Link>\n  </Nav.Item>\n  }\n  {props.windowId !== \"window1\"\n  &&\n  <Nav.Item>\n    <Nav.Link title=\"Close Window\" onClick={() => {props.handleClose(props.windowId)}}><FaRegWindowClose/></Nav.Link>\n  </Nav.Item>\n  }\n  {/* commented to prevent window moving; this insures window 1 is always side window and window 2 is bottom window\n    uncomment if this behavior is desired\n    <Nav.Item>\n    <Nav.Link title=\"Move Window\" onClick={() => {props.handleSwitchWindow(props.windowId, props.windowType)}}>{props.windowType === \"sideWindow\" ? <FaAngleDoubleDown/> : <FaAngleDoubleLeft/>}</Nav.Link>\n  </Nav.Item>\n  */\n  }\n  <Nav.Item>\n    {!props.altWindowState && <Nav.Link title=\"Clone Window\" onClick={() => {props.handleDuplicateWindow(props.windowId, props.windowType)}}>{<FaClone/>}</Nav.Link>}\n  </Nav.Item>\n\n\n</Nav>\n\n  );\n}\n\nexport default WindowNavBar;\n","import React, {useState} from 'react';\nimport FormControl from 'react-bootstrap/FormControl';\nimport { FaAngleLeft, FaAngleRight, FaAngleUp} from 'react-icons/fa';\nimport Nav from 'react-bootstrap/Nav';\n\nfunction NextPrevBar(props) {\n  const [customResourceTarget, setCustomResourceTarget] = useState(\"\")\n  const [showCustomResourceTarget, setShowCustomResourceTarget] = useState(false)\n  const handleUpArrow = () => {\n    if (props.selectionRange && props.selectionRange.wordRange){\n      props.handleBlockFocusChange(props.info.resourceid)\n    }\n    else{\n      props.handleBlockFocusChange(props.info.parent)\n    }\n  }\n  const getTitle = () => {\n    if (props.selectionRange && props.selectionRange.wordRange){\n      return props.info.title + \"@\" + props.selectionRange.wordRange.start + \"-\" + props.selectionRange.wordRange.end\n    }\n    else{\n      return props.info.title\n    }\n  }\n  const handelOnEnterPress = (e) => {\n    if (e.charCode === 13) {\n      let target = e.target.value\n      if (target.includes(\"https://scta.info/resource/\")){\n        target = target.replace(\"https://scta.info/resource/\", \"http://scta.info/resource/\")\n      }\n      else if (target.includes(\"sctar:\")){\n        target = target.replace(\"sctar:\", \"http://scta.info/resource/\")\n      }\n      else if (target.includes(\"http://scta.info/resource/\")){\n\n      }\n      else(\n        target = \"http://scta.info/resource/\" + target\n      )\n      props.handleFocusChange(target)\n      setCustomResourceTarget(\"\")\n      //setShowCustomResourceTarget(false)\n    }\n  }\n  const displayNextPrevBar = () => {\n    if (props.info){\n      return (\n        <Nav variant=\"tabs\">\n        <Nav.Link onClick={() => {props.handleBlockFocusChange(props.info.resourceid)}}>{getTitle()}</Nav.Link>\n        <Nav.Item>\n          {(props.info.previous && props.info.previous !== \"http://scta.info/resource/\")  && <Nav.Link title=\"Move Up to Previous Sibling Resource\" onClick={() => {props.handleBlockFocusChange(props.info.previous)}}><FaAngleLeft/></Nav.Link>}\n        </Nav.Item>\n        <Nav.Item>\n          {(props.info.next && props.info.next !== \"http://scta.info/resource/\") && <Nav.Link title=\"Move Up to Next Sibling Resource\" onClick={() => {props.handleBlockFocusChange(props.info.next)}}><FaAngleRight/></Nav.Link>}\n        </Nav.Item>\n        <Nav.Item>\n          {(props.info.resourceid !== props.info.topLevel) && (props.info.parent !== \"http://scta.info/resource/\") \n          && <Nav.Link title=\"Move Up to Parent Resource\" onClick={handleUpArrow}><FaAngleUp/></Nav.Link>}\n        </Nav.Item>\n        {showCustomResourceTarget ? \n          <div style={{display: 'flex', justifyContent: \"space-between\", width: \"100%\"}}>\n            <Nav.Item><Nav.Link><span onClick={() => {setShowCustomResourceTarget(false)}}><FaAngleUp/></span></Nav.Link></Nav.Item>\n            <FormControl style={{width: \"90%\"}} type=\"text\" value={customResourceTarget} placeholder=\"supply scta resource id\" className=\"mr-sm-2\" onKeyPress={((e) => {handelOnEnterPress(e)})} onChange={(e) => {setCustomResourceTarget(e.target.value)}}/>\n          </div>\n          :\n          <Nav.Item onClick={() => {setShowCustomResourceTarget(true)}}><Nav.Link>Go to: <FaAngleRight/></Nav.Link></Nav.Item>\n        }\n        </Nav>\n        \n      )\n    }\n    else{\n      return null\n    }\n  }\n  return (\n    displayNextPrevBar()\n  );\n}\n\nexport default NextPrevBar;\n","import React from 'react';\nimport Diff from 'diff-match-patch'\nimport Axios from 'axios'\nimport PropTypes from 'prop-types';\n\nimport { getHtmlDiff } from 'ngram-diff';\nimport Spinner from './Spinner';\nimport {Link} from 'react-router-dom';\nimport { FaEyeSlash, FaEdit, FaEye, FaStar, FaToggleOn, FaToggleOff, FaRegImage} from 'react-icons/fa';\n\n\nimport {textReduce, goToGitHubEdit} from './utils'\n\n//import Surface3Wrapper from './Surface3Wrapper'\nimport {Surface3Wrapper} from \"@jeffreycwitt/lbp2.surface3wrapper\"\n\nclass TextCompareItem extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleToggleShow = this.handleToggleShow.bind(this)\n    this.handleToggleCompare = this.handleToggleCompare.bind(this)\n    this.mounted = \"\"\n    this.state = {\n      showCompare: true,\n      showCompareType: \"ngram\", //could also be editDistance\n      compareText: \"\",\n      rawText: \"\",\n      show: true,\n      levenshteinDistance: undefined, \n      usedBase: undefined,\n      usedCompareTranscription: undefined,\n      showImage: false\n    }\n  }\n  handleToggleShow(){\n    this.setState((prevState) => {\n      return{\n        show: !prevState.show\n      }\n    })\n  }\n  handleToggleCompare(){\n    this.setState((prevState) => {\n      return{\n        showCompare: !prevState.showCompare\n      }\n    })\n  }\n  // TODO: should be replaced by function in utils.js file\n  textClean(text){\n    // remove most punctuation\n    let punctuationless = text.replace(/[.,/#!$%^&*;:{}=\\-_`~()/\\u00B6/|/\\u204B/]/g,\"\");\n    //convert v->u, ae->e, oe-e>\n    punctuationless = punctuationless.replace(/v/g, \"u\");\n    punctuationless = punctuationless.replace(/ae/g, \"e\");\n    punctuationless = punctuationless.replace(/oe/g, \"e\");\n    punctuationless = punctuationless.replace(/oe/g, \"e\");\n    punctuationless = punctuationless.replace(/y/g, \"i\");\n    //remove space\n    punctuationless = punctuationless.replace(/\\s{2,}/g,\" \");\n    //lowercase\n    const finalFinalString = punctuationless.toLowerCase()\n    return finalFinalString\n\n  }\n\n  \n  createCompare(base, transcription){\n    Axios.get(\"https://exist.scta.info/exist/apps/scta-app/csv-pct.xq?resourceid=\" + transcription)\n          .then((text) => {\n            let reducedText = text.data;\n            if (this.props.isMainText && this.props.targetRange){\n              reducedText = textReduce(text.data, this.props.targetRange)\n            }\n            // this conditional should exclude most relations (or relations initated by a structureElement type)\n            else if (this.props.relationLabel === 'isQuotedBy' || this.props.relationLabel === 'isReferencedBy'){\n              reducedText = text.data\n            }\n            else if (this.props.isRelatedToRange){\n              reducedText = textReduce(text.data, this.props.isRelatedToRange)\n            }\n            //function needed for word level comparison\n            //see https://github.com/google/diff-match-patch/wiki/Line-or-Word-Diffs\n            // also required for of npm google-diff-patch and then added function wordsToChars_()\n            \n            // eslint disable to avoid error when not using this function\n            // eslint-disable-next-line\n            const diff_wordMode = (text1, text2, dmp) => {\n              //var dmp = new Diff.diff_match_patch();\n              var a = dmp.diff_wordsToChars_(text1, text2);\n              var lineText1 = a.chars1;\n              var lineText2 = a.chars2;\n              var lineArray = a.lineArray;\n              var diffs = dmp.diff_main(lineText1, lineText2, false);\n              dmp.diff_charsToLines_(diffs, lineArray);\n              return diffs;\n            }\n\n            const dmp = new Diff.diff_match_patch();\n\n            //NOTE: uncomment below if you want to switch back to character level diff\n              const diff = dmp.diff_main(this.textClean(base), this.textClean(reducedText)); //character level diff\n              //const diff = diff_wordMode(this.textClean(base), this.textClean(reducedText), dmp) // word level diff\n            // Result: [(-1, \"Hell\"), (1, \"G\"), (0, \"o\"), (1, \"odbye\"), (0, \" World.\")]\n            dmp.diff_cleanupSemantic(diff);\n            const levenshteinDistance = dmp.diff_levenshtein(diff)\n            //const ds = dmp.diff_prettyHtml(diff);\n\n            \n            const compareDisplayHtml = (this.state.showCompareType === \"ngram\") ? getHtmlDiff(base, reducedText).compare : dmp.diff_prettyHtml(diff)\n            if (this.mounted === true && base){\n              // TODO: setting showCompare to \"derivedState\" is an ANTI-PATTERN. Better would be to let it be entirely controlled by parent. \n              // NOTE: usedBase and usedCompare transcription are used to record data used to make compare \n              // so that componentDidUpdate can efficiently decide if a new comparison is or is not needed\n              this.setState({compareText: compareDisplayHtml, rawText: reducedText, levenshteinDistance: levenshteinDistance, showCompare: this.props.showCompare,\n                showCompareType: this.props.showCompareType, usedBase: this.props.base, usedCompareTranscription: this.props.compareTranscription})\n            }\n            else if(this.mounted){\n              // TODO: setting showCompare to \"derivedState\" is an ANTI-PATTERN. Better would be to let it be entirely controlled by parent.\n              // NOTE: usedBase and usedCompare transcription are used to record data used to make compare \n              // so that componentDidUpdate can efficiently decide if a new comparison is or is not needed\n              this.setState({rawText: reducedText, showCompare: this.props.showCompare, \n                usedBase: this.props.base, usedCompareTranscription: this.props.compareTranscription})\n            }\n          }).catch((error) => {\n            console.log(\"text request/comparison error\", error)\n          })\n        }\n\n  componentDidMount(){\n    this.mounted = true;\n    // TODO: setting showCompare to \"derivedState\" is an ANTI-PATTERN. Better would be to let it be entirely controlled by parent.\n    this.setState({rawText: \"\", compareText: \"\", showCompare: this.props.showCompare, showCompareType: this.props.showCompareType, showImage: this.props.showImages})  \n    //conditional attempts to restrict async call to only those components who are intended to be visible at mount\n    // NOTE: this conditional will important when scaling. (i.e. when there hundres of references and hundreds of transcriptons)\n    if (this.props.show){\n      this.createCompare(this.props.base, this.props.compareTranscription)\n    }\n  }\n\n  componentDidUpdate(prevProps){\n    // NOTE: conditional attempts to restrict async call to only those components who are intended to be visible \n    // and for whom a previous comparison has not been made or needs to be changed.\n    // need for generation of new comparison is detected by comparing props base and props compare transcription \n    //to base/compare transcription used in previous comparison (or lack there of)\n    // NOTE: this conditional will important when scaling. (i.e. when there are hundreds of references and hundreds of transcriptions)\n    if (this.props.show && \n      (\n        // NOTE: check to see if the current props base/compareTranscription is different than one the last base/compareTranscription when comparison was ran. \n        // If it is different, then re-run compare. If not, don't run because the comparison has already been made.\n        (this.props.base !== this.state.usedBase || this.props.compareTranscription !== this.state.usedCompareTranscription))\n      )\n      {\n        this.createCompare(this.props.base, this.props.compareTranscription)\n      }\n      //NOTE: setting state from props here is an anti pattern\n      //view either needs to be controlled by props or state, but not both\n      if (this.props.showImages !== prevProps.showImages){\n        this.setState({showImage: this.props.showImages})\n      }\n\n  }\n\n\n\n  componentWillUnmount(){\n      this.mounted = false;\n    }\n\n\n  render(){\n    \n\n    const displayImage = () => {\n      const newManifestations = [{\n        manifestation: this.props.manifestation,\n        manifestationTitle: this.props.manifestationTitle,\n        transcription: \"\"\n      }]\n      return (\n            <div>\n              <span onClick={() => {this.setState((prevState)=> {return({showImage: !prevState.showImage})})}}><FaRegImage/></span> \n              {this.state.showImage &&\n                <div>\n                  <Surface3Wrapper\n                  manifestations={newManifestations}\n                  focusedManifestation={this.props.manifestation}\n                  width={parseInt(this.props.surfaceWidth)}\n                  hideSelectionList={true}\n                  isDependentSurface3={true}\n                  startWord={(this.props.isMainText && this.props.targetRange) && parseInt(this.props.targetRange.split(\"-\")[0])}\n                  endWord={(this.props.isMainText && this.props.targetRange) && parseInt(this.props.targetRange.split(\"-\")[1])}\n                  />\n                </div>\n                }\n            </div>\n      )\n\n    }\n\n    const displayComparison = () => {\n      const isBase = this.props.base === this.state.rawText\n      if (this.state.showCompare && this.props.base && this.state.compareText){\n        const levenNum = this.state.levenshteinDistance\n        const heatColor = levenNum * 5\n        return (\n          <div style={{borderLeft: \"5px solid rgba(\" + heatColor + \", 0, 255, 1)\", paddingLeft: \"5px\"}}>\n            <span><Link to={\"/text?resourceid=\" + this.props.compareTranscription + ((this.props.relationLabel !== \"isQuotedBy\" && this.props.relationLabel !== \"isReferencedBy\" && this.props.isRelatedToRange) ? \"@\" + this.props.isRelatedToRange : \"\")}>{this.props.manifestationTitle}</Link> </span>\n            <span> | </span>\n            <span className=\"lbp-span-link\" title=\"show/hide\" onClick={() => this.handleToggleShow()}>{this.state.show ? <FaEyeSlash/> : <FaEye/>}</span>\n            <span> | </span>\n            <span className=\"lbp-span-link\" title=\"toggle comparison off\" onClick={() => this.handleToggleCompare()}><FaToggleOn/></span>\n            {!isBase && <span> | </span>}\n            {!isBase && <span className=\"lbp-span-link\" title=\"set as base\" onClick={() => this.props.handleChangeBase(this.state.rawText)}><FaStar/></span>}\n            {this.props.compareTranscriptionDoc && <span> | </span>}\n            {this.props.compareTranscriptionDoc && <span className=\"lbp-span-link\" title=\"edit on github\" onClick={() => {goToGitHubEdit(this.props.compareTranscriptionDoc.split(\"#\")[0], \"\", this.props.compareTranscriptionDoc.split(\"#\")[1]) }}><FaEdit/></span>}\n            <span> | </span>\n            <span style={{fontSize: \"14px\", paddingLeft: \"4px\"}} title=\"levenshtein distance\">{levenNum}</span>\n            <div className={this.state.show ? \"unhidden\" : \"hidden\"}>\n              <div ref=\"text\" dangerouslySetInnerHTML={{ __html: this.state.compareText}}></div>\n              {displayImage()}\n\n            </div>\n          </div>\n        )\n      }\n      else if (this.state.rawText){\n        \n        return (\n          <div>\n            <span><Link to={\"/text?resourceid=\" + this.props.compareTranscription + ((this.props.relationLabel !== \"isQuotedBy\" && this.props.relationLabel !== \"isReferencedBy\" && this.props.isRelatedToRange) ? \"@\" + this.props.isRelatedToRange : \"\")}>{this.props.manifestationTitle}</Link></span> |\n            <span> | </span>\n            <span className=\"lbp-span-link\" title=\"show/hide\" onClick={() => this.handleToggleShow()}>{this.state.show ? <FaEyeSlash/> : <FaEye/>}</span>\n            <span> | </span>\n            <span className=\"lbp-span-link\" title=\"toggle comparison on\" onClick={() => this.handleToggleCompare()}><FaToggleOff/></span>\n            {!isBase && <span> | </span>}\n            {!isBase && <span className=\"lbp-span-link\" title=\"set as base\" onClick={() => this.props.handleChangeBase(this.state.rawText)}><FaStar/></span>}\n            {this.props.compareTranscriptionDoc && <span> | </span>}\n            {this.props.compareTranscriptionDoc && <span className=\"lbp-span-link\" title=\"edit on github\" onClick={() => {goToGitHubEdit(this.props.compareTranscriptionDoc.split(\"#\")[0], \"\", this.props.compareTranscriptionDoc.split(\"#\")[1]) }}><FaEdit/></span>}\n            <div className={this.state.show ? \"unhidden\" : \"hidden\"}>\n              <div ref=\"text\" dangerouslySetInnerHTML={{ __html: this.state.rawText}}></div>\n              {displayImage()}\n            </div>\n          </div>\n        )\n      }\n      else{\n        return <Spinner/>\n      }\n    }\n\n    return (\n      displayComparison()\n    );\n  }\n}\n\nTextCompareItem.propTypes = {\n  /**\n  * text comparison component\n  **/\n  base: PropTypes.string, // base text to perform comparison against\n  compareTranscription: PropTypes.string, // transcription id of text to be used in comparison against base text\n  handleChangeBase: PropTypes.func, // function to trigger base text change\n  show: PropTypes.bool, // boolean to state whether text should be shown. TODO: currently competing with derivedState \"show\", needs to be resolved\n  showCompare: PropTypes.bool //boolean to state whether should be shown with comparison markup. TODO: currently competing with derivedState \"showCompare\" needs to be resolved\n}\n\nexport default TextCompareItem;\n","import React from 'react';\nimport {Link} from 'react-router-dom';\nimport { FaEyeSlash, FaEye, FaTable } from 'react-icons/fa';\n\nimport {runQuery} from './utils'\nimport {basicInfoQuery} from './Queries'\nimport TextCompareItem from './TextCompareItem'\n\nclass TextCompare extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleToggleShowAll = this.handleToggleShowAll.bind(this)\n    this.handleToggleShowAllImages = this.handleToggleShowAllImages.bind(this)\n    this.mounted = \"\"\n    this.state = {\n      info: \"\",\n      show: false,\n      showImages: false,\n      baseText: \"\"\n    }\n  }\n\n  handleToggleShowAll(){\n    this.setState((prevState) => {\n      return{\n        show: !prevState.show\n      }\n    })\n  }\n  handleToggleShowAllImages(){\n    this.setState((prevState) => {\n      return{\n        showImages: !prevState.showImages\n      }\n    })\n  }\n\n  // TODO dupblicate of function in Text Component\n  // needs refactoring\n  arrangeTextInfo(info, resourceid){\n    info.then((d) => {\n      const bindings = d.data.results.bindings[0]\n      const manifestations = d.data.results.bindings.map((b) => {\n        return {\n          manifestation: b.manifestation.value,\n          manifestationTitle: b.manifestationTitle.value,\n          transcription: b.manifestationCTranscription ? b.manifestationCTranscription.value : \"\",\n          transcriptionDoc: b.manifestationCTranscriptionDoc?.value\n        }\n      })\n      if (this.mounted === true && bindings){\n        this.setState({\n          info: {\n            resourceid: resourceid,\n            title: bindings.title.value,\n            structureType: bindings.structureType.value,\n            inbox: bindings.inbox.value,\n            next: bindings.next ? bindings.next.value : \"\",\n            previous: bindings.previous ? bindings.previous.value : \"\",\n            cdoc: bindings.cdoc ? bindings.cdoc.value : \"\",\n            cxml: bindings.cxml ? bindings.cxml.value : \"\",\n            topLevel: bindings.topLevelExpression.value,\n            cmanifestation: bindings.cmanifestation ? bindings.cmanifestation.value : \"\",\n            ctranscription: bindings.ctranscription ? bindings.ctranscription.value : \"\",\n            manifestations: manifestations\n          }\n        });\n      }\n    });\n  }\n  getTextInfo(id){\n    const info = runQuery(basicInfoQuery(id))\n    this.arrangeTextInfo(info, id)\n  }\n  componentDidMount(){\n    this.mounted = true;\n    //TODO: setting \"derivative state\" here is an anti-pattern\n    //instead this should probably be controlled by parent \n    //(handleToggleShowAll should probably change parent which would then pass down the required prop rather than setting prop to state)\n    this.setState({show: this.props.show})\n    this.setState({showImages: this.props.showImages})\n    //NOTE: this conditional, does set prop to state, but there is a reason. \n    // the point is that the information has already been achieved, thus we save one async call by using props. \n    // otherwise an async request is called.\n    // I think the \"derivate state is acceptable in this case\"\n    if (this.props.isMainText){\n      this.setState({info: this.props.info})\n    }\n    else{\n      this.getTextInfo(this.props.expressionid)\n    }\n  }\n  componentDidUpdate(prevProps){\n    // conditional try to restrict new async calls to only when props.info changes\n    if ((this.props.info.resourceid !== prevProps.info.resourceid) || (this.props.info.relatedExpressions !== prevProps.info.relatedExpressions)){\n      if (this.props.isMainText){\n        this.setState({info: this.props.info})\n      }\n      else{\n        this.getTextInfo(this.props.expressionid)\n      }\n    }\n    //NOTE: setting state from props here is an anti pattern; \n    //view either needs to be controlled by props or state, but not both\n    if (this.props.show !== prevProps.show){\n      this.handleToggleShowAll()\n    }\n    //NOTE: setting state from props here is an anti pattern\n    //view either needs to be controlled by props or state, but not both\n    if (this.props.showImages !== prevProps.showImages){\n      this.handleToggleShowAllImages()\n    }\n  }\n  componentWillUnmount(){\n    this.mounted = false;\n  }\n  render(){\n    const displayComparisons = () => {\n      // NOTE: this conditional here to stop attempt to display text manifestation texts at the collection level\n      // collection level is usually just too big to be useful. \n      if (this.props.isMainText && this.props.info.structureType === \"http://scta.info/resource/structureCollection\"){\n        return <p>Text too big to display; move down the text hierarchy to focus on a smaller section</p>\n      }\n      else if (this.state.info.manifestations){\n        const texts = this.state.info.manifestations.map((m) => {\n          return (\n            <TextCompareItem\n            key={m.transcription}\n            base={this.props.baseText}\n            compareTranscription={m.transcription}\n            compareTranscriptionDoc={m.transcriptionDoc}\n            manifestationTitle={m.manifestationTitle}\n            manifestation={m.manifestation}\n            handleChangeBase={this.props.handleChangeBase}\n            show={this.state.show}\n            showCompare={this.props.isMainText ? true : true}\n            showCompareType={this.props.isMainText ? 'editDistance' : 'ngram'}\n            surfaceWidth={this.props.surfaceWidth}\n            isRelatedToRange={this.props.isRelatedToRange}\n            targetRange={this.props.targetRange}\n            isMainText={this.props.isMainText}\n            relationLabel={this.props.relationLabel}\n            showImages={this.state.showImages}\n            />\n          )\n        })\n        return texts\n      }\n    }\n  return (\n    <div style={{\"borderBottom\": \"1px solid rgba(0, 0, 0, 0.1)\", padding: \"5px\"}}>\n      {\n        // the link to reroute is not quite working, because the base Text is not resetting, focusBlockChange might be better; but item structure will also need to be changed.\n      }\n      \n      <div style={{fontSize: \"12px\"}}>\n        {this.props.isMainText && <span>[Target] </span>}\n        <span>{this.props.relationLabel}</span> \n        {(this.props.referringResource && this.props.referringResource !== this.props.info.resourceid) \n        && <span> (<Link to={\"/text?resourceid=\" + this.props.referringResource}>via</Link>)</span>}\n      </div>\n      <div>\n        {this.state.info.resourceid ?\n        <Link to={\"/text?resourceid=\" + this.state.info.resourceid + ((this.props.relationLabel !== \"isQuotedBy\" && this.props.relationLabel !== \"isReferencedBy\" && this.props.isRelatedToRange) ? \"@\" + this.props.isRelatedToRange : \"\")}>\n          {this.props.authorTitle || this.props.longTitle ? <span> {this.props.authorTitle} {this.props.longTitle}</span> : this.state.info.resourceid}\n        </Link> :\n        this.props.authorTitle || this.props.longTitle ? <span> {this.props.authorTitle} {this.props.longTitle}</span> : this.state.info.resourceid\n        }\n        <span> | </span>\n        {this.state.info.resourceid && <span className=\"lbp-span-link\" onClick={() => this.handleToggleShowAll()}>{this.state.show ? <FaEyeSlash/> : <FaEye/>}</span>}\n        <span> | </span>\n        {this.props.expressionid && <span className=\"lbp-span-link\" title=\"add to collation table\" onClick={this.props.isMainText ? this.props.handleShowCollationOverlay : () => \n        { \n          // this conditional checks checks if there is a wordRange and the target is active; if true then it adds the wordRange\n          // otherwise no WordRange is added\n          const fullEid = ((this.props.relationLabel !== \"isQuotedBy\" && this.props.relationLabel !== \"isReferencedBy\") && this.props.isRelatedToRange) ? this.props.expressionid + \"@\" + this.props.isRelatedToRange : this.props.expressionid\n          this.props.handleAddCtRelatedExpressions(fullEid)}}><FaTable/></span>\n        }\n        <span> | </span>\n        <a href={\"https://mirador.scta.info?blockid=\" + this.state.info.resourceid} target=\"_blank\" rel=\"noopener noreferrer\"><img alt=\"view in mirador\" style={{width: \"12px\", height: \"12px\"}} src=\"https://projectmirador.org/img/mirador-logo.svg\"></img></a>\n      </div>\n      <div className={this.state.show ? \"unhidden\" : \"hidden\"} style={{\"paddingLeft\": \"10px\"}}>\n        {displayComparisons()}\n      </div>\n    </div>\n    );\n  }\n}\nexport default TextCompare;\n","import Axios from 'axios'\n\nexport function ngramRelatedQuery(id, intersectionTotal = 4){\n  // const query = [\n  //   \"SELECT ?s ?start ?other ?text ?cosineScore \",\n  //     \"WHERE {\",\n  //       \"BIND (<\" + id + \"> as ?start) . \",\n  //       \"{\",\n  //       \"?s <http://www.w3.org/ns/oa#hasSource> ?start .\",\n  //       \"?s <http://www.w3.org/ns/oa#hasTarget> ?other .\",\n  //       \"?s <http://www.w3.org/ns/oa#hasBody> ?bn .\",\n  //       \"?bn <http://www.w3.org/1999/02/22-rdf-syntax-ns#value> ?text .\",\n  //       \"}\",\n  //       \"UNION\",\n  //       \"{\",\n  //       \"?s <http://www.w3.org/ns/oa#hasSource> ?other .\",\n  //       \"?s <http://www.w3.org/ns/oa#hasTarget> ?start . \",\n  //       \"?s <http://www.w3.org/ns/oa#hasBody> ?bn .\",\n  //       \"?bn <http://www.w3.org/1999/02/22-rdf-syntax-ns#value> ?text .\",\n  //       \"}\",\n  //       \"?s <http://scta.info/property/cosineScore> ?cosineScore .\" ,\n  //       \"FILTER (?cosineScore >= \" + cosineScoreLimit + \") \",\n  //     \"}\",\n  //     \"ORDER BY DESC(?cosineScore) \",\n  //     \"LIMIT 100\"].join(' ')\n\n\n    // const query = [\n    //   \"SELECT ?start ?target ?targetLongTitle ?cosineScore ?intersectionTotal ?cosineScoreIntersection ?targetItem ?author ?authorTitle \",\n    //     \"WHERE {\",\n    //       \"VALUES ?start { <\"  + id + \"> }\",\n    //       \"{\",\n    //       \"?start <http://scta.info/property/hasCosineSimilarity> ?bn . \",\n    //       \"?bn <http://scta.info/property/target> ?target . \",\n    //       \"?bn <http://scta.info/property/cosineScore> ?cosineScore . \",\n    //       \"?bn <http://scta.info/property/cosineScoreIntersection> ?cosineScoreIntersection . \",\n    //       \"?bn <http://scta.info/property/cosineScoreIntersectionOverBase> ?cosineScoreIntersectionOverBase . \",\n    //       \"?bn <http://scta.info/property/cosineScoreIntersectionOverCompare> ?cosineScoreIntersectionOverCompare . \",\n    //       \"?bn <http://scta.info/property/intersectionTotal> ?intersectionTotal . \",\n    //       \"FILTER (?cosineScore >= \" + cosineScoreFilter + \") .\",\n    //       //\"FILTER (?cosineScoreIntersection >= \" + cosineScoreFilter + \") \",\n    //       \"FILTER (?intersectionTotal >= \" + intersectionTotal + \") .\",\n    //       \"}\",\n    //       \"UNION\",\n    //       \"{\",\n    //       \"?target <http://scta.info/property/hasCosineSimilarity> ?bn . \",\n    //       \"?bn <http://scta.info/property/target> ?start . \",\n    //       \"?bn <http://scta.info/property/cosineScore> ?cosineScore . \",\n    //       \"?bn <http://scta.info/property/cosineScoreIntersection> ?cosineScoreIntersection . \",\n    //       \"?bn <http://scta.info/property/cosineScoreIntersectionOverBase> ?cosineScoreIntersectionOverBase . \",\n    //       \"?bn <http://scta.info/property/cosineScoreIntersectionOverCompare> ?cosineScoreIntersectionOverCompare . \",\n    //       \"?bn <http://scta.info/property/intersectionTotal> ?intersectionTotal . \",\n    //       \"FILTER (?cosineScore >= \" + cosineScoreFilter + \") .\",\n    //       //\"FILTER (?cosineScoreIntersection >= \" + cosineScoreFilter + \") \",\n    //       \"FILTER (?intersectionTotal >= \" + intersectionTotal + \") .\",\n    //       \"}\",\n    //       \"?target <http://scta.info/property/longTitle> ?targetLongTitle . \",\n    //       \"?target <http://scta.info/property/totalOrderNumber> ?targetTotalOrderNumber . \",\n    //       \"?target <http://scta.info/property/isPartOfStructureItem> ?targetItem . \",\n    //       \"?targetItem <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel . \",\n    //       \"?targetItem <http://scta.info/property/totalOrderNumber> ?targetItemTotalOrderNumber .\",\n    //       //expression && \"FILTER(?topLevel = <\" + expression + \">) . \",\n    //       //expression && \"?target <http://scta.info/property/isMemberOf> <\" + expression + \"> . \",\n    //       //expressionType && \"?target <http://scta.info/property/isMemberOf> ?member . ?member <http://scta.info/property/expressionType> <\" + expressionType + \"> .\",\n    //       //workGroup && \"<\" + workGroup + \"> <http://scta.info/property/hasExpression> ?topLevel  .\",\n    //       \"OPTIONAL{\",\n    //       \"?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author . \",\n    //       \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle . \",\n    //       \"}\",\n    //       \"}\",\n    //       \"ORDER BY DESC(?intersectionTotal) DESC(?cosineScore)\",\n    //       //\"ORDER BY ?authorTitle ?topLevel ?targetItemTotalOrderNumber ?targetTotalOrderNumber\"\n    //       //\"LIMIT 1000\",\n    //       //\"OFFSET 2000\"\n    //     ].join(' ')\n\n    const query = `SELECT (COUNT(*) as ?count) ?start ?target ?longTitle ?author ?authorTitle\n            WHERE {\n              VALUES ?start { <${id}> }\n              ?ngram <http://scta.info/property/isFoundIn> ?start .\n              ?ngram <http://scta.info/property/isFoundIn> ?target .\n              FILTER(?start != ?target) .\n              ?target <http://scta.info/property/longTitle> ?longTitle .\n              ?target <http://scta.info/property/isPartOfStructureItem> ?targetItem .\n              ?targetItem <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\n              OPTIONAL{\n              ?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\n              ?author <http://purl.org/dc/elements/1.1/title> ?authorTitle . \n                OPTIONAL{\n                ?author <http://scta.info/property/dateOfBirth> ?authorBirthDate .\n                }\n              }\n            }\n            GROUP BY ?start ?target ?longTitle ?targetItem ?topLevel ?author ?authorTitle ?authorBirthDate\n            HAVING (?count >= ${intersectionTotal})\n            ORDER BY ?authorTitle ?longTitle`\n\n return query\n}\n\nexport function ngramFragmentQuery(ngramIds, intersectionTotal = 4){\n  const query = `SELECT (COUNT(*) as ?count) ?target ?longTitle ?author ?authorTitle\n            WHERE {\n              VALUES ?ngram { ${ngramIds} }\n              ?ngram <http://scta.info/property/isFoundIn> ?target .\n              ?target <http://scta.info/property/longTitle> ?longTitle .\n              ?target <http://scta.info/property/isPartOfStructureItem> ?targetItem .\n              ?targetItem <http://scta.info/property/isPartOfTopLevelExpression> ?topLevel .\n              OPTIONAL{\n              ?topLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\n              ?author <http://purl.org/dc/elements/1.1/title> ?authorTitle . \n                OPTIONAL{\n                ?author <http://scta.info/property/dateOfBirth> ?authorBirthDate .\n                }\n              }\n            }\n            GROUP BY ?target ?longTitle ?targetItem ?topLevel ?author ?authorTitle ?authorBirthDate\n            HAVING (?count >= ${intersectionTotal})\n            ORDER BY ?authorTitle ?longTitle`\n return query\n}\n\nexport function runNgramQuery(query){\n  const sparqlEndpoint = \"https://ngram.scta.info/ds/query\"\n  const queryPromise = Axios.get(sparqlEndpoint, { params: { \"query\": query, \"output\": \"json\" } })\n  return queryPromise\n}","import React, {useState, useEffect} from 'react';\n\nimport {Link} from 'react-router-dom';\n\nimport TextCompare from './TextCompare'\nimport Spinner from './Spinner'\nimport {ngramRelatedQuery} from '../queries/ngramRelatedQuery'\nimport {ngramFragmentQuery} from '../queries/ngramRelatedQuery'\nimport {runNgramQuery} from '../queries/ngramRelatedQuery'\nimport {textClean} from './utils'\n\n/**\n * \n * A comment wrapper for submitting comments to local storage test\n * @public\n */\n\nconst createExpressionsList = (bindings) => {\n  const expressions = [];\n  bindings.forEach((r) => {\n    expressions.push({\n      id: r.target.value,\n      relationLabel: \"Ngram Intersections:\" + r.count.value,\n      referringResource: \"\",\n      author: r.author?.value,\n      authorTitle: r.authorTitle?.value,\n      longTitle: r.longTitle?.value,\n      show: false,\n      isRelatedToRange: \"\"\n    })\n  })\n  return expressions\n}\n\nfunction NgramDisplay(props) {\n  const [relatedExpressions, setRelatedExpressions] = useState([])\n  const [intersectionTotal, setIntersectionTotal] = useState(4)\n  useEffect(() => {\n    // if targetRange is presents forces query to wait until baseText is present\n    if (props.baseText && props.targetRange){\n      console.log(\"firing1\")\n      const tokenizedText = textClean(props.baseText).split(\" \");\n      const ngramArray = []  \n      console.log(\"baseText\", props.baseText)\n      console.log(\"tokenizedText\", tokenizedText)\n      // create a for loop the length of the number of words props.baseText\n      for (let i = 0; i < (tokenizedText.length - 3); i++){\n        const ngramId = `<http://scta.info/resource/ngram/${tokenizedText.slice(i, (i + 4)).join(\"\")}>`\n        ngramArray.push(ngramId)\n      }\n      const ngramRelated = runNgramQuery(ngramFragmentQuery(ngramArray.join(\" \"), intersectionTotal));\n      ngramRelated.then((d) => {\n        const bindings = d.data.results.bindings;\n        const expressions = createExpressionsList(bindings);\n        setRelatedExpressions(expressions)\n      })\n    }\n    // NOTE: prevents general query if a targetRange is present\n    // TODO: probably needs to be refactored; useEffect can probably be used better\n    else if (!props.targetRange){\n      const ngramRelated = runNgramQuery(ngramRelatedQuery(props.resourceid, intersectionTotal));\n      ngramRelated.then((d) => {\n        const bindings = d.data.results.bindings\n        const expressions = createExpressionsList(bindings);\n        setRelatedExpressions(expressions)\n      })\n    }\n  }, [props.resourceid, props.baseText, props.targetRange, intersectionTotal])\n  \n  const displayExpressions = () => {\n    const displayExpressions = relatedExpressions.map((i, index) => {\n      const marked = props.markedExpressions.find((e) => e.parentBlock === i.id)\n      return (\n      \n      <div key={index + \"-ngram-\" + i.id}>\n        {marked && <span style={{fontSize: \"12px\", paddingLeft: \"2px\", marginLeft: \"3px\", borderLeft: \"3px solid purple\"}}>Already Marked via <Link to={\"/text?resourceid=\" + marked.id}>{marked.id}</Link></span>}\n            {<TextCompare\n              info={props.info}\n              expressionid={i.id}\n              relationLabel={i.relationLabel}\n              referringResource={i.referringResource}\n              author={i.author}\n              authorTitle={i.authorTitle}\n              longTitle={i.longTitle}\n              isMainText={false}\n              handleChangeBase={props.handleChangeBase}\n              baseText={props.baseText}\n              show={i.show}\n              surfaceWidth={props.surfaceWidth}\n              isRelatedToRange={i.isRelatedToRange}\n              handleAddCtRelatedExpressions={props.handleAddCtRelatedExpressions}\n              handleShowCollationOverlay={props.handleShowCollationOverlay}\n            />}\n          </div>\n          )\n    })\n    return displayExpressions\n  }\n  return(\n    <div>\n      <hr/>\n      <p>\n        Potential Related Passages \n        <br/>\n        <span style={{\"fontSize\": '12px'}}>Ngram Intersection Threshold: {intersectionTotal}\n          (<span className='lbp-span-link' title=\"increase intersection threshold\" onClick={() => setIntersectionTotal(intersectionTotal + 1)}> + </span>\n          {intersectionTotal > 0 && <> | <span className='lbp-span-link' title=\"decrease intersection threshold\" onClick={() => setIntersectionTotal(intersectionTotal - 1)}> - </span></>})\n        </span> \n        </p>\n      \n      {/* <input type=\"text\" value={scoreMinimumInput} onChange={(e) => setScoreMinimumInput(e.target.value)}></input>\n      <button onClick={() => {setScoreMinimumUse(scoreMinimumInput)}}>Re-run Query with new minimum</button> */}\n      {relatedExpressions === \"retrieving\" ? <Spinner/> : displayExpressions()}\n    </div>\n  )\n}\nexport default NgramDisplay;","import React from 'react';\nimport Axios from 'axios'\nimport Container from 'react-bootstrap/Container';\nimport Form from 'react-bootstrap/Form';\nimport FormControl from 'react-bootstrap/FormControl';\nimport Button from 'react-bootstrap/Button';\nimport TextCompare from './TextCompare'\nimport NgramDisplay from './NgramDisplay'\n\nimport { runQuery } from './utils'\nimport { getRelatedExpressions } from './Queries'\nimport {textReduce} from './utils'\n\nclass TextCompareWrapper extends React.Component {\n  constructor(props) {\n    super(props)\n    this.handleToggleCompare = this.handleToggleCompare.bind(this)\n    this.handleChangeBase = this.handleChangeBase.bind(this)\n    this.handleCustomUpdateRelatedExpressions = this.handleCustomUpdateRelatedExpressions.bind(this)\n    this.handleSetCustomExpressionId = this.handleSetCustomExpressionId.bind(this)\n    this.handleToggleAllChildren = this.handleToggleAllChildren.bind(this)\n    this.handleToggleAllChildrenImages = this.handleToggleAllChildrenImages.bind(this)\n    this.getText = this.getText.bind(this)\n    this.mounted = \"\"\n    this.state = {\n      expressions: [],\n      expressionsCumulative: [],\n      page: 1,\n      intendedPage: 1,\n      pagesize: 10,\n      nextPage: 2,\n      previousPage: undefined,\n      offset: 0,\n      rangeStart: 1,\n      rangeEnd: 20,\n      baseText: \"\",\n      customExpressionId: \"\",\n      customExpressionObject: {},\n      showAllChildren: false,\n      showAllChildrenImages: false\n    }\n\n  }\n  handleToggleAllChildren(){\n    this.setState((prevState) => {\n      return{\n        showAllChildren: !prevState.showAllChildren\n      }\n    })\n  }\n  handleToggleAllChildrenImages(){\n    this.setState((prevState) => {\n      return{\n        showAllChildrenImages: !prevState.showAllChildrenImages\n      }\n    })\n  }\n  handleSetCustomExpressionId(customExpressionId) {\n    this.setState({ customExpressionId: customExpressionId })\n  }\n  handleCustomUpdateRelatedExpressions(e) {\n    e.preventDefault()\n    const expressionObject = {\n      resourceid: this.state.customExpressionId,\n      relationLabel: \"user added comparison\"\n    }\n    this.setState({ customExpressionObject: expressionObject })\n  }\n  handleChangeBase(rawText) {\n    this.setState({ baseText: rawText })\n  }\n  //TODO: Doesn't seem to be called; should be deleted\n  handleToggleCompare(expressionid) {\n    this.setState((prevState) => {\n      const newExpressions = { ...prevState.expressions }\n      newExpressions[expressionid].show = !newExpressions[expressionid].show\n      return {\n        expressions: newExpressions\n      }\n    })\n  }\n  getText(ctranscription) {\n    const _this = this;\n    Axios.get(\"https://exist.scta.info/exist/apps/scta-app/csv-pct.xq?resourceid=\" + ctranscription)\n      .then((text) => {\n        if (this.mounted) {\n          let reducedText = text.data;\n            if (this.props.selectionRange.wordRange){\n              const wordRange = _this.props.selectionRange.wordRange.start + \"-\" + _this.props.selectionRange.wordRange.end\n              reducedText = textReduce(text.data, wordRange)\n            }\n          _this.setState({ baseText: reducedText })\n        }\n      })\n  }\n  /**\n   * @description initiates sparql requests and parses initial results.\n   * @param {string} resourceid - scta url for expression object\n   * @param {integer} page - page to start on in paging results\n   * @param {integer} pagesize - length of page results\n   */\n  getRelatedExpressions(resourceid, page, pagesize) {\n    const offset = (page - 1) * pagesize\n    const rangeStart = (this.props.selectionRange && this.props.selectionRange.wordRange) ? this.props.selectionRange.wordRange.start : \"\" ;\n    const rangeEnd = (this.props.selectionRange && this.props.selectionRange.wordRange) ? this.props.selectionRange.wordRange.end : \"\";\n    const relatedExpressions = runQuery(getRelatedExpressions(resourceid, offset, pagesize, rangeStart, rangeEnd))\n    \n    relatedExpressions.then((d) => {\n      console.log(\"result from query for related expressions\", d)\n      const bindings2 = d.data.results.bindings\n      const expressions = []\n      // if target resource is NOT structureCollect, \n      // then add first object which should be compare item for first/target resource\n      \n        expressions.push({\n          id: this.props.info.resourceid,\n          authorTitle: this.props.info.authorTitle,\n          longTitle: this.props.info.longTitle,\n          show: false\n        });\n      //arrange sparql results into an object with resourceids as keys\n      bindings2.forEach((r) => {\n        expressions.push({\n          id: r.isRelatedTo.value,\n          relationLabel: r.label.value,\n          referringResource: r.element ? r.element.value : \"\",\n          author: r.author ? r.author.value : \"\",\n          authorTitle: r.authorTitle ? r.authorTitle.value : \"\",\n          longTitle: r.longTitle ? r.longTitle.value : \"\",\n          show: false,\n          isRelatedToRange: r.isRelatedToRangeStart && r.isRelatedToRangeEnd ? r.isRelatedToRangeStart.value + '-' + r.isRelatedToRangeEnd.value : \"\",\n          parentBlock: r.parentBlock ? r.parentBlock.value : \"\",\n\n        })\n      })\n      // set state with new related expressions results and updates to paging information\n      if (this.mounted) {\n      this.setState((prevState) => {\n        return {\n          expressions: expressions,\n          // expressionCumulative is dangerous, because the array will continue to fill up everytime paging is changed \n          // even the page contents have already been added\n          expressionsCumulative: prevState.expressionsCumulative.concat(expressions),\n          intendedPage: page,\n          nextPage: page + 1,\n          previousPage: page > 1 ? page - 1 : undefined,\n          offset: (page - 1) * pagesize,\n          rangeStart: ((page - 1) * pagesize) + 1,\n          rangeEnd: pagesize * page\n        }\n      })\n      }\n    })\n  }\n  componentDidMount() {\n    this.mounted = true\n    if (this.props.info) {\n      this.getRelatedExpressions(this.props.info.resourceid, this.state.page, this.state.pagesize)\n      if (this.props.info.structureType !== \"http://scta.info/resource/structureCollection\"){\n        this.getText(this.props.info.ctranscription)\n      }\n    }\n  }\n  componentDidUpdate(prevProps, prevState) {\n    // if resource id changes or results paging, then perform new query\n    if (prevProps.info.resourceid !== this.props.info.resourceid || prevState.page !== this.state.page || prevProps.selectionRange !== this.props.selectionRange) {\n      const startPage = prevProps.info.resourceid !== this.props.info.resourceid ? 1 : this.state.page\n      this.getRelatedExpressions(this.props.info.resourceid, startPage, this.state.pagesize)\n      if (this.props.info.structureType !== \"http://scta.info/resource/structureCollection\"){\n        this.getText(this.props.info.ctranscription)\n      }\n    }\n    // if a custom object has been added; add custom object to state.expressions\n    if (prevState.customExpressionObject !== this.state.customExpressionObject) {\n      const r = this.state.customExpressionObject\n      const newExpression = {\n        id: r.resourceid,\n        relationLabel: r.relationLabel,\n      }\n      this.setState((prevState) => {\n        return {\n          expressions: [ ...prevState.expressions, newExpression ]\n        }\n      })\n    }\n  }\n  componentWillUnmount() {\n    this.mounted = false\n  }\n  render() {\n    const displayExpressions = () => {\n      \n      const expressions = this.state.expressions.map((i, index) => {\n        const isMainText = this.props.info.resourceid === i.id ? true : false\n        return (\n          <div key={index + \"-\" + i.id}>\n            {<TextCompare\n              info={this.props.info}\n              expressionid={i.id}\n              relationLabel={i.relationLabel}\n              referringResource={i.referringResource}\n              author={i.author}\n              authorTitle={i.authorTitle}\n              longTitle={i.longTitle}\n              isMainText={isMainText}\n              handleChangeBase={this.handleChangeBase}\n              baseText={this.state.baseText}\n              show={this.state.showAllChildren ? true : i.show}\n              showImages={this.state.showAllChildrenImages ? true : i.show}\n              surfaceWidth={this.props.surfaceWidth}\n              isRelatedToRange={i.isRelatedToRange}\n              targetRange={(this.props.selectionRange && this.props.selectionRange.wordRange) ? this.props.selectionRange.wordRange.start + \"-\" + this.props.selectionRange.wordRange.end : \"\"}\n              handleAddCtRelatedExpressions={this.props.handleAddCtRelatedExpressions}\n              handleShowCollationOverlay={this.props.handleShowCollationOverlay}\n            />}\n          </div>\n        )\n      })\n      return expressions\n    }\n    const displayPagination = () => {\n      return (\n        <div>\n        {\n          (Object.keys(this.state.expressions).length > this.state.pagesize || this.state.rangeEnd > this.state.pagesize) &&\n        <p className=\"small\">\n          {this.state.previousPage &&\n            <span>\n              <span className=\"lbp-span-link\" onClick={() => this.setState({ page: this.state.previousPage })}>Previous {this.state.previousPage}</span>  \n              <span> | </span>\n            </span>\n              }\n          <span>Current Page: </span>\n          <FormControl style={{width: \"40px\", display: \"inline\"}} inline=\"true\" size=\"sm\" id=\"text\" type=\"text\" onChange={(e) => this.setState({ intendedPage: e.target.value })} value={this.state.intendedPage}></FormControl>\n          <Button style={{display: \"inline\"}}inline=\"true\" size=\"sm\" onClick={(e) => this.setState({ page: parseInt(this.state.intendedPage) })}>Go</Button>\n          \n          <span>({this.state.rangeStart} - {this.state.rangeEnd})</span>\n          {Object.keys(this.state.expressions).length > this.state.pagesize && \n            <span>\n              <span> | </span> \n              <span className=\"lbp-span-link\" onClick={() => this.setState({ page: this.state.nextPage })}>Next: {this.state.nextPage}</span>\n            </span>\n          }\n        </p>\n          }\n        </div>\n      )\n    }\n\n    return (\n      <Container className={this.props.hidden ? \"hidden\" : \"showing\"}>\n        <h4>Text Comparisons</h4>\n        {displayPagination()}\n        <p className=\"small\"><a href=\"https://lombardpress.org/adfontes/\" target=\"_blank\" rel=\"noopener noreferrer\">Advanced Index and Filtering</a></p>\n        <p className=\"small lbp-span-link\" onClick={this.handleToggleAllChildren}>Toggle All Children</p>\n        {this.state.showAllChildren && <p className=\"small lbp-span-link\" onClick={this.handleToggleAllChildrenImages}>Toggle All Children Images</p>}\n        <hr />\n        {displayExpressions()}\n        <hr />\n        {displayPagination()}\n        <div style={{ \"borderBottom\": \"1px solid rgba(0, 0, 0, 0.1)\", padding: \"5px\" }}>\n          <p style={{ fontSize: \"12px\" }}>Create custom user compare</p>\n          <Form onSubmit={this.handleCustomUpdateRelatedExpressions} inline=\"true\" >\n            <FormControl inline=\"true\" size=\"sm\" id=\"text\" type=\"text\" value={this.state.customExpressionId} placeholder=\"expression id\" className=\"mr-sm-2\" onChange={(e) => { this.handleSetCustomExpressionId(e.target.value) }} />\n            <Button inline=\"true\" size=\"sm\" type=\"submit\" style={{ margin: \"2px\" }}>Submit</Button>\n          </Form>\n        </div>\n\n        <hr />\n        <div>\n          <p>Other Comparison/Connection Visualizations</p>\n          <p><a target=\"_blank\" rel=\"noopener noreferrer\" href={\"http://lombardpress.org/collation-vizualizer/index.html?id=\" + this.props.info.resourceid}>Collation Overlay</a></p>\n          {/* <p><span className=\"lbp-span-link\" onClick={this.props.handleShowCollationOverlay}>Collation Table Overlay</span></p> */}\n          <p><a target=\"_blank\" rel=\"noopener noreferrer\" href={\"https://scta.github.io/networks-explorer/?resourceid=\" + this.props.info.resourceid}>View Reference Connections</a></p>\n          <p><a target=\"_blank\" rel=\"noopener noreferrer\" href={\"https://scta.github.io/networks-explorer/topicconnections.html?resourceid=\" + this.props.info.resourceid}>View Topic Connections</a></p>\n        </div>\n        <div>\n        <NgramDisplay info={this.props.info}\n          handleChangeBase={this.handleChangeBase}\n          baseText={this.state.baseText}\n          surfaceWidth={this.props.surfaceWidth}\n          resourceid={this.props.info.resourceid}\n          markedExpressions={this.state.expressionsCumulative}\n          handleAddCtRelatedExpressions={this.props.handleAddCtRelatedExpressions}\n          handleShowCollationOverlay={this.props.handleShowCollationOverlay}\n          targetRange={(this.props.selectionRange && this.props.selectionRange.wordRange) ? this.props.selectionRange.wordRange.start + \"-\" + this.props.selectionRange.wordRange.end : \"\"}\n          />\n        </div>\n\n        \n        \n      </Container>\n\n    );\n  }\n}\n\nexport default TextCompareWrapper;\n","import React, {useState, useEffect} from 'react';\nimport {Link} from 'react-router-dom';\nimport Axios from 'axios'\nimport {runQuery} from './utils';\nimport Container from 'react-bootstrap/Container';\n\nimport {getPersonInfo, getPersonMentionedByFrequency, getPersonMentionsFrequency} from '../queries/personInfoQuery';\n\n\nfunction PersonInfo(props) {\n  const [authorTitle, setAuthorTitle] = useState()\n  const [authorImageUrl, setAuthorImageUrl] = useState()\n  const [authorDescription, setAuthorDescription] = useState()\n  const [birthDate, setAuthorBirthDate] = useState()\n  const [deathDate, setAuthorDeathDate] = useState()\n  const [mentionedByFrequency, setMentionedByFrequency] = useState([])\n  const [mentionsFrequency, setMentionsFrequency] = useState([])\n  useEffect(() => {\n      setMentionedByFrequency([]);\n      setMentionsFrequency([]);\n      setAuthorImageUrl(\"\");\n      setAuthorDescription(\"\");\n      setAuthorBirthDate(\"\");\n      setAuthorDeathDate(\"\");\n      setAuthorTitle(\"\");\n\n\n      const personInfo = runQuery(getPersonInfo(props.resourceid))\n      personInfo.then((pd) => {\n        const bindings = pd.data.results.bindings\n        if (bindings.length > 0){\n          const personTitle = bindings[0].authorTitle && bindings[0].authorTitle.value;\n          const wikidataid = bindings[0].wikidataid && bindings[0].wikidataid.value;\n          setAuthorTitle(personTitle)\n          wikidataid && getWikiDataInfo(wikidataid)\n        }\n      })\n      const mentionedByfreq = runQuery(getPersonMentionedByFrequency(props.resourceid))\n      mentionedByfreq.then((fd) => {\n        const bindings = fd.data.results.bindings\n        //TODO; this conditional is extremely hacking; window component is passing not person id at the same time that is passing personView=true\n        // this needs to be corrected, but the conditions is checking for null results when using the wrong id\n        if (bindings.length > 0 && bindings[0].count.value !== \"0\"){\n          \n          // sort by name\n          bindings.sort(sortFrequencyResults);\n          const results = bindings.map((item) => {\n            \n            return (\n              <p key={item.author.value}>\n                <Link to={\"/text?resourceid=\" + item.author.value}>{item.authorTitle.value}</Link>:\n                 {item.count.value}\n                 </p>\n            )\n          })\n          setMentionedByFrequency(results);\n          \n        }\n        })\n      \n      \n\n      const mentionsFreq = runQuery(getPersonMentionsFrequency(props.resourceid))\n      mentionsFreq.then((fd) => {\n        const bindings = fd.data.results.bindings\n        //TODO; this conditional is extremely hacking; window component is passing not person id at the same time that is passing personView=true\n        // this needs to be corrected, but the conditions is checking for null results when using the wrong id\n        if (bindings.length > 0 && bindings[0].count.value !== \"0\"){\n        // sort by name\n        bindings.sort(sortFrequencyResults);\n        const results = bindings.map((item, idx) => {\n          \n          return (\n            <p key={idx + \"-\" + item.author.value}>\n              <Link to={\"/text?resourceid=\" + item.author.value}>{item.authorTitle.value}</Link>: \n              {item.count.value}\n              </p>\n          )\n        })\n        setMentionsFrequency(results);\n      }\n      })\n    }, [props.resourceid]);\n\n  const sortFrequencyResults = (a, b) => {\n      //order by author name\n       const nameA = a.authorTitle.value.toUpperCase(); // ignore upper and lowercase\n       const nameB = b.authorTitle.value.toUpperCase(); // ignore upper and lowercase\n      // order by frequency \n      //const nameA = parseInt(a.count.value); // ignore upper and lowercase\n      //const nameB = parseInt(b.count.value); // ignore upper and lowercase\n      if (nameA < nameB) {\n        return -1; //switch to 1 to reverse order\n      }\n      if (nameA > nameB) {\n        return 1; //switch to -1 to reverse order\n      }\n      // names must be equal\n      return 0;\n    }\n  const getWikiDataInfo = (wikidataid) => {\n    const wikidataShortId = wikidataid.split(\"/entity/\")[1];\n    Axios.get(\"https://www.wikidata.org/w/api.php?origin=*&action=wbgetentities&ids=\" + wikidataShortId + \"&format=json\").then((wd)=> {\n        const imageslug = wd.data.entities[wikidataShortId].claims.P18 && wd.data.entities[wikidataShortId].claims.P18[0].mainsnak.datavalue.value;\n        const description = wd.data.entities[wikidataShortId].descriptions[\"en\"] && wd.data.entities[wikidataShortId].descriptions[\"en\"].value;\n        const birthDate = wd.data.entities[wikidataShortId].claims.P569 && wd.data.entities[wikidataShortId].claims.P569[0].mainsnak.datavalue.value.time;\n        const deathDate = wd.data.entities[wikidataShortId].claims.P570 && wd.data.entities[wikidataShortId].claims.P570[0].mainsnak.datavalue.value.time;\n        Axios.get(\"https://commons.wikimedia.org/w/api.php?origin=*&action=query&prop=imageinfo&iiprop=url&redirects&format=json&titles=File:\" + imageslug).then((d3) => {\n          const pages = d3.data.query.pages\n          const page = Object.keys(pages)[0];\n          const imageurl = d3.data.query.pages[page].imageinfo && d3.data.query.pages[page].imageinfo[0].url\n          \n        setAuthorImageUrl(imageurl)\n        setAuthorDescription(description)\n        //setAuthorBirthDate(new Date(birthDate.split('+')[1]).toDateString())\n        //setAuthorDeathDate(new Date(deathDate.split('+')[1]).toDateString())\n        setAuthorBirthDate(parseInt(birthDate));\n        setAuthorDeathDate(parseInt(deathDate));\n        })\n        \n        \n      });\n\n  }\n  return (\n    <div className={props.hidden ? \"hidden\" : \"showing\"}>\n      <Container>\n    <h1>PersonInfo for {authorTitle} {birthDate && \"(\" + birthDate + \"-\" + deathDate + \")\"}</h1>\n    <div style={{display: \"flex\", justifyContent: \"left\"}}>\n    { authorImageUrl && <img alt=\"author\" src={authorImageUrl} width=\"100px\"/>}\n    <p style={{marginLeft: \"10px\"}}>{authorDescription} {authorDescription && \"(wikidata)\"}</p>\n    </div>\n    <div>\n      <h1>Discussed/Mentioned By Frequency</h1>\n        {mentionedByFrequency}\n    </div>\n    <div>\n      <h1>Discusses/Mentions Frequency</h1>\n        {mentionsFrequency}\n    </div>\n    </Container>\n\n    </div>\n  );\n}\n\nexport default PersonInfo;","export function getPersonInfo(resourceid){\n  const query = [\n    \"SELECT ?author ?authorTitle ?wikidataid\",\n    \"{\",\n        \"BIND(<\" + resourceid + \"> AS ?author) .\",\n        \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\" ,\n        \"OPTIONAL {\",\n          \"?author <http://www.w3.org/2002/07/owl#sameAs> ?wikidataid .\",\n          \"FILTER(regex(str(?wikidataid), 'http://www.wikidata.org' ))\",\n        \"}\",\n     \"}\",\n    \"ORDER BY ?authorTitle\"].join(' ')\n return query\n}\n\nexport function getPersonMentionedByFrequency(personid){\n\n      var query = [\n        \"select ?personTitle ?author ?authorTitle (count(?ref) as ?count)\" ,\n        \"where {\",\n\n        \"?ref <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementName> .\",\n\t\t\t  \"?ref <http://scta.info/property/isInstanceOf> <\" + personid + \"> .\",\n        \"<\" + personid + \"> <http://purl.org/dc/elements/1.1/title> ?personTitle .\",\n        \"?ref <http://scta.info/property/isPartOfTopLevelExpression> ?refTopLevel .\",\n        \"?refTopLevel <http://www.loc.gov/loc.terms/relators/AUT> ?author .\",\n        \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n        \"}\",\n        \"GROUP BY ?author ?authorTitle ?personTitle\"\n      ].join('');\n\n    \n    return query;\n}\n\nexport function getPersonMentionsFrequency(personid){\n\n  \n\n  var query = [\n    \"select ?author ?authorTitle (count(?ref) as ?count)\",\n    \"where {\",\n      \"?sourceTopLevel <http://www.loc.gov/loc.terms/relators/AUT> <\" + personid + \"> .\",\n      \"?sourceTopLevel <http://scta.info/property/level> '1' .\",\n      \"?ref <http://scta.info/property/isPartOfTopLevelExpression> ?sourceTopLevel .\",\n      \"?ref <http://scta.info/property/structureElementType> <http://scta.info/resource/structureElementName> .\",\n      \"?ref <http://scta.info/property/isInstanceOf> ?author .\",\n      \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n    \"}\",\n    \"GROUP BY ?author ?authorTitle\",\n  ].join('');\nreturn query;\n}","import React, {useState} from 'react';\nimport FormControl from 'react-bootstrap/FormControl';\n\nfunction Comments2TagSuggestions(props) {\n  const [tagFilter, setTagFilter] = useState(\"\")\n\n  const handleOnClickTag = (t) => {\n    setTagFilter(\"\")\n    props.handleOnClickTag(t)\n  }\n  const displayTagSuggestions = (tags) => {\n    const possibleTags = Object.keys(tags).map((t) => {\n      if (tagFilter === \"?\"){\n        return (<span onClick={(() => handleOnClickTag(t))} key={\"tsuggest-\" + t}>{t}</span>)\n      }\n      else if (t.toLowerCase().includes(tagFilter.toLowerCase())){\n        return (<span onClick={(() => handleOnClickTag(t))} key={\"tsuggest-\" + t}>{t}</span>)\n      }\n      else {\n        return null\n      }\n    })\n    return possibleTags\n  }\n  const handelOnEnterPress = (e) => {\n    if (e.charCode === 13) {\n      props.handleOnClickTag(e.target.value)\n      setTagFilter(\"\")\n    }\n  }\n  return(\n    <div>\n          <FormControl size=\"sm\" type=\"text\" value={tagFilter} placeholder={props.placeHolderText} className=\"mr-sm-2\" onChange={(e) => {setTagFilter(e.target.value)}} onKeyPress={((e) => {handelOnEnterPress(e)})}/>\n          {tagFilter && <div className=\"tagSuggestionList\">{displayTagSuggestions(props.tagsList)}</div>}\n        </div>\n  )\n}\n  export default Comments2TagSuggestions;","import React, {useState, useEffect} from 'react';\nimport FormControl from 'react-bootstrap/FormControl';\nimport Button from 'react-bootstrap/Button';\nimport {useTranslation} from 'react-i18next'\nimport {FaEdit, FaComment} from 'react-icons/fa';\n\nimport Comments2TagSuggestions from './Comments2TagSuggestions'\n\nfunction Comment2Create(props) {\n  const {t} = useTranslation();\n  const [comment, setComment] = useState(props.comment);\n  const [motivation, setMotivation] = useState(props.motivation || \"commenting\") // \"commenting\" vs \"editing\"; default \"commenting\"\n  const editedTextDefault = props.selectionRange && props.selectionRange.text ? props.selectionRange.text : \"\"\n  const [editedText, setEditedText] = useState((props.selectionRange && props.selectionRange.textEdited) ? props.selectionRange.textEdited : editedTextDefault);\n  const [noTarget, setNoTarget] = useState(props.noTarget || false); // if noTarget is set to true, annotation is made without a target\n  const [orderNumber] = useState(props.orderNumber);\n  const [inputTags, setInputTags] = useState(props.tagsList || []);\n  \n  \n  const handleOnClickTag = (t) => {\n    if (!inputTags.includes(t)){\n      setInputTags([...inputTags, t])\n    }\n  }\n  const handleDropTag = (t) => {\n    const newInputTags = inputTags.filter((ot) => {\n      if (ot.split(\":\")[0] !== t.split(\":\")[0]){\n        return ot\n      }\n      else{\n        return null\n      }\n    })\n    setInputTags(newInputTags)\n\n  }\n  const handleCommentUpdate = (e) => {\n    e.preventDefault()\n    const commentType = motivation;\n    props.submitComment(comment, commentType, editedText, props.selectionRange, orderNumber, noTarget, inputTags)\n    setComment('')\n  }\n  useEffect(() => {\n    const editedTextDefault = props.selectionRange && props.selectionRange.text ? props.selectionRange.text : \"\"\n    setEditedText((props.selectionRange && props.selectionRange.textEdited) ? props.selectionRange.textEdited : editedTextDefault)\n  }, [props.selectionRange])\n  useEffect(() => {\n    if (motivation === \"commenting\"){\n      setEditedText(props.selectionRange ? props.selectionRange.text : \"\")\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [motivation])\n\n  const wordRange = (props.selectionRange && props.selectionRange.wordRange) ? props.selectionRange.wordRange.start + \"-\" + props.selectionRange.wordRange.end : \"\"\n\n  return (\n      <div>\n      {motivation === \"editing\" && \n      <div>\n        <span>Suggest Edit for : \n          <i>{props.selectionRange.text} </i> \n          <span className=\"lbp-span-link\" title=\"leave simple comment on text\" onClick={()=>{setMotivation(\"commenting\")}}> <FaComment/> </span>\n          <span> ({wordRange}) </span>\n        </span> \n        <FormControl as=\"textarea\" type=\"text\" id=\"editedText\" rows=\"3\" \n        value={editedText} placeholder={t(\"comment\")} className=\"mr-sm-2\" onChange={(e) => {setEditedText(e.target.value)}}/>\n      </div>\n      }\n        <div>\n        {(props.selectionRange && props.selectionRange.text) &&\n        <div>\n        {motivation === \"editing\" ? \n        <span>Leave comment on edit</span> \n        : \n        <span>\n          Comment on: \n          <i>{props.selectionRange.text} </i> \n          <span className=\"lbp-span-link\" title=\"edit text\" onClick={()=>{setMotivation(\"editing\")}}> <FaEdit/> </span>\n          <span> ({wordRange}) </span>\n        </span>\n        }\n        </div>\n        }\n        \n        <span>Has Target: <input type=\"checkbox\" inline=\"true\" label=\"has target\" checked={!noTarget} onChange={(e) => {setNoTarget(!noTarget)}} style={{display: \"inline\"}}/></span>\n        <FormControl as=\"textarea\" type=\"text\" id=\"comment\" rows=\"3\" value={comment} placeholder={t(\"comment\")} className=\"mr-sm-2\" onChange={(e) => {setComment(e.target.value)}}/>\n        {inputTags && <span>Selected Tags: {\n          \n          inputTags.map((t) => {\n            return (<span key={\"tag-\"+ t}><span onClick={() => {handleDropTag(t)}}>X</span><span>{t}</span></span>)\n          })\n        }\n        </span>\n        }\n        <Comments2TagSuggestions tagsList={props.availableTagsList} handleOnClickTag={handleOnClickTag} placeHolderText=\"add tags (e.g beauty, faith:1, faith:2); type ? to see in-use tags\"/>\n\n      </div>\n      <Button size=\"sm\"  type=\"submit\" onClick={handleCommentUpdate} block style={{margin: \"2px\"}}>{t(\"Submit\")}</Button>\n   </div>\n  );\n}\n\nexport default Comment2Create;\n","import React, {useState} from 'react';\nimport {Link} from 'react-router-dom';\nimport {FaTrash, FaEdit, FaClipboard} from 'react-icons/fa';\nimport Comment2Create from './Comment2Create.js'\nimport {useTranslation} from 'react-i18next'\nimport {copyToClipboard} from './utils'\n\nfunction Comment2Item(props) {\n  const {t} = useTranslation();\n  const [editable, setEditable] = useState(false);\n  \n  const submitUpdate = (update, motivation, editedText, selectionRange, orderNumber, noTarget, inputTags) => {\n    props.updateComment(props.comment.id, update, editedText, motivation, selectionRange, orderNumber, noTarget, inputTags)\n    setEditable(false)\n  }\n  const addSCTALinksToValue = (value) => {\n    // conversion template source: http://talkerscode.com/webtricks/convert-url-text-into-clickable-html-links-using-javascript.php \n    const link = value.match(/(\\b(https?|ftp|file):\\/\\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/ig)\n    if (link){\n      const firstString = value.split(link[0])[0]\n      let strings = [firstString]\n      link.forEach((l, i) => {\n        const linkComponent = <Link key={l} to={\"/res?resourceid=\" + l}>{l}</Link> \n        const linkCopy = <span key={\"s-\" + l} className=\"lbp-span-link\" title=\"Copy Resource Url Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(l)}}><FaClipboard /></span>\n        strings.push(linkComponent)\n        strings.push(linkCopy)\n        const afterString = value.split(l)[1]\n        const prunedString = afterString.split(link[i+1])[0]\n        strings.push(prunedString)\n      })\n      return strings\n    }\n    else{\n      return value\n    }\n  }\n  \n  \n  let target =  typeof(props.comment.target) === 'string' ? props.comment.target : props.comment.target.source;\n  \n\n  let selectedFragment = undefined;\n  let selectedFragmentRange = undefined;\n  if (props.comment.target.selector){\n    selectedFragment = props.comment.target.selector.filter((i) => (i.type === \"TextQuoteSelector\"))[0].exact;\n    selectedFragmentRange = props.comment.target.selector.filter((i) => (i.type === \"TextPositionSelector\"))[0];\n    //selectedCharacterRange = props.comment.target.selector.filter((i) => (i.type === \"TextPositionSelector\"))[0];\n    target = selectedFragmentRange.start ? target + \"@\" + selectedFragmentRange.start + \"-\" + selectedFragmentRange.end : target;\n\n  }\n  \n  const selectionRange = {\n    text: selectedFragment, \n    textEdited: props.comment.body.editedValue,\n    wordRange: selectedFragmentRange\n  }\n\n  const getTagsWithOrderNumbers = (annoid, tags) => {\n    const tagsWithOrder = []\n    if (Object.keys(props.tagsList).length > 0){\n      tags && Object.keys(tags).forEach((t) => {\n      const orderNumber = getTagOrderNumber(annoid, t)\n      const fullTag = orderNumber ? t + \":\" + orderNumber : t\n      tagsWithOrder.push(fullTag)\n    })\n    }\n    return tagsWithOrder // should return array\n  }\n  const getTagOrderNumber = (annoid, t) => {\n    const annoShortId = annoid.replace(\"http://inbox.scta.info/notifications/\", \"sctan:\")\n    if (props.tagsList[t] && props.tagsList[t][annoShortId] && props.tagsList[t][annoShortId].order) {\n      return props.tagsList[t][annoShortId].order\n    }\n    else{\n      return null\n    }\n  }\n  const displayTags = (tags) => {\n    if (Object.keys(props.tagsList).length > 0){\n    const displayTags = tags && Object.keys(tags).map((t) => {\n      const orderNumber = getTagOrderNumber(props.comment.id, t)\n      return (<span key={\"tag-\" + t} className=\"lbp-span-link\" onClick={() => props.setTagFilter(t)}>{t} {orderNumber && <span>({orderNumber})</span>} </span>)\n    })\n    return displayTags\n    }\n    else{\n      return null\n    }\n  }\n  \n  return (\n      <div>\n        {/* {!props.focused && <p>{t(\"For\")}: <Link to={\"/text?resourceid=\" + target}>{target}</Link></p>} */}\n        {/* <span className=\"lbp-span-link\" onClick={() => props.handleOnClickComment(target.split(\"/resource/\")[1], selectedFragment, props.comment.body.editedValue, selectedFragmentRange, selectedCharacterRange)}>{target} {selectedFragmentRange && <span> ({selectedFragmentRange.start}-{selectedFragmentRange.end})</span>}</span> */}\n        \n        <p>{t(\"For\")}: <Link to={\"/text?resourceid=\" + target}>{target}</Link></p>\n        {\n          editable ?\n          <Comment2Create submitComment={submitUpdate} \n          comment={props.comment.body.value} \n          selectionRange={selectionRange} \n          motivation={props.comment.motivation}\n          noTarget={props.comment.target ? false : true}\n          orderNumber={props.orderNumber}\n          tagsList={getTagsWithOrderNumbers(props.comment.id, props.comment.tags)}\n          availableTagsList={props.tagsList}\n          /> :\n          <p>\n          {\n          //<span dangerouslySetInnerHTML={{ __html: addSCTALinksToValue(props.comment.body.value)}}/>\n          }\n          {selectedFragment && <span>Comment on: <i>{selectedFragment}</i></span>}\n          <br/>\n          {props.comment.motivation === \"editing\" && <span>Suggested Correction: {props.comment.body.editedValue}<br/></span>}\n          \n          <span>{addSCTALinksToValue(props.comment.body.value)}</span>\n          <br/>\n          <span>Tags: {displayTags(props.comment.tags)}</span>\n          <br/>\n          <span>Submitted: </span> {props.comment.created && props.comment.created.split(\"T\")[0]} | \n          <span className=\"lbp-span-link\" onClick={() => {props.removeComment(props.comment.id)}}><FaTrash/> </span> | \n          <span className=\"lbp-span-link\" onClick={() => setEditable(true)}> <FaEdit/></span>\n          </p>\n        }\n        <hr/>\n      </div>\n    );\n}\n\nexport default Comment2Item;\n","import React, {useState} from 'react'\nimport Axios from 'axios'\nimport {FaDownload, FaCloudDownloadAlt, FaUpload} from 'react-icons/fa';\n\nconst ImportExport = (props) =>{\n  //const [newListName, setNewListName] = useState('');\n  const [newListUrl, setNewListUrl] = useState('');\n  const [showImport, setShowImport] = useState(false);\n  const [pdfStatus, setPdfStatus] = useState(null)\n\n  const handleGetPdfStatus = () => {\n    const printApiEndpoint = \"https://print.lombardpress.org/api/v1/\"\n    //const printApiEndpoint = \"http://localhost:5000/api/v1/\"\n\n    Axios.post(printApiEndpoint + \"annolist\", props.currentList).then((data) => {\n      if (data.data.url){\n        console.log(\"first condition passed\", data.data.url)\n        const hashWithExtension = data.data.url\n        //setPdfStatus({pdf: \"https://print.lombardpress.org/api/v1/\" + hashWithExtension})\n        setPdfStatus({pdf: printApiEndpoint + \"cache/\" + hashWithExtension})\n      }\n      else{\n        setPdfStatus({status: data.data.Status + \"Please check back in a few minutes\", pdf: \"\"})\n      }\n    })\n\n\n  }\n\n\n  const handleFileImport = (e) => {\n    var reader = new FileReader();\n\n    reader.readAsText(e.target.files[0]);\n    const fileName = e.target.files[0].name\n    // define callback function; aka actions to be peerformed after file is read\n    reader.onload = function(e) {\n      var list = reader.result;\n      \n      props.handleImportList(JSON.parse(list), fileName)\n    }\n\n\n  }\n  const handleUrlImport = (e) => {\n    e.preventDefault()\n    Axios.get(newListUrl).then((d) => {\n      console.log(\"data\", d)\n      props.handleImportList(d.data, newListUrl)\n    })\n\n\n  }\n  // const createNewList = (e) => {\n  //   e.preventDefault();\n  //   //NOTE: first argument needs to be string that will be parsed in the parent component, in this case to an array\n  //   props.handleImportList([], newListName)\n  //   setNewListName('')\n  // }\n  const packageData = () =>\n   {\n    const data = JSON.stringify(props.currentList, null, 2);\n    const dataLink = \"data:application/json;charset=utf-8,\" + encodeURI(data)\n    return dataLink\n  }\n  const downloadTitle = () =>\n   {\n    const title = props.currentListName.split('.json')[0] + \"-\" + new Date().toISOString().slice(0, 10)\n    return title\n  }\n\n  const displayPdfStatus = () => {\n    if (!pdfStatus){\n      return (\n        <p><span className=\"lbp-span-link\" onClick={handleGetPdfStatus}>Generate Pdf Text From List</span> </p>\n      )\n    }\n    else if (pdfStatus.pdf){\n      return (\n      <p><a href={pdfStatus.pdf} rel=\"noopener noreferrer\">View PDF</a></p>\n      )\n    }\n    else{\n      return (\n      <div>\n        <p><span>{pdfStatus.status}</span></p>\n        <p><span className=\"lbp-span-link\" onClick={handleGetPdfStatus}>Click here to update status</span> </p>\n      </div>)\n    }\n  }\n\n  return (\n    <div>\n      <span className=\"lbp-span-link\" onClick={() => setShowImport(!showImport)}>Import <FaUpload/></span> \n      {showImport &&\n        <div>\n          <span className=\"lbp-span-link\"><FaUpload/> Load from local file</span> \n          <br/>\n          <input type=\"file\" id=\"files\" name=\"files[]\" onChange={handleFileImport}/>\n          <br/>\n          <span className=\"lbp-span-link\"><FaCloudDownloadAlt/> Load from Cloud</span>\n          <form onSubmit={handleUrlImport}><input type=\"text\" value={newListUrl} onChange={(e) => {setNewListUrl(e.target.value)}}></input><input type=\"submit\"/></form>\n          \n          {/* <span className=\"lbp-span-link\"><FaPlusCircle/> Create New List</span> \n          <form onSubmit={createNewList}><input type=\"text\" value={newListName} onChange={(e) => {setNewListName(e.target.value)}}></input><input type=\"submit\"/></form> */}\n        </div>\n      } \n      <br/> \n      <a href={packageData()} download={downloadTitle()}><span className=\"lbp-span-link\">Export <FaDownload/></span></a>\n      {displayPdfStatus()}\n      \n    </div>\n  );\n}\n\nexport default ImportExport","import * as firebase from 'firebase';\n\n\nconst config = {\n  apiKey: \"AIzaSyDYqsSNAdVzipni4Zj6H0lTxFQz_bTE3XE\",\n  authDomain: \"scta-65c18.firebaseapp.com\",\n  databaseURL: \"https://scta-65c18-default-rtdb.firebaseio.com\",\n  projectId: \"scta-65c18\",\n  storageBucket: \"scta-65c18.appspot.com\",\n  messagingSenderId: \"300565788198\",\n  appId: \"1:300565788198:web:fcce3fafc05706de0718e7\",\n  measurementId: \"G-WN007V665V\"\n};\nfirebase.initializeApp(config);\nconst db = firebase.database()\nconst googleAuthProvider = new firebase.auth.GoogleAuthProvider();\n\n// firebase.database().ref().set({\n//   name: \"Jeffrey C. Witt\"\n// });\n\nexport {firebase, googleAuthProvider, db}","import React, {useState, useEffect} from 'react';\nimport {Link} from 'react-router-dom';\nimport Container from 'react-bootstrap/Container';\nimport FormControl from 'react-bootstrap/FormControl';\nimport PropTypes from 'prop-types';\nimport Comment2Create from './Comment2Create.js'\nimport Comment2Item from './Comment2Item.js'\nimport Comments2ImportExport from './Comments2ImportExport'\nimport Comments2TagSuggestions from './Comments2TagSuggestions'\n\nimport uuidv4 from 'uuid/v4';\nimport Button from 'react-bootstrap/Button';\nimport {FaClipboard} from 'react-icons/fa';\nimport {useTranslation} from 'react-i18next'\nimport {copyToClipboard} from './utils'\nimport {db } from '../firebase/firebase'\nimport {camelCase} from './utils'\n\n\n/**\n * \n * A comment wrapper for submitting comments to local storage\n * \n */\n\nfunction Comments2(props) {\n  const {t} = useTranslation();\n  //const [lists, setLists] = useState(JSON.parse(localStorage.getItem(\"sctaCommentsState2\"))|| {\"local\": []})\n  const [lists, setLists] = useState({\"local\": []})\n  const [filterTags, setFilterTags] = useState([]); // tagFilter\n  const [annotations, setAnnotations] = useState({})\n  const [tags, setTags] = useState({})\n  const [showFocusComments, setShowFocusComments] = useState(true)\n  const [commentFilter, setCommentFilter] = useState(\"\")\n  const [mentionedBy, setMentionedBy] = useState([])\n  //const [showFilters, setShowFilters] = useState(false)\n  const [userId, setUserId] = useState(\"\")\n  const [tagsToDelete, setTagsToDelete] = useState([])\n  const [showManageTags, setShowManageTags] = useState(false)\n\n  \n  \n//retrieve annotations on mount\nuseEffect(()=>{\n  setUserId(props.userId)\n    if (props.userId && props.userId !== \"jeff\") {\n    db.ref(props.userId)\n      .once('value')\n      .then((snapshot) => {\n        const dbResult = snapshot.val()\n        if (dbResult) {\n          setAnnotations(dbResult.annotations || {})\n          setTags(dbResult.tags || {})\n        }\n        else {\n          setAnnotations({})\n          setTags({})\n        }\n      })\n    }\n    }, [props.userId])\n\n\n  \n\n  const generateTagList = (inputTags, akey) => {\n    const tagsPerComment = inputTags.map((t) => {\n      return t.split(\":\")[0]\n    })\n    // loop through tags and create hash of tag to order, so that the tag order can be looked up\n    const tagsOrderMap = {}\n    inputTags.forEach((t) => {\n      const order = t.split(\":\")[1]\n      const tagid = t.split(\":\")[0]\n      tagsOrderMap[tagid] = order ? parseInt(order) : false\n    })\n\n     //const tagsBlock = {}\n     const tagsNewList = {...tags}\n    \n     tagsPerComment.forEach((t) => {\n       //tagsBlock[t] = true\n       // if the tag already exists\n       if (tagsNewList[t]){\n         // if this new entry has an order, then bump the order of all following annos\n         if (tagsOrderMap[t]){\n           //const renumberingCounter = tagsOrderMap[t]\n           Object.keys(tagsNewList[t]).forEach((nt) => {\n             if (tagsNewList[t][nt].order && tagsNewList[t][nt].order >= tagsOrderMap[t]){\n               tagsNewList[t][nt].order = tagsNewList[t][nt].order + 1\n             }\n           })\n         }\n         // then add new entry\n         tagsNewList[t][akey] = tagsOrderMap[t] ? {order: tagsOrderMap[t]} : true\n         \n       }\n       else{\n         tagsNewList[t] = {}\n         tagsNewList[t][akey] =  tagsOrderMap[t] ? {order: tagsOrderMap[t]} : true\n       }\n     })\n     return tagsNewList\n\n  }\n  \n  // \n  const generateAnnoTagBlock = (inputTags) => {\n    const tagsPerComment = inputTags.map((t) => {\n      return t.split(\":\")[0]\n    })\n    const tagsBlock = {}\n    tagsPerComment.forEach((t) => {\n      tagsBlock[t] = true\n    })\n    return tagsBlock\n  }\n\n  /**\n   * submit the comment\n   * \n   * @param {string} comment \n   * @public\n   */\n  const submitComment = (comment, motivation, editedText, selectionRange, orderNumber, noTarget, inputTags) => {\n    const randomid = uuidv4();\n    const annoId = \"http://inbox.scta.info/notifications/\" + randomid\n    const akey = prefixedId(annoId)\n    const dateObject = new Date();\n    const userId = \"http://scta.info/resource/jeffreycwitt\" //TODO; needs to adjust to user logged in info\n    \n    const tagsNewList = generateTagList(inputTags, akey)\n      \n    let start = \"\"\n    let end = \"\"\n\n    if (selectionRange && selectionRange.wordRange){\n      start = selectionRange.wordRange.start\n      end = selectionRange.wordRange.end\n    }\n      const selector = [\n      {\n        \"type\": \"TextQuoteSelector\",\n        \"exact\": selectionRange ? selectionRange.text : \"\"\n      },\n      {\n        \"type\": \"TextPositionSelector\",\n        \"start\": start,\n        \"end\": end\n      }\n    ]\n    const annotation = {\n      \"@context\": \"http://www.w3.org/ns/anno.jsonld\",\n      \"id\": annoId,\n      \"type\": \"Annotation\",\n      \"created\": dateObject.toISOString(),\n      \"creator\": userId,\n      \"motivation\": motivation,\n      \"tags\": generateAnnoTagBlock(inputTags),\n      \"body\": {\n        \"type\": \"TextualBody\",\n        \"value\": comment\n      },\n      \"target\": !noTarget && { // changing target to object rather than string will break retrieval\n        source: props.resourceid, \n        esource: \"http://scta.info/resource/\" + props.resourceid.split(\"/resource/\")[1].split(\"/\")[0],\n        selector: selector\n      }\n      \n    }\n    // conditionally add editedValue only if motivation is editing\n    if (motivation === \"editing\"){\n      annotation.body.editedValue = editedText;\n    }\n    else {\n      delete annotation.body[\"editedValue\"];\n    }\n    setCommentFilter('')\n    \n    const annotationsNewList = {...annotations}\n    annotationsNewList[akey] = annotation\n\n    setAnnotations(annotationsNewList)\n    setTags(tagsNewList)\n\n  }\n  const prefixedId = (id) => {\n    const prefixedId = \"sctan:\" + id.split(\"/notifications/\")[1]\n    return prefixedId\n  }\n  const handleRemoveTags = (tagsToRemove) => {\n    let clonedAnnotations = { ...annotations};\n    let clonedTags = { ...tags};\n    \n    const modifiedAnnos = []\n    // first remove all tags from affected annotations\n    tagsToRemove.forEach((t) => {\n      const annosToModify = Object.keys(clonedTags[t])\n      modifiedAnnos.push(annosToModify)\n      annosToModify.forEach((a)=> {\n        delete clonedAnnotations[a].tags[t]\n      })\n    // then delete tags\n      delete clonedTags[t]\n    })\n    alert(\"Are you sure you want to remove these tags; This will modify \" + modifiedAnnos.length + \"annotations\")\n    setTags(clonedTags)\n    setAnnotations(clonedAnnotations)\n\n  }\n  // const handleRemoveTagsAndTaggedComments = () => {\n\n  // }\n\n  const handleDropTagToDelete = (t) => {\n    const newTagsToDelete = tagsToDelete.filter((ot) => {\n      if (ot.split(\":\")[0] !== t.split(\":\")[0]){\n        return ot\n      }\n      else{\n        return null\n      }\n    })\n    setTagsToDelete(newTagsToDelete)\n\n  }\n  const handleOnClickTagToDelete = (t) => {\n    if (!tagsToDelete.includes(t)){\n    setTagsToDelete([...tagsToDelete, t])\n    }\n  }\n\n  const handleAddFilterTag = (t) => {\n    if (!filterTags.includes(t)){\n      setFilterTags([...filterTags, t])\n    }\n  }\n  const handleAddSingleFilterTag = (t) => {\n    setFilterTags([t])\n  }\n  const handleDropFilterTag = (t) => {\n    const newFilterTags = filterTags.filter((ot) => {\n      if (ot.split(\":\")[0] !== t.split(\":\")[0]){\n        return ot\n      }\n      else{\n        return null\n      }\n    })\n    setFilterTags(newFilterTags)\n\n  }\n\n  const removeComment = (id) => {\n    //filter current list\n    \n    let clonedAnnotations = { ...annotations};\n    \n    //get list of tags who members need to be updated\n    const affectedTags = Object.keys(clonedAnnotations[prefixedId(id)].tags)\n\n    delete clonedAnnotations[prefixedId(id)]\n    let clonedTags = { ...tags};\n    affectedTags.forEach((at) => {\n      delete clonedTags[at][prefixedId(id)]\n    })\n    \n    // replace current list value with filtered list\n    setAnnotations(clonedAnnotations)\n    setTags(clonedTags)\n  }\n  const updateComment = (id, update, editedText, motivation, selectionRange, orderNumber, noTarget, inputTags) => {\n    let clonedAnnotations = { ...annotations};\n    const targetComment = clonedAnnotations[prefixedId(id)]\n    targetComment.body.value = update\n    targetComment.body.editedValue = editedText\n    targetComment.motivation = motivation\n    //targetComment.orderNumber = orderNumber\n    targetComment.target = noTarget ? false : targetComment.target\n    targetComment.tags = generateAnnoTagBlock(inputTags)\n\n    const akey = prefixedId(id)\n    const tagsNewList = generateTagList(inputTags, akey)\n    \n    //const old_index = lists[comments].indexOf(targetComment);\n    \n    //reposition comment\n    //see https://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\n    //todo: this could/should be a utility function\n    // if (orderNumber >= lists[comments].length) {\n    //   var k = orderNumber - lists[comments].length + 1;\n    //   while (k--) {\n    //     lists[comments].push(undefined);\n    //   }\n    // }\n    \n    //lists[comments].splice(orderNumber, 0, lists[comments].splice(old_index, 1)[0]);\n    \n    setAnnotations(clonedAnnotations)\n    setTags(tagsNewList)\n  }\n  useEffect(() => {\n    setMentionedBy(getMentionedBy())\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.resourceid])\n  \n  const getMentionedBy = () => {\n    if (Object.keys(annotations).length > 0){\n      let mentionedBy = Object.keys(annotations).map((c) => {\n        if (annotations[c].body.value && annotations[c].body.value.includes(props.resourceid.split(\"/resource/\")[1].split(\"/\")[0])){\n          const target =  typeof(annotations[c].target) === 'string' ? annotations[c].target : annotations[c].target.source;\n          return target\n        }\n        else{\n          return undefined\n        }\n      })\n      mentionedBy = mentionedBy.filter((i) => {return i !== undefined})\n      return mentionedBy\n    }\n    else{\n      return []\n    }\n  }\n  // expect list to be in already parsed JSON\n  const handleImportList = (list, listname) => {\n    //TODO; this would need to take in annotaitonList Array and convert it to object structure \n    // and then add it to annotationState which would then update db\n\n    // try to load data from local storage\n    try {\n      const parsedList = list;\n      const name = camelCase(listname) || uuidv4();\n      lists[name] = parsedList\n      setLists({\n        ...lists\n      })\n    }\n    // if import update fails do nothing and proceed with the default state\n    catch (e) {\n      console.log(\"error\", e)\n    }\n  }\n\n  useEffect(() => {\n    //localStorage.setItem(\"sctaCommentsState2\", JSON.stringify(lists))\n    //NOTE/TODO: this conditional lists['local'].length > 0 is temporary and MUST BE changed\n    // its currently there so that database won't be re-written on load, but it is completely acceptable for local to be 0\n    // and this will prevent writing to other lists, when local list is empty\n    // it is temporary to get db synch to work. \n\n    if (db && Object.keys(annotations).length > 0) {\n      try{\n        db.ref(userId).set({annotations: annotations, tags: tags})\n      }\n      catch (e){\n        console.log(\"error in db update\", e)\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [annotations, lists, tags])\n  // bug here; lists needs to be included or update won't happen\n\n  // useEffect(() => {\n  //   //localStorage.setItem(\"sctaCommentsState2\", JSON.stringify(lists))\n  //   //NOTE/TODO: this conditional lists['local'].length > 0 is temporary and MUST BE changed\n  //   // its currently there so that database won't be re-written on load, but it is completely acceptable for local to be 0\n  //   // and this will prevent writing to other lists, when local list is empty\n  //   // it is temporary to get db synch to work. \n\n  //   if (db && tags && Object.keys(tags).length > 0) {\n  //     console.log('firing tags', tags)\n  //     db.ref(\"jeff\").set({tags: tags})\n  //   }\n  // }, [tags])\n  // bug here; lists needs to be included or update won't happen\n  const generateFullList = () => {\n    let fullList = []\n    if (!filterTags){\n       Object.keys(annotations).forEach((k) => {\n         fullList.push(annotations[k])\n      })\n    }\n    else if (filterTags.length === 1){\n      const ft = filterTags[0]\n      const newAnnotations = {...annotations}\n        Object.keys(newAnnotations).forEach((a) => {\n        if (tags && tags[ft] && Object.keys(tags[ft]).includes(a)) {\n          if (tags[ft][a].order){\n            newAnnotations[a][\"order\"] = tags[ft][a].order\n          }\n          return fullList.push(newAnnotations[a])\n        }\n        else {\n          return null\n        }\n      })\n    }\n    else{\n      const newAnnotations = {...annotations}\n        Object.keys(newAnnotations).forEach((a) => {\n          if (newAnnotations[a].tags){\n            if (filterTags.every(element => Object.keys(newAnnotations[a].tags).includes(element))) {\n              return fullList.push(newAnnotations[a])\n            }\n            else {\n              return null\n            }\n          }\n          else {\n            return null\n          }\n      })\n    }\n     fullList.sort((a,b) => {\n       if (a.order > b.order){\n         return 1\n       }\n       else if (a.order < b.order){\n         return -1\n       }\n       else {\n         return 0\n       }\n       \n      })\n    return fullList\n\n  }\n  \n  const displayComments = () => {\n    const fullList = generateFullList()\n\n    const displayComments = fullList.length > 0 && fullList.slice(0).map((c,i) => {\n      const target = typeof(c.target) === 'string' ? c.target : c.target.source;\n      if (showFocusComments){\n        if (target && target.includes(props.expressionid) && (c.body.value && c.body.value.includes(commentFilter))){\n          return (\n            <div key={i}>\n              <Comment2Item comment={c} focused={true} removeComment={removeComment} updateComment={updateComment}\n              handleOnClickComment={props.handleOnClickComment} setTagFilter={handleAddSingleFilterTag} tagsList={tags}/>\n              {\n              //<button onClick={() => {removeNote(n.title)}}>x</button>\n              }\n            </div>\n          )\n        }\n        else{\n          return null\n        }\n      }\n      else{\n        if (target && target.includes(props.expressionid) && (c.body.value && c.body.value.includes(commentFilter))){\n          return (\n            <div key={i} style={{borderLeft: \"1px solid black\"}}>\n              <Comment2Item comment={c} removeComment={removeComment} updateComment={updateComment} setTagFilter={handleAddSingleFilterTag} tagsList={tags}/>\n              {\n              //<button onClick={() => {removeNote(n.title)}}>x</button>\n              }\n            </div>\n            )\n        }\n        else if (c.body.value && c.body.value.includes(commentFilter)){\n          return (\n            <div key={i}>\n              <Comment2Item comment={c} removeComment={removeComment} updateComment={updateComment} setTagFilter={handleAddSingleFilterTag} tagsList={tags}/>\n              {\n              //<button onClick={() => {removeNote(n.title)}}>x</button>\n              }\n            </div>\n          )\n        }\n        else{\n          return null\n        }\n      }\n    })\n    return displayComments\n  }\n  return (\n    <Container className={props.hidden ? \"hidden\" : \"showing\"}>\n      {(props.userId && props.userId !== \"jeff\") ? \n      <>\n      <Comment2Create \n        submitComment={submitComment} \n        selectionRange={props.selectionRange}\n        textEdit={props.textEdit}\n        orderNumber={Object.keys(annotations).length}\n        availableTagsList={tags}\n        />\n      <hr/>\n      <div id=\"commentToggleButtons\">\n        \n          {showFocusComments ? <Button size=\"sm\" disabled>{t(\"Show Comments For Focused Passage\")}</Button> : <Button id=\"btnAllCommentsToggle\" size=\"sm\" onClick={() => setShowFocusComments(true)}>{t(\"Show Comments For Focused Passage\")}</Button>}\n          {!showFocusComments ? <Button size=\"sm\" disabled>Show Comments Regardless of Target</Button> : <Button id=\"btnAllCommentsToggle\" size=\"sm\" onClick={() => setShowFocusComments(false)}>Show Comments Regardless of Target</Button>}\n        \n      </div>\n      <div id=\"commentFilterInputs\">\n        <div>\n        <FormControl size=\"sm\" type=\"text\" value={commentFilter} placeholder={t(\"filter comments by text\")} className=\"mr-sm-2\" onChange={(e) => {setCommentFilter(e.target.value)}}/>\n        </div>\n        <Comments2TagSuggestions tagsList={tags} handleOnClickTag={handleAddFilterTag} placeHolderText=\"search for tags; type ? to see all tags\"/>\n      </div>\n      {filterTags && <span>Filter Tags: {\n          \n          filterTags.map((t) => {\n            return (<span key={\"tag-\"+ t}><span onClick={() => {handleDropFilterTag(t)}}>X</span><span>{t}</span></span>)\n          })\n        }\n        </span>\n        }\n      <hr/>\n      {mentionedBy.length > 0 && \n      <div>\n        <span>Discussed By:</span>\n        {mentionedBy.map((m) => {\n            return(\n              <div>\n              <Link key={m} to={\"/res?resourceid=\" + m}>{m}</Link>\n              <span className=\"lbp-span-link\" title=\"Copy Resource Url Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(m)}}><FaClipboard /></span>\n              </div>\n            )\n          })\n          }\n        <hr/>\n      </div>\n      }\n      <div>\n        {displayComments()}\n      </div>\n      \n      <div>\n        <span className=\"lbp-span-link\" onClick={() => {setShowManageTags(!showManageTags)}}>Manage Tags</span>\n        { showManageTags &&\n        <div>\n        {tagsToDelete && <span>Selected Tags: {\n          \n          tagsToDelete.map((t) => {\n            return (<span key={\"tag-\"+ t}><span onClick={() => {handleDropTagToDelete(t)}}>X</span><span>{t}</span></span>)\n          })\n        }\n        </span>\n        }\n        <div><Comments2TagSuggestions tagsList={tags} handleOnClickTag={handleOnClickTagToDelete} placeHolderText=\"search for tags; type ? to see all tags\"/></div>\n        <p onClick={() => {handleRemoveTags(tagsToDelete)}}>Delete Tags</p>\n      </div>\n      }\n      </div>\n      {\n      <Comments2ImportExport currentList={generateFullList()} currentListName={filterTags.join(\"-\") || \"all\"} handleImportList={handleImportList} />\n      }\n    </> : \n    <p> You must be logged in to comment</p> }\n    </Container>\n  );\n}\n\nComments2.propTypes = {\n  /**\n  * \n  * resourceid to serve as target of annotation\n  *\n  */\n  resourceid: PropTypes.string.isRequired,\n\n}\n\nexport default Comments2;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Container from 'react-bootstrap/Container';\nimport Spinner from './Spinner';\nimport { FaClipboard} from 'react-icons/fa';\nimport {runQuery, copyToClipboard} from './utils'\nimport {getManifestationCitationInfo} from './Queries'\n\n/**\n* citation component\n*\n* TODO: it would be better to separate the citation display, manifestation picker, citation explation\n* into three differen compoments wrapped in a citation Wrapper.\n* This way the citation display could be truly independent\n*/\nclass Citation extends React.Component{\n  constructor(props){\n    super(props)\n    this.mounted = \"\"\n    this.state = {\n      eurl: \"\",\n      etitle: \"\",\n      murl: \"\",\n      mtitle: \"\",\n      turl: \"\",\n\n      fetching: false\n    }\n  }\n\n  retrieveCitation(tresourceid){\n    if (tresourceid){\n      this.setState({fetching: true})\n      const manifestationCitationInfo = runQuery(getManifestationCitationInfo(tresourceid))\n      manifestationCitationInfo.then((data) => {\n        const allBindings = data.data.results.bindings\n        if (allBindings.length > 0){\n          const bindings = allBindings[0]\n          const expressionid = bindings.expression ? bindings.expression.value : \"\"\n          const manifestationid = bindings.manifestation ? bindings.manifestation.value : \"\"\n          const eLongTitle = bindings.eLongTitle ? bindings.eLongTitle.value : \"\"\n          const authorTitle = bindings.authorTitle ? bindings.authorTitle.value : \"\"\n          const author = bindings.author ? bindings.author.value : \"\"\n          const editorTitle = bindings.editorTitle ? bindings.editorTitle.value : \"\"\n          const editor = bindings.editor ? bindings.editor.value : \"\"\n          const datasource = bindings.datasource ? bindings.datasource.value : \"\"\n          const title = bindings.codexTitle ? bindings.codexTitle.value : \"\"\n          const start = bindings.surfaceTitle ? bindings.surfaceTitle.value : \"\"\n          const end = allBindings[allBindings.length - 1].surfaceTitle ? allBindings[allBindings.length - 1].surfaceTitle.value : \"\"\n          if (this.mounted){\n            this.setState(\n              {\n                author: author,\n                authorTitle: authorTitle,\n                editor: editor,\n                editorTitle: editorTitle,\n                eurl: expressionid,\n                etitle: eLongTitle,\n                murl: manifestationid,\n                mtitle: start !== end ? title + \", \" + start + \"-\" + end : title + \", \" + start,\n                turl: tresourceid,\n                datasource: datasource,\n                fetching: false\n              }\n            )\n          }\n        //})\n        }\n      })\n    }\n  }\n  componentDidMount(){\n    this.mounted = true\n    this.retrieveCitation(this.props.tresourceid)\n\n  }\n  \n  componentDidUpdate(prevProps){\n    if (this.props.tresourceid !== prevProps.tresourceid){\n      this.retrieveCitation(this.props.tresourceid)\n    }\n  }\n  componentWillUnmount(){\n    this.mounted = false\n  }\n  render(){\n\n    const fullCitationString = this.state.authorTitle + \", \" + this.state.etitle + \"(\" + this.state.mtitle + \") Data source: \" + this.state.datasource + \".\"\n    const wordRange = this.props.selectionRange && this.props.selectionRange.wordRange && \n      this.props.selectionRange.wordRange.start + \"-\" + this.props.selectionRange.wordRange.end;\n    return (\n      <Container>\n      <h4>Citation</h4>\n      {this.state.fetching ?\n        <Spinner/> :\n      <div>\n        <p className=\"etitle\">{this.state.authorTitle}, {this.state.etitle} {wordRange && wordRange && \"@ \" + wordRange} (<a href={this.state.eurl} target=\"_blank\" rel=\"noopener noreferrer\">{this.state.eurl}{wordRange && \"@\" + wordRange}</a> <span className=\"lbp-span-link\" title=\"Copy Citation to Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(wordRange ? this.state.eurl + \"@\" + wordRange : this.state.eurl)}}><FaClipboard /></span>)</p>\n\n        <p className=\"mtitle\">\n          {this.state.editor && <span>Ed. {this.state.editorTitle}, </span>}\n          \n          {this.state.mtitle && this.state.mtitle + \" \"}\n          \n          (<a href={this.state.murl} target=\"_blank\" rel=\"noopener noreferrer\">{this.state.murl}{wordRange && \"@\" + wordRange}</a> \n          \n          <span className=\"lbp-span-link\" title=\"Copy Citation to Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(wordRange ? this.state.murl + \"@\" + wordRange : this.state.murl)}}><FaClipboard /></span>)\n        </p>\n\n        <p className=\"ttitle\">\n          <span>Transcription Resource: </span>\n          <a href={this.state.turl} target=\"_blank\" rel=\"noopener noreferrer\">{this.state.turl}{wordRange && \"@\" + wordRange}</a>\n          <span className=\"lbp-span-link\" title=\"Copy Citation to Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(wordRange ? this.state.turl + \"@\" + wordRange : this.state.turl)}}><FaClipboard /></span>\n          <br/>\n          <span>Data source: </span>\n          <a href={this.state.datasource} target=\"_blank\" rel=\"noopener noreferrer\"> {this.state.datasource}</a> \n          <span className=\"lbp-span-link\" title=\"Copy Citation to Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(this.state.datasource)}}><FaClipboard /></span>\n          </p>\n        <p className=\"lbp-span-link\" title=\"Copy Citation to Clipboard\" onClick={(e) => {e.preventDefault(); copyToClipboard(fullCitationString)}}><FaClipboard /> Copy Full Citation to Clipboard</p>\n      </div>\n      }\n      </Container>\n    );\n  }\n}\n\nCitation.propTypes = {\n  /**\n  * transcription resource id of focused passage,\n  * transcription id is required, because a specific text passage is being complicated\n  *\n  * TODO: perhaps it would be good to allow the expression or manifestation id to be given\n  * but the citation component would need to know what kind of resource this and would\n  * need to produce a different query in each case\n  */\n  tresourceid: PropTypes.string.isRequired,\n\n}\n\nexport default Citation;\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport {FaChevronDown, FaChevronUp} from 'react-icons/fa';\n\nclass CitationExplanation extends React.Component {\n  constructor(props){\n    super(props)\n    this.toggleCitationExplanation = this.toggleCitationExplanation.bind(this)\n    this.state = {\n      showCitationExplanation: false,\n    }\n  }\n  toggleCitationExplanation(){\n    this.setState((prevState) => {\n      return {showCitationExplanation: !prevState.showCitationExplanation}\n    })\n  }\n  render(){\n    return (\n      <Container className=\"CitationExplanation\">\n      <p onClick={this.toggleCitationExplanation}>{this.state.showCitationExplanation ? <span><FaChevronDown/>Hide Explanation of Citation Practices</span> : <span><FaChevronUp/>View Explanation of Citation Practices</span>} </p>\n      {this.state.showCitationExplanation &&\n        <div>\n          <p>The citation of a text that has survived through a historical succession of manifestations is a complicated endeavor.\n          Today, when transcriptions of these manifestations\n          can be published as data, separate from any presentation,\n          and thereby can be presented in a variety of ways,\n          a full citation inevitably becomes even more complex.\n          In order to identify the content hierarchy of the text,\n          the specifical material or born digital manifestation of that text,\n          and the data sources used to represent and display that manifestation,\n          specificity and precision are needed.</p>\n\n          <p>Full citations therefore identify three aspects of the text currently being viewed.</p>\n\n          <p className=\"etitle\">First (blue) it identifies the idea of the paragraph in question situated within the conceptual hierarchy of the text.</p>\n\n          <p className=\"mtitle\">Second (red) it identifies the manifestation of the text in a historical or born digital edition.</p>\n\n          <p className=\"ttitle\">Third (purple) it identifies the transcription and transcription data source used to power the current text presentation.</p>\n        </div>}\n      </Container>\n\n    );\n  }\n}\n\nexport default CitationExplanation;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Container from 'react-bootstrap/Container';\nimport {FaChevronDown, FaChevronUp} from 'react-icons/fa';\nimport {Link} from 'react-router-dom';\n\nclass ManifestationList extends React.Component {\n  constructor(props){\n    super(props)\n    this.toggleAlternativeManifestations = this.toggleAlternativeManifestations.bind(this)\n    this.state = {\n      showAlternativeManifestations: true\n    }\n  }\n  toggleAlternativeManifestations(){\n    this.setState((prevState) => {\n      return {showAlternativeManifestations: !prevState.showAlternativeManifestations}\n    })\n  }\n  render(){\n    const wordRange = this.props.selectionRange && this.props.selectionRange.wordRange && \n      this.props.selectionRange.wordRange.start + \"-\" + this.props.selectionRange.wordRange.end;\n    \n      const displayManifestations = () => {\n      if (this.props.manifestations){\n        const manifestations = this.props.manifestations.map((i) => {\n          if (this.props.tresourceid.includes(i.manifestation)){\n            return (<p key={i.manifestation}>\n              {i.manifestationTitle}{wordRange && \"@\" + wordRange} (Currrent Focus)\n            </p>)\n          }\n          else{\n            return (<p key={i.manifestation}>\n              <Link to={wordRange ? \"/text?resourceid=\" + i.manifestation + \"@\" + wordRange : \"/text?resourceid=\" + i.manifestation}>\n              {i.manifestationTitle}{wordRange && \"@\" + wordRange}</Link>\n            </p>\n            )\n          }\n        })\n        return manifestations\n      }\n    }\n    return (\n      <Container className=\"ManifestationList\">\n      {this.props.optionalDisplay ?\n        <h4 onClick={this.toggleAlternativeManifestations}>{this.state.showAlternativeManifestations ? <span><FaChevronDown/>Hide Alternative Manifestations</span> : <span><FaChevronUp/>View Alternative Manifestations</span>} </h4>\n        \n        :\n        <h4>Available Manifestations</h4>\n        // <div>\n        //   <h4>Alternative Manifestations</h4>\n        //   <a href={\"https://mirador.scta.info?blockid=\" + this.props.resourceid} target=\"_blank\" rel=\"noopener noreferrer\">View in Mirador <img alt=\"view in mirador\" style={{width: \"12px\", height: \"12px\"}} src=\"https://projectmirador.org/img/mirador-logo.svg\"></img></a>\n        // </div>\n      }\n\n        {this.state.showAlternativeManifestations && displayManifestations()}\n      </Container>\n    );\n  }\n}\nManifestationList.propTypes = {\n/**\n  * manifestations provides list of other mnaifestations for focused expression\n\n  * TODO: it seems desireable not to require a manifestations property so that\n  * one can simply provide the transcription resource id, but if the propery is not\n  * the component could look it up itself. But information could also be supplied a prop\n  * in the case the parent component already has the information. In this case,\n  * a second look up by the component would be needless\n  */\n  manifestations: PropTypes.array,\n  optionalDisplay: PropTypes.bool\n}\nexport default ManifestationList;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Container from 'react-bootstrap/Container';\nimport Citation from './Citation'\nimport CitationExplanation from './CitationExplanation'\nimport ManifestationList from './ManifestationList'\n\nfunction CitationWrapper(props) {\n  return (\n    <Container className={props.hidden ? \"CitationWrapper hidden\" : \"CitationWrapper showing\"}>\n      <Citation tresourceid={props.tresourceid} selectionRange={props.selectionRange}/>\n      <CitationExplanation/>\n      <hr/>\n      <ManifestationList \n      tresourceid={props.tresourceid}\n      manifestations={props.manifestations} \n      selectionRange={props.selectionRange}/>\n    </Container>\n  );\n}\n\nCitation.propTypes = {\n  /**\n  * transcription resource id of focused passage,\n  * transcription id is required to be passed down to Citaiton Component\n  */\n  tresourceid: PropTypes.string.isRequired,\n  /**\n  * manifestations provides list of other mnaifestations for focused expression\n\n  * TODO: it seems desireable not to require a manifestations property so that\n  * one can simply provide the transcription resource id, but if the propery is not\n  * the component could look it up itself. But information could also be supplied a prop\n  * in the case the parent component already has the information. In this case,\n  * a second look up by the component would be needless\n  */\n  manifestations: PropTypes.array,\n  /**\n  * hidden designates whether the component should be hidden after mounting\n  */\n  hidden: PropTypes.bool,\n  /**\n  * function to handle response when new manifestaiton is picked.\n  * should be passed down to ManifestationList component\n  */\n  handleFocusChange: PropTypes.func\n}\nexport default CitationWrapper;\n","import React, {useState, useEffect} from 'react';\nimport {getCodexInfo, getCodexInfoFromSurface, getCodexInfoFromCanvas, getCodexInfoFromManifest} from './Queries'\nimport {Link} from 'react-router-dom';\nimport {runQuery} from './utils'\n\nfunction CodexToc(props) {\n  const [items, setItems] = useState([])\n  const retrieveCodexInfo = (id, type) => {\n    \n    let codexInfo = undefined\n    if (type === \"surface\"){\n      codexInfo = runQuery(getCodexInfoFromSurface(id))\n    }\n    else if (type === \"canvas\"){\n      codexInfo = runQuery(getCodexInfoFromCanvas(id))\n    }\n    else if (type === \"manifest\"){\n      codexInfo = runQuery(getCodexInfoFromManifest(id))\n    }\n    else{\n      codexInfo = runQuery(getCodexInfo(id))\n    }\n    codexInfo.then((d) => {\n      console.log(\"id\", id, \"type\", type, \"data\", d)\n      const data = d.data.results.bindings\n      if (data.length > 0 && data[0].surface){\n        const expressionIdMap = data.map((d) => {\n          return d.expression ? d.expression.value : \"\"\n        })\n        var unique = expressionIdMap.filter((v, i, a) => a.indexOf(v) === i);\n        let expressionList = {}\n        unique.forEach((e) => {\n           expressionList[e] = []\n        })\n        data.forEach((d) => {\n            const info = {\n              expression: d.expression.value,\n              expressionTitle: d.item_expression_title.value,\n              manifestation: d.manifestation.value,\n              surface: d.surface.value,\n              surfaceTitle: d.surface_title.value,\n              questionTitle: d.item_expression_question_title ? d.item_expression_question_title.value : ''\n            }\n          expressionList[d.expression.value].push(info)\n        })\n        // let focusedSurface = \"\";\n        // if (type === \"surface\"){\n        //    focusedSurface = id\n        //  }\n        //  else if (type === \"canvas\"){\n        //    focusedSurface = data[0].surfaceFocus.value\n        //  }\n        //  else{\n        //    focusedSurface = data[0].surface.value\n        //  }\n         setItems(expressionList)\n        ///this.setState({items: expressionList, focusedSurface: focusedSurface})\n\n      }\n    })\n  }\n  useEffect(() => {\n    retrieveCodexInfo(props.resourceid, props.codexResourceType)\n    // eslint-disable-next-line\n  }, [props.resourceid])\n    \n  const displayItems = () => {\n      const displayItems = Object.keys(items).map((key) => {\n        return (\n          <p key={items[key][0].expression}>\n          <span>\n          <Link to={\"/text?resourceid=\" + items[key][0].surface}>{items[key][0].surfaceTitle}</Link>\n          -\n          <Link to={\"/text?resourceid=\" + items[key][items[key].length - 1].surface}>{items[key][items[key].length - 1].surfaceTitle}</Link>\n          </span>{\": \"}\n          <Link to={\"/text?resourceid=\" + items[key][0].manifestation}>{items[key][0].expressionTitle}</Link>{\": \"}\n          {items[key][0].questionTitle && items[key][0].questionTitle}\n          </p>\n\n        )\n      })\n      return displayItems\n    }\n  return (\n    <div className={props.hidden ? \"hidden\" : \"showing\"}>\n      {displayItems()}\n    </div>\n    );\n}\n\nexport default CodexToc;","import React from 'react';\nimport {Link} from 'react-router-dom';\nimport Container from 'react-bootstrap/Container';\n//import TextPreview from '@bit/jeffreycwitt.lbp.text-preview'\nimport {TextView} from '@jeffreycwitt/lbp2.text-view'\nimport {runQuery} from './utils'\nimport {getCanonicalTranscription} from '../queries/TextPreviewWrapperQueries'\n//import {FaToggleOn, FaToggleOff} from 'react-icons/fa';\n\nclass TextPreviewWrapper extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleToggleShowTokenPosition = this.handleToggleShowTokenPosition.bind(this)\n    this.mounted = false\n    this.state = {\n      tresourceid: \"\",\n      longTitle: null,\n      showTokenPosition: false\n    }\n  }\n  handleToggleShowTokenPosition(){\n    this.setState((prevState)=> {\n      return {showTokenPosition: !prevState.showTokenPosition}\n    })\n  }\n  getTranscriptionId(textPreviewResourceId){\n    const info = runQuery(getCanonicalTranscription(textPreviewResourceId))\n\n    info.then((d) => {\n      if (this.mounted){\n        this.setState(\n          {\n            tresourceid: d.data.results.bindings[0].ctranscription.value,\n            longTitle: d.data.results.bindings[0].longTitle.value \n        })\n      }\n    })\n    .catch((e) => {\n      this.setState({tresourceid: \"\"})\n      //console.log(\"transcription id could not be found\", e)\n      // uncomment if you want to automatically redirect\n        //this.props.handleFocusChange(textPreviewResourceId)\n    })\n\n\n  }\n  componentDidMount(){\n    this.mounted = true\n    this.getTranscriptionId(this.props.textPreviewResourceId)\n  }\n  componentDidUpdate(prevProps){\n    if (prevProps.textPreviewResourceId !== this.props.textPreviewResourceId){\n      this.getTranscriptionId(this.props.textPreviewResourceId)\n    }\n  }\n  componentWillUnmount()\n  {\n    this.mounted = false\n  }\n  render(){\n    const link = (this.props.textPreviewStart && this.props.textPreviewEnd) \n    ? this.state.tresourceid + \"@\" + this.props.textPreviewStart + \"-\" + this.props.textPreviewEnd\n    : this.state.tresourceid\n    const referringRange = (this.props.referringSelectionRange && this.props.referringSelectionRange.wordRange) && this.props.referringSelectionRange.wordRange.start + \"-\" + this.props.referringSelectionRange.wordRange.end\n    // const referringStart = (this.props.referringSelectionRange && this.props.referringSelectionRange.wordRange) && this.props.referringSelectionRange.wordRange.start\n    // const referringEnd = (this.props.referringSelectionRange && this.props.referringSelectionRange.wordRange) && this.props.referringSelectionRange.wordRange.end\n    return (\n      <Container className={this.props.hidden ? \"hidden\" : \"showing\"}>\n      {/* <p>Go to: <span className=\"lbp-span-link\" onClick={() => this.props.handleFocusChange(this.state.tresourceid)}>{this.state.tresourceid}</span></p> */}\n      <p>Go to: <Link onClick={() => {this.props.handleTextPreviewFocusChange([{id: this.props.referringResource, range: referringRange}])}} to={\"/text?resourceid=\" + link}>{this.state.longTitle}</Link></p>\n      {\n       this.state.tresourceid && \n       <div>\n         <TextView tresourceid={this.state.tresourceid} start={parseInt(this.props.textPreviewStart)} stop={parseInt(this.props.textPreviewEnd)} context={true}/>\n      {/* <span className=\"lbp-span-link\" alt=\"show word token position\" onClick={this.handleToggleShowTokenPosition}>{this.state.showTokenPosition ? <FaToggleOn/> : <FaToggleOff/>}</span> */}\n       </div>\n      }\n      </Container>\n    );\n  }\n}\n\nexport default TextPreviewWrapper;\n"," export function getCanonicalTranscription(resourceid){\n   const query = [\n      \"SELECT DISTINCT ?ctranscription ?longTitle \",\n      \"WHERE { \",\n        \"{\",\n          \"<\" + resourceid + \"> <http://scta.info/property/hasCanonicalManifestation> ?manifestation .\",\n          \"?manifestation <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .\",\n        \"}\",\n        \"UNION\",\n        \"{\",\n          \"BIND(<\" + resourceid + \"> AS ?ctranscription ) . \",\n          \"?ctranscription a <http://scta.info/resource/transcription> .\",\n        \"}\",\n        \"UNION\",\n        \"{\",\n          \"<\" + resourceid + \"> <http://scta.info/property/hasCanonicalTranscription> ?ctranscription .\",\n        \"}\",\n        \"?ctranscription <http://scta.info/property/isTranscriptionOf> ?m .\",\n        \"?m <http://scta.info/property/isManifestationOf> ?e .\",\n        \"?e <http://scta.info/property/longTitle> ?longTitle .\",\n      \"}\"\n      ].join(' ');\n  return query\n }\n","//vendor imports\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport Button from 'react-bootstrap/Button';\nimport {Link} from 'react-router-dom';\nimport {FaExternalLinkAlt} from 'react-icons/fa';\n\nimport {Surface3Wrapper} from \"@jeffreycwitt/lbp2.surface3wrapper\"\n\n//internal imports\n//import Surface3Wrapper from './Surface3Wrapper'\n\n//import Comments from './Comments'\nimport {runQuery} from './utils'\nimport {getSurfaceInfo} from '../queries/SurfaceInfoQuery'\n\n\n//TODO: the result of the CONSTRUCT query is returning prefixed uris, and arrays for multiple results and objects for single results; \n// it is creating all kind of type confusion that requires extra conditionals\n// it would be better stop using the CONSTRUCT query or abstract this variations away into a separate utility function\n\nclass SurfaceInfo extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleToggleRelatedDiscussion = this.handleToggleRelatedDiscussion.bind(this)\n    this.handleSurface3Manifestations = this.handleSurface3Manifestations.bind(this)\n    this.handleToggleShowQuery = this.handleToggleShowQuery.bind(this)\n    this.handleToggleShowImages = this.handleToggleShowImages.bind(this)\n    this.state = {\n      expressions: [],\n      surfaceMap: {},\n      showTextRegion: false,\n      showQuery: false,\n      query: \"\"\n    }\n  }\n  handleToggleShowQuery(){\n    this.setState((prevState) => {\n      return {\n        showQuery: !prevState.showQuery\n      }\n    })\n  }\n  handleSurface3Manifestations(manifestations, eid){\n    let newManifestations = \"\"\n    \n    //if (typeof manifestations === \"object\"){\n    if (manifestations instanceof Array){\n      newManifestations = manifestations.map((m) =>{\n        return {\n          manifestation: m[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"),\n          manifestationTitle: m[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\").split(\"/resource/\")[1],\n          transcription: \"\"\n        }\n      })\n    }\n    // sometimes there is only manifestation not in an array\n    else if (manifestations){\n      newManifestations = [{\n        manifestation: manifestations[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"),\n        manifestationTitle: manifestations[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\").split(\"/resource/\")[1],\n        transcription: \"\"\n      }]\n    }\n    console.log(\"newManifestations\", newManifestations)\n    const split1 = this.props.surfaceid.split(\"/resource/\")[1]\n    const codexSlug = split1.split(\"/\")[0]\n    const surface3FocusedManifestation = newManifestations ? newManifestations.filter((m) => m.manifestation.includes(codexSlug))[0].manifestation : \"\"\n\n    return {\n      surface3Manifestations: newManifestations,\n      surface3FocusedManifestation: surface3FocusedManifestation\n    } \n  }\n  \n  handleToggleRelatedDiscussion(eid){\n    this.setState((prevState) => {\n      const target = prevState.expressions.find((e) => e.expressionid === eid )\n      target.showComments = !target.showComments\n      const newExpressions = [...prevState.expressions]\n      return {\n        expressions: newExpressions\n      }\n    })\n\n  }\n  handleToggleRelatedSurfaces(eid){\n    this.setState((prevState) => {\n      const target = prevState.expressions.find((e) => e.expressionid === eid )\n      target.showRelatedSurfaces = !target.showRelatedSurfaces\n      const newExpressions = [...prevState.expressions]\n      return {\n        expressions: newExpressions\n      }\n    })\n\n  }\n  handleToggleShowImages(eid){\n    this.setState((prevState) => {\n      const target = prevState.expressions.find((e) => e.expressionid === eid )\n      target.showImages = !target.showImages\n      const newExpressions = [...prevState.expressions]\n      return {\n        expressions: newExpressions\n      }\n    })\n\n  }\n\n  \n  retrieveSurfaceInfo(surfaceid){\n    const query = getSurfaceInfo(surfaceid)\n    const surfaceInfo = runQuery(query)\n    surfaceInfo.then((d) => {\n      if (d.data[\"@graph\"]){\n        const data = d.data[\"@graph\"]\n        console.log(\"data\", data)\n        const expressions = [] \n        data.forEach((e) => {\n          if (e[\"sctap:hasManifestation\"]){\n            const surface3Manifestations = this.handleSurface3Manifestations(e[\"sctap:hasManifestation\"], e[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"))\n            expressions.push({\n              expressionid: e[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"),\n              manifestations: e[\"sctap:hasManifestation\"],\n              surface3Manifestations: surface3Manifestations,\n              showComments: false,\n              showRelatedSurfaces: false,\n              showImages: false,\n            })\n          }\n          else{\n            return null\n          }\n        })\n        let surfaceMap = {}\n        data.forEach((e) => {\n          if (e[\"sctap:isOnSurface\"]){\n            surfaceMap[e[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\")] = e[\"sctap:isOnSurface\"][\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\")\n          }\n        })\n        this.setState({\n          expressions: expressions,\n          surfaceMap: surfaceMap,\n          query: query\n        })\n      }\n    })\n  }\n\n  componentDidMount(){\n    this.retrieveSurfaceInfo(this.props.surfaceid)\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.surfaceid !== prevProps.surfaceid){\n      this.retrieveSurfaceInfo(this.props.surfaceid)\n    }\n  }\n  render(){\n    const displayExpressions = () => {\n      if (this.state.expressions.length > 0){\n        const expressions = this.state.expressions.map((e) => {\n          let manifestations = \"\"\n          // sometimes there are several manifestations\n          if (Array.isArray(e.manifestations)){\n            manifestations = e.manifestations.map((mShort) => {\n              const m = mShort[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\")\n              return (\n                  <div key={m}>\n                  <span>{m} <Link to={\"/text?resourceid=\" + m}><FaExternalLinkAlt/></Link></span>\n                  <br/>\n                  <span style={{\"textIndent\": \"10px\"}}>...Appearing on Surface {this.state.surfaceMap[m]} <Link to={\"/text?resourceid=\" + this.state.surfaceMap[m]}><FaExternalLinkAlt/></Link></span>\n                  <br/>\n                  <br/>\n                  </div>\n                )\n              })\n            }\n            // sometimes there is only manifestation\n            else if (e.manifestations){\n              const m = e.manifestations[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\")\n              manifestations = (\n                  <div key={m}>\n                  <span>{m} <Link to={\"/text?resourceid=\" + m}><FaExternalLinkAlt/></Link></span>\n                  <br/>\n                  <span style={{\"textIndent\": \"10px\"}}>...Appearing on Surface {this.state.surfaceMap[m]} <Link to={\"/text?resourceid=\" + this.state.surfaceMap[m]}><FaExternalLinkAlt/></Link></span>\n                  <br/>\n                  <br/>\n                  </div>\n                )\n              }\n              else{\n                manifestations = []\n              }\n          return (\n            <div key={e.expressionid}>\n            <hr/>\n            <p>{e.expressionid} <Link to={\"/text?resourceid=\" + e.expressionid}><FaExternalLinkAlt/></Link></p>\n            <Button variant=\"outline-primary\" size=\"sm\" block onClick={() => this.handleToggleShowImages(e.expressionid)}>{e.showImages ? \"Hide Images\" : \"Show Images\"}</Button>\n              <br/>\n              {(e.showImages && (e.surface3Manifestations && e.surface3Manifestations.surface3Manifestations.length > 0)) &&\n              <Surface3Wrapper key={e.expressionid} manifestations={e.surface3Manifestations.surface3Manifestations} focusedManifestation={e.surface3Manifestations.surface3FocusedManifestation} annotationsDisplay=\"paragraph\" width=\"501\" hidden={false}/>\n              }\n            {e.showRelatedSurfaces ?\n              <div>\n                <Button variant=\"outline-primary\" size=\"sm\" block onClick={() => {this.handleToggleRelatedSurfaces(e.expressionid)}}>Hide Related Codices</Button>\n              <br/>\n              {manifestations}\n              </div> :\n              <div>\n                <Button variant=\"outline-primary\" size=\"sm\" block onClick={() => {this.handleToggleRelatedSurfaces(e.expressionid)}}>Show Related Codices</Button>\n                <br/>\n              </div>\n            }\n            </div>\n          )\n        })\n        return expressions\n      }\n      else{\n        return null\n      }\n    }\n\n    return (\n      <div className={this.props.hidden ? \"hidden\" : \"showing\"}>\n      <h1>Page Info</h1>\n        <div style={{\"fontSize\": \"16px\"}}>\n        <h1>Text objects on this page <Button size=\"sm\" className=\"lbp-span-link\" onClick={this.handleToggleShowQuery}>{this.state.showQuery ? \"Hide Proof\" : \"Prove It!\"}</Button></h1>\n        {this.state.showQuery && <p>{this.state.query}</p>}\n        {displayExpressions()}\n        </div>\n\n      </div>\n    );\n  }\n}\n\nSurfaceInfo.propTypes = {\n  /**\n  * SCTA rdf url surfaceid to use when performing SPARQL query\n  */\n surfaceid: PropTypes.string.isRequired,\n /**\n  * a parent function to be triggered to indicate a new view display; namely \"swithc to viewTextFocused Region\"\n  */\n handleSurface3Manifestations: PropTypes.func\n}\n\n\nexport default SurfaceInfo;\n","//note; each query here represents an attempt an efficient single request for related information\n//each query therefore could be tranformed into a restful api\n\n\n export function getSurfaceInfo(surfaceid){\n   const query = [\n     \"PREFIX sctap: <http://scta.info/property/>\",\n     \"CONSTRUCT\",\n     \"{\",\n     \"?expression sctap:hasManifestation ?manifestation2 .\",\n     \"?manifestation2 sctap:isOnSurface ?surface2 .\",\n     \"}\",\n     \"WHERE\",\n     \"{\",\n     \"?manifestation <http://scta.info/property/isOnSurface> <\" + surfaceid + \"> .\",\n     \"?manifestation <http://scta.info/property/structureType> <http://scta.info/resource/structureBlock> .\",\n     \"?manifestation <http://scta.info/property/isManifestationOf> ?expression .\",\n     \"?expression <http://scta.info/property/totalOrderNumber> ?order .\",\n     \"?expression <http://scta.info/property/hasManifestation> ?manifestation2 .\",\n     \"?manifestation2 <http://scta.info/property/isOnSurface> ?surface2 .\",\n     \"?codex <http://scta.info/property/hasSurface> ?surface2 .\",\n     \"}\"\n   ].join('');\n   return query\n }\n","import React from 'react';\n\nfunction WorkGroupInfo(props) {\n  return (\n    <div className={props.hidden ? \"hidden\" : \"showing\"}>\n      <h1>WorkGroupInfo</h1>\n\n    </div>\n  );\n}\n\nexport default WorkGroupInfo;\n","import React, {useState} from 'react';\n//import Nav from 'react-bootstrap/Nav';\n//import {FaBook} from 'react-icons/fa';\n\nfunction Dictionary(props) {\n  //const [dictionary, setDictionary] = useState(\"logeion\")\n  const [dictionary] = useState(\"logeion\")\n\n  return (\n    <div className={props.hidden ? \"hidden dict-container\" : \"showing dict-container\"} >\n      {/* commented out because whitaker's words does not run over https and therefore is not accessible as iframe on https sites<Nav>\n        {(dictionary === 'whitakerswords') ? \n        <Nav.Link title=\"select logeion\" onClick={()=>setDictionary(\"logeion\")}><FaBook/> Logeion</Nav.Link>\n        : \n        <Nav.Link title=\"select whitaker's words\" onClick={()=>setDictionary(\"whitakerswords\")}><FaBook/> Whitaker's Words</Nav.Link>}\n      </Nav> */}\n      {(props.text && props.text.split(\" \").length === 1) && \n      <div className=\"dict-container2\">\n        {\n        dictionary === \"logeion\" ? <iframe className=\"dict-iframe\" title=\"logeion\" src={\"https://logeion.uchicago.edu/\" + props.text }></iframe> \n        : \n        <iframe className=\"dict-iframe\" title=\"whitakerswords\" src={\"http://archives.nd.edu/cgi-bin/wordz.pl?keyword=\" + props.text }></iframe> \n        }\n        </div>\n      }\n    </div>\n\n    \n  );\n}\n\nexport default Dictionary;","export function getAvailableComponents(resourceType) {\n    let showComponents = []\n      switch (resourceType){\n      case \"collection\":\n        showComponents.push(\"textCitation\")\n        showComponents.push(\"textCompare\")\n        showComponents.push(\"comments\")\n        showComponents.push(\"search\")\n        break\n      case \"workGroup\":\n        showComponents.push(\"workGroupInfo\")\n        showComponents.push(\"comments\")\n        showComponents.push(\"search\")\n        break;\n      case \"person\":\n        showComponents.push(\"personInfo\")\n        showComponents.push(\"comments\")\n        showComponents.push(\"search\")\n        break;\n      case \"codex\":\n        showComponents.push(\"codex\")\n        showComponents.push(\"codexToc\")\n        showComponents.push(\"comments\")\n        showComponents.push(\"search\")\n        break;\n      case \"expressionType\":\n          showComponents.push(\"comments\")\n          showComponents.push(\"search\")\n          break;\n      case \"text\":\n        showComponents.push(\"textCitation\")\n        showComponents.push(\"textCompare\")\n        showComponents.push(\"comments\")\n        showComponents.push(\"search\")\n        showComponents.push(\"xml\")\n        showComponents.push(\"surface3\")\n        showComponents.push(\"textOutlineWrapper\")\n        break;\n      default:\n        break;\n      }\n      return showComponents\n}","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Surface2 from \"../Surface2\"\n//import Surface3Wrapper from \"../Surface3Wrapper\"\nimport {Surface3Wrapper} from \"@jeffreycwitt/lbp2.surface3wrapper\"\nimport {CollationTable} from \"@jeffreycwitt/lbp2.collation-table\"\nimport XmlView from \"../XmlView\"\nimport WindowNavBar from \"./WindowNavBar\"\nimport NextPrevBar from \"../NextPrevBar\"\nimport TextCompareWrapper from \"../TextCompareWrapper\"\nimport Search3 from \"../Search3\"\nimport PersonInfo from \"../PersonInfo\"\nimport Comments2 from \"../Comments2\"\nimport CitationWrapper from \"../CitationWrapper\"\nimport TextOutlineWrapper from \"../TextOutlineWrapper\"\nimport CodexToc from \"../CodexToc\"\nimport TextPreviewWrapper from \"../TextPreviewWrapper\"\nimport SurfaceInfo from \"../SurfaceInfo\"\nimport WorkGroupInfo from \"../WorkGroupInfo\"\nimport Dictionary from \"../Dictionary\"\nimport {getAvailableComponents} from \"./WindowUtil\"\n\nimport {FaSearch, FaGripVertical, FaCode, FaInfo, FaRegImage, FaComments, FaAlignLeft} from 'react-icons/fa';\n\n\n\nclass Window2 extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleToggleTextLinesView = this.handleToggleTextLinesView.bind(this)\n    this.handleChangeManifestation = this.handleChangeManifestation.bind(this)\n    \n    this.state = {\n      windowLoad: \"\",\n      mountStatus: {\n        textCompare: false,\n        surface3: false,\n        comments: false,\n        xml: false,\n        search:  false,\n        textOutline: false,\n        citation: false\n      },\n      collationTableWithRange: false\n\n    }\n  }\n  \n  // used to control default iamge view prop for surface3 component\n  handleToggleTextLinesView(view){\n    this.props.handleToggleTextLinesView(this.props.windowId, view)\n  }\n  // used to control default manifestation prop for surface3 component\n  handleChangeManifestation(manifestation){\n    // to do getting manifestation slug, to apply as default view\n    // TODO: it is precarious to get info like this by deconstructing identifier\n    // it would better if this information were being passed from original db look up\n    const manifestationSlug = manifestation.split(\"/resource/\")[1].split(\"/\")[1]\n    this.props.handleChangeManifestation(this.props.windowId, manifestationSlug)\n  }\n  componentDidMount(){\n    this.setState(\n      {windowLoad: this.props.windowLoad}\n    )\n  }\n  componentDidUpdate(prevProps){\n    //when receiving props we check first to see if a new resource id is present,\n    // if so, mounting status for all window child components is set back to false\n    let newMountStatus = {}\n    if (this.props.resourceid !== prevProps.resourceid){\n      newMountStatus = {\n        textCompare: false,\n        surface3: false,\n        comments: false,\n        xml: false,\n        search:  false,\n        textOutline: false,\n        citation: false,\n      }\n      // then, the mount status of the opening window load is changed to true\n      newMountStatus[this.props.windowLoad] = true\n      this.setState(\n        {\n          windowLoad: this.props.windowLoad,\n          mountStatus: newMountStatus,\n        }\n      )\n    }\n    else if (this.props.windowLoad !== prevProps.windowLoad){\n      const tempNewMount = this.state.mountStatus\n      tempNewMount[this.props.windowLoad] = true\n      newMountStatus = tempNewMount\n      this.setState(\n        {windowLoad: this.props.windowLoad,\n        mountStatus: newMountStatus}\n      )\n    }\n    else{\n      newMountStatus = this.state.mountStatus\n    }\n  }\n\n  render(){\n    const displayTextPreviewWrappers = () => {\n      //TODO: start and end numbers are not yet arrays\n      // so the same start and end numbers will get sent to each item\n      const items = this.props.textPreviewObjects.map((i, index) => {\n        return (\n          <TextPreviewWrapper key={index}\n        textPreviewResourceId={i.id} \n        textPreviewStart={i.range ? i.range.split(\"-\")[0] : null} \n        textPreviewEnd={i.range ? i.range.split(\"-\")[1] : null} \n        handleFocusChange={this.props.handleFocusChange} \n        hidden={this.state.windowLoad !== \"textPreview\"}\n        handleTextPreviewFocusChange={this.props.handleTextPreviewFocusChange}\n        referringResource={this.props.info.ctranscription}\n        referringSelectionRange={this.props.selectionRange}\n        />\n        )\n      })\n      return items\n    }\n    const displayChild = () => {\n      //NOTE possible state machine pattern based on focus structureType\n      //different options should be available depending on the focus structureType\n      \n      //const structureType = this.props.info.structureType\n      //const isCollection = structureType === \"http://scta.info/resource/structureCollection\" || false\n\n      \n      //TODO: use of props.info, itemFocus, focusResearceid, resourceid vs info.resourceid needs to be better organized and clarified\n      //props.info.resourceid seems redundant with props.resourceid; doesn't seem to do any harm\n      // but in this component props.info will not always be available so props.resourceid should be used. \n      \n\n      const displayComponents = getAvailableComponents(this.props.resourceType)\n      return(\n        <div>\n          \n          {\n            // NOTE: performance seems a lot better when these mount only when clicked on\n            // some downside as it was nice to have them pre-loaded\n            // and the state doesn't remain when leaving tab and returning back to tab.\n            // for this reason search is always loaded, so that search results remain when moving between tabs.\n            // a compromise approach could be made for similar resources, where some components are dismounted and some are hiddden\n          }\n            {\n            displayComponents.includes(\"textCompare\")\n            && \n            (this.state.windowLoad === \"textCompare\" || this.state.mountStatus.textCompare) \n            && \n            <TextCompareWrapper \n              info={this.props.info}  \n              surfaceWidth={this.props.windowType === 'bottomWindow' ? \"1000\" : \"501\"}\n              hidden={this.state.windowLoad !== \"textCompare\"}\n              selectionRange={this.props.selectionRange}\n              handleShowCollationOverlay={this.props.handleShowCollationOverlay}\n              handleAddCtRelatedExpressions={this.props.handleAddCtRelatedExpressions}\n            />\n            }\n            {\n            displayComponents.includes(\"textCitation\") \n            && \n            (this.state.windowLoad === \"citation\" || this.state.mountStatus.citation) \n            &&\n            <CitationWrapper \n            tresourceid={this.props.info.resourceid + this.props.mtFocus}\n            resourceid={this.props.info.resourceid}\n            manifestations={this.props.info.manifestations} \n            handleFocusChange={this.props.handleFocusChange} \n            hidden={this.state.windowLoad !== \"citation\"}\n            selectionRange={this.props.selectionRange}\n            />\n            }\n            {\n            displayComponents.includes(\"personInfo\") \n            && \n            (this.state.windowLoad === \"citation\" || this.state.mountStatus.citation) \n            && \n            <PersonInfo \n              resourceid={this.props.resourceid} \n              hidden={this.state.windowLoad !== \"citation\"}\n            />\n            }\n            {\n            displayComponents.includes(\"workGroupInfo\") \n            && \n            (this.state.windowLoad === \"citation\" || this.state.mountStatus.citation) \n            && \n            <WorkGroupInfo \n              resourceid={this.props.resourceid} \n              hidden={this.state.windowLoad !== \"citation\"}\n            />\n            }\n            {\n            displayComponents.includes(\"codex\") \n            && \n            (this.state.windowLoad === \"textCompare\" || this.state.mountStatus.textCompare) \n            && \n            <SurfaceInfo \n              surfaceid={this.props.surfaceid} \n              resourceid={this.props.resourceid} \n              codexResourceType={this.props.codexResourceType}\n              hidden={this.state.windowLoad !== \"textCompare\"}\n            />\n            }\n            {\n            displayComponents.includes(\"surface3\")  \n            && \n            (this.state.windowLoad === \"surface3\" || this.state.mountStatus.surface3) \n            &&  \n            <Surface3Wrapper\n            className=\"surfaceWrapper\"\n            manifestations={this.props.info.manifestations}\n            //expressionid={this.props.resourceid}\n            focusedManifestation={this.props.defaultManifestationSlug ? this.props.resourceid + \"/\" + this.props.defaultManifestationSlug : this.props.resourceid + \"/\" + this.props.mtFocus.split(\"/\")[1]}\n            annotationsDisplay={this.props.annotationsDisplay}\n            handleToggleTextLinesView={this.handleToggleTextLinesView}\n            handleChangeManifestation={this.handleChangeManifestation}\n            width={this.props.windowType === 'bottomWindow' ? 1000 : 501}\n            lineFocusId={this.props.lineFocusId}\n            hidden={this.state.windowLoad !== \"surface3\"}\n            startWord={this.props.selectionRange.wordRange && this.props.selectionRange.wordRange.start}\n            endWord={this.props.selectionRange.wordRange && this.props.selectionRange.wordRange.end}/>\n            }\n            \n            {\n              displayComponents.includes(\"comments\")  \n              &&\n              (this.state.windowLoad === \"comments\" || this.state.mountStatus.comments) \n              &&  \n              <Comments2 \n                resourceid={this.props.resourceid + this.props.mtFocus}\n                expressionid={this.props.resourceid} \n                hidden={this.state.windowLoad !== \"comments\"}\n                selectionRange={this.props.selectionRange} // this will only apply at resourceType=text level\n                userId={this.props.userId}\n              /> \n            }\n            {displayComponents.includes(\"xml\") \n            && (this.state.windowLoad === \"xml\" || this.state.mountStatus.xml) \n            &&  \n            <XmlView \n            tresourceid={this.props.info ? this.props.info.resourceid + this.props.mtFocus : this.props.itemFocus.expression + this.props.mtFocus} \n            hidden={this.state.windowLoad !== \"xml\"}/>\n            }\n          {\n            //NOTE: always load outline (i.e. don't check mountStatus) since it reduces number of calls, as most info is the same for all paragraphs\n          }\n          {\n          displayComponents.includes(\"textOutlineWrapper\") \n          &&\n          <TextOutlineWrapper \n            focusResourceid={this.props.info ? this.props.info.resourceid : this.props.itemFocus.expression} \n            resourceid={this.props.info.topLevel} \n            title={this.props.info.topLevel} \n            hidden={this.state.windowLoad !== \"textOutlineWrapper\"} \n            mtFocus={this.props.mtFocus}\n            collectionLink={true}/> \n          }\n          {\n          displayComponents.includes(\"codexToc\") \n          &&\n          <CodexToc \n            resourceid={this.props.resourceid}\n            codexResourceType={this.props.codexResourceType}\n            hidden={this.state.windowLoad !== \"citation\"} \n          />\n          }\n          {\n            //NOTE: always load search (i.e. don't check mountStatus) to keep search results present even when navigating two different tabs\n          }\n          { displayComponents.includes(\"search\") \n          &&\n          <Search3\n            hidden={this.state.windowLoad !== \"search\"}\n            searchEid={this.props.info ? this.props.info.topLevel : this.props.resourceType === \"collection\" && this.props.resourceid}\n            searchAuthor={this.props.info ? this.props.info.author : this.props.resourceType === \"person\" && this.props.resourceid} \n            searchEType={this.props.resourceType === \"expressionType\" && this.props.resourceid}\n            searchWorkGroup={this.props.resourceType === \"workGroup\" && this.props.resourceid}\n            searchType=\"text\"\n            showSubmit={true}\n            showAdvancedParameters={true}\n            showLabels={false}\n            searchTerm={(this.props.selectionRange && this.props.selectionRange.text) ? '\"' + this.props.selectionRange.text + '\"' : \"\"}\n            />\n          }\n          \n          {\n            // text preview wrapper -- loads a text preview from expression resource id\n            this.state.windowLoad === \"textPreview\" &&  displayTextPreviewWrappers()\n          }\n          {\n            (this.state.windowLoad === \"dictionary\" && this.props.selectionRange.text) &&\n            <Dictionary text={this.props.selectionRange.text} hidden={this.state.windowLoad !== \"dictionary\"}/>\n          }\n          {\n            this.state.windowLoad === \"collationTable\" &&  \n            <div>\n              {this.state.collationTableWithRange ? \n              <CollationTable expressionIds={this.props.selectionRange.wordRange \n              ? [this.props.resourceid + \"@\" + this.props.selectionRange.wordRange.start + \"-\" + this.props.selectionRange.wordRange.end, ...this.props.ctRelatedExpressions] \n              : [this.props.resourceid, ...this.props.ctRelatedExpressions]} \n              handleOnSegDoubleClick={this.props.handleFocusChange}/>\n              :\n              <CollationTable expressionIds={[this.props.resourceid, ...this.props.ctRelatedExpressions]} \n                handleOnSegDoubleClick={this.props.handleFocusChange}/>\n              }\n              <p onClick={() => {this.setState({collationTableWithRange: !this.state.collationTableWithRange})}}>{this.state.collationTableWithRange ? \"Show without range constraint\" : \"Show with range constraint\"}</p>\n            </div>\n          }\n          {\n            this.state.windowLoad === \"surface2\" \n            &&  \n            <Surface2 \n              surfaceid={this.props.surfaceid} \n              lineFocusId={this.props.lineFocusId} \n              topLevel={this.props.info.topLevel} \n              handleSurfaceFocusChange={this.props.handleSurfaceFocusChange} \n              handleLineFocusChange={this.props.handleLineFocusChange} \n              hidden={this.state.windowLoad !== \"surface2\"}\n            />\n            }\n        </div>\n      )\n\n    }\n  \n    // TODO/NOTE: perhaps tabs should be pushed to array with component above; the same logic should apply to component as \n    // to its corresponding tab. So this should really be done once instead of twice.\n    const getAvailableTabs = () => {\n      const displayComponents = getAvailableComponents(this.props.resourceType)\n      return [\n      {\n        name: \"citation\",\n        desc: \"Text Citation\",\n        show: displayComponents.includes(\"textCitation\") \n        || displayComponents.includes(\"textCitation\")\n        || displayComponents.includes(\"personInfo\")\n        || displayComponents.includes(\"codexToc\")\n        || displayComponents.includes(\"workGroupInfo\"),\n        icon: <FaInfo/>\n      },\n      {\n        name: \"surface3\",\n        desc: \"Images\",\n        show: displayComponents.includes(\"surface3\"),\n        icon: <FaRegImage/>\n      },\n      {\n        name: \"xml\",\n        desc: \"Text XML Source\",\n        show: displayComponents.includes(\"xml\"),\n        icon: <FaCode/>\n      },\n      {\n        name: \"textCompare\",\n        desc: \"Text Comparisons\",\n        show: displayComponents.includes(\"textCompare\")\n        || displayComponents.includes(\"codex\"),\n        icon: <FaGripVertical/>\n      },\n      {\n        name: \"comments\",\n        desc: \"Comments\",\n        show: displayComponents.includes(\"comments\"),\n        icon: <FaComments/>\n      },\n      {\n        name: \"textOutlineWrapper\",\n        desc: \"Text Outline\",\n        show: displayComponents.includes(\"textOutlineWrapper\"),\n        icon: <FaAlignLeft/>\n      },\n      {\n        name: \"search\",\n        desc: \"Text Search\",\n        show: displayComponents.includes(\"search\"),\n        icon: <FaSearch/>\n      }\n    ]\n  }\n  return (\n    <div className={this.props.windowType + \" \" + this.props.windowType + this.props.openWidthHeight}>\n      <WindowNavBar handleTabChange={this.props.handleTabChange}\n      handleClose={this.props.handleClose}\n      handleMinimize={this.props.handleMinimize}\n      handleMaximize={this.props.handleMaximize}\n      handleMiddlize={this.props.handleMiddlize}\n      windowType={this.props.windowType}\n      openWidthHeight={this.props.openWidthHeight}\n      windowId={this.props.windowId}\n      windowLoad={this.props.windowLoad}\n      focus={this.props.resourceid}\n      handleSwitchWindow={this.props.handleSwitchWindow}\n      handleDuplicateWindow={this.props.handleDuplicateWindow}\n      altWindowState={this.props.altWindowState}\n      focusSet={!!this.props.info}\n      availableTabs={getAvailableTabs()}\n      />\n      {(this.state.windowLoad !== \"surface2\" && this.state.windowLoad !== \"dictionary\" ) \n      && <NextPrevBar \n      info={this.props.info} \n      handleBlockFocusChange={this.props.handleBlockFocusChange}\n      handleFocusChange={this.props.handleFocusChange}\n      selectionRange={this.props.selectionRange}\n      />}\n\n      {displayChild()}\n\n    </div>\n    );\n  }\n}\n\nWindow2.propTypes = {\n  /**\n  * Window Component\n  * \n  * \n  **/\n  handleClose: PropTypes.func, //={this.handleClose}\n  handleMinimize: PropTypes.func, //{this.handleMinimize}\n  handleMaximize: PropTypes.func, //{this.handleMaximize}\n  handleMiddlize: PropTypes.func, //{this.handleMiddlize} //TODO these functions could be reduced to window resize object\n  handleTabChange: PropTypes.func, //{this.handleTabChange}\n  handleBlockFocusChange: PropTypes.func, //={this.setFocus} //TODO this should be replaced by handleFocusChange\n  handleFocusChange: PropTypes.func, //={this.setFocus2} //TODO this should replace handleBlockFocusChange\n  handleSurfaceFocusChange: PropTypes.func, //={this.handleSurfaceFocusChange}\n  handleSwitchWindow: PropTypes.func, //={this.handleSwitchWindow}\n  handleDuplicateWindow: PropTypes.func, //{this.handleDuplicateWindow}\n  resourceid: PropTypes.string, //={this.state.focus ? this.state.focus.resourceid : this.props.resourceid}\n  windowType: PropTypes.string, //={this.state.windows[key].position}\n  windowId: PropTypes.string, //={this.state.windows[key].windowId}\n  windowLoad: PropTypes.string, //{this.state.windows[key].windowLoad}\n  openWidthHeight: PropTypes.string, //{this.state.windows[key].openWidthHeight}\n  surfaceid: PropTypes.string, // {this.state.surfaceid}\n  lineFocusId: PropTypes.string, //{this.state.lineFocusId}\n  //info: PropTypes.object, // {this.state.focus} \n  //itemFocus: PropTypes.string, // ={this.state.itemFocus} //Todo standardize this as scta url id, instead of short id\n  altWindowState: PropTypes.bool, // {this.state.windows[key].windowId === \"window1\" ? this.state.windows[\"window2\"].open : this.state.windows[\"window1\"].open} TODO could this be combined as part of a windowsParameter Object\n  mtFocus: PropTypes.string, //{this.state.mtFocus}\n  handleToggleTextLinesView: PropTypes.func, //={this.handleToggleTextLinesView}\n  annotationsDisplay: PropTypes.string, //{this.state.windows[key].annotationsDisplay} //TODO; reduce and combine by just passing windows[key]\n  handleChangeManifestation: PropTypes.func, //{this.handleChangeManifestation}\n  defaultManifestationSlug: PropTypes.string, //={this.state.windows[key].defaultManifestationSlug}: TODO as part of windows object pass\n  textPreviewObjects: PropTypes.array, //{this.state.textPreviewObjects}\n  handleTextPreviewFocusChange: PropTypes.func, //{this.handleTextPreviewFocusChange}\n  handleLineFocusChange: PropTypes.func, //{this.handleLineFocusChange}\n  selectionRange: PropTypes.object //{this.state.selectionRange}\n}\n\nexport default Window2;\n","import React, {useEffect, useState} from 'react';\nimport Axios from 'axios';\n\nconst MemberBanner = (props) => {\n  const [ipAddress, setIpAddress] = useState()\n  const [ipAddressRange, setIpAddressRange] = useState()\n  useEffect(() => {\n    getIp()\n  }, [])\n  //NOTE:TODO: this function should be to the App.js component; \n  //as the ip address only needs to be found once during the users visit\n  //if it remain here; it will unnecessarily call this function whenever this component loads.\n  const getIp = () => {\n    Axios(\"https://api.ipify.org?format=json\").then((d) => {\n    setIpAddress(d.data.ip)\n    setIpAddressRange(d.data.ip.split(\".\")[0] + \".\" + d.data.ip.split(\".\")[1] + \".\" + d.data.ip.split(\".\")[2])\n    })\n\n  }\n  const ipRangeLogoMap = {\n    \"144.126.4\": {\n      \"name\": \"Loyola Notre Dame Library\",\n      \"logoUrl\": \"https://www.lndl.org/~/media/library/images/utility/lndl_logo.svg\",\n      \"linkUrl\": \"https://www.lndl.org\"\n    },\n    \"192.124.249\": {\n      \"name\": \"Loyola Notre Dame Library\",\n      \"logoUrl\": \"https://www.lndl.org/~/media/library/images/utility/lndl_logo.svg\",\n      \"linkUrl\": \"https://www.lndl.org\"\n    },\n    \"34.196.56\": {\n      \"name\": \"Universidad de los Andes\",\n      \"logoUrl\": \"https://uniandes.edu.co/caribe/sites/default/files/logo_negro_0.png\",\n      \"linkUrl\": \"https://uniandes.edu.co\"\n    }\n  }\n\n  const getMemberInfo = () => {\n    if (ipRangeLogoMap[ipAddressRange]){\n      return ipRangeLogoMap[ipAddressRange]\n    }\n    else{\n      const indexValue = Math.floor(Math.random()*Object.keys(ipRangeLogoMap).length);\n      const keyValue = Object.keys(ipRangeLogoMap)[indexValue]\n      return ipRangeLogoMap[keyValue]\n    }\n  }\n  const memberInfo = getMemberInfo()\n  return(\n    ipAddress ?\n    <div className=\"nav-link\">\n      <span><a style={{\"color\": \"rgba(0, 0, 0, 0.5)\"}} href=\"https://community.scta.info/members\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"find out more about membership\">Member Supported</a> by: </span>\n      <a href={memberInfo.linkUrl} target=\"_blank\" rel=\"noopener noreferrer\" title={\"You are viewing content generously supported by \" + memberInfo.name}>\n        <img alt=\"member logo\" height=\"25px\" src={memberInfo.logoUrl}/>\n        </a>\n    </div>\n    \n    :\n    null\n  )\n}\n\nexport default MemberBanner;","import React from 'react';\nimport {NavLink} from 'react-router-dom';\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\nimport { withTranslation } from 'react-i18next';\nimport MemberBanner from \"./MemberBanner\"\n\n\nconst TextNavBar = (props) => {\n  \n    const { t } = props;\n    return (\n      <Navbar bg=\"light\" variant=\"light\" expand=\"lg\" fixed=\"bottom\">\n        <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n        <Navbar.Collapse id=\"basic-navbar-nav\">\n        <Nav>\n          {props.previous && <NavLink className=\"nav-link\" to={\"/text?resourceid=\" + props.previous + props.mtFocus}>{t(\"Previous\")}</NavLink>}\n          {props.next && <NavLink className=\"nav-link\" to={\"/text?resourceid=\" + props.next + props.mtFocus}>{t(\"Next\")}</NavLink>}\n          {props.topLevel && <NavLink className=\"nav-link\" to={\"/text?resourceid=\" + props.topLevel}>{t(\"Text Home\")}</NavLink>}\n          {props.pdfView ? <span className=\"nav-link\" onClick={()=>props.handleTogglePdfView()}>{t(\"Web View\")}</span> : <span className=\"nav-link\" onClick={()=>props.handleTogglePdfView()}>{t(\"Print View\")}</span>}\n          <MemberBanner/>\n        </Nav>\n        </Navbar.Collapse>\n      </Navbar>\n\n    );\n}\n\nexport default withTranslation()(TextNavBar);\n","\nimport React from 'react';\nimport Spinner from './Spinner';\nimport $ from 'jquery';\nimport {convertXMLDoc, scrollToParagraph, loadHtmlResultDocFromExist, toRange, cleanText, getContainingP, getRangeWordCount, createRange, goToGitHubEdit} from './utils'\nimport ReactTooltip from 'react-tooltip';\nimport Nav from 'react-bootstrap/Nav';\nimport {FaComments, FaEdit, FaInfo, FaBook, FaSearch} from 'react-icons/fa';\n\nclass Text extends React.Component {\n  constructor(props){\n    super(props)\n    this.retrieveText = this.retrieveText.bind(this)\n    this.handleShowToolTip = this.handleShowToolTip.bind(this)\n    this.handleHideToolTip = this.handleHideToolTip.bind(this)\n    this.handleHideFootnoteToolTip = this.handleHideFootnoteToolTip.bind(this)\n    this.handleShowFootnoteToolTip = this.handleShowFootnoteToolTip.bind(this)\n    this.handleOnToolTipClick = this.handleOnToolTipClick.bind(this)\n    this.mounted = \"\";\n    this.state = {\n      fetching: false,\n      // state.selectionRange is puposevively different than props.selection Range\n      // it governs selection state of component without yet changing focus selection State of the entire app\n      selectionRange: \"\", \n      selectionCoords: \"\",\n      dictionary: \"\"\n    }\n  }\n  retrieveText(doc, topLevel, scrollTo, selectionRange){\n    const _this = this;\n    \n    if (doc){\n      //construct file url request ot exist db to get a cors enabled copy of the text (github does not serve files with cors enabled)\n      const doc = this.props.doc;\n      const topLevel = this.props.topLevel;\n      const docFragment = doc.split(\"/master/\")[1]\n      const topLevelFragment = topLevel.split(\"/resource/\")[1]\n      \n      let xmlurl = \"\"\n      if (doc.includes(\"ipfs\")){\n        xmlurl = doc\n      }\n      else{\n        xmlurl = \"https://exist.scta.info/exist/apps/scta-app/text/\" + topLevelFragment + \"/\" + docFragment;\n      }\n      const xslurl = \"/xslt/main_view.xsl\"\n\n      //Begin fetch and conversion\n      this.setState({fetching: true})\n      //frist try to request html converted by eXist\n      const resultDocument = loadHtmlResultDocFromExist(xmlurl)\n      resultDocument.then((data) => {\n        //uncomment \"throw\" to force use of local xslt\n        //throw \"test exception\" \n        this.setState({fetching: false})\n        //appendage to file\n        //and event binding\n        //happens inside promise call back\n        document.getElementById(\"text\").innerHTML = \"\";\n        document.getElementById(\"text\").innerHTML = data.data;\n        // add event binding\n        this.setEvents(_this, scrollTo, selectionRange)\n      })\n      .catch((e) => {\n        // if eXist conversion fails, do conversion in browser\n        const resultDocument = convertXMLDoc(xmlurl, xslurl)\n        resultDocument.then((data) => {\n          this.setState({fetching: false})\n          document.getElementById(\"text\").innerHTML = \"\";\n          document.getElementById(\"text\").appendChild(data)\n          // add event binding\n          this.setEvents(_this, scrollTo, selectionRange)\n          }).catch((e) => {\n            //if browswer conversion fails, log error message\n            console.log(\"something went wrong\", e)\n            document.getElementById(\"text\").innerHTML = \"\";\n            document.getElementById(\"text\").innerHTML = \"<p>Apologies, the document is not able to be loaded at this time</p>\";\n          })\n        })\n      }\n  }\n\n  setEvents(_this, scrollTo, selectionRange){\n\n    $('.paragraphnumber').click(function(e) {\n      e.preventDefault();\n      const id = $(this).parent(\"p\").attr('id')\n      _this.props.setFocus(id)\n      _this.props.openWindow(\"window1\")\n    });\n    if (scrollTo){\n     scrollToParagraph(scrollTo, true)\n   }\n   if(selectionRange){\n    _this.markWithElement(selectionRange)\n  }\n\n  $('.js-show-figure-image').click(function(e) {\n    e.preventDefault();\n    const figureid = $(this).attr('id');\n    _this.props.setFocus(figureid)\n    if (scrollTo){\n      scrollToParagraph(scrollTo, true)\n    }\n    \n  });\n\n   $('.js-show-folio-image').click(function(e) {\n     e.preventDefault();\n     const surfaceid = $(this).attr('data-surfaceid');\n     const paragraphid = $(this).closest('.plaoulparagraph').attr(\"id\");\n\n     _this.props.setFocus(paragraphid)\n     _this.props.handleSurfaceFocusChange(\"http://scta.info/resource/\" + surfaceid)\n     _this.props.openWindow(\"window2\", \"surface2\")\n   });\n\n   $('.lbp-line-number').click(function(e) {\n     e.preventDefault();\n     const surfaceid = $(this).attr('data-surfaceid');\n     const ln = $(this).attr('data-ln');\n     const paragraphid = $(this).closest('.plaoulparagraph').attr(\"id\");\n\n     _this.props.setFocus(paragraphid)\n     _this.props.handleSurfaceFocusChange(\"http://scta.info/resource/\" + surfaceid)\n     _this.props.handleLineFocusChange(\"http://scta.info/resource/\" + surfaceid + \"/\" + ln)\n     _this.props.openWindow(\"window2\", \"surface2\")\n   });\n\n   $('.appnote, .footnote').click(function(e) {\n        e.preventDefault();\n        $(this).attr(\"data-tip\", \"hello world\")\n        const link = $(this).parent().children('.appnote, .footnote')\n        const target = $(link).attr('href')\n        const text = $(target).html()\n        const footnoteOffset = this.getBoundingClientRect()\n        _this.setState({footnoteText: text, footnoteOffset: footnoteOffset})\n        _this.handleShowFootnoteToolTip()\n        const targetText = $(this).parent().children(\".note-display\").attr('data-target-id')\n        $(\".highlight\").removeClass(\"highlight\")\n        $(\"#\" + targetText).addClass(\"highlight\")\n        $(\"span[data-corresp=\" + targetText + \"]\").addClass(\"highlight\")\n          \n      \n      });\n\n      $(document).on(\"click\", '.js-show-info', function(e) {\n        // this conditional is used prevent click event from binding event \n        // to children (like line numbers which have their own click bind)\n        if (e.target === this){\n          e.preventDefault();\n          const id = $(this).attr('data-pid')\n          _this.props.setFocus(id)\n          _this.props.openWindow(\"window1\")\n        }\n       });\n       // this seems like a repetition of line 88\n       if (scrollTo){\n        scrollToParagraph(scrollTo, true)\n      }\n\n      $(document).on(\"click\", '.show-line-witness', function(e) {\n\n        e.preventDefault();\n        const surfaceid = $(this).attr('data-surfaceid');\n        const ln = $(this).attr('data-ln');\n        \n\n        //const paragraphid = $(this).closest('.plaoulparagraph').attr(\"id\");\n        //_this.props.setFocus(paragraphid)\n\n        _this.props.handleSurfaceFocusChange(\"http://scta.info/resource/\" + surfaceid)\n        _this.props.handleLineFocusChange(\"http://scta.info/resource/\" + surfaceid + \"/\" + ln)\n        _this.props.openWindow(\"window2\", \"surface2\")\n      });\n\n      $(document).on(\"click\", '.js-show-reference-paragraph', function(e){\n        e.preventDefault();\n        \n        // this conditional is used prevent click event from binding event \n        // to children (like line numbers which have their own click bind) within diplomatic type transcriptions\n        // but within \"critical transcriptions\" we want the event to fire even if a child node is clicked.\n        // so the conditional below first checks if the data attribute data-bind-to-children is true. If it is true, then it fires\n        // if it is not true, then it only fires if the e.target is the same as this.\n        const transcriptionType = $(this).attr('data-bind-to-children')\n        if (transcriptionType === \"true\" || e.target === this){\n          \n          /** @type {string} */\n          const targetParagraph = $(this).attr('data-target-resource')\n          /** @type {string} */\n          const targetIds = $(this).attr('data-url')\n          /** @type {Array} */\n          const splitTargetId = targetIds.split(\" \")\n          /** @type {string} */\n          const targetRange = $(this).attr('data-target-range')\n          /** @type {Array} */\n          const splitTargetRange = targetRange ? targetRange.split(\" \") : null\n          /** @type {Array} */\n          const targetObjects = splitTargetId.map((i, index) => {\n            return {\n              id: i,\n              range: splitTargetRange ? splitTargetRange[index] : null\n            }\n            \n          })\n          \n          // set the desired text preview focus to the target of the reference\n          _this.props.handleTextPreviewFocusChange(targetObjects)\n          //opening bottomw window 2 to textPreview\n          _this.props.openWindow(\"window2\", \"textPreview\")\n\n      // NOTE: Order seems to make a difference here (at least in the production version)\n      // calling this.props.setFocus before handleTextPreviewFocusChange and openWindow\n      // was causing a reload that prevented desired functionality (but not on local version, only on production/deployed version)\n      // TODO: investigate further, because even thought the re-arranged order seems to be working\n      // the problem is likely to do with async timing (i.e. on job finish before another)\n      //which could vary in different enviornments\n\n          //setting paragraph focus for paragraph containing target footnote\n          _this.props.setFocus(targetParagraph)\n      }\n     })\n\n\n\n     \n      function mark(e) {\n        // hide tooltip\n        _this.handleHideToolTip();\n        //get selection object\n        var sel = document.getSelection();\n        // condition to test against invalid getRangeAt index\n        if (window.getSelection().rangeCount >= 1){\n          var rng = sel && sel.getRangeAt(0);\n          const pAncestor = getContainingP(rng.commonAncestorContainer)\n          //if selection is in a text paragraph\n          //TODO: improve this so that selections within .appnote or .footnote get excluded\n          if (pAncestor && pAncestor.className.includes(\"plaoulparagraph\")){\n            const selectedElementTargetId = pAncestor.id;\n            var cnt = rng.cloneContents();\n            $(cnt).find(\".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg\").remove();\n            // if selection is greater than 0 \n            if (cnt.textContent.length > 0){\n              //get ancestor p text\n              const pClone = $(pAncestor).clone()\n              pClone.find(\".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg\").remove();\n              \n              \n              const selectionText = cleanText(cnt.textContent)\n              \n              \n              // Get preceding word token length in order to identify start word position of selected range.\n                // NOTE: this replaces  \n                //let precedingTextArray = pText.split(cleanText(selectionText))[0].split(\" \").filter(n=>n); \n                // the above split approach was finding previous instances of the select word and giving false results.\n              let startOffset;\n              let startContainer;\n              if (rng.startOffset === 0){\n                startOffset = rng.startOffset;\n                startContainer = rng.startContainer;\n              }\n              else{\n                startOffset = rng.startOffset - 1;\n                startContainer = rng.startContainer;\n\n              }\n              const precedingRange = createRange(pAncestor, pAncestor, 0, startContainer, startOffset)\n              const precedingTextLength = getRangeWordCount(precedingRange);\n              const startToken = precedingTextLength + 1\n              const endToken = precedingTextLength + (selectionText.split(\" \").filter(n=>n).length) \n              const wordRange = {start: startToken, end: endToken}\n              \n              const oRect = rng.getBoundingClientRect();\n              const selectionRange = {\n                text: selectionText,\n                wordRange, \n                selectedElementTargetId, \n              }\n\n              _this.handleShowToolTip(selectionRange, oRect);\n            }\n          }\n        }\n      }\n      document.addEventListener('keyup', mark); // ctrl+keyup\n      document.addEventListener('mouseup', mark);// ctrl+mouseup\n    }\n  /**\n  * \n  * @param {object} selectionRange    \n  */\n  markWithElement(selectionRange){\n    // remove existing mark elements\n    this.markElementRemove()\n    //only attempt to set mark if container can be found\n    const container = document.getElementById(selectionRange.selectedElementTargetId);\n    // NOTE: this conditional is a backup test, \n    //required properties should already be check in didUpdate method\n    if (container && selectionRange.wordRange){\n      const range = toRange(container, selectionRange.wordRange.start, selectionRange.wordRange.end)\n      const cnt = range.extractContents();\n      const node = document.createElement('mark');\n      node.style.backgroundColor = \"#BBCEBE\";\n      node.appendChild(cnt);\n      range.insertNode(node);\n      //get selection text from clone\n      const clone = $(node).clone();\n      $(clone).find(\".lbp-line-number, .paragraphnumber, br, .lbp-folionumber, .appnote, .footnote, .lbp-reg\").remove();\n      selectionRange.text = cleanText($(clone).text());\n      this.props.handleUpdateSelectionRange(selectionRange)\n    }\n  }\n  /**\n   * @description finds any exiting mark element and removes it\n   */\n  markElementRemove(){\n    $('mark').contents().unwrap();\n  }\n  handleOnToolTipClick(windowLoad, window = \"window1\"){\n    const selectionRange = this.state.selectionRange\n    console.log(\"selection range test\", selectionRange)\n    // send selectionRange up to App State\n    this.markWithElement(selectionRange);\n    const s = selectionRange;\n    this.props.setFocus(s.selectedElementTargetId + \"@\" + s.wordRange.start + \"-\" + s.wordRange.end)\n    // open display window\n    this.props.openWindow(window, windowLoad)\n  }\n  handleHideToolTip(){\n    ReactTooltip.hide(this.fooRef)\n  }\n  handleHideFootnoteToolTip(){\n    ReactTooltip.hide(this.foonoteRef)\n  }\n  /**\n   * @description show tool tip relative to selected text\n   * @param {{\n      text: string,\n      wordRange: object, \n      selectedElementTargetId: string,\n    }} selectionRange - object contain needed if about selectedRange\n   * @param {object} - coords object resulting from from current selection\n   */\n  handleShowToolTip(selectionRange, selectionCoords){\n    if (this.mounted) // NOTE: conditional was added because react was complaining of memory leak\n    {\n      this.setState({selectionRange: selectionRange, selectionCoords: selectionCoords})\n      ReactTooltip.show(this.fooRef)\n    }\n  }\n  handleShowFootnoteToolTip(){\n    ReactTooltip.show(this.foonoteRef)\n  }\n  componentDidMount(){\n    this.mounted = true;\n    // NOTE: ScrollToNew helps ensure that scrollTo id is SCTA ShortID, \n    // since TextWrapper is (at present) sometimes sending the shortid and sometimes the full url id\n    // TODO: when TextWrapper is refactored and consistently sending the same ID type. this should be removed\n    const scrollToNew = this.props.scrollTo && this.props.scrollTo.includes(\"/resource/\") ? this.props.scrollTo.split(\"/resource/\")[1] : this.props.scrollTo\n    this.retrieveText(this.props.doc, this.props.topLevel, scrollToNew, this.props.selectionRange)\n  }\n\n  componentDidUpdate(prevProps, prevState){\n\n    //check to see if doc has changed\n    if (prevProps.doc !== this.props.doc){\n      // NOTE: ScrollToNew helps ensure that scrollTo id is SCTA ShortID, \n      // since TextWrapper is (at present) sometimes sending the shortid and sometimes the full url id\n      // TODO: when TextWrapper is refactored and consistently sending the same ID type. this should be removed\n      const scrollToNew = this.props.scrollTo && this.props.scrollTo.includes(\"/resource/\") ? this.props.scrollTo.split(\"/resource/\")[1] : this.props.scrollTo\n      this.retrieveText(this.props.doc, this.props.topLevel, scrollToNew, this.props.selectionRange)\n    }\n    // if doc has already been appended, still scroll to target block\n    else{\n      if (this.props.scrollTo !== prevProps.scrollTo){\n        // NOTE: ScrollToNew helps ensure that scrollTo id is SCTA ShortID, \n        // since TextWrapper is (at present) sometimes sending the shortid and sometimes the full url id\n        // TODO: when TextWrapper is refactored and consistently sending the same ID type. this should be removed\n        const scrollToNew = this.props.scrollTo && this.props.scrollTo.includes(\"/resource/\") ? this.props.scrollTo.split(\"/resource/\")[1] : this.props.scrollTo\n        scrollToParagraph(scrollToNew, true)\n        \n        // set mark if object is present with required properties\n        if (this.props.selectionRange.selectedElementTargetId && this.props.selectionRange.wordRange){\n          this.markWithElement(this.props.selectionRange)\n        }\n        else{\n          this.markElementRemove()\n        }\n      }\n      // TODO/Note: this seems to be firing even when it seems like the prevProps.doc !== this.props.doc\n      // perhaps props are not changing/updating at the same time. So the doc prop has already changed\n      // then the range changes and tries to mark element, but the retrieve text asynch request has not finished \n      // and so the marking container element cannot be found. \n      // NOTE: error solved by preventing attempt to mark if container cannot be found. \n      // but it doesn't seem great that this is firing at undesired times.\n      else if (this.props.selectionRange.wordRange !== prevProps.selectionRange.wordRange && this.props.selectionRange.selectedElementTargetId){\n        this.markWithElement(this.props.selectionRange)\n      }\n      //final check if selection range required properties are removed then remove existing mark\n      else if (!this.props.selectionRange.selectedElementTargetId && !this.props.selectionRange.wordRange) {\n        this.markElementRemove()\n      }\n    }\n    \n  }\n  componentWillUnmount(){\n    this.mounted = false;\n  }\n  \n  render(){\n    const displayText = this.state.fetching ? \"none\" : \"block\"\n\n    return (\n      <div>\n        {\n          this.state.fetching\n          &&\n          <div style={{position: \"fixed\", top: \"50%\", left: \"50%\"}}>\n          <Spinner/>\n          </div>\n        }\n        \n        {this.state.selectionRange && <p ref={ref => this.fooRef = ref} data-tip='tooltip' data-for=\"selection\" style={{position: \"fixed\", top: this.state.selectionCoords.top + 10, left: this.state.selectionCoords.left}}></p>}\n        {this.state.footnoteText && <p ref={ref => this.foonoteRef = ref} data-tip='tooltip' data-for=\"footnote\" style={{position: \"fixed\", top: this.state.footnoteOffset.top + 10, left: this.state.footnoteOffset.left}}></p>}\n        <ReactTooltip clickable={true} place=\"top\" id=\"selection\">\n            {this.state.selectionRange &&\n            <Nav>\n              <Nav.Link title={this.state.selectionRange.wordRange.start + \"-\" +this.state.selectionRange.wordRange.end} onClick={() => {this.handleOnToolTipClick(\"citation\")}}><FaInfo/></Nav.Link>\n              <Nav.Link onClick={() => {this.handleOnToolTipClick(\"comments\")}}><FaComments/></Nav.Link>\n              {(this.state.selectionRange.text && this.state.selectionRange.text.split(\" \").length === 1) && \n              <Nav.Link onClick={() => {goToGitHubEdit(this.props.doc, this.state.selectionRange.text, this.state.selectionRange.selectedElementTargetId)}}><FaEdit/></Nav.Link>\n              }\n              <Nav.Link onClick={() => {this.handleOnToolTipClick(\"search\")}}><FaSearch/></Nav.Link>\n              {(this.state.selectionRange.text && this.state.selectionRange.text.split(\" \").length === 1) && \n              <Nav.Link title=\"look up word\" onClick={()=>this.handleOnToolTipClick(\"dictionary\", \"window2\")}><FaBook/></Nav.Link>\n              }\n              \n            </Nav>\n            }\n        </ReactTooltip>\n        <ReactTooltip id=\"footnote\" clickable={true} place=\"top\">\n        \n          <p dangerouslySetInnerHTML={{ __html: this.state.footnoteText}}></p>\n        </ReactTooltip>\n        <div id=\"text\" style={{display: displayText}}></div>\n      </div>\n\n    );\n  }\n}\n\nexport default Text;\n","import React from 'react';\nimport {Link} from 'react-router-dom';\nfunction Item(props) {\n  const displayItem = () => {\n    // conditions prevents attempt to render when props.item is not present\n    if (props.item){\n      return (\n        <tr>\n          {props.item.author && <td><Link to={\"/text?resourceid=\" + props.item.author}>{props.item.authorTitle}</Link></td>}\n          <td><Link to={\"/text?resourceid=\" + props.item.id}>{props.item.title}</Link></td>\n          {props.item.questionTitle && <td><Link to={\"/text?resourceid=\" + props.item.id}>{props.item.questionTitle}</Link></td>}\n        </tr>\n      )\n    }\n    else{\n      return null\n    }\n  }\n  return (\n    displayItem()\n  );\n}\n\nexport default Item;\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport Table from 'react-bootstrap/Table';\nimport {runQuery} from './utils'\nimport {getAuthorInformation} from './Queries'\nimport Item from \"./Item\"\n\n//import Lbp from \"lbp.js/lib\"\n\n\nclass AuthorCollection extends React.Component {\n  constructor(props){\n    super(props)\n\n    this.retrieveAuthorCollectionInfo = this.retrieveAuthorCollectionInfo.bind(this)\n    this.handleItemFilter = this.handleItemFilter.bind(this)\n    this.itemFilter = React.createRef();\n\n    this.mount = false\n    this.state = {\n      authorTitle: \"\",\n      authorArticles: [],\n      textArticles: [],\n      expressions: [],\n      itemFilter: \"\",\n    }\n\n  }\n  handleItemFilter(e){\n    const item = e.target.value\n    this.setState({itemFilter: item})\n\n  }\n  arrangeItems(itemsPromise, resourceid){\n    itemsPromise.then((d) => {\n      // author get with conditional fall back due to strange changing behavior in results\n      let author = d.data[\"@graph\"].filter((i) => i[\"@id\"] === resourceid.replace(\"http://scta.info/resource/\", \"sctar:\"))[0]\n      if (!author){\n        author = d.data[\"@graph\"].filter((i) => i[\"@id\"] === resourceid)[0]\n      }\n      const authorTitle = author[\"dc:title\"]\n      \n      let authorArticles = null\n      if(Array.isArray(author[\"sctap:authorArticle\"])){\n        authorArticles =  author[\"sctap:authorArticle\"].map((a) => {\n          return {\n            id: a[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"),\n            //change due to fuseki 4.3.1 update \n            //title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === a)[0][\"http://purl.org/dc/elements/1.1/title\"]\n            title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === a[\"@id\"])[0][\"dc:title\"]\n          }\n        })\n      }\n      else if (author[\"sctap:authorArticle\"]){\n        authorArticles = [{id: author[\"sctap:authorArticle\"][\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"), title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === author[\"sctap:authorArticle\"][\"@id\"])[0][\"dc:title\"]}]\n      }\n      let textArticles = null\n      if(Array.isArray(author[\"sctap:textArticle\"])){\n          textArticles =  author.textArticle.map((a) => {\n          return {\n            id: a[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"),\n            title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === a[\"@id\"])[0][\"dc:title\"]\n          }\n        })\n      }\n      else if (author[\"sctap:textArticle\"]){\n        textArticles = [{id: author[\"sctap:textArticle\"][\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"), title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === author[\"sctap:textArticle\"][\"@id\"])[0][\"dc:title\"]}]\n      }\n\n      let expressions = null\n      if(Array.isArray(author[\"sctap:hasTopLevelExpression\"])){\n        expressions =  author[\"sctap:hasTopLevelExpression\"].map((a) => {\n          return {\n            id: a[\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"),\n            title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === a[\"@id\"])[0][\"dc:title\"]\n          }\n        })\n      }\n      else if (author[\"sctap:hasTopLevelExpression\"]){\n        expressions = [{id: author[\"sctap:hasTopLevelExpression\"][\"@id\"].replace(\"sctar:\", \"http://scta.info/resource/\"), title: d.data[\"@graph\"].filter((i) => i[\"@id\"] === author[\"sctap:hasTopLevelExpression\"][\"@id\"])[0][\"dc:title\"]}]\n      }\n      console.log(\"expressions\", expressions)\n      if (this.mount){\n        this.setState({authorArticles: authorArticles, textArticles: textArticles, expressions: expressions, authorTitle: authorTitle })\n      }\n      \n    })\n    .catch((err) => {\n      console.log(err)\n    })\n  }\n\n  retrieveAuthorCollectionInfo(resourceid){\n    const authorCollectionInfo = runQuery(getAuthorInformation(resourceid))\n    /// add items to state\n    this.arrangeItems(authorCollectionInfo, resourceid)\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.resourceid !== prevProps.resourceid){\n      this.refs.itemFilter ? this.refs.itemFilter.value = \"\" :\n      this.retrieveAuthorCollectionInfo(this.props.resourceid)\n    }\n  }\n  componentDidMount(){\n    this.mount = true\n    this.retrieveAuthorCollectionInfo(this.props.resourceid)\n\n  }\n  componentWillUnmount(){\n    this.mount = false\n  }\n  render(){\n    //const resourceid = Qs.parse(this.props.location.search, { ignoreQueryPrefix: true }).resourceid;\n\n    const displayItems = (list) => {\n      const items = list.map((i) => {\n        return (\n\n          <Item key={i.id} item={i}/>\n\n        )\n      });\n      return items\n    }\n\n\n\n\n\n\n    return (\n      <Container className=\"collectionBody\">\n      <h1>{this.state.authorTitle}</h1>\n      \n        {this.state.expressions &&\n        <Container>\n        <h1>Expressions</h1>\n        <br/>\n        <Table striped bordered hover size=\"sm\">\n        <tbody>\n        {displayItems(this.state.expressions)}\n        </tbody>\n        </Table>\n        </Container>\n      }\n      {this.state.authorArticles &&\n        <Container>\n        <h1>Author Related Articles</h1>\n        <br/>\n        <Table striped bordered hover size=\"sm\">\n        <tbody>\n        {displayItems(this.state.authorArticles)}\n        </tbody>\n        </Table>\n        </Container>\n      }\n      {this.state.textArticles &&\n        <Container>\n        <h1>Text Related Articles</h1>\n        <br/>\n        <Table striped bordered hover size=\"sm\">\n        <tbody>\n        {displayItems(this.state.textArticles)}\n        </tbody>\n        </Table>\n        </Container>\n      }\n      </Container>\n    );\n  }\n}\n\nexport default AuthorCollection;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Axios from 'axios'\nimport Alert from 'react-bootstrap/Alert';\nimport { withTranslation } from 'react-i18next';\n\nimport {runQuery} from './utils'\nimport {versionHistoryInfo} from './Queries'\n\nclass VersionChain extends React.Component {\n  constructor(props){\n    super(props)\n    this.getVersionHistory = this.getVersionHistory.bind(this)\n    this.handleToggleShowVersions = this.handleToggleShowVersions.bind(this)\n    this.state = {\n      versions: [],\n      currentVersion: \"\",\n      showVersions: false\n    }\n  }\n  handleToggleShowVersions(){\n    this.setState((prevState) => {\n      return {showVersions: !prevState.showVersions}\n    })\n  }\n  getVersionHistory(transcriptionid){\n      const versionChainInfo = runQuery(versionHistoryInfo(transcriptionid))\n      versionChainInfo.then((d) => {\n        const b = d.data.results.bindings\n        b.forEach((b, i) => {\n          var reviewUrl = \"https://dll-review-registry.scta.info/api/v1/reviews/?url=\" + b.doc.value + \"?society=MAA\"\n          Axios(reviewUrl).then((d2) => {\n            const data = d2.data\n            var reviewObject = {}\n            if (data.length > 0){\n              reviewObject = {\n                img_url: data[0][\"badge-url\"],\n                reviewid: data[0][\"id\"],\n                ipfsHash: data[0][\"ipfs-hash\"],\n                html_link: \"https://dll-review-registry.scta.info/reviews/\" + data[0][\"id\"] + \".html\",\n                rubric_link: data[0][\"badge-rubric\"],\n                summary: data[0][\"review-summary\"]\n              }\n            }\n            this.setState((prevState) => {\n              const newVersion = {\n                versionTranscription: b.version ? b.version.value : \"\",\n                versionLabel: b.version_label ? b.version_label.value : \"\",\n                versionOrderNumber: b.order_number ? b.order_number.value : \"\",\n                versionReview: b.review ? b.review.value : \"\",\n                versionDoc: b.doc ? b.doc.value : \"\",\n                versionReviewInfo: reviewObject,\n              }\n              return {\n                versions: [...prevState.versions, newVersion],\n                currentVersion: transcriptionid\n              }\n            })\n          })\n        })\n      })\n    }\n  componentDidMount(){\n    //prevents call when itemInfo prop is not present\n    if (this.props.transcriptionid){\n      this.getVersionHistory(this.props.transcriptionid)\n    }\n  }\n  componentDidUpdate(prevProps, prevState){\n    if (this.props.transcriptionid !== prevProps.transcriptionid){\n      console.log('running fetch')\n      this.setState({versions: []}, () => {\n        this.getVersionHistory(this.props.transcriptionid)\n      })\n    }\n}\n  render(){\n    const { t } = this.props;\n    const displayVersions = () => {\n      const versions = this.state.versions.map((v) => {\n        const currentlyViewing = v.versionTranscription === this.state.currentVersion ? \"currentlyViewing\" : \"\"\n        const gitHubEdit = v.versionDoc.includes(\"github.com\") && v.versionDoc.replace(\"/raw/\", \"/edit/\")\n        //NOTE this topLevel get is a precarious shortcut, it could be inherited as a prop from a previous sparql query\n        const topLevelShortId = v.versionDoc.includes(\"github.com\") && v.versionDoc.split(\"/scta-texts/\")[1].split(\"/\")[0]\n        const gitHubIssues = \"https://github.com/scta-texts/\" + topLevelShortId + \"issues\";\n        return (<p key={v.versionTranscription} className={currentlyViewing + \" small\"}>\n          {currentlyViewing ? <span>{v.versionLabel} {t(\"(Currently Viewing)\")}</span> : <span className=\"lbp-span-link\" onClick={()=>{this.props.handleFocusChange(v.versionTranscription)}}>{v.versionLabel}</span>}\n          {v.versionReviewInfo.html_link && <span> {t(\"Peer Reviewed\")}: <a href={v.versionReviewInfo.html_link}><img alt=\"review\" src={v.versionReviewInfo.img_url}/></a> </span>}\n          <span className=\"small\"> {t(\"Data Source\")}: <a href={v.versionDoc}>{v.versionDoc}</a> </span>\n          {gitHubEdit && <span className=\"small\"> | <a href={gitHubEdit} target=\"_blank\" rel=\"noopener noreferrer\"> Edit on <img src=\"github-octocat-logo.png\" alt=\"github\" height=\"25px\"/> Github</a> or <a href={gitHubIssues} target=\"_blank\" rel=\"noopener noreferrer\">Create a GitHub Issue</a></span>}\n          </p>)\n      })\n      return versions\n    }\n    const displayAlert = () => {\n      if (this.state.versions){\n        if (this.state.versions.length > 1){\n          return (\n            <Alert variant=\"info\">\n              <p onClick={this.handleToggleShowVersions} className=\"small\">{t(\"This Text Has Multiple Indexed Versions\")}</p>\n              {this.state.showVersions && displayVersions()}\n            </Alert>\n          )\n        }\n        else if (this.state.versions.length === 1){\n          const version = this.state.versions[0]\n          const gitHubEdit = version.versionDoc.includes(\"github.com\") && version.versionDoc.replace(\"/raw/\", \"/edit/\")\n          //NOTE this topLevel get is a precarious shortcut, it could be inherited as a prop from a previous sparql query\n          const topLevelShortId = version.versionDoc.includes(\"github.com\") && version.versionDoc.split(\"/scta-texts/\")[1].split(\"/\")[0]\n          const gitHubIssues = \"https://github.com/scta-texts/\" + topLevelShortId + \"/issues\";\n          \n          return (<Alert className=\"versioninfobox\" variant=\"info\">\n            <span className=\"small\">{t(\"Version\")}: {version.versionLabel} \n            | \n            {t(\"Data Source\")}: <a href={version.versionDoc}>{version.versionDoc}</a> \n            </span>\n            {gitHubEdit && <span className=\"small\"> | <a href={gitHubEdit} target=\"_blank\" rel=\"noopener noreferrer\"> Edit on <img src=\"github-octocat-logo.png\" alt=\"github\" height=\"25px\"/> Github</a> or <a href={gitHubIssues} target=\"_blank\" rel=\"noopener noreferrer\">Create a GitHub Issue</a></span>}\n          </Alert>\n          )\n        }\n        else{\n          return null\n        }\n      }\n      else {\n        return null\n      }\n    }\n    return (\n      displayAlert()\n    );\n  }\n}\nVersionChain.propTypes = {\n  /**\n  * transcription resource id of focused passage,\n  * transcription id is required, because a specific text passage is being complicated\n  */\n  transcriptionid: PropTypes.string.isRequired,\n  /**\n  * handleFocusChange; a function carrying desired behavior\n  * when you user selects non-current version\n  */\n  handleFocusChange: PropTypes.func.isRequired\n}\n\nexport default withTranslation()(VersionChain);\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport {Link} from 'react-router-dom';\nimport {runQuery} from './utils'\nimport {basicStructureAllItemsInfoQuery, partsInfoQuery,workGroupExpressionQuery} from './Queries'\nimport TextOutlineWrapper from \"./TextOutlineWrapper\"\n//import Lbp from \"lbp.js/lib\"\n\n\nclass Collection extends React.Component {\n  constructor(props){\n    super(props)\n    this.retrieveCollectionInfo = this.retrieveCollectionInfo.bind(this)\n    this.makeRequests = this.makeRequests.bind(this)\n    this.handleFilter = this.handleFilter.bind(this)\n    this.filter = React.createRef();\n    this.mount = false\n    this.state = {\n      title: \"\",\n      description: \"\",\n      items: {},\n      parts: {},\n      filter: \"\"\n    }\n\n  }\n  handleFilter(e){\n    const item = e.target.value\n    this.setState({filter: item})\n\n  }\n  arrangeParts(partsPromise){\n    const _this = this\n    partsPromise.then((d) => {\n        const bindings = d.data.results.bindings\n        const title = bindings[0].title.value\n        const description = bindings[0].description.value\n        let partsObject = {}\n        bindings.forEach((b) => {\n          const pId = b.part.value\n          partsObject[pId] = {\n            id: b.part.value,\n            title: b.partTitle.value,\n            type: b.partType.value,\n            questionTitle: b.partQuestionTitle ? b.partQuestionTitle.value : null,\n            level: b.partLevel ? b.partLevel.value : \"unknown\",\n        }\n      });\n      if (this.mount){\n        _this.setState(\n          {\n            title,\n            description,\n            parts: partsObject\n          }\n        )\n      }\n    });\n  }\n  arrangeItems(itemsPromise){\n    const _this = this\n    itemsPromise.then((d) => {\n      const bindings = d.data.results.bindings\n      let itemsObject = {}\n      bindings.forEach((b) => {\n        const itemId = b.item.value\n        itemsObject[itemId] = {\n          title: b.itemTitle.value,\n          id: b.item.value,\n          type: b.itemType.value,\n          questionTitle: b.itemQuestionTitle ? b.itemQuestionTitle.value : null,\n          author: b.itemAuthor ? b.itemAuthor.value : null,\n          authorTitle: b.itemAuthorTitle ? b.itemAuthorTitle.value : null,\n          next: b.next ? b.next.value : null,\n          previous: b.previous ? b.previous.value : null,\n          cm: b.cm ? b.cm.value : null,\n          cmTitle: b.cmTitle ? b.cmTitle.value : null,\n          ct: b.ct ? b.ct.value : null,\n          topLevel: b.topLevel ? b.topLevel.value : null,\n          doc: b.doc ? b.doc.value : null\n        }\n      });\n      if (this.mount){\n        _this.setState(\n          {\n            items: itemsObject\n          }\n        )\n      }\n    })\n    .catch((err) => {\n      console.log(err)\n    })\n  }\n\n  retrieveWorkGroupInfo(resourceid){\n    const expressionsInfo = runQuery(workGroupExpressionQuery(resourceid))\n    const partsInfo = runQuery(partsInfoQuery(resourceid))\n    this.arrangeParts(partsInfo)\n    this.arrangeItems(expressionsInfo)\n  }\n  retrieveCollectionInfo(resourceid, structureType, topLevel){\n    const collectionInfo = runQuery(basicStructureAllItemsInfoQuery(topLevel))\n    const partsInfo = runQuery(partsInfoQuery(resourceid))\n\n    //add parts to state\n    this.arrangeParts(partsInfo)\n    /// add items to state\n    this.arrangeItems(collectionInfo)\n  }\n  makeRequests(newResourceId, structureType, topLevel, type){\n\n    //\n    //   // get all expressions for this workGroup\n      if (type === \"http://scta.info/resource/workGroup\"){\n          this.retrieveWorkGroupInfo(newResourceId, structureType, topLevel)\n          //this.setState({itemFocus: \"\"})\n      }\n      // get all items for this collection\n      else if (structureType === \"http://scta.info/resource/structureCollection\"){\n          this.retrieveCollectionInfo(newResourceId, structureType, topLevel)\n          //this.setState({itemFocus: \"\"})\n      }\n\n  }\n  \n  componentDidMount(){\n    this.mount = true\n    this.setState({resourceid: this.props.resourceid})\n    this.makeRequests(this.props.resourceid, this.props.structureType, this.props.topLevel, this.props.type)\n\n  }\n\n  // UNSAFE_componentWillReceiveProps(nextProps) {\n\n  //   // conditional prevents new information requestion if resource id has not changed\n  //   if (nextProps.resourceid !== this.props.resourceid){\n  //     this.setState({resourceid: nextProps.resourceid, filter: \"\"})\n  //     // this conditional resets form value if ref is present\n  //     // if (this.filter){\n  //     //   this.filter.current.value = \"\"\n  //     // }\n  //     this.makeRequests(nextProps.resourceid, nextProps.structureType, nextProps.topLevel, nextProps.type)\n  //   }\n  // }\n  componentDidUpdate(prevProps) {\n\n    // conditional prevents new information requestion if resource id has not changed\n    if (this.props.resourceid !== prevProps.resourceid){\n      this.setState({resourceid: this.props.resourceid, filter: \"\"})\n      // this conditional resets form value if ref is present\n      // if (this.filter){\n      //   this.filter.current.value = \"\"\n      // }\n      this.makeRequests(this.props.resourceid, this.props.structureType, this.props.topLevel, this.props.type)\n    }\n  }\n  componentWillUnmount(){\n    this.mount = false\n  }\n  render(){\n    return (\n      <Container className=\"collectionBody\">\n      {this.state.title && <h1>{this.state.title}</h1>}\n      {this.state.title && <p style={{\"textAlign\": \"center\"}}>{this.state.description}</p>}\n      {\n        //<p style={{\"textAlign\": \"center\"}}><Link to={\"/text?resourceid=http://scta.info/resource/scta\"}>Back to Top Level</Link></p>\n      }\n\n      <Row>\n        <Col xs={9}>\n          <Container>\n              <TextOutlineWrapper\n                focusResourceid={this.state.resourceid}\n                resourceid={this.state.resourceid}\n                title={this.state.title}\n                hidden={false}\n                mtFocus={\"\"}\n                collectionLink={true}\n                showAuthor={true}\n                showParentLink={true}\n                showChildren={true}\n                showFirstLevelChildren={true}\n                />\n          </Container>\n        </Col>\n      </Row>\n      {this.state.resourceid === \"http://scta.info/resource/scta\" &&\n      <div>\n        <h1>Special Collections</h1>\n        <p><Link to={\"/res?resourceid=http://scta.info/resource/et-000004\"}>Magnetica</Link>: A collection of texts on \"Magnets\"</p>\n      </div>}\n      </Container>\n\n    );\n  }\n}\n\nexport default Collection;\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport PropTypes from 'prop-types';\nimport Axios from 'axios'\n\nimport ImageLogo from './ImageLogo';\nimport ImageTextWrapper from './ImageTextWrapper';\n\nimport {runQuery} from './utils'\nimport {getSurfaceInfo, getBlockLines} from './Queries'\n\nclass Surface3 extends React.Component {\n  constructor(props){\n    super(props)\n    this.mounted = \"\"\n    this.handleNext = this.handleNext.bind(this)\n    this.handlePrevious = this.handlePrevious.bind(this)\n    this.state = {\n      region: \"full\",\n      surfaces: [\n      ]\n    }\n\n  }\n  handleNext(){\n    //this.retrieveSurfaceInfo(this.state.next)\n    this.props.handleSurfaceFocusChange(this.state.next)\n  }\n  handlePrevious(){\n    //this.retrieveSurfaceInfo(this.state.previous)\n    this.props.handleSurfaceFocusChange(this.state.previous)\n\n  }\n  retrieveSurfaceInfo(manifestationid){\n    // manifest id should be retrieved from query\n    // this is a temporary measure until db is corrected and query is posible\n    const blockLineInfo = runQuery(getBlockLines(manifestationid))\n    blockLineInfo.then((d1) => {\n      d1.data.results.bindings.forEach((z) => {\n        const surfaceid = z.surface.value\n        const firstLine = z.first.value\n        const lastLine = z.last.value\n        const order = z.order.value\n        //const manifest = \"http://scta.info/iiif/\" + this.props.topLevel.split(\"/resource/\")[1] + \"/\" + surfaceid.split(\"/resource/\")[1].split(\"/\")[0] + \"/\" + \"manifest\";\n        const surfaceInfo = runQuery(getSurfaceInfo(surfaceid))\n        surfaceInfo.then((d) => {\n          const b = d.data.results.bindings[0]\n          // only preceed if sparql query returns results\n          if (b){\n            //second nested async call for annotation list\n            const alUrl = \"https://exist.scta.info/exist/apps/scta-app/folio-annotaiton-list-from-simpleXmlCoordinates.xq?surfaceid=\" + surfaceid.split(\"/resource/\")[1] + \"&coords=loose\"\n            Axios.get(alUrl).then((d2) => {\n              //const resources = d2.data.resources\n              if (this.mounted){\n                this.setState((prevState) => {\n                  const newSurface = {\n                    currentSurfaceId: surfaceid,\n                    surfaceTitle: b.surfaceTitle ? b.surfaceTitle.value : \"\",\n                    //manifest: manifest,\n                    canvas: b.canvas.value,\n                    imageurl: b.imageurl.value,\n                    next: b.next_surface ? b.next_surface.value : \"\",\n                    previous: b.previous_surface ? b.previous_surface.value : \"\",\n                    annotations: d2.data ? d2.data.resources : \"\",\n                    surfaceid: surfaceid,\n                    firstLine: firstLine,\n                    lastLine: lastLine,\n                    order: order\n\n                  }\n                return {\n                  surfaces: [\n                    ...prevState.surfaces,\n                    newSurface\n                    ]\n                  }\n                })\n              }\n            }).catch((error) => {\n              if (this.mounted){\n                this.setState((prevState) => {\n                  const newSurface = {\n                    currentSurfaceId: surfaceid,\n                    surfaceTitle: b.surfaceTitle.value,\n                    //manifest: manifest,\n                    canvas: b.canvas.value,\n                    imageurl: b.imageurl.value,\n                    next: b.next_surface ? b.next_surface.value : \"\",\n                    previous: b.previous_surface ? b.previous_surface.value : \"\",\n                    annotations: \"\",\n                    surfaceid: surfaceid,\n                    firstLine: firstLine,\n                    lastLine: lastLine,\n                    order: order\n\n                  }\n                return {\n                  surfaces: [\n                    ...prevState.surfaces,\n                    newSurface\n                  ]\n                }\n              })\n            }\n          })\n        }\n      })\n    })\n  })\n}\ncomponentDidMount(){\n  this.mounted = true\n    if (this.props.manifestationid){\n      this.setState((prevState) => {\n        return {\n          surfaces: []\n        }\n      },\n      this.retrieveSurfaceInfo(this.props.manifestationid)\n    )\n    }\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.manifestationid !== prevProps.manifestationid){\n      this.setState((prevState) => {\n        return {\n          surfaces: []\n        }\n\n      },\n    this.retrieveSurfaceInfo(this.props.manifestationid))\n    }\n  }\n  componentWillUnmount(){\n    this.mounted = false\n  }\n  render() {\n    const displayAllImages = () => {\n      const sortedSurfaces = this.state.surfaces.sort((a, b) => {\n        if (a.order > b.order) return 1;\n        if (b.order > a.order) return -1;\n        return 0;\n      })\n      const surfacesDisplay = sortedSurfaces.map((surface) => {\n        return displayImages(surface)\n      })\n      return surfacesDisplay\n    }\n    const displayImages = (surface) => {\n      // handle line display\n      if (surface.annotations && this.props.annotationsDisplay === \"lines\"){\n        const imageTextWrappers = surface.annotations.map((h, i) => {\n\n          if (i + 1 >= surface.firstLine && i < surface.lastLine){\n            const text = h.resource.chars;\n            const canvas = h.on.split(\"#xywh=\")[0];\n            const canvasShort = canvas.split(\"/\")[canvas.split(\"/\").length - 1];\n            const coords = h.on.split(\"#xywh=\")[1];\n            const imageUrl = h.imageUrl\n            const label = h.label\n            return (\n              <ImageTextWrapper key={i}\n                imageUrl={imageUrl}\n                canvas={canvas}\n                coords={coords}\n                canvasShort={canvasShort}\n                text={text}\n                label={label}\n                number={i + 1}\n                targetLabel={this.props.targetLabel}\n                surfaceButton={false}\n                displayWidth={this.props.width}\n                />\n              )\n            }\n            else{\n              return null\n            }\n\n        })\n        return imageTextWrappers\n      }\n      // handle paragraph display\n      else if (surface.annotations && this.props.annotationsDisplay === \"paragraph\"){\n        // sometimes surface annotations is an array (tested with surface.annotations.length) sometimes (when there is only one result) it is an object\n        const h = surface.annotations.length ? surface.annotations[surface.firstLine - 1] : surface.annotations;\n        const fl = surface.annotations.length ? surface.annotations[surface.firstLine - 1] : surface.annotations;\n        const flcanvas = fl ? fl.on.split(\"#xywh=\")[0] : \"\"\n        const flcanvasShort = flcanvas.split(\"/\")[flcanvas.split(\"/\").length - 1];\n        const flcoords = fl ? fl.on.split(\"#xywh=\")[1] : \"\"\n        const y = flcoords.split(\",\")[1]\n        const ll = surface.annotations.length ? surface.annotations[surface.lastLine - 1] : surface.annotations\n        //const llcanvas = ll ? ll.on.split(\"#xywh=\")[0] : \"\"\n        //const llcanvasShort = llcanvas.split(\"/\")[llcanvas.split(\"/\").length - 1];\n        const llcoords = ll ? ll.on.split(\"#xywh=\")[1] : \"\"\n        const lly = llcoords.split(\",\")[1]\n        const llh = llcoords.split(\",\")[3]\n        const llbottom = (parseInt(lly) + parseInt(llh)) - parseInt(y)\n        //x widens the column by 10, but only if the x is greater than 10\n        const x = parseInt(flcoords.split(\",\")[0]) > 10 ? parseInt(flcoords.split(\",\")[0]) - 10 : parseInt(flcoords.split(\",\")[0])\n        const coords = x + \",\" + (parseInt(y)) + \",\" + (parseInt(flcoords.split(\",\")[2]) + 10) + \",\" + (parseInt(llbottom) + 50)\n        const text = \"\"\n        const imageUrl = h ? h.imageUrl : \"\"\n        // check to see if an Image Url has been found.\n        // if not show \"error message\"\n        \n        // get line coordinates for focused line\n        let lineFocusCoords = \"\"\n        if (this.props.lineFocusId){\n          if (!surface.annotations.length){\n            const h = surface.annotations;\n            const i = 0;\n            if (parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1]) === (i + 1) ){\n              lineFocusCoords = h.on.split(\"#xywh=\")[1];\n              }\n          }\n          else{\n            surface.annotations.forEach((h, i) => {\n            if (parseInt(this.props.lineFocusId.split(\"/\")[this.props.lineFocusId.split(\"/\").length - 1]) === (i + 1) ){\n              lineFocusCoords = h.on.split(\"#xywh=\")[1];\n              }\n            })\n          }\n        }\n        if (imageUrl){\n          return (\n            <ImageTextWrapper\n              key={surface.currentSurfaceId + \"-\" + surface.order}\n              imageUrl={imageUrl}\n              canvas={flcanvas}\n              coords={coords}\n              canvasShort={flcanvasShort}\n              text={text}\n              label={\"\"}\n              targetLabel={\"\"}\n              surfaceButton={false}\n              displayWidth={this.props.width}\n              lineFocusCoords={lineFocusCoords}\n              />\n            )\n          }\n          else {\n            return (<p key={surface.currentSurfaceId + \"-\" + surface.order}>Sorry, this image is not yet ready</p>)\n          }\n        }\n      else{\n        return <img key={surface.currentSurfaceId + \"-\" + surface.order} alt=\"manuscript\" src={surface.imageurl + \"/full/\" + this.props.width + \",/0/default.jpg\"}/>\n      }\n    }\n    return (\n      <Container className={this.props.hidden ? \"hidden\" : \"showing\"}>\n      {displayAllImages()}\n      <ImageLogo imageurl={this.state.surfaces[0] ? this.state.surfaces[0].imageurl : \"\"}/>\n      </Container>\n\n    );\n  }\n\n}\nSurface3.defaultProps = {\n  width: \"501\"\n};\n\nSurface3.propTypes = {\n  /**\n  * a string indicating desired width in pixels for image display\n  *\n  * TODO: it might be desireable to change propType to an integer. I'm not sure.\n  */\n  width: PropTypes.string,\n  /**\n  * manifestation id\n  */\n  manifestationid: PropTypes.string,\n  /**\n  * indicates what kind of display is desired, \"lines, paragraph, surface/null\"\n  */\n  annotationsDisplay: PropTypes.string\n}\n\nexport default Surface3;\n","import React from 'react';\nimport Surface3 from './Surface3';\nimport PropTypes from 'prop-types';\nimport Form from 'react-bootstrap/Form';\nimport FormControl from 'react-bootstrap/FormControl';\nimport Button from 'react-bootstrap/Button';\nimport { FaList, FaFile, FaParagraph} from 'react-icons/fa';\n\nimport {runQuery} from './utils'\nimport {basicInfoQuery} from './Queries'\n\n//TODO: surface 3 needs to run in a wrapper which allows the user to choose between manifestations.\n//TODO: rdf dbase needs to include first line numbers for paragraphs that start in the middle of al line.\n\nclass Surface3Wrapper extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleChangeManifestation = this.handleChangeManifestation.bind(this)\n    this.handleToggleTextLinesView = this.handleToggleTextLinesView.bind(this)\n    this.handleSetCustomExpressionId = this.handleSetCustomExpressionId.bind(this)\n    this.handleGetCustomManifestations = this.handleGetCustomManifestations.bind(this)\n    this.handleChangeCustomManifestation = this.handleChangeCustomManifestation.bind(this)\n    this.state = {\n      focusedManifestation: \"\",\n      annotationsDisplay: \"lines\",\n      userAddedExpressionId: \"\",\n      userAddedManifestations: [],\n      focusedCustomManifestation: \"\"\n    }\n  }\n  handleChangeCustomManifestation(value){\n    this.setState({focusedCustomManifestation: value})\n  }\n  handleSetCustomExpressionId(value){\n    this.setState({userAddedExpressionId: value})\n  }\n  handleGetCustomManifestations(e){\n    e.preventDefault()\n    const results = runQuery(basicInfoQuery(this.state.userAddedExpressionId))\n    results.then((d) => {\n      const manifestations = d.data.results.bindings.map((b) => {\n        return {\n          manifestation: b.manifestation.value,\n          manifestationTitle: b.manifestationTitle.value,\n          transcription: b.manifestationCTranscription ? b.manifestationCTranscription.value : \"\"\n        }\n      })\n      this.setState({userAddedManifestations: manifestations, focusedCustomManifestation: d.data.results.bindings[0].cmanifestation.value})\n    })\n     \n\n  }\n\n  handleToggleTextLinesView(view){\n    //optional prop to allow parent container to reset default view prop\n    if (this.props.handleToggleTextLinesView){\n      this.props.handleToggleTextLinesView(view)\n    }\n    else{\n      this.setState((prevState) => {\n        return {annotationsDisplay: view}\n      })\n    }\n  }\n  handleChangeManifestation(e){\n    e.preventDefault()\n    //optional prop to allow parent container to reset default view prop\n    if (this.props.handleChangeManifestation){\n      this.props.handleChangeManifestation(e.target.value)\n    }\n    else{\n      this.setState({focusedManifestation: e.target.value})\n    }\n  }\n  componentDidMount(){\n    if (this.props.manifestations){\n      this.setState((prevState) => {\n        return {\n          focusedManifestation: this.props.focusedManifestation,\n          annotationsDisplay: this.props.annotationsDisplay,\n        }\n      })\n    }\n  }\n  // UNSAFE_componentWillReceiveProps(nextProps){\n  //   if (nextProps.focusedManifestation !== this.props.focusedManifestation){\n  //     this.setState((prevState) => {\n  //       return {\n  //         focusedManifestation: nextProps.focusedManifestation,\n  //       }\n  //     })\n  //   }\n  //   if (nextProps.annotationsDisplay !== this.props.annotationsDisplay){\n  //     this.setState((prevState) => {\n  //       return {\n  //         annotationsDisplay: nextProps.annotationsDisplay,\n  //       }\n  //     })\n  //   }\n  // }\n\n  //TODO: is passing of props to state necessary? settingDerivedState is not ideal\n  //thus there should be a good reason for setting a derived state. \n  // the goal here is to allow the component to update the state, but for \n  // the parent component to determine the default state. \n  // unless there is another way to do this, this seems like a sufficient justification for the derived state.\n  componentDidUpdate(prevProps){\n    if (this.props.focusedManifestation !== prevProps.focusedManifestation){\n      this.setState((prevState) => {\n        return {\n          focusedManifestation: this.props.focusedManifestation,\n        }\n      })\n    }\n    if (this.props.annotationsDisplay !== prevProps.annotationsDisplay){\n      this.setState((prevState) => {\n        return {\n          annotationsDisplay: this.props.annotationsDisplay,\n        }\n      })\n    }\n  }\n  render() {\n    const displayManifestationsList = () => {\n      const list = this.props.manifestations.map((m) => {\n        return <option key={\"title-\" + m.manifestation} value={m.manifestation}>{m.manifestationTitle}</option>\n      })\n      return list\n    }\n    const displayManifestation = () => {\n      const manifestation = this.props.manifestations.map((m) => {\n        if (m.manifestation === this.state.focusedManifestation){\n          return <Surface3 key={\"surface-\" + m.manifestation} \n          manifestationid={m.manifestation} \n          annotationsDisplay={this.state.annotationsDisplay} \n          width={this.props.width}\n          lineFocusId={this.props.lineFocusId}/>\n        }\n        else{\n          return null\n        }\n      })\n      return manifestation\n\n    }\n\n    return (\n      <div className={this.props.hidden ? \"hidden\" : \"showing\"}>\n        {!this.props.hideSelectionList &&\n        <div className=\"manifestationsList\">\n          <Form.Control size=\"sm\" as=\"select\" onChange={this.handleChangeManifestation} value={this.state.focusedManifestation}>\n            {displayManifestationsList()}\n          </Form.Control>\n        </div>\n        }\n        <div className=\"surfaceWrapper\">\n          {!this.props.hideDisplayChoice && this.state.focusedManifestation &&\n            <div className=\"image-display-choice\">\n              <p><span title=\"Text Line View\" onClick={() => {this.handleToggleTextLinesView(\"lines\")}}><FaList/></span></p>\n              <p><span title=\"Paragraph View\" onClick={() => {this.handleToggleTextLinesView(\"paragraph\")}}><FaParagraph/></span></p>\n              <p><span title=\"Full Surface View\" onClick={() => {this.handleToggleTextLinesView(\"surface\")}}><FaFile/></span></p>\n            </div>\n          }\n          <div className=\"imagesDisplay\">\n            {displayManifestation()}\n          </div>\n        </div>\n        \n        {\n          this.state.userAddedManifestations.length > 0 && \n          <Surface3Wrapper \n            manifestations={this.state.userAddedManifestations}\n            focusedManifestation={this.state.focusedCustomManifestation}\n            annotationsDisplay={this.state.annotationsDisplay}\n            handleToggleTextLinesView={this.props.handleToggleTextLinesView}\n            handleChangeManifestation={this.handleChangeCustomManifestation}\n            width={this.props.width}\n            lineFocusId={\"\"}\n            hidden={false}\n            isDependentSurface3={true}/>\n        }\n        {!this.props.isDependentSurface3 &&\n        <div style={{\"borderBottom\": \"1px solid rgba(0, 0, 0, 0.1)\", \"borderTop\": \"1px solid rgba(0, 0, 0, 0.1)\", marginTop: \"5px\", padding: \"5px\"}} >\n          <p style={{fontSize: \"12px\"}}>Create custom user compare</p>\n          <Form onSubmit={this.handleGetCustomManifestations} inline> \n            <FormControl inline=\"true\" size=\"sm\" id=\"text\" type=\"text\" value={this.state.userAddedExpressionId} placeholder=\"expression id\" className=\"mr-sm-2\" onChange={(e) => {this.handleSetCustomExpressionId(e.target.value)}}/>\n            <Button inline=\"true\" size=\"sm\"  type=\"submit\" style={{margin: \"2px\"}}>Submit</Button>\n          </Form>\n        </div>\n        }\n\n      </div>\n    );\n  }\n}\n\nSurface3Wrapper.defaultProps = {\n  manifestations: [],\n  hidden: false,\n  focusedManifestation: \"\",\n  annotationsDisplay: \"paragraph\",\n  width: \"500\"\n};\n\nSurface3Wrapper.propTypes = {\n  /**\n  * an array of manifestation ids\n  */\n  manifestations: PropTypes.array,\n  /**\n  * boolean indicating whether or not compoment should be mounted by still hidden\n  */\n  hidden: PropTypes.bool,\n  /**\n  * indicates on which manifestation component to default focus.\n  * manifestation value MUST be included in manifestations array\n  */\n  focusedManifestation: PropTypes.string,\n  /**\n  * indicates what kind of display is desired, \"lines, paragraph, surface/null\"\n  */\n\n  annotationsDisplay: PropTypes.string,\n  /**\n  * optional prop to allow parent container to reset default view prop\n  */\n  handleToggleTextLinesView: PropTypes.func,\n  /**\n  * desired image width\n  */\n  width: PropTypes.string\n}\n\nexport default Surface3Wrapper;\n","import React from 'react';\nimport Surface2 from './Surface2'\nimport Surface3Wrapper from './Surface3Wrapper'\n//import {Link} from 'react-router-dom';\n\nimport {runQuery} from './utils'\nimport {getCodexInfo, getCodexInfoFromSurface, getCodexInfoFromCanvas, getCodexInfoFromManifest} from './Queries'\n\nclass Codex extends React.Component {\n  constructor(props){\n    super(props)\n    this.retrieveCodexInfo = this.retrieveCodexInfo.bind(this)\n    this.handleSurfaceFocusChange = this.handleSurfaceFocusChange.bind(this)\n    this.handleToggleShowContents = this.handleToggleShowContents.bind(this)\n    //this.handleSurface3Manifestations = this.handleSurface3Manifestations.bind(this)\n    this.state = {\n      items: {},\n      title: \"\",\n      focusedSurface: \"\",\n      relatedCodices: [],\n      showContents: true,\n      surface3Manifestations: [],\n      surface3FocusedManifestation: \"\"\n    }\n  }\n  handleToggleShowContents(){\n    this.setState((prevState) => {\n      return{\n        showContents: !prevState.showContents\n      }\n    })\n  }\n  \n  handleSurfaceFocusChange(surfaceid){\n    //this.setState({focusedSurface: surfaceid})\n    this.props.handleSetFocus(surfaceid)\n  }\n  retrieveCodexInfo(id, type){\n    let codexInfo = undefined\n    if (type === \"surface\"){\n      codexInfo = runQuery(getCodexInfoFromSurface(id))\n    }\n    else if (type === \"canvas\"){\n      codexInfo = runQuery(getCodexInfoFromCanvas(id))\n    }\n    else if (type === \"manifest\"){\n      codexInfo = runQuery(getCodexInfoFromManifest(id))\n    }\n    else{\n      codexInfo = runQuery(getCodexInfo(id))\n    }\n    codexInfo.then((d) => {\n      const data = d.data.results.bindings\n      if (data.length > 0 && data[0].surface){\n        const expressionIdMap = data.map((d) => {\n          return d.expression ? d.expression.value : \"\"\n        })\n        var unique = expressionIdMap.filter((v, i, a) => a.indexOf(v) === i);\n        let expressionList = {}\n        unique.forEach((e) => {\n           expressionList[e] = []\n        })\n        data.forEach((d) => {\n            const info = {\n              expression: d.expression.value,\n              expressionTitle: d.item_expression_title.value,\n              manifestation: d.manifestation.value,\n              surface: d.surface.value,\n              surfaceTitle: d.surface_title.value,\n              questionTitle: d.item_expression_question_title ? d.item_expression_question_title.value : ''\n            }\n          expressionList[d.expression.value].push(info)\n        })\n        let focusedSurface = \"\"\n        if (type === \"surface\"){\n           focusedSurface = id\n         }\n         else if (type === \"canvas\"){\n           focusedSurface = data[0].surfaceFocus.value\n         }\n         else{\n           focusedSurface = data[0].surface.value\n         }\n        this.setState({items: expressionList, focusedSurface: focusedSurface})\n        this.props.handleSurfaceFocusChange(focusedSurface)\n\n      }\n    })\n  }\n  componentDidMount(){\n    this.retrieveCodexInfo(this.props.resourceid, this.props.codexResourceType)\n  }\n  componentDidUpdate(prevProps){\n    if (this.props.resourceid && this.props.resourceid !== prevProps.resourceid){\n      this.retrieveCodexInfo(this.props.resourceid, this.props.codexResourceType)\n  }\n  }\n\n  render(){\n    const displayImages = () => {\n      if (this.state.surface3Manifestations.length > 0){\n        return <Surface3Wrapper manifestations={this.state.surface3Manifestations} focusedManifestation={this.state.surface3FocusedManifestation} annotationsDisplay=\"paragraph\" width=\"501\" hidden={false}/>\n      }\n      else if (this.state.focusedSurface){\n        return <Surface2 surfaceid={this.state.focusedSurface} lineFocusId=\"\" topLevel={this.props.topLevel} handleSurfaceFocusChange={this.handleSurfaceFocusChange} width={\"501\"} annotationsDisplay={false} hidden={false}/>\n      }\n      else{\n        return null\n      }\n\n    }\n    return (\n      <div className=\"codexImage\">\n          <h1>Codex Pages</h1>\n          {displayImages()}\n         </div>\n    );\n  }\n}\n\nexport default Codex;\n","import React, {useState, useEffect} from 'react';\nimport {runQuery} from './utils'\nimport {getExpressionTypeInfo} from '../queries/expressionTypeQuery'\nimport TextOutlineWrapper from \"./TextOutlineWrapper\"\nimport Container from 'react-bootstrap/Container';\n\nconst ExpressionType = (props) => {\n  const [expressions, setExpressions] = useState([])\n  useEffect(()=> {\n    const results = runQuery(getExpressionTypeInfo(props.expressionTypeId))\n    results.then((d) => {\n      const bindings = d.data.results.bindings\n      setExpressions(bindings)\n    })\n  }, [props.expressionTypeId])\n  return (\n    <Container className=\"collectionBody\">\n      <h1>{props.expressionTypeId}</h1>\n      {expressions.map((e)=> {\n        return (\n          <Container>\n          <TextOutlineWrapper\n          focusResourceid={e.expression.value}\n          resourceid={e.expression.value}\n          title={e.authorTitle ? e.authorTitle.value + \", \" + e.eLongTitle.value : e.eLongTitle.value }\n          hidden={false}\n          mtFocus={\"\"}\n          collectionLink={true}\n          showParentLink={true}/>\n          </Container>\n        )\n      })}\n      \n      \n  </Container>\n\n  );\n}\n\nexport default ExpressionType;\n","export function getExpressionTypeInfo(id){\n   const query = [\n     \"SELECT ?expression ?eLongTitle ?expressionAuthor ?expressionAuthorTitle ?author ?authorTitle \",\n     \"{\",\n       \"{\",\n         \"?expression <http://scta.info/property/expressionType> <\" + id + \"> .\",\n       \"}\",\n       \"UNION\",\n       \"{\",\n         \"?expression <http://scta.info/property/expressionType> ?expressionType .\",\n         \"?expressionType <http://scta.info/property/isMemberOf> <\" + id + \"> .\",\n       \"}\",\n       \"?expression <http://scta.info/property/longTitle> ?eLongTitle .\",\n       \"OPTIONAL {\",\n       \"?expression <http://www.loc.gov/loc.terms/relators/AUT> ?author . \",\n       \"?author <http://purl.org/dc/elements/1.1/title> ?authorTitle .\",\n       \"}\",\n      \"}\",\n      \n\n     \"ORDER BY ?authorTitle\"].join(' ')\n  return query\n}\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\nimport Print from \"./Print\"\nimport PropTypes from 'prop-types';\n\nimport TextOutlineWrapper from \"./TextOutlineWrapper\"\nimport {Link} from 'react-router-dom';\n\nimport Window from \"./Window/Window2\"\nimport TextNavBar from \"./TextNavBar\"\nimport Text from \"./Text\"\nimport AuthorCollection from \"./AuthorCollection\"\nimport VersionChain from \"./VersionChain\"\nimport Collection from \"./Collection\"\nimport Codex from \"./Codex\"\nimport ExpressionType from \"./ExpressionType\"\nimport {runQuery, scrollToParagraph} from './utils'\n\nimport {basicInfoQuery, itemTranscriptionInfoQuery} from './Queries'\n\n\nclass TextWrapper extends React.Component {\n  constructor(props){\n    super(props)\n    this.mount = false\n    this.openWindow = this.openWindow.bind(this)\n    this.setFocus = this.setFocus.bind(this)\n    this.setFocus2 = this.setFocus2.bind(this)\n    this.handleTabChange = this.handleTabChange.bind(this)\n    this.handleClose = this.handleClose.bind(this)\n    this.handleMinimize = this.handleMinimize.bind(this)\n    this.handleMaximize = this.handleMaximize.bind(this)\n    this.handleMiddlize = this.handleMiddlize.bind(this)\n    this.handleSwitchWindow = this.handleSwitchWindow.bind(this)\n    this.handleDuplicateWindow = this.handleDuplicateWindow.bind(this)\n    this.handleSurfaceFocusChange = this.handleSurfaceFocusChange.bind(this)\n    this.handleLineFocusChange = this.handleLineFocusChange.bind(this)\n    this.handleToggleTextLinesView = this.handleToggleTextLinesView.bind(this)\n    this.handleChangeManifestation = this.handleChangeManifestation.bind(this)\n    this.handleTextPreviewFocusChange = this.handleTextPreviewFocusChange.bind(this)\n    this.handleShowCollationOverlay = this.handleShowCollationOverlay.bind(this)\n    this.handleAddCtRelatedExpressions = this.handleAddCtRelatedExpressions.bind(this)\n    this.handleTogglePdfView = this.handleTogglePdfView.bind(this)\n    this.handleUpdateSelectionRange = this.handleUpdateSelectionRange.bind(this)\n    this.state = {\n      ctRelatedExpressions: [],\n      doc: \"\",\n      focus: \"\",\n      //focusRelatedExpressions: \"\",\n      mtFocus: \"\",\n      itemFocus: \"\",\n      //collectionFocus: \"\",\n      surfaceid: \"\",\n      lineFocusId: \"\",\n      textPreviewObjects: [],\n      pdfView: false,\n      selectionRange: undefined, // should be undefined or object\n      windows: {\n        window1: {\n          windowId: \"window1\",\n          open: true,\n          windowLoad: \"citation\",\n          position: \"sideWindow\",\n          openWidthHeight: \"middle\",\n          annotationsDisplay: \"paragraph\",\n          defaultManifestationSlug: \"\"\n        },\n        window2: {\n          windowId: \"window2\",\n          open: false,\n          windowLoad: \"citation\",\n          position: \"bottomWindow\",\n          openWidthHeight: \"middle\",\n          annotationsDisplay: \"paragraph\",\n          defaultManifestationSlug: \"\"\n        }\n      }\n    }\n  }\n\n  handleTogglePdfView(){\n    this.setState((prevState) => {\n        return {\n          pdfView: !prevState.pdfView\n        }\n    })\n  }\n  handleToggleTextLinesView(windowId, value){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].annotationsDisplay = value\n      return {windows: windows}\n    })\n  }\n  handleChangeManifestation(windowId, manifestationSlug){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].defaultManifestationSlug = manifestationSlug\n      return {windows: windows}\n    })\n  }\n\n  openWindow(id, windowLoad){\n    if (!this.state.windows[id].open || this.state.windows[id].windowLoad !== windowLoad){\n      this.setState((prevState) => {\n        const windows = prevState.windows\n        windows[id].open = true\n        if (windowLoad){\n          windows[id].windowLoad = windowLoad\n        }\n        return {\n          windows: windows,\n        }\n      })\n    }\n  }\n  handleClose(windowId){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].open = false\n      return {windows: windows}\n\n    })\n    //scroll is supposed to re-align text scroll to focused paragraph after side bar close.\n    //but it is not quite working\n    scrollToParagraph(this.state.blockFocus, true)\n\n  }\n  \n  handleMinimize(windowId){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].openWidthHeight = \"minimum\"\n      return {windows: windows}\n\n    })\n  }\n  handleMaximize(windowId){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].openWidthHeight = \"maximum\"\n      return {windows: windows}\n\n    })\n  }\n  handleMiddlize(windowId){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].openWidthHeight = \"middle\"\n      return {windows: windows}\n\n    })\n  }\n  \n  /**\n   * @description update state with selectionRangeObject\n   * @param {object} selectionRange\n   */\n  handleUpdateSelectionRange(selectionRange){\n    const s = selectionRange\n    this.setState({selectionRange: s})\n  }\n  handleSwitchWindow(windowId, windowType){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      if (windows[windowId].position === \"sideWindow\"){\n        windows[windowId].position = \"bottomWindow\"\n        // these conditionals control whether an already existing window will be closed when the other is moved\n        // while commented they allow window1 and window2 to stack on top of each other\n\n        // if (windowId === \"window1\"){\n        //   windows[\"window2\"].open = false\n        // }\n        // else if ((windowId === \"window2\")){\n        //   windows[\"window1\"].open = false\n        // }\n      }\n      else if (windows[windowId].position === \"bottomWindow\"){\n        windows[windowId].position = \"sideWindow\"\n        // these conditionals control whether an already existing window will be closed when the other is moved\n        // while commented they allow window1 and window2 to stack on top of each other\n\n        // if (windowId === \"window1\"){\n        //   windows[\"window2\"].open = false\n        // }\n        // else if ((windowId === \"window2\")){\n        //   windows[\"window1\"].open = false\n        // }\n      }\n      return {windows: windows}\n\n    })\n  }\n  handleDuplicateWindow(windowId, windowType){\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      const altWindowId = windowId === \"window1\" ? \"window2\" : \"window1\"\n      if (windows[windowId].position === \"sideWindow\"){\n        windows[altWindowId].position = \"bottomWindow\"\n        windows[altWindowId].open = true\n      }\n      else if (windows[windowId].position === \"bottomWindow\"){\n        windows[altWindowId].position = \"sideWindow\"\n        windows[altWindowId].open = true\n      }\n      return {windows: windows}\n    })\n  }\n  handleTabChange(windowLoad, windowId){\n\n    this.setState((prevState) => {\n      const windows = prevState.windows\n      windows[windowId].windowLoad = windowLoad\n      return {windows: windows}\n\n    })\n\n  }\n\n  handleSurfaceFocusChange(surfaceid){\n    this.setState({surfaceid: surfaceid})\n  }\n  handleLineFocusChange(lineFocusId){\n    this.setState({lineFocusId: lineFocusId})\n  }\n  /**\n   * @description a function that handle events on main text and passes relevant information to TextPreviewWrapper Component\n   * \n   * @param {Object[]} targetObjects - an array of objects \n   * @param {string} id - the target id\n   * @param {string} range - the word range (e.g. 1-4), delimited by a dash, corresponding to the target\n   */\n  handleTextPreviewFocusChange(targetObjects){\n    //check to see if textPreviewResourceId carries more than one id\n    //if so split by white space \n    this.setState({textPreviewObjects: targetObjects})\n  }\n\n  handleShowCollationOverlay(){\n    console.log(\"firing\")\n    this.openWindow(\"window2\", \"collationTable\")\n  }\n  \n  handleAddCtRelatedExpressions(expressionId){\n    this.handleShowCollationOverlay(true)\n    this.setState((prevState) => {\n      return{\n        ctRelatedExpressions: [...prevState.ctRelatedExpressions, expressionId]\n      }\n    })\n\n  }\n\n  //TODO\n  //These two function should be refactored into one\n  setFocus(id){\n    const range = id.split(\"@\")[1] ? \"@\" + id.split(\"@\")[1] : \"\"\n    id = id.split(\"@\")[0];\n    const fullid = id.includes(\"http\") ? id + this.state.mtFocus + range : \"http://scta.info/resource/\" + id + this.state.mtFocus + range;\n    this.props.handleUpdateUrlResource(fullid)\n  }\n  setFocus2(newid){\n    this.props.handleUpdateUrlResource(newid)\n  }\n  //END TODO\n\n\n  retrieveFocusInfo(id){\n    const fullid = id.includes(\"http\") ? id : \"http://scta.info/resource/\" + id\n    // get info\n    const info = runQuery(basicInfoQuery(fullid))\n    //arrange info and set it to state\n\n    this.arrangeFocusInfo(info, fullid)\n    // get related expressions info\n    // removed these second calls and embed the query in arrange focus info to keep information in sync.\n    // TODO remove below three lines\n    //const relatedExpressions = runQuery(getRelatedExpressions(fullid))\n    //arrange info and set it to state\n    //this.arrangeFocusRelatedInfo(relatedExpressions)\n\n    //scrollToParagraph(shortid, true)\n\n  }\n\n  arrangeFocusInfo(info, resourceid){\n      info.then((d) => {\n        const bindings = d.data.results.bindings[0]\n        const manifestations = d.data.results.bindings.map((b) => {\n          return {\n            manifestation: b.manifestation.value,\n            manifestationTitle: b.manifestationTitle.value,\n            transcription: b.manifestationCTranscription ? b.manifestationCTranscription.value : \"\",\n            transcriptionDoc: b.manifestationCTranscriptionDoc?.value\n          }\n        })\n\n          if (this.mount && bindings){\n            this.setState({\n              focus: {\n                resourceid: resourceid,\n                title: bindings.title.value,\n                longTitle: bindings.longTitle ? bindings.longTitle.value : \"\",\n                author: bindings.author ? bindings.author.value : \"\",\n                authorTitle: bindings.authorTitle ? bindings.authorTitle.value : \"\",\n                structureType: bindings.structureType.value,\n                inbox: bindings.inbox.value,\n                next: bindings.next ? bindings.next.value : \"\",\n                previous: bindings.previous ? bindings.previous.value : \"\",\n                parent: bindings.parent ? bindings.parent.value : \"\",\n                cdoc: bindings.cdoc ? bindings.cdoc.value : \"\",\n                cxml: bindings.cxml ? bindings.cxml.value : \"\",\n                topLevel: bindings.topLevelExpression ? bindings.topLevelExpression.value : \"\",\n                cmanifestation: bindings.cmanifestation.value,\n                ctranscription: bindings.ctranscription ? bindings.ctranscription.value : \"\",\n                manifestations: manifestations\n              }\n            });\n          }\n      });\n    }\n    /**\n     * sets focus\n     * @param {string} id \n     * @public\n     */\n    setItemFocus(id){\n      const fullid = id.includes(\"http\") ? id : \"http://scta.info/resource/\" + id\n      // get info\n      const info = runQuery(itemTranscriptionInfoQuery(fullid))\n      this.arrangeItemFocusInfo(info)\n    }\n    arrangeItemFocusInfo(itemFocusInfo){\n        itemFocusInfo.then((d) => {\n          const bindings = d.data.results.bindings[0]\n          if (this.mount){\n            this.setState({\n              itemFocus: {\n                title: bindings.title.value,\n                manifestation: bindings.manifestation.value,\n                expression: bindings.expression.value,\n                doc: bindings.doc.value,\n                xml: bindings.xml.value,\n                next: bindings.next ? bindings.next.value : \"\",\n                previous: bindings.previous ? bindings.previous.value : \"\",\n                inbox: bindings.inbox.value,\n                topLevel: bindings.topLevelExpression.value,\n                transcriptionid: bindings.t.value\n              }\n            });\n          }\n        });\n      }\n\n  componentDidMount(){\n    this.mount = true\n    if (this.props.resourceType === \"person\" \n    || this.props.resourceType === \"workGroup\" \n    || this.props.resourceType === \"codex\"\n    || this.props.resourceType === \"expressionType\"){\n    }\n    //transcriptionid should be required Prop\n    //conditional here to reinfurce that rule\n    else if (this.props.resourceType === \"collection\"){\n      //TODO props.expressionid is doing something very similar to blockDivFocus\n      this.retrieveFocusInfo(this.props.expressionid)\n      //TODO: splitting strings for this information is not ideal.\n        //info should be part of original query\n        const mFocus = this.props.transcriptionid ? this.props.transcriptionid.split(\"/resource/\")[1].split(\"/\")[1] : \"\"\n        const tFocus = this.props.transcriptionid ? this.props.transcriptionid.split(\"/resource/\")[1].split(\"/\")[2] : \"\"\n        this.setState(\n          {\n            mtFocus: \"/\" + mFocus + \"/\" + tFocus,\n            itemFocus: \"\"\n          }\n        )\n      }\n    else{\n      if (this.props.itemTranscriptionId){\n        this.setItemFocus(this.props.itemTranscriptionId)\n        //TODO: splitting strings for this information is not ideal.\n        //info should be part of original query\n        const mFocus = this.props.itemTranscriptionId.split(\"/resource/\")[1].split(\"/\")[1]\n        const tFocus = this.props.itemTranscriptionId.split(\"/resource/\")[1].split(\"/\")[2]\n        const selectionRange = this.props.tokenRange ? {\n          wordRange: this.props.tokenRange,\n          selectedElementTargetId: this.props.expressionid && this.props.expressionid.split(\"/resource/\")[1],\n        } : {}\n        this.setState(\n          {mtFocus: \"/\" + mFocus + \"/\" + tFocus, \n          selectionRange: selectionRange\n        })\n\n        if (this.props.expressionid){\n          this.retrieveFocusInfo(this.props.expressionid)\n        }\n      }\n    }\n  }\n\n    componentDidUpdate(prevProps){\n      //Keep testing, but it seems like this look up only needs to fire, when the transcription id prop changes\n      // not when other props changes.\n      \n      if (this.props.resourceType === \"person\" \n      || this.props.resourceType === \"workGroup\" \n      || this.props.resourceType === \"codex\"\n      || this.props.resourceType === \"expressionType\"\n      ){\n        if (this.props.resourceid !== prevProps.resourceid){\n          this.setState({\n            focus: \"\",\n            mtFocus: \"\"\n          });\n        }\n      }\n      else if (this.props.resourceType === \"collection\"){\n        \n        if (this.props.resourceid !== prevProps.resourceid){\n          this.retrieveFocusInfo(this.props.expressionid)\n          //TODO: splitting strings for this information is not ideal.\n          //info should be part of original query\n          const mFocus = this.props.transcriptionid ? this.props.transcriptionid.split(\"/resource/\")[1].split(\"/\")[1] : \"\"\n          const tFocus = this.props.transcriptionid ? this.props.transcriptionid.split(\"/resource/\")[1].split(\"/\")[2] : \"\"\n          this.setState(\n          {\n            mtFocus: \"/\" + mFocus + \"/\" + tFocus,\n            itemFocus: \"\"\n          }\n        )\n        }\n      }\n      else{\n  \n        if (this.props.itemTranscriptionId !== prevProps.itemTranscriptionId){\n          this.setItemFocus(this.props.itemTranscriptionId)\n          const mFocus = this.props.itemTranscriptionId.split(\"/resource/\")[1].split(\"/\")[1]\n          const tFocus = this.props.itemTranscriptionId.split(\"/resource/\")[1].split(\"/\")[2]\n          //clear or set parts of state when new transcription file is loaded\n          this.setState((prevState) => {\n            const windows = prevState.windows\n            windows[\"window1\"].defaultManifestationSlug = \"\"\n            windows[\"window2\"].defaultManifestationSlug = \"\"\n            const selectionRange = this.props.tokenRange ? {\n              ...prevState.selectionRange, \n              wordRange: this.props.tokenRange,\n              selectedElementTargetId: this.props.expressionid && this.props.expressionid.split(\"/resource/\")[1],\n            } : {}\n            return {\n              mtFocus: \"/\" + mFocus + \"/\" + tFocus,\n              selectionRange: selectionRange,\n              windows: windows,\n              ctRelatedExpressions: []\n            }\n          })\n        }\n        //TODO: seems a little dangerous to have these two different setState/async calls \n        //if one depends on the other, this is a good place for things to get out of sync\n        if (this.props.expressionid !== prevProps.expressionid){\n          if (!this.props.expressionid){\n            this.setState(\n              {\n                focus: \"\",\n                selectionRange: \"\",\n                ctRelatedExpressions: []\n            });\n          }\n          else {\n            this.setState((prevState) => {\n              const selectionRange = this.props.tokenRange ? {\n                ...prevState.selectionRange, \n                wordRange: this.props.tokenRange,\n                selectedElementTargetId: this.props.expressionid && this.props.expressionid.split(\"/resource/\")[1],\n              } : {}\n              return({\n              selectionRange: selectionRange,\n              ctRelatedExpressions: []\n              })  \n            })\n            this.retrieveFocusInfo(this.props.expressionid)\n          }\n        }\n        if (this.props.tokenRange !== prevProps.tokenRange){\n          this.setState((prevState)=>{\n            const selectionRange = this.props.tokenRange ? {\n              ...prevState.selectionRange, \n              wordRange: this.props.tokenRange,\n              selectedElementTargetId: this.props.expressionid && this.props.expressionid.split(\"/resource/\")[1],\n            } : {}\n            return({\n            selectionRange: selectionRange,\n            ctRelatedExpressions: []\n          })\n          })\n        }\n      }\n}\n  componentWillUnmount(){\n    this.mount = false\n  }\n  render(){\n    const displayWindows = () => {\n      const windows = Object.keys(this.state.windows).map((key) => {\n        if (this.state.windows[key].open){\n          return (<Window\n              key={key}\n              handleClose={this.handleClose}\n              handleMinimize={this.handleMinimize}\n              handleMaximize={this.handleMaximize}\n              handleMiddlize={this.handleMiddlize}\n              handleTabChange={this.handleTabChange}\n              handleBlockFocusChange={this.setFocus}\n              handleFocusChange={this.setFocus2}\n              handleSurfaceFocusChange={this.handleSurfaceFocusChange}\n              handleSwitchWindow={this.handleSwitchWindow}\n              handleDuplicateWindow={this.handleDuplicateWindow}\n              resourceid={this.state.focus ? this.state.focus.resourceid : this.props.resourceid}\n              resourceType={this.props.resourceType ? this.props.resourceType : \"text\" }\n              windowType={this.state.windows[key].position}\n              windowId={this.state.windows[key].windowId}\n              windowLoad={this.state.windows[key].windowLoad}\n              openWidthHeight={this.state.windows[key].openWidthHeight}\n              surfaceid={this.state.surfaceid}\n              lineFocusId={this.state.lineFocusId}\n              info={this.state.focus}\n              itemFocus={this.state.itemFocus}\n              altWindowState={this.state.windows[key].windowId === \"window1\" ? this.state.windows[\"window2\"].open : this.state.windows[\"window1\"].open}\n              mtFocus={this.state.mtFocus}\n              handleToggleTextLinesView={this.handleToggleTextLinesView}\n              annotationsDisplay={this.state.windows[key].annotationsDisplay}\n              handleChangeManifestation={this.handleChangeManifestation}\n              defaultManifestationSlug={this.state.windows[key].defaultManifestationSlug}\n              textPreviewObjects={this.state.textPreviewObjects}\n              handleTextPreviewFocusChange={this.handleTextPreviewFocusChange}\n              handleLineFocusChange={this.handleLineFocusChange}\n              selectionRange={this.state.selectionRange}\n              codexResourceType={this.props.codexResourceType}\n              userId={this.props.userId}\n              handleShowCollationOverlay={this.handleShowCollationOverlay}\n              handleAddCtRelatedExpressions={this.handleAddCtRelatedExpressions}\n              ctRelatedExpressions={this.state.ctRelatedExpressions}\n              />\n            )\n          }\n          else{\n            return null\n          }\n        })\n        return windows\n      }\n    \n    const textClassNames = [\"lbp-text\"]\n    this.state.windows.window1.open && this.state.windows.window1.openWidthHeight === \"middle\" ? textClassNames.push(\"skinnyText\") : textClassNames.push(\"fullText\");\n    this.state.windows.window2.open && textClassNames.push(\"longText\");\n    this.state.pdfView ? textClassNames.push(\"hidden\"): textClassNames.push(\"showing\");\n    \n    const displayMain = () => {\n      if (this.props.resourceType === \"codex\"){\n        return (\n          <Codex \n          resourceid={this.props.resourceid} \n          codexResourceType={this.props.codexResourceType}\n          handleSetFocus={this.setFocus}\n          handleSurfaceFocusChange={this.handleSurfaceFocusChange}\n          />\n        )\n      }\n      else if (this.props.resourceType === \"person\"){\n        return (<AuthorCollection resourceid={this.props.resourceid}/>)\n      }\n      else if (this.props.resourceType === \"workGroup\"){\n        return ( <Collection resourceid={this.props.resourceid} \n           type=\"http://scta.info/resource/workGroup\"\n          />)\n      }\n      else if (this.props.resourceType === \"expressionType\"){\n        return (\n        <ExpressionType expressionTypeId={this.props.resourceid}/>\n        )\n      }\n      else if (this.props.resourceType === \"collection\"){\n        return (<div>\n          <h1>{this.state.resourceTitle}</h1>\n            <p style={{\"textAlign\": \"center\"}}>By <Link to={\"/text?resourceid=\" + this.state.focus.author}>{this.state.focus.authorTitle}</Link></p>\n            <TextOutlineWrapper\n              //focusResourceid={this.props.expressionid}\n              //resourceid={this.props.expressionid}\n              focusResourceid={this.props.resourceid}\n              resourceid={this.props.resourceid}\n              title={this.state.focus.title}\n              hidden={false}\n              //mtFocus={this.state.mtFocus}\n              mtFocus={\"\"}\n              collectionLink={true}\n              showParentLink={true}\n              />\n          </div>)  \n      }\n      else{\n        return (\n          this.state.itemFocus &&  \n          <>\n          <VersionChain transcriptionid={this.state.itemFocus.transcriptionid} handleFocusChange={this.setFocus2}/>\n          <Text\n            doc={this.state.itemFocus.doc}\n            topLevel={this.state.itemFocus.topLevel}\n            setFocus={this.setFocus}\n            handleSurfaceFocusChange={this.handleSurfaceFocusChange}\n            handleLineFocusChange={this.handleLineFocusChange}\n            openWindow={this.openWindow}\n            // NOTE: using props instead of state; seems better, but needs full documentation\n            // NOTE: itemid is shortid of item: TODO: needs documentation; or better, refactoring!\n            // TODO: when scrollTo id type is consistent, remove id checker in didMount and didUpdate of Text component\n            scrollTo={this.props.expressionid && this.props.expressionid.split(\"/resource/\")[1]}\n            handleTextPreviewFocusChange={this.handleTextPreviewFocusChange}\n            handleUpdateSelectionRange={this.handleUpdateSelectionRange}\n            selectionRange={this.state.selectionRange}\n            />\n          </>\n        )\n\n      }\n    }\n\n    return (\n      <div>\n        \n        { this.state.pdfView && <Print url={this.state.itemFocus.doc}/>}\n        \n        <Container className={textClassNames.join(\" \")}>\n          {displayMain()}\n        </Container>\n\n        {this.state.itemFocus && <TextNavBar\n          next={this.state.itemFocus && this.state.itemFocus.next}\n          previous={this.state.itemFocus && this.state.itemFocus.previous}\n          topLevel={this.state.itemFocus && this.state.itemFocus.topLevel}\n          handleClose={this.handleClose}\n          pdfView={this.state.pdfView}\n          handleTogglePdfView={this.handleTogglePdfView}\n          mtFocus={this.state.mtFocus}\n        />}\n        <div>\n        \n        {!this.state.pdfView && displayWindows()}\n        </div>\n      </div>\n    );\n  }\n}\n\nTextWrapper.propTypes = {\n  /**\n  * Text Wrapper Component\n  * \n  * \n  **/\n  resourceid: PropTypes.string, // id of focused resource (this can be a resource at any structure level and FRBR level)\n  expressionid: PropTypes.string, // corresponding expression id of the focused resource'\n  transcriptionid: PropTypes.string, // corresponding transcription id of the focused resource (Note: only really seems necessary at collection level)\n  \n  //itemid: PropTypes.string, // corresponding item expression parent (or self) corresponding to focused resource; (currently requires shortId, but (TODO) this would be good to change; seems like it would be better to call this ItemExpressionId to match ItemTranscriptionId)\n  itemTranscriptionId: PropTypes.string, //corresponding item transcription parent (or self corresponding to focused resource) \n  tokenRange: PropTypes.object, // an object containing word token range (tokenRange.start.int tokenRange.end.int)\n  handleUpdateUrlResource: PropTypes.func, // inherited function to send up resource focus change\n  \n  resourceType: PropTypes.string // currently only being used to switch between collection and non-collection levels.\n\n}\nexport default TextWrapper;\n","import React from 'react';\nimport Container from 'react-bootstrap/Container';\n\nimport '../styles/timelinelist.scss';\nimport $ from 'jquery';\n\nimport {convertXMLDoc, scrollToParagraph} from './utils'\n\n///TODO: Not this is very similar to the Text component\n//it would be nice if this could be refactored to be a more generic component that could handle both\n//however, the edition text will\n\n//TODO: article componet needs to retrieve and article type and then pick a different style sheet for different types.\n\nclass TextArticle extends React.Component {\n  constructor(props){\n    super(props)\n    this.retrieveText = this.retrieveText.bind(this)\n\n\n  }\n  retrieveText(doc, scrollTo, articleType){\n    const _this = this;\n    if (doc){\n      //construct file url request ot exist db to get a cors enabled copy of the text (github does not serve files with cors enabled)\n      const doc = this.props.doc;\n      \n\n\n      let xmlurl = \"\"\n      if (doc.includes(\"ipfs\") || (doc.includes(\"zotero\"))){\n         xmlurl = doc\n       }\n       else{\n        const docFragment = doc.split(\"/master/\")[1].split(\"/\")[1]\n         xmlurl = \"https://exist.scta.info/exist/apps/scta-app/text/scta-articles/\" + docFragment\n       }\n      let xslurl = \"\"\n      if (articleType === \"http://scta.info/resource/timeline\"){\n         xslurl = \"/xslt/articles/timeline.xsl\"\n      }\n      else if (articleType === \"http://scta.info/resource/bibliography\"){\n        xslurl = \"/xslt/articles/bibliography.xsl\"\n      }\n      else if (articleType === \"http://scta.info/resource/biography\"){\n        xslurl = \"/xslt/articles/biography.xsl\"\n      }\n      else{\n        xslurl = \"/xslt/articles/standard.xsl\"\n      }\n\n      //conversion done in promise in utils.js file\n      const resultDocument = convertXMLDoc(xmlurl, xslurl)\n      resultDocument.then((data) => {\n        //appendage to file\n        //and event binding\n        //happens inside promise call back\n        document.getElementById(\"text\").innerHTML = \"\";\n        document.getElementById(\"text\").appendChild(data);\n\n        // $('.paragraphnumber').click(function(e) {\n        //    e.preventDefault();\n        //    const id = $(this).parent(\"p\").attr('id')\n        //    _this.props.setFocus(id)\n        //    _this.props.openWindow(\"window1\")\n        //  });\n        //  if (scrollTo){\n        //   scrollToParagraph(scrollTo, true)\n        // }\n        //\n        // $('.js-show-folio-image').click(function(e) {\n        //   e.preventDefault();\n        //   const surfaceid = $(this).attr('data-surfaceid');\n        //   const paragraphid = $(this).closest('.plaoulparagraph').attr(\"id\");\n        //\n        //   _this.props.setFocus(paragraphid)\n        //   _this.props.handleSurfaceFocusChange(\"http://scta.info/resource/\" + surfaceid)\n        //   _this.props.openWindow(\"window2\", \"surface2\")\n        // });\n        //\n        // $('.lbp-line-number').click(function(e) {\n        //   e.preventDefault();\n        //   const surfaceid = $(this).attr('data-surfaceid');\n        //   const ln = $(this).attr('data-ln');\n        //   const paragraphid = $(this).closest('.plaoulparagraph').attr(\"id\");\n        //\n        //   _this.props.setFocus(paragraphid)\n        //   _this.props.handleSurfaceFocusChange(\"http://scta.info/resource/\" + surfaceid)\n        //   _this.props.handleLineFocusChange(\"http://scta.info/resource/\" + surfaceid + \"/\" + ln)\n        //   _this.props.openWindow(\"window2\", \"surface2\")\n        // });\n\n        $('.appnote, .footnote').click(function(e) {\n          e.preventDefault();\n\n        });\n        $('.appnote, .footnote').parent().click(function(e) {\n             e.preventDefault();\n             const link = $(this).children('.appnote, .footnote')\n             const target = $(link).attr('href')\n             const text = $(target).html()\n             const targetText = $(this).children(\".note-display\").attr('data-target-id')\n             /// toggles highlight for select text segemnts\n             if (targetText){\n               $(\"#\" + targetText).toggleClass(\"highlight\")\n               $(\"span[data-corresp=\" + targetText + \"]\").toggleClass(\"highlight\")\n             }\n\n             //adds footnote text to noteDisplay Div and toggles hidden class\n             const noteDisplay = $(this).children(\".note-display\")\n             noteDisplay.toggleClass(\"hidden\")\n             noteDisplay.html(text)\n           });\n           $(document).on(\"click\", '.js-show-reference-paragraph', function(e){\n            e.preventDefault();\n            const target = $(this).attr('data-url')\n            const targetParagraph = $(this).attr('data-target-paragraph')\n            //setting paragraph focus for paragraph containing target footnote\n            _this.props.setFocus(targetParagraph)\n            // set the desired text preview focus to the target of the reference\n            _this.props.handleTextPreviewFocusChange(target)\n            //opening bottomw window 2 to textPreview\n            _this.props.openWindow(\"window2\", \"textPreview\")\n          })\n        })\n        .catch((e) => {\n          console.log(\"something went wrong\", e)\n          document.getElementById(\"text\").innerHTML = \"\";\n          document.getElementById(\"text\").innerHTML = \"<p>Apologies, the document is not able to be loaded at this time</p>\";\n        })\n      }\n  }\n\n  componentDidUpdate(prevProps, prevState){\n\n    //check to see if doc has changed\n    if (prevProps.doc !== this.props.doc){\n      this.retrieveText(this.props.doc, this.props.scrollTo, this.props.articleType)\n    }\n    // if doc has already been appended, still scroll to target block\n    else{\n      if (this.props.scrollTo !== prevProps.scrollTo){\n        scrollToParagraph(this.props.scrollTo, true)\n      }\n    }\n\n\n    //this.retrieveText(this.props.doc, this.props.topLevel, this.props.scrollTo)\n  }\n\n  componentDidMount(){\n    this.retrieveText(this.props.doc, this.props.scrollTo, this.props.articleType)\n  }\n\n  render(){\n\n    return (\n      <Container>\n        <div id=\"text\"></div>\n      </Container>\n    );\n  }\n}\n\nexport default TextArticle;\n","import React, {useState, useEffect} from 'react';\nimport Container from 'react-bootstrap/Container';\nimport Form from 'react-bootstrap/Form';\nimport {Link} from 'react-router-dom';\nimport Spinner from './Spinner';\nimport {runQuery} from './utils'\nimport {getResources} from '../queries/resourceTypeQuery'\n\n\nconst ResourceTypeList = (props) => {\n  const [resources, setResources] = useState([])\n  const [filter, setFilter] = useState(\"\")\n\n  useEffect(() => {\n    const results = runQuery(getResources(props.resourceTypeId))\n    setResources(\"fetching\")\n    results.then((d) => {\n      setResources(d.data.results.bindings)\n    })\n  }, [props.resourceTypeId])\n  return (\n    <Container className=\"collectionBody\">\n      <h1>{props.resourceTypeId}</h1>\n      <Form.Control as=\"input\" type=\"text\" placeholder=\"filter\" onChange={(e) => setFilter(e.target.value)} value={filter}/>\n      {resources === \"fetching\" ? <Spinner/> :\n      resources.map((r) => {\n        //check against error resources with ids\n        if (r.resource.value !== \"http://scta.info/resource/\"){\n          if (r.resourceTitle.value.toLowerCase().includes(filter.toLowerCase())){\n            return <p key={r.resource.value}><Link to={\"/text?resourceid=\" + r.resource.value}>{r.resourceTitle.value}</Link></p>\n          }\n          else{\n            return null\n          }\n        }\n        else{ \n          return null\n        }\n      })\n    }\n    </Container>\n\n  )\n}\n\nexport default ResourceTypeList;\n","export function getResources(resourceType){\n   const query = [\n     \"SELECT ?resource ?resourceTitle\",\n     \"{\",\n       \"?resource a <\" + resourceType + \"> .\",\n       \"?resource <http://purl.org/dc/elements/1.1/title> ?resourceTitle\",\n      \"}\",\n     \"ORDER BY ?resourceTitle\"].join('')\n  return query\n}\n","import React from 'react';\nimport Qs from \"query-string\";\nimport {Helmet} from \"react-helmet\";\nimport TextWrapper from \"./TextWrapper\"\nimport TextArticle from \"./TextArticle\"\nimport ResourceTypeList from './ResourceTypeList';\n\nimport {runQuery} from './utils'\nimport {getArticleTranscriptionDoc, getItemTranscriptionFromBlockDiv, getStructureType} from './Queries'\n\nclass TextSwitch extends React.Component {\n  constructor(props){\n    super(props)\n    this.handleUpdateUrlResource = this.handleUpdateUrlResource.bind(this)\n    this.state = {\n      displayType: \"\",\n      resourceid: \"\",\n      itemTranscriptionId: \"\",\n      blockDivFocus: \"\",\n      resourceTitle: \"\",\n      author: \"\",\n      authorTitle: \"\",\n      tokenRange: \"\",\n    }\n  }\n\n  handleUpdateUrlResource(fullid){\n    this.props.history.push({search: '?resourceid=' + fullid})\n  }\n  getInfo(resourceid, attemptNumber){\n    let tokenRange;\n    if (resourceid.split(\"@\")[1]){\n      tokenRange = {start: parseInt(resourceid.split(\"@\")[1].split(\"-\")[0]), end: parseInt(resourceid.split(\"@\")[1].split(\"-\")[1])}\n    }\n    resourceid = resourceid.split(\"@\")[0]\n\n    const structureTypePromise = runQuery(getStructureType(resourceid))\n\n    structureTypePromise.then((t) => {\n      // reduce results to bindings variable\n      const bindings = t.data.results.bindings.length > 0 ? t.data.results.bindings[0] : \"\"\n      // get specific results from bindings data\n      const type = bindings.type ? bindings.type.value : null\n      const structureType = bindings.structureType ? bindings.structureType.value : null\n      //const level = bindings.level ? bindings.level.value : null\n      const topLevel = bindings.topLevel ? bindings.topLevel.value : resourceid\n      const itemParent = bindings.itemParent ? bindings.itemParent.value : null\n      const resourceTitle = bindings.resourceTitle ? bindings.resourceTitle.value : \"\"\n      const author = bindings.author ? bindings.author.value : \"\"\n      const authorTitle = bindings.authorTitle ? bindings.authorTitle.value : \"\"\n      const ctranscription = bindings.ctranscription ? bindings.ctranscription.value : \"\"\n\n      //const itemTranscriptionId = t.data.results.bindings[0].ctranscription ? t.data.results.bindings[0].ctranscription.value : null\n      if (resourceid === \"http://scta.info/resource/person\"){\n        this.setState({displayType: \"personList\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: \"\", resourceTitle: \"\"})\n      }\n      else if (resourceid === \"http://scta.info/resource/codex\"){\n        this.setState({displayType: \"codexList\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: \"\", resourceTitle: \"\"})\n      }\n      else if (resourceid === \"http://scta.info/resource/expressionType\"){\n        this.setState({displayType: \"expressionTypeList\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: \"\", resourceTitle: \"\"})\n      }\n      else if (type === \"http://scta.info/resource/expressionType\"){\n        this.setState({displayType: \"expressionType\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: \"\", resourceTitle: \"\"})\n      }\n      else if (type === \"http://scta.info/resource/person\"){\n        this.setState({displayType: \"person\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: type, resourceTitle: resourceTitle})\n      }\n      else if (type === \"http://scta.info/resource/article\"){\n        const structureTypePromise = runQuery(getArticleTranscriptionDoc(resourceid))\n        structureTypePromise.then((t) => {\n          this.setState(\n            {displayType: \"article\",\n            articleDoc: t.data.results.bindings[0] ? t.data.results.bindings[0].doc.value : \"\", // conditional checks in case the query comes up empty; if empty it sets transcription id to \"\"\n            articleType: t.data.results.bindings[0] ? t.data.results.bindings[0].articleType.value : \"\", // conditional checks in case the query comes up empty; if empty it sets transcription id to \"\"\n            resourceid: resourceid,\n            structureType: \"\", topLevel: \"\",\n            type: type,\n            resourceTitle: resourceTitle}\n          )\n        })\n\n      }\n      else if (type === \"http://scta.info/resource/codex\"){\n          this.setState({displayType: \"codex\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: type, resourceTitle: resourceTitle})\n      }\n      else if (type === \"http://scta.info/resource/surface\"){\n          this.setState({displayType: \"surface\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: type, resourceTitle: resourceTitle})\n      }\n      else if (type === \"http://iiif.io/api/presentation/2#Manifest\"){\n          this.setState({displayType: \"manifest\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: type, resourceTitle: resourceTitle})\n      }\n      else if (type === \"http://iiif.io/api/presentation/2#Canvas\"){\n          this.setState({displayType: \"canvas\", resourceid: resourceid, structureType: \"\", topLevel: \"\", type: type, resourceTitle: resourceTitle})\n      }\n      else if (type === \"http://scta.info/resource/workGroup\"){\n          this.setState({displayType: \"workGroup\", resourceid: resourceid, structureType: structureType, topLevel: topLevel, type: type, resourceTitle: resourceTitle})\n      }\n      else if (structureType === \"http://scta.info/resource/structureCollection\"){\n          this.setState({\n            displayType: \"collection\", \n            transcriptionid: ctranscription,\n            resourceid: resourceid, \n            //TODO: this is a hacky way to get expression id; it should be retrievable from the query itself\n            expressionid: \"http://scta.info/resource/\" + resourceid.split(\"/resource/\")[1].split(\"/\")[0],\n            structureType: structureType, \n            topLevel: topLevel, \n            type: type, \n            resourceTitle: resourceTitle, \n            author: author, \n            authorTitle: authorTitle\n          }\n          )\n      }\n      else if (structureType === \"http://scta.info/resource/structureItem\" ){\n       // if (type === \"http://scta.info/resource/transcription\"){\n          this.setState({\n            itemTranscriptionId: ctranscription,\n            displayType: \"item\", \n            resourceid: resourceid, // focused resource introduced via url parameter\n            //TODO: this is a hacky way to get expression id; it should be retrievable from the query itself\n            expressionid: \"http://scta.info/resource/\" + resourceid.split(\"/resource/\")[1].split(\"/\")[0],\n            transcriptionid: ctranscription,\n            resourceTitle: resourceTitle, \n            tokenRange: tokenRange,\n          })\n        }\n      else if (structureType === \"http://scta.info/resource/structureElement\" || structureType === \"http://scta.info/resource/structureBlock\" || structureType === \"http://scta.info/resource/structureDivision\" ){\n        const structureTypePromise = runQuery(getItemTranscriptionFromBlockDiv(resourceid))\n        structureTypePromise.then((t) => {\n          // if transcription\n          if (type === \"http://scta.info/resource/transcription\"){\n            this.setState({\n              itemTranscriptionId: itemParent, \n              resourceid: resourceid, // focused resource introduced via url parameter\n              expressionid: t.data.results.bindings[0].blockDivExpression.value,\n              transcriptionid: resourceid,\n              displayType: \"item\", \n              resourceTitle: resourceTitle, \n              tokenRange: tokenRange\n            })\n          }\n          // if expression\n          else if (type === \"http://scta.info/resource/expression\"){\n            if (t.data.results.bindings[0].ctranscription){\n              this.setState({\n                itemTranscriptionId: t.data.results.bindings[0].ctranscription.value, \n                resourceid: resourceid, // focused resource introduced via url parameter\n                expressionid: resourceid,\n                transcriptionid: \"this would be the focus transcription id\",\n                displayType: \"item\", \n                resourceTitle: resourceTitle, \n                tokenRange: tokenRange})\n            }\n            else{\n              this.setState({displayType: \"notFound\"})\n            }\n          }\n          // if manifestation\n          else {\n            this.setState(\n              {itemTranscriptionId: t.data.results.bindings[0].ctranscription.value, \n              resourceid: resourceid, // focused resource introduced via url parameter\n              expressionid: t.data.results.bindings[0].blockDivExpression.value,\n              transcriptionid: \"this would be the focus transcription id\",\n              displayType: \"item\", \n              resourceTitle: resourceTitle, \n              tokenRange: tokenRange})\n          }\n        });\n      }\n      else{\n        // the secondTryResourceID is meant to be a fallback when a transcription or manifestation fails, \n        // the fall back is meant to revert on available expression id, which will then default to the available canonical manifestation\n        // NOTE: i'm not sure this is the best way to do this, but it seems to work.\n        const secondTryResourceId = resourceid.split(\"/resource/\")[0] + \"/resource/\" + resourceid.split(\"/resource/\")[1].split(\"/\")[0]\n        // NOTE: if secondTryResourceId is different, make a second attempt\n        if (resourceid !== secondTryResourceId){\n          console.log(\"no record for \" + resourceid + \". Trying second attempt with \" + secondTryResourceId)\n          // update with new resource;\n          this.handleUpdateUrlResource(secondTryResourceId)\n        }\n        else{\n          console.log(\"failed on second request\")\n          this.setState({displayType: \"notFound\"})\n        }\n      }\n    });\n  }\n\n  componentDidMount(){\n    // conditional to only get info when props.location exists\n    if (this.props.location){\n      const newResourceId = Qs.parse(this.props.location.search, { ignoreQueryPrefix: true }).resourceid\n      if (newResourceId.includes(\"https://scta.info/\")){\n        this.handleUpdateUrlResource(newResourceId.replace(\"https://scta.info/\", \"http://scta.info/\"))\n      }\n      else{\n        this.getInfo(newResourceId)\n      }\n    }\n  }\n  \n  componentDidUpdate(prevProps) {\n    const newResourceId = Qs.parse(this.props.location.search, { ignoreQueryPrefix: true }).resourceid\n    const oldResourceId = Qs.parse(prevProps.location.search, { ignoreQueryPrefix: true }).resourceid\n    if (newResourceId !== oldResourceId){\n      if (newResourceId.includes(\"https://scta.info/\")){\n        this.handleUpdateUrlResource(newResourceId.replace(\"https://scta.info/\", \"http://scta.info/\"))\n      }\n      else{\n        this.getInfo(newResourceId)\n      }\n    }\n  }\n\n\n\n  render(){\n    const display = () => {\n      if (this.state.displayType === \"personList\"){\n        return (<ResourceTypeList resourceTypeId=\"http://scta.info/resource/person\"/>)\n      }\n      else if (this.state.displayType === \"codexList\"){\n        return (<ResourceTypeList resourceTypeId=\"http://scta.info/resource/codex\"/>)\n      }\n      else if (this.state.displayType === \"expressionTypeList\"){\n        return (<ResourceTypeList resourceTypeId=\"http://scta.info/resource/expressionType\"/>)\n      }\n      else if (this.state.displayType === \"person\"){\n        return (\n        // <AuthorCollection resourceid={this.state.resourceid}/>\n        <TextWrapper \n          resourceid={this.state.resourceid}\n          resourceType=\"person\"\n          handleUpdateUrlResource={this.handleUpdateUrlResource}\n          userId={this.props.userId}\n          />\n        )\n\n      }\n      else if (this.state.displayType === \"article\"){\n        return (<TextArticle doc={this.state.articleDoc} articleType={this.state.articleType}/>)\n\n      }\n      else if (this.state.displayType === \"workGroup\"){\n        //TODO: this conditional should be comined with the conditional below\n        return (\n          // <Collection resourceid={this.state.resourceid} structureType={this.state.structureType} topLevel={this.state.topLevel} type={this.state.type}/>\n        <TextWrapper \n        resourceid={this.state.resourceid}\n        resourceType=\"workGroup\"\n        handleUpdateUrlResource={this.handleUpdateUrlResource}\n        userId={this.props.userId}\n        />\n      )\n      }\n      else if (this.state.displayType === \"collection\"){\n        return (\n          <TextWrapper \n          resourceid={this.state.resourceid}\n          expressionid={this.state.expressionid}\n          transcriptionid={this.state.transcriptionid}\n          resourceType=\"collection\"\n          handleUpdateUrlResource={this.handleUpdateUrlResource}\n          userId={this.props.userId}\n          />\n          )\n      }\n      else if (this.state.displayType === \"item\"){\n        // check to see if a transcription for this text has been found\n        if (this.state.itemTranscriptionId){\n          return (\n            <TextWrapper \n            resourceid={this.state.resourceid}\n            expressionid={this.state.expressionid}\n            transcriptionid={this.state.transcriptionid}\n            tokenRange={this.state.tokenRange}\n            itemTranscriptionId={this.state.itemTranscriptionId}\n            handleUpdateUrlResource={this.handleUpdateUrlResource}\n            userId={this.props.userId}\n            />\n          )\n        }\n        // if no transcription resource id, exists return message\n        else{\n          return (<p>Apologies, no transcriptions of this text are currently available.</p>)\n\n\n        }\n      }\n      else if (this.state.displayType === \"codex\" \n      || this.state.displayType === \"surface\" \n      || this.state.displayType === \"canvas\" \n      || this.state.displayType === \"manifest\"){\n        return (\n        // <Codex codexid={this.state.resourceid}/>\n        <TextWrapper \n        resourceid={this.state.resourceid}\n        resourceType=\"codex\"\n        codexResourceType={this.state.displayType}\n        handleUpdateUrlResource={this.handleUpdateUrlResource}\n        userId={this.props.userId}\n        />\n        \n        )\n      }\n      // else if (this.state.displayType === \"surface\"){\n      //   return (<Codex surfaceid={this.state.resourceid}/>)\n      // }\n      // else if (this.state.displayType === \"canvas\"){\n      //   return (<Codex canvasid={this.state.resourceid}/>)\n      // }\n      // else if (this.state.displayType === \"manifest\"){\n      //   return (<Codex manifestid={this.state.resourceid}/>)\n      // }\n      else if (this.state.displayType === \"expressionType\"){\n        return (\n            <TextWrapper \n            resourceid={this.state.resourceid}\n            resourceType=\"expressionType\"\n            handleUpdateUrlResource={this.handleUpdateUrlResource}\n            userId={this.props.userId}\n            />\n          )\n      }\n      else if (this.state.displayType === \"notFound\"){\n        return (<p>Apologies, this resource could not be found</p>)\n      }\n      else{\n        return null\n      }\n    }\n  const dctype = () => {\n    if (this.state.displayType === \"codex\"){\n      return <meta name=\"BIB.type\" content=\"Manuscript\"/>\n    }\n    else{\n      return <meta name=\"DC.type\" content=\"document\"/>\n    }\n  }\n  return (\n    <div>\n      <Helmet>\n        <title>{this.state.resourceTitle}</title>\n        <link rel=\"schema.DC\" href=\"http://purl.org/dc/elements/1.1/\" ></link>\n        <link rel=\"schema.DCTERMS\" href=\"http://purl.org/dc/terms/\"/>\n        <link rel=\"schema.BIB\" href=\"http://purl.org/net/biblio#\"/>\n        {dctype()}\n        <meta name=\"DC.identifier\" content={this.state.resourceid}/>\n        {//<meta name=\"DC.description\" content=\"test description\"/>\n        }\n        <meta name=\"DC.title\" content={this.state.resourceTitle}/>\n        <meta name=\"DC.creator\" content={this.state.authorTitle}/>\n        <meta name=\"DC.Language\" content=\"la\"/>\n        <meta name=\"DC.Publisher\" content=\"SCTA\"/>\n        \n      </Helmet>\n      {display()}\n    </div>\n    \n    );\n  }\n\n}\n\nexport default TextSwitch;\n","import React from 'react';\n\nfunction About() {\n  return (\n    <div className=\"About\">\n    <h1>About</h1>\n\n    </div>\n  );\n}\n\nexport default About;\n","import React, {useState, useEffect} from 'react';\nimport { firebase, googleAuthProvider } from '../firebase/firebase';\nimport Button from 'react-bootstrap/Button';\n\nfunction LoginPage(props) {\n  const [userDisplayName, setUserDisplayName] = useState(props.user && props.user.displayName);\n  //const [user, setUser] = useState(props.user);\n  const [userPicture, setPicture] = useState(props.user && props.user.photoURL);\n  const startLogin = () => {\n    return firebase.auth().signInWithPopup(googleAuthProvider).then((d) => {\n      setUserDisplayName(d.additionalUserInfo.profile.name)\n      setPicture(d.additionalUserInfo.profile.picture)\n    })\n  }\n  const startLogout = () => {\n    setUserDisplayName()\n      setPicture()\n    return firebase.auth().signOut()\n  }\n  useEffect(() => {\n    setUserDisplayName(props.user && props.user.displayName)\n    //setUser(props.user)\n    setPicture(props.user && props.user.photoURL)\n  }, [props.user])\n  return (\n    <div>\n    {userDisplayName ? <span><span>{userDisplayName}</span> <img src={userPicture} alt=\"usrImage\" height=\"25px\"></img> <Button  size=\"sm\" onClick={startLogout}>Logout</Button> </span> : <Button size=\"sm\" onClick={startLogin}>Login</Button>}\n    </div>\n  );\n}\n\nexport default LoginPage;","import React from 'react';\nimport {NavLink} from 'react-router-dom';\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\n\nimport LoginPage from './LoginPage.js'\nimport {resourceEndpoint} from './config';\nimport {useTranslation} from 'react-i18next'\n\nfunction NavBar(props) {\n  const {t} = useTranslation();\n\n  \n  return (\n    <Navbar bg=\"dark\" variant=\"light\" expand=\"lg\" fixed=\"top\" style={{borderBottom: \"1px solid #dee2e6\"}}>\n      <Nav>\n        <NavLink className=\"nav-link\" to=\"/\">{t(\"Title\")}</NavLink>\n      </Nav>\n      <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n      <Navbar.Collapse id=\"basic-navbar-nav\">\n      <Nav>\n\n\n\n        <NavLink className=\"nav-link\" to={\"/res?resourceid=\" + resourceEndpoint}>{t(\"Texts\")}</NavLink>\n        <NavLink className=\"nav-link\" to={\"/res?resourceid=http://scta.info/resource/person\"}>{t(\"People\")}</NavLink>\n        <NavLink className=\"nav-link\" to={\"/res?resourceid=http://scta.info/resource/codex\"}>{t(\"Codices\")}</NavLink>\n        {// example drop down\n          // <NavDropdown title=\"Dropdown\" id=\"basic-nav-dropdown\">\n        //   <NavDropdown.Item href=\"#action/3.1\">Action</NavDropdown.Item>\n        //   <NavDropdown.Item href=\"#action/3.2\">Another action</NavDropdown.Item>\n        //   <NavDropdown.Item href=\"#action/3.3\">Something</NavDropdown.Item>\n        //   <NavDropdown.Divider />\n        //   <NavDropdown.Item href=\"#action/3.4\">Separated link</NavDropdown.Item>\n        // </NavDropdown>\n      }\n      {/* <NavLink className=\"nav-link\" to=\"/search\">{t(\"Search\")}</NavLink> */}\n      </Nav>\n\n      <Nav>\n        {\n          //<NavLink className=\"nav-link\" to=\"/about\">{t(\"About\")}</NavLink>\n        }\n        <a className=\"nav-link\" href=\"https://secure.qgiv.com/for/givescta\">{t(\"Donate\")}</a>\n      </Nav>\n      \n      </Navbar.Collapse>\n      <Navbar.Collapse id=\"basic-navbar-nav-right\" className=\"float-right\" style={{flexGrow: \"0\"}}>\n      <Nav>\n          <LoginPage user={props.user}/>\n      </Nav>\n      </Navbar.Collapse>\n      \n\n      \n      \n    </Navbar>\n\n  );\n}\n\nexport default NavBar;\n","import React from 'react';\n\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\nimport {useTranslation} from 'react-i18next'\n\nimport MemberBanner from \"./MemberBanner\"\n\n\n\n\nfunction Footer() {\n  const {t} = useTranslation();\n  return (\n\n    <Navbar bg=\"light\" variant=\"light\" expand=\"lg\" fixed=\"bottom\" style={{\"zIndex\": \"1\"}}>\n    <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n    <Navbar.Collapse id=\"basic-navbar-nav\">\n\n    <Nav style={{\"display\": \"flex\", \"justifyContent\": \"space-around\", \"width\": \"100%\"}}>\n      <Nav.Link href=\"http://github.com/lombardpress/lombardpress-webjs\">Lbp-Web.js</Nav.Link>\n      <Nav.Link href=\"http://lombardpress.org\">{t(\"A LombardPress Publication\")}</Nav.Link>\n      <Nav.Link href=\"http://scta.info\">{t(\"Powered by SCTA Data\")} </Nav.Link>\n      <Nav.Link href=\"http://jeffreycwitt.com\">{t(\"Designed by Jeffrey C Witt\")}</Nav.Link>\n      <MemberBanner/>\n    </Nav>\n    \n    </Navbar.Collapse>\n\n    </Navbar>\n\n  );\n}\n\nexport default Footer;\n","import React, {Suspense} from 'react';\nimport {BrowserRouter, Route, Switch} from 'react-router-dom';\nimport Home from \"./Home\"\nimport Search3 from \"./Search3\"\nimport TextSwitch from \"./TextSwitch\"\nimport About from \"./About\"\nimport NavBar from './NavBar';\nimport Spinner from './Spinner';\nimport Footer from './Footer';\n\n\nimport 'bootstrap/dist/css/bootstrap.css'\nimport '../styles/App.scss';\n//import '../styles/index.scss';\n\nconst AppRouter = (props) => {\n  \n  const uid = props.user ? props.user.uid : \"\"\n  return (\n  <Suspense fallback={<Spinner/>}>\n    <BrowserRouter forceRefresh={false}>\n      <div>\n        <NavBar  user={props.user}/>\n        <Switch>\n          <Route path=\"/\" exact={true} render={(props) => <Home {...props} userId={uid}/>}/>\n          <Route path=\"/res\" exact={true} render={(props) => <TextSwitch {...props} userId={uid}/>}/>\n          <Route path=\"/text\"  exact={true} render={(props) => <TextSwitch {...props} userId={uid}/>}/>\n          <Route path=\"/about\" exact={true} render={(props) => <About {...props} userId={uid}/>}/>\n          <Route path=\"/search\" exact={true} render={(props) => <Search3 {...props} userId={uid}/>}/>\n          <Route path=\"/osd\" exact={true} render={(props) => <TextSwitch {...props} userId={uid}/>}/>\n          {\n            //<Route path=\"/edit/:id\" exact={true} component={EditExpensePage}/>\n          //<Route path=\"/help\" exact={true} component={HelpPage}/>\n          // <Route component={NotFoundPage}/>\n          }\n        </Switch>\n        <Footer/>\n      </div>\n    </BrowserRouter>\n  </Suspense>\n)\n}\n\nexport default AppRouter\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\n\nimport Backend from 'i18next-xhr-backend';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n// not like to use this?\n// have a look at the Quick start guide\n// for passing in lng and translations on init\n\ni18n\n  // load translation using xhr -> see /public/locales\n  // learn more: https://github.com/i18next/i18next-xhr-backend\n  .use(Backend)\n  // detect user language\n  // learn more: https://github.com/i18next/i18next-browser-languageDetector\n  .use(LanguageDetector)\n  // pass the i18n instance to react-i18next.\n  .use(initReactI18next)\n  // init i18next\n  // for all options read: https://www.i18next.com/overview/configuration-options\n  .init({\n    fallbackLng: \"en\",\n    debug: true,\n\n    interpolation: {\n      escapeValue: false, // not needed for react as it escapes by default\n    }\n  });\n\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n//import './styles/index.scss';\nimport AppRouter from './components/AppRouter';\nimport * as serviceWorker from './serviceWorker';\nimport './i18n';\nimport './firebase/firebase';\nimport { firebase } from './firebase/firebase';\n\n//ReactDOM.render(<AppRouter/>, document.getElementById('root'));\n\n\nlet hasRendered = false; \nconst renderApp = (user) => {\n  if (!hasRendered){\n    ReactDOM.render(\n      //<React.StrictMode> // commented out because it is causing setStates to run twice; but this should be a problem if my setState functions were pure functions as they should be; but apparently mine are not: see https://github.com/facebook/react/issues/12856#issuecomment-390206425\n        <AppRouter user={user}/>,\n      //</React.StrictMode>\n      document.getElementById('root')\n    );\n    //hasRendered = true\n  }\n}\n\nfirebase.auth().onAuthStateChanged((user) => {\n  if (user){\n    console.log(\"log in\")\n    renderApp(user)\n  }\n  else {\n    console.log(\"log out\")\n    const user = {uid: \"jeff\"}\n    renderApp(user)\n  }\n})\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}